"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[3524],{16519:function(e,t,n){n.d(t,{A:function(){return A}});var r=n(66190),i=n(72714),o=n(2235),a=n(34207),l=n(83590),s=n(24563),c=n(77337),u=n(96421),d=n(34174),m=n(30162),g=n(51654),f=n.n(g),v=n(21758),p=n(50433);function h({error:e,onClose:t}){const{details:n}=null!==e&&void 0!==e?e:{};return v.createElement(i.a,{position:"middle",onClose:t},v.createElement(o.w,null,r.A.t("Error Details")),v.createElement(a.$,null,v.createElement("div",{style:{background:l.T.grey050,padding:24,border:`1px solid ${l.T.grey300}`}},v.createElement("code",{style:{fontSize:14}},JSON.stringify(n)))),v.createElement(s.N,null,v.createElement(c.$,{onClick:t},r.A.t("Close"))))}function A({error:e,resetErrorBoundary:t}){var n,i;const[o,a]=(0,v.useState)(!1),s=(0,p.W6)(),g=()=>{t?t():window.location.reload()};return v.createElement("div",{className:"column center ",style:{height:"100%",textAlign:"center"}},v.createElement(u.o,null,v.createElement("div",{className:"column align-items-center"},v.createElement(m.A,{style:{color:l.T.grey700,fontSize:64},fontSize:"large"}),v.createElement("h2",{style:{color:l.T.grey700,margin:8}},null!==(n=null===e||void 0===e?void 0:e.title)&&void 0!==n?n:r.A.t("Something Went Wrong")),v.createElement("p",{style:{color:l.T.grey700}},"string"===typeof e?e:null===e||void 0===e?void 0:e.message),v.createElement(d.v,{center:!0},404===(null===e||void 0===e||null===(i=e.details)||void 0===i?void 0:i.httpStatusCode)?v.createElement(c.$,{primary:!0,onClick:()=>{s?null===s||void 0===s||s.replace("/"):g()}},r.A.t("Back to scorecard list")):v.createElement(c.$,{onClick:g},r.A.t("Refresh")),(null===e||void 0===e?void 0:e.details)&&v.createElement(c.$,{onClick:()=>a(!0)},r.A.t("View error logs")))),o&&v.createElement(h,{error:e,onClose:()=>a(!1)})))}h.propTypes={error:f().object.isRequired,onClose:f().func.isRequired},A.propTypes={error:f().any,resetErrorBoundary:f().func}},21097:function(e,t,n){n.d(t,{Db:function(){return u},bT:function(){return k},sE:function(){return C},ow:function(){return P},Nm:function(){return w},CH:function(){return I},Hb:function(){return T},Ub:function(){return g},BZ:function(){return s},kp:function(){return D},Ok:function(){return d},lB:function(){return b}});var r=n(4147),i=n(59541),o=n(21758),a=n(65298),l=n(84161);function s(e=""){const[t,n]=(0,o.useState)(e),{state:r,contents:i}=(0,a.useRecoilValueLoadable)((0,l.gT)(t));return{loading:"loading"===r,orgUnits:"hasValue"===r?i:[],error:"hasError"===r?i:void 0,setId:n}}const c={nameQuery:{resource:"organisationUnits",params:({keyword:e})=>({filter:[`displayName:ilike:${e}`],fields:["id","displayName","path","level"]})},idQuery:{resource:"organisationUnits",params:({keyword:e})=>({filter:[`id:ilike:${e}`],fields:["id","displayName","path","level"]})}};async function u(e,t){if(!(0,i.isEmpty)(e)){const l=await t.query(c,{variables:{keyword:e}});if(!(0,i.isEmpty)(l)){var n,r,o,a;const e=null!==(n=null===l||void 0===l||null===(r=l.idQuery)||void 0===r?void 0:r.organisationUnits)&&void 0!==n?n:[],t=null!==(o=null===l||void 0===l||null===(a=l.nameQuery)||void 0===a?void 0:a.organisationUnits)&&void 0!==o?o:[];return[...e,...t].map(e=>({...e,hierarchy:e.displayName}))}}return[]}function d(){const[e,t]=(0,o.useState)(),{data:n,error:a,loading:l,refetch:s}=(0,r.iO)(c,{lazy:!0}),u=(0,o.useRef)((0,i.debounce)(t,1e3,{trailing:!0,leading:!1})),d=(0,o.useMemo)(()=>{if(!(0,i.isEmpty)(n)){var e,t,r,o;return[...null!==(e=null===n||void 0===n||null===(t=n.idQuery)||void 0===t?void 0:t.organisationUnits)&&void 0!==e?e:[],...null!==(r=null===n||void 0===n||null===(o=n.nameQuery)||void 0===o?void 0:o.organisationUnits)&&void 0!==r?r:[]]}return[]},[n]);return(0,o.useEffect)(()=>{(0,i.isEmpty)(e)||s({keyword:e})},[e]),{orgUnits:d,error:a,loading:l,updateKeyword:u.current}}function m(){const{innerWidth:e,innerHeight:t}=window;return{width:e>1366?e:1366,height:(t>763?t:763)-48}}function g(){const[e,t]=(0,o.useState)(m());return(0,o.useLayoutEffect)(()=>{function e(){t(m())}return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e}var f=n(10353),v=n(65859);const p={type:"update",resource:v.ix,id:v.Sd,data:({data:e})=>e};function h(){const[e,t]=(0,o.useState)(),[n,s]=(0,a.useRecoilState)(l.Oj),[c,{error:u,loading:d}]=(0,r.r8)(p),m=(0,a.useRecoilCallback)(({set:e})=>async t=>{try{var r;const o=null!==(r=(0,i.cloneDeep)(n))&&void 0!==r?r:[];o.push(t),await c({data:o}),e(l.Oj,()=>o)}catch(o){console.error(o)}},[n,c]),g=(0,o.useCallback)(async(e,r)=>{try{var o;const t=null!==(o=(0,i.cloneDeep)(n))&&void 0!==o?o:[];t.splice((0,i.findIndex)(t,["id",e]),1,r),await c({data:t}),s(t)}catch(a){t(a)}},[s,n,c]),v=(0,o.useCallback)(async e=>{try{const t=(0,f.Ay)(n,t=>{t.splice((0,i.findIndex)(t,["id",e]),1)});await c({data:t}),s(t)}catch(r){console.error(r),t(r)}},[s,n,c]);return{summary:n,error:null!==e&&void 0!==e?e:u,loading:d,updateSingleScorecardSummary:g,removeSingleScorecardSummary:v,addSingleScorecardSummary:m}}var A=n(31594);const y={scorecard:{resource:v.ix,id:({id:e})=>e}},E={type:"update",resource:v.ix,id:({id:e})=>e,data:({data:e})=>e},S={type:"delete",resource:v.ix,id:({id:e})=>e};function w(e){var t;const[n,i]=(0,o.useState)(),[a,{loading:l,error:s}]=(0,r.r8)(S,{variables:{id:e}}),{removeSingleScorecardSummary:c,error:u}=h();return{remove:async()=>{try{await a({id:e}),await c(e)}catch(t){console.error(t),i(t)}},error:null!==(t=null!==s&&void 0!==s?s:n)&&void 0!==t?t:u,loading:l}}function b(e){const t=(0,a.useSetRecoilState)((0,l.Pn)(e)),[n,{loading:i}]=(0,r.r8)(E,{variables:{id:e}}),{updateSingleScorecardSummary:o}=h();return{update:async r=>{const i=(0,A.gW)(r);await o(e,i),await n({id:e,data:r}),t(e=>e+1)},loading:i}}function k(){const e=(0,r.ow)(),{addSingleScorecardSummary:t}=h();return{add:async n=>{const r=(0,A.gW)(n);await e.mutate((0,A.bD)(null===n||void 0===n?void 0:n.id),{variables:{data:n}}),await t(r)}}}function D(e){const t=(0,a.useSetRecoilState)((0,l.Qs)(e)),{loading:n,data:i,error:s,refetch:c}=(0,r.iO)(y,{lazy:!0});return(0,o.useEffect)(()=>{null!==i&&void 0!==i&&i.scorecard&&t(()=>null===i||void 0===i?void 0:i.scorecard)},[i]),{loading:n,error:s,set:async e=>{await c({id:e})}}}function C(){const{removeSingleScorecardSummary:e,error:t,loading:n,summary:r,updateLoading:i}=h(),{remove:o,loading:a,error:l}=w("");return{scorecards:r,error:null!==t&&void 0!==t?t:l,loading:n,removeLoading:a||i,remove:async t=>{await o({id:t}),await e(t)}}}var U=n(96464),N=n(19984);function T(){(0,N.R)();const{baseUrl:e,apiVersion:t}=(0,r.UK)();U.Fn.init({baseUrl:`${e}/api/${t}/`});const n=(0,r.ow)();return{initializeState:function({set:e}){e(l.jZ,(0,A.YO)()),e(l.Se,n)}}}function I(e){const t=(0,a.useSetRecoilState)((0,l.oL)(e));return{forceUpdate:()=>{t(e=>e+1)}}}function P(){const e=(0,a.useSetRecoilState)(l.Se),t=(0,r.ow)();(0,o.useEffect)(()=>{e(t)},[])}},26802:function(e,t,n){n.r(t),n.d(t,{ACCESS_HELP_STEPS:function(){return r.Lw},ACCESS_TYPES:function(){return r.Zk},ALMA_HEADERS:function(){return r.xT},APP_NAME:function(){return r.C3},APP_TITLE:function(){return r.B_},AccessDeniedPage:function(){return i.p3},AccessTypes:function(){return r.es},AllScorecardsSummaryState:function(){return s.Uz},Area:function(){return u.Gk},AverageDisplayType:function(){return r.uL},Bar:function(){return u.yP},CHART_TYPES:function(){return r.XD},CalendarTypes:function(){return r.eW},Column:function(){return u.VP},ContainerLoader:function(){return i.PG},CustomFunctionsKeysState:function(){return s.mS},CustomFunctionsState:function(){return s.mW},DATASTORE_ENDPOINT:function(){return r.ix},DATASTORE_FUNCTIONS_ENDPOINT:function(){return r.UT},DATASTORE_NAMESPACE:function(){return r.ki},DATASTORE_OLD_SCORECARD_ENDPOINT:function(){return r.B6},DATASTORE_SCORECARD_SUMMARY_INCLUDE_KEYS:function(){return r.Iq},DATASTORE_SCORECARD_SUMMARY_KEY:function(){return r.Sd},DATA_CONFIGURATION_HELP_STEPS:function(){return r.ej},DATA_CONFIGURATION_STEPS_MAP:function(){return r.XR},DATA_CONFIGURATION_WITH_DATA_HELP_STEPS:function(){return r.kN},DATA_MIGRATION_CHECK:function(){return r.Vq},DEFAULT_LAYOUT:function(){return r.zR},DHIS2ValueTypes:function(){return r.x5},DataGroupErrorState:function(){return s.xb},DataModel:function(){return a.QE},DataSelection:function(){return a.ZI},DecreasingArrows:function(){return i.wz},DefaultAuthority:function(){return r.XI},Dotted:function(){return u.Hj},DownloadTypes:function(){return r.R$},DraggableItems:function(){return r.Kg},EngineState:function(){return s.Se},ErrorIcon:function(){return i.IJ},ErrorState:function(){return s.W5},FieldErrorState:function(){return s.Ck},FilterComponentTypes:function(){return r.fg},FormFieldModel:function(){return i.GN},FullPageError:function(){return i.HE},FullPageLoader:function(){return i.AZ},GENERAL_HELP_STEPS:function(){return r.X0},GROUPS_CONFIG_HELP_STEPS:function(){return r.KB},Gauge:function(){return u._I},HIGHLIGHTED_INDICATOR_HELP_STEPS:function(){return r.az},HIGHLIGHTED_TABLE_HELP_STEPS:function(){return r.bx},Help:function(){return i._V},HelpIndex:function(){return s.aN},HelpState:function(){return s.r6},HelpSteps:function(){return s.rZ},HighlightedIndicatorsState:function(){return s.he},INDICATOR_CONFIGURATION_STEPS:function(){return r.nC},INDICATOR_SETUP_HELP_STEPS:function(){return r.uz},INTRODUCTION_HELP_STEPS:function(){return r.dg},IncreasingArrows:function(){return i.Yb},InitialOrgUnits:function(){return s.kg},IsNewScorecardState:function(){return s.c7},IsSpecificTargetsSet:function(){return s.xp},LAYOUTS:function(){return r.my},Line:function(){return u.N1},LinkedCellSvg:function(){return i.Sx},LowestOrgUnitLevel:function(){return s.dw},ModalLoader:function(){return i.VI},NO_GROUPS_HELP_STEPS:function(){return r.Zh},NO_INDICATORS_HELP_STEPS:function(){return r.d8},OPTIONS_HELP_STEPS:function(){return r.NQ},OrgUnit:function(){return s.h7},OrgUnitChildren:function(){return s.gT},OrgUnitGroups:function(){return s.X},OrgUnitLevels:function(){return s.cT},OrgUnitPathState:function(){return s.HN},OrgUnitSelection:function(){return a.vi},Orientation:function(){return r.t4},PREVIEW_TABLE_HELP_STEPS:function(){return r.gA},PeriodCategories:function(){return r.kT},PeriodResolverState:function(){return s.Jv},PeriodSelection:function(){return a.M8},Pie:function(){return u.Fq},REQUIRED_FIELDS:function(){return r.Ws},Radar:function(){return u.Vd},RefreshScorecardState:function(){return s.j$},RouterState:function(){return s.ZK},SCORECARD_DOCUMENTATION_URL:function(){return r.WW},SCORECARD_LIST_HELP_STEPS:function(){return r.W1},SCORECARD_VIEW_HELP_STEPS:function(){return r.dI},STEP_OPTIONS:function(){return r.Sf},SavableDataModel:function(){return a.ed},Scorecard:function(){return a.HI},ScorecardAccess:function(){return a.Ny},ScorecardAccessType:function(){return r.he},ScorecardCardImage:function(){return u.qF},ScorecardConfState:function(){return s.Qs},ScorecardConfigDirtySelector:function(){return s.a5},ScorecardConfigDirtyState:function(){return s.SG},ScorecardConfigEditState:function(){return s.qf},ScorecardConfigErrorSelector:function(){return s.cH},ScorecardConfigErrorState:function(){return s.Yk},ScorecardDataEngine:function(){return a.v5},ScorecardDataLoadingState:function(){return s.Wn},ScorecardDataSourceState:function(){return s.T8},ScorecardForceUpdateState:function(){return s.oL},ScorecardIdState:function(){return s.x9},ScorecardIndicator:function(){return a.w1},ScorecardIndicatorGroup:function(){return a.XA},ScorecardIndicatorHolder:function(){return a._p},ScorecardLegend:function(){return a.ki},ScorecardLegendDefinitionSelector:function(){return s.Ye},ScorecardNameSort:function(){return s.ug},ScorecardOptions:function(){return a.f6},ScorecardOptionsForm:function(){return i.V6},ScorecardOptionsModal:function(){return i.Il},ScorecardOrgUnitState:function(){return s.iH},ScorecardRequestId:function(){return s.Pn},ScorecardSummaryState:function(){return s.Oj},ScorecardTableConfigState:function(){return s.Mj},ScorecardTableConstants:function(){return r.sK},ScorecardTableOrientationState:function(){return s.Qq},ScorecardTableSortState:function(){return s.Qy},ScorecardView:function(){return i.Yc},ScorecardViewState:function(){return s.NP},ScreenDimensionState:function(){return s.jZ},SelectedOrgUnits:function(){return s.ZU},ShouldValidate:function(){return s.Uf},SingleCellSvg:function(){return i.Pj},SingleHighlightedIndicatorState:function(){return s.cX},StackedBar:function(){return u.lV},StackedColumn:function(){return u.gz},SystemSettingsState:function(){return s.SN},TableSort:function(){return r.hn},UNSUPPORTED_PERIOD_TYPES:function(){return r.qR},UserAuthorityOnScorecard:function(){return s.Qg},UserState:function(){return s.bM},accessPageFields:function(){return r.F8},constructAppUrl:function(){return l.QY},dataConfigurationPageFields:function(){return r.fO},generalPageFields:function(){return r.nN},generateCreateMutation:function(){return l.bD},generateLegendDefaults:function(){return l.j9},generateRandomValues:function(){return l.fw},generateScorecardSummary:function(){return l.gW},getColSpanDataGroups:function(){return l.dL},getColSpanWithOrgUnit:function(){return l.Dp},getCustomFunctionAnalytics:function(){return l.ac},getCustomFunctions:function(){return c.pu},getDataSourceDetails:function(){return l.qK},getDataSourceShortName:function(){return l.hL},getDataSourcesDisplayName:function(){return l.iS},getDataSourcesFromGroups:function(){return l.$q},getHighlightedIndicatorsData:function(){return c.WP},getHoldersFromGroups:function(){return l.Ik},getIncreasingStatus:function(){return l.Mq},getLegend:function(){return l.sG},getNameCellWidth:function(){return l.QB},getOrgUnitSelection:function(){return c.jJ},getOrgUnitsFromAnalytics:function(){return c.AM},getScorecard:function(){return c.Dh},getScorecardCellData:function(){return c.fZ},getScorecardData:function(){return c.ZM},getScorecardSummary:function(){return c.dD},getSelectedOrgUnitSelectionDisplay:function(){return l.Sx},getSystemSettings:function(){return c.d5},getTableWidthWithDataGroups:function(){return l.hp},getTableWidthWithOrgUnit:function(){return l.H1},getUserAuthority:function(){return l.t4},getValidationPageFields:function(){return l.Ob},getWindowDimensions:function(){return l.YO},highlightedIndicatorPageFields:function(){return r.zP},isOrgUnitId:function(){return c.Gx},migrateScorecard:function(){return l.Ee},optionsPageFields:function(){return r.LU},restoreScorecardSummary:function(){return c.fh},reverseLegends:function(){return l.jb},scorecardManagementTooltips:function(){return r.KK},searchOrganisationUnit:function(){return o.Db},sortDataSourcesBasedOnData:function(){return l.nZ},sortDataSourcesBasedOnNames:function(){return l.J$},sortOrgUnitsBasedOnData:function(){return l.af},sortOrgUnitsBasedOnNames:function(){return l.sq},specificTargetsSet:function(){return l.X},truncateDescription:function(){return l.Hy},uid:function(){return l.Ld},updateListFromDragAndDrop:function(){return l.cq},updateListsFromDragAndDrop:function(){return l.pk},updatePager:function(){return l.nS},useAddScorecard:function(){return o.bT},useAllScorecards:function(){return o.sE},useDataEngine:function(){return o.ow},useDeleteScorecard:function(){return o.Nm},useForceUpdate:function(){return o.CH},useInitApp:function(){return o.Hb},useMediaQuery:function(){return o.Ub},useOrganisationUnitChildren:function(){return o.BZ},useScorecard:function(){return o.kp},useSearchOrganisationUnit:function(){return o.Ok},useUpdateScorecard:function(){return o.lB},validateGroups:function(){return l.V3},validateScorecard:function(){return l.dG}});var r=n(65859),i=n(74179),o=n(21097),a=n(37973),l=n(31594),s=n(84161),c=n(43861),u=n(55785)},31594:function(e,t,n){n.d(t,{QY:function(){return R},bD:function(){return Q},j9:function(){return p},fw:function(){return v},gW:function(){return j},dL:function(){return z},Dp:function(){return X},ac:function(){return q},qK:function(){return o},hL:function(){return g},iS:function(){return S},$q:function(){return E},Ik:function(){return y},Mq:function(){return $},sG:function(){return D},QB:function(){return Z},Sx:function(){return M},hp:function(){return J},H1:function(){return K},t4:function(){return P},Ob:function(){return re},YO:function(){return m},Ee:function(){return O},jb:function(){return h},nZ:function(){return N},J$:function(){return T},af:function(){return C},sq:function(){return U},X:function(){return A},Hy:function(){return b},Ld:function(){return f},cq:function(){return a},pk:function(){return l},nS:function(){return w},V3:function(){return te},dG:function(){return ne}});const r={object:{resource:"identifiableObjects",id:({id:e})=>e}};function i(e){switch(e){case"indicators":return"indicator";case"dataElements":case"eventDataItems":return"dataElement";case"dataSets":return"dataSet";case"programIndicators":return"programIndicator";default:return e}}async function o(e,t){try{var n;const{object:a}=null!==(n=await e.query(r,{variables:{id:t}}))&&void 0!==n?n:{};if(a.href){var o;return{type:i(function(e){const t=e.split("/");return t[t.length-2]}(a.href)),name:null!==(o=a.displayName)&&void 0!==o?o:a.name}}return null}catch(a){return null}}function a(e,t,n){if(!isNaN(n)&&!isNaN(t)){const r=e[t],i=[...e];return i.splice(t,1),i.splice(n,0,r),i}return e}function l({sourceList:e,destinationList:t},{sourceIndex:n,destinationIndex:r}){if(!isNaN(r)&&!isNaN(n)){const i=e[n],o=[...e],a=[...t];return o.splice(n,1),a.splice(r,0,i),{destinationList:a,sourceList:o}}}var s=n(39398),c=n(59541),u=n(37973),d=n(65859);function m(){const{innerWidth:e,innerHeight:t}=window;return{width:e>1366?e:1366,height:(t>763?t:763)-48}}function g(e=""){return(0,c.snakeCase)(e).split("_").map(e=>(0,c.capitalize)(e)[0]).join("")}function f(){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t="0123456789"+e,n=t.length;let r;r=e.charAt(Math.random()*e.length);for(let i=1;i<11;++i)r+=t.charAt(Math.random()*n);return r}function v(e){const t=e||100;return Math.floor(Math.random()*t)}function p(e=[],t,n=!0){let r=e;if(n||(r=r.reverse()),!(0,c.isEmpty)(r)){var i;const e=null!==t&&void 0!==t?t:100,n=e/(null===(i=r)||void 0===i?void 0:i.length),o=[];let a=r.length-1;for(let t=0;t<e;t+=n){const{id:e}=r[a];o.push(new u.ki({startValue:Math.floor(t),endValue:Math.floor(t+n),legendDefinitionId:e})),a--}return o}return[]}function h(e){}function A(e){return(0,c.reduce)(e,(e,t)=>e||t.specificTargetsSet,!1)}function y(e=[]){var t;return(0,c.flattenDeep)(null!==(t=null===e||void 0===e?void 0:e.map(({dataHolders:e})=>e))&&void 0!==t?t:[])}function E(e){const t=(0,c.compact)(y(e));return(0,c.flattenDeep)(null===t||void 0===t?void 0:t.map(({dataSources:e})=>e))}function S(e){var t,n,r;return(null===e||void 0===e?void 0:e.length)>1?`${null===(t=(0,c.head)(e))||void 0===t?void 0:t.label} / ${null===(n=(0,c.last)(e))||void 0===n?void 0:n.label}`:`${null===(r=(0,c.head)(e))||void 0===r?void 0:r.label}`}function w(e,t){const{page:n,pageSize:r}=e;return{page:n,pageSize:r,pageCount:Math.ceil(t/r),total:t}}function b(e="",t=100){return(0,c.truncate)(e,{length:t})}function k(e,t,{max:n,legendDefinitions:r}){var i;if((t=+t)>n)return(0,c.find)(r,{id:"N/A"});if(isNaN(t))return(0,c.find)(r,{id:"No Data"});const{legendDefinitionId:o}=null!==(i=(0,c.find)(e,e=>{if(e){const{startValue:r,endValue:i}=e;return+i===n?+r<=t&&+i>=t:+r<=t&&+i>t}return!1}))&&void 0!==i?i:{};return(0,c.find)(r,["id",o])}function D(e,t,{max:n=100,orgUnitLevels:r=[],dataOrgUnitLevel:i,legendDefinitions:o,specificTargets:a,period:l,orgUnit:s}){if(!(0,c.isEmpty)(a)){const r=(0,c.head)(a);if(r){if("period"===r.type){var u;const i=null!==(u=function(e,t){if(e.items.includes(t))return e.legends}(r,l))&&void 0!==u?u:t;return k(i,e,{max:n,legendDefinitions:o})}if("orgUnit"===r.type){var d;const i=null!==(d=function(e,t){if(e.items.includes(t))return e.legends}(r,s))&&void 0!==d?d:t;return k(i,e,{max:n,legendDefinitions:o})}}}if(Array.isArray(t)){return k([...t],e,{max:n,legendDefinitions:o})}if("object"===typeof t){const a=function(e,t){var n;return null===(n=(0,c.find)(e,["level",t]))||void 0===n?void 0:n.id}(r,i);if(a){return k(t[a],e,{max:n,legendDefinitions:o})}}}function C({orgUnitSort:e,filteredOrgUnits:t,childrenOrgUnits:n}){const r=[],i=[];for(const o of e)r.push((0,c.find)(t,["id",o])),i.push((0,c.find)(n,["id",o]));return{parentOrgUnits:(0,c.uniqBy)((0,c.compact)([...r,...t]),"id"),childOrgUnits:(0,c.uniqBy)((0,c.compact)([...i,...n]),"id")}}function U({sort:e,filteredOrgUnits:t,childrenOrgUnits:n}){let r=n,i=t;return e===d.hn.ASC&&(r=(0,c.sortBy)(n,"displayName")),e===d.hn.DESC&&(r=(0,c.sortBy)(n,"displayName").reverse()),e===d.hn.ASC&&(i=(0,c.sortBy)(t,"displayName")),e===d.hn.DESC&&(i=(0,c.sortBy)(t,"displayName").reverse()),{childOrgUnits:r,parentOrgUnits:i}}function N({dataSort:e,dataSources:t}){const n=[];for(const r of e)n.push((0,c.find)(t,({dataSources:e})=>!!(0,c.find)(e,["id",r])));return(0,c.uniqBy)(n,"id")}function T({sort:e,dataSources:t}){let n=t;return e===d.hn.ASC&&(n=(0,c.sortBy)(t,"displayName")),e===d.hn.DESC&&(n=(0,c.sortBy)(t,"displayName").reverse()),n}function I(e=""){const t={read:!1,write:!1};return e.includes("r")&&(t.read=!0),e.includes("w")&&(t.write=!0),t}function P(e,t){const{user:n,userAccesses:r,userGroupAccesses:i,publicAccess:o}=null!==t&&void 0!==t?t:{};if((null===e||void 0===e?void 0:e.id)===n)return{...I("rw-----"),delete:!0};if(!(0,c.isEmpty)(r)){const t=(0,c.find)(r,["id",null===e||void 0===e?void 0:e.id]);if(t)return I(null===t||void 0===t?void 0:t.access)}if(!(0,c.isEmpty)(i)){const t=(0,c.intersectionBy)([...i],[...e.userGroups],"id");if(!(0,c.isEmpty)(t)){const e=t.map(({access:e})=>e).map(I);return{read:(0,c.reduce)(e,(e,t)=>e||t.read,!1),write:(0,c.reduce)(e,(e,t)=>e||t.write,!1)}}}return o?I(null===o||void 0===o?void 0:o.access):d.XI}function R(e,t,n){let r=e;const i=n.major>=2&&n.minor>=35,o=(i?t.name:t.title).replace(/[^A-Za-z0-9\s-]/g,"").replace(/\s+/g,"-");t.coreApp&&i?r+=`/dhis-web-${o}/`:r+=`/api/apps/${o}/`,i||(r+="index.html");const a=r.substr(0,r.indexOf("://")+3);return r=a+r.substr(a.length).replace(/\/+/g,"/"),r}async function O(e,t){try{var n,r,i,o,a,l,u,d,m,g,f;if(e)return{id:null===e||void 0===e?void 0:e.id,name:null===e||void 0===e||null===(n=e.header)||void 0===n?void 0:n.title,title:null===e||void 0===e||null===(r=e.header)||void 0===r?void 0:r.title,subtitle:null===e||void 0===e||null===(i=e.header)||void 0===i?void 0:i.sub_title,description:null===e||void 0===e||null===(o=e.header)||void 0===o?void 0:o.description,user:{id:null===e||void 0===e||null===(a=e.user)||void 0===a?void 0:a.id},periodType:null===e||void 0===e?void 0:e.periodType,customHeader:null===e||void 0===e||null===(l=e.header)||void 0===l||null===(u=l.template)||void 0===u?void 0:u.content,publicAccess:G(null===e||void 0===e?void 0:e.user_groups),userAccesses:[],userGroupAccesses:_(null===e||void 0===e?void 0:e.user_groups),targetOnLevels:!1,periodSelection:(p=e.selected_periods,h=e.periodType,{periods:p.map(e=>({id:e.id,name:e.name})),type:h}),orgUnitSelection:x(e.orgunit_settings),dataSelection:await L(e.data_settings,t),additionalLabels:e.additional_labels,legendDefinitions:(v=null===e||void 0===e?void 0:e.legendset_definitions,(v||[]).map(e=>{const t=(0,c.has)(e,"default");return t?{id:e.definition,color:e.color,name:e.definition,isDefault:e.default}:{id:e.color,color:e.color,name:e.definition}})),options:{title:!0,legend:null===e||void 0===e||null===(d=e.header)||void 0===d?void 0:d.show_legend_definition,emptyRows:null===e||void 0===e?void 0:e.empty_rows,averageRow:null===e||void 0===e?void 0:e.show_average_in_row,itemNumber:!0,averageColumn:null===e||void 0===e?void 0:e.show_average_in_column,showHierarchy:null===e||void 0===e?void 0:e.show_hierarchy,averageDisplayType:null===e||void 0===e||null===(m=e.average_selection)||void 0===m?void 0:m.toUpperCase(),highlightedIndicators:null===e||void 0===e||null===(g=e.highlighted_indicators)||void 0===g?void 0:g.display},highlightedIndicators:await(0,s.Tj)((null===e||void 0===e||null===(f=e.highlighted_indicators)||void 0===f?void 0:f.definitions)||[],async e=>await F(e,t))}}catch(A){console.error(A)}var v,p,h}async function L(e,t){return{dataGroups:await(0,s.Tj)((null===e||void 0===e?void 0:e.indicator_holder_groups)||[],async n=>({id:null===n||void 0===n?void 0:n.id,style:{color:"#000000",backgroundColor:n.background_color},title:null===n||void 0===n?void 0:n.name,dataHolders:(0,c.compact)(await(0,s.Tj)(null===n||void 0===n?void 0:n.indicator_holder_ids,async n=>await async function(e,t,n){var r;const i=(0,c.find)(e,["holder_id",t]);return i?{id:i.holder_id,dataSources:await(0,s.Tj)(null!==(r=i.indicators)&&void 0!==r?r:[],async e=>await F(e,n))}:void 0}(e.indicator_holders,n,t)))}))}}async function F(e,t){var n,r,i,a;const{name:l,type:s}=null!==(n=await o(t,e.id))&&void 0!==n?n:{};return{id:e.id,name:null!==(r=e.title)&&void 0!==r?r:l,type:null!==s&&void 0!==s?s:"customFunction",label:e.title,weight:e.weight,legends:e.legendset.map(e=>({id:f(),legendDefinitionId:null===e||void 0===e?void 0:e.color,endValue:"string"===typeof(null===e||void 0===e?void 0:e.max)?parseFloat(null===e||void 0===e?void 0:e.max):null===e||void 0===e?void 0:e.max,startValue:"string"===typeof(null===e||void 0===e?void 0:e.min)?parseFloat(null===e||void 0===e?void 0:e.min):e.min})),highIsGood:null===e||void 0===e?void 0:e.high_is_good,showColors:null===e||void 0===e?void 0:e.legend_display,effectiveGap:(null===e||void 0===e||null===(i=e.arrow_settings)||void 0===i?void 0:i.effective_gap)||5,displayArrows:null===e||void 0===e||null===(a=e.arrow_settings)||void 0===a?void 0:a.display}}function x(e){var t,n,r;return{groups:(null===e||void 0===e||null===(t=e.selected_groups)||void 0===t?void 0:t.map(e=>null===e||void 0===e?void 0:e.id))||[],levels:(null===e||void 0===e||null===(n=e.selected_levels)||void 0===n?void 0:n.map(e=>null===e||void 0===e?void 0:e.id))||[],orgUnits:null===e||void 0===e||null===(r=e.selected_orgunits)||void 0===r?void 0:r.map(e=>({id:e.id})),userOrgUnit:Boolean((0,c.find)(null===e||void 0===e?void 0:e.selected_user_orgunit,["id","USER_ORGUNIT"])),userSubUnit:Boolean((0,c.find)(null===e||void 0===e?void 0:e.selected_user_orgunit,["id","USER_ORGUNIT_CHILDREN"])),userSubX2Unit:Boolean((0,c.find)(null===e||void 0===e?void 0:e.selected_user_orgunit,["id","USER_ORGUNIT_GRANDCHILDREN"]))}}function G(e){return{id:"public",type:"public",access:B((0,c.find)(e,["id","all"])),displayName:"Public"}}function _(e){const t=null===e||void 0===e?void 0:e.filter(e=>"all"!==e.id);return null===t||void 0===t?void 0:t.map(e=>({id:null===e||void 0===e?void 0:e.id,type:"userGroup",access:B(e),displayName:null===e||void 0===e?void 0:e.name}))}function B(e){return null!==e&&void 0!==e&&e.see?"r-----":"------"}var V=n(66190);function M(e,{orgUnitLevels:t,orgUnitGroups:n}){const{orgUnits:r,levels:i,groups:o,userOrgUnit:a,userSubUnit:l,userSubX2Unit:s}=e,u=[...r];return a&&u.push({name:V.A.t("User Organisation Unit")}),l&&u.push({name:V.A.t("User Sub-units")}),s&&u.push({name:V.A.t("User Sub-x2-units")}),(0,c.isEmpty)(i)||u.push({name:`Levels: ${null===i||void 0===i?void 0:i.map(e=>{var n;return(null!==(n=(0,c.find)(t,["id",e]))&&void 0!==n?n:{}).displayName})}`}),(0,c.isEmpty)(o)||u.push({name:`Groups: ${null===o||void 0===o?void 0:o.map(e=>(0,c.find)(n,["id",e]).displayName)}`}),u}function j(e){const t={};for(const n of d.Iq)t[n.key]=(0,c.get)(e,n.path);return t}const Q=e=>({type:"create",resource:`${d.ix}/${e}`,data:({data:e})=>e}),Y={function:{resource:"dataStore/functions",id:({id:e})=>e}};async function H({customFunction:e,ruleId:t,orgUnits:n,periods:r}){try{if(e){const o=(0,c.find)(null===e||void 0===e?void 0:e.rules,{id:t});if(o){var i;const t=await async function({orgUnits:e,periods:t,rule:n,code:r,progress:i}){const o={ou:e.join(";"),pe:t.join(";"),rule:n,layout:{rows:["dx"],column:["ou"],filter:["pe"]},progress:i};return await new Promise((e,t)=>{try{Function("parameters",`${r}`)({...o,success:e,error:e=>{t(e||"Unknown error")}})}catch(n){t(n)}setTimeout(()=>{t("Function timed out")},6e4)})}({orgUnits:n,periods:r,rule:{...o,json:"string"===typeof o.json?JSON.parse(o.json):o.json},code:null!==(i=null===e||void 0===e?void 0:e.function)&&void 0!==i?i:"",progress:()=>{}});if(t)return function(e,{customFunction:t,rule:n}){var r,i,o;const a={...e},l=`${t.id}.${n.id}`,s=(0,c.findIndex)(null===a||void 0===a?void 0:a.headers,{name:"dx"});return(0,c.set)(a,"metaData.dimensions.dx",[l]),a.metaData.items[l]={name:`${t.name} - ${n.name}`},a.metaData.names={},(0,c.forIn)(null===a||void 0===a||null===(r=a.metaData)||void 0===r?void 0:r.items,(e,t)=>{a.metaData.names[t]=null===e||void 0===e?void 0:e.name}),(0,c.forIn)(null===(i=a.metaData)||void 0===i?void 0:i.dimensions,(e,t)=>{a.metaData[t]=e}),(0,c.set)(a,"rows",null===a||void 0===a||null===(o=a.rows)||void 0===o?void 0:o.map(e=>{const t=[...e];return(0,c.set)(t,s,l),t})),a}(t,{customFunction:e,rule:o})}}}catch(o){return console.error(o),null}return null}async function W(e,t,{periods:n,orgUnits:r}){try{if(e){var i,o;const[a,l]=null!==(i=null===e||void 0===e?void 0:e.split("."))&&void 0!==i?i:[],{function:s}=null!==(o=await async function(e,t){return await e.query(Y,{variables:{id:t}})}(t,a))&&void 0!==o?o:{};return await H({customFunction:s,ruleId:l,periods:n,orgUnits:r})}}catch(a){console.error(a)}}async function q(e,{functions:t,periods:n,orgUnits:r}){try{if(t&&!(0,c.isEmpty)(t)){const i=(0,c.compact)(await Promise.all(t.map(t=>W(t,e,{periods:n,orgUnits:r}))));return(0,c.reduce)(i,(e,t)=>(0,c.mergeWith)(e,t,(e,t)=>{if(Array.isArray(e))return e.concat(t)}),{})}}catch(i){console.error(i)}}function J(e=[],t=[],n){return 105*z(e,t,n)+200}function z(e=[],t=[],n){const r=(null===e||void 0===e?void 0:e.length)||1;return t.reduce((e,t)=>{var n;return e+(null===(n=t.dataHolders)||void 0===n?void 0:n.length)},0)*r+(n?1:0)}function K(e,t,n){return 105*X(e,t,n)+200}function X(e,t,n){const r=(null===e||void 0===e?void 0:e.length)||1;return(t.length||1)*r+(n?1:0)}function Z(e,t){const n=function(e,t){return d.sK.CELL_WIDTH*t}(0,t),r=100-n/e*100;return r>30?"30%":r>10?`${Math.abs(r)}%`:"200px"}function $(e,t,n){const r=parseFloat(e),i=parseFloat(t);if(Math.abs(r-i)>=parseInt(n)){if(r>i)return"increasing";if(r<i)return"decreasing"}return null}function ee(e,t=[]){const n={};return(0,c.forIn)(e,(r,i)=>{t.includes(i)&&(0,c.isEmpty)((0,c.get)(e,i))&&(n[`${i}`]=V.A.t("This field is required"))}),n}function te(e=[]){const t={};for(const n of e)(0,c.isEmpty)(n.dataHolders)&&(t[n.id]=V.A.t("This group does not have any configured data sources"));return t}function ne(e){var t,n;return null!==(t={...ee(e,d.Ws),...te(null===e||void 0===e||null===(n=e.dataSelection)||void 0===n?void 0:n.dataGroups)})&&void 0!==t?t:{}}function re(e,t){switch(t.id){case"general":return d.nN;case"dataConfiguration":return d.fO;case"highlightedIndicator":return d.zP;case"access":return d.F8;case"options":return d.LU;default:return[]}}},37973:function(e,t,n){n.d(t,{QE:function(){return o},ZI:function(){return l},vi:function(){return s},M8:function(){return u},ed:function(){return a},HI:function(){return v},Ny:function(){return m},v5:function(){return U},w1:function(){return N},XA:function(){return P},_p:function(){return T},ki:function(){return I},f6:function(){return g}});var r=n(10353),i=n(59541);class o{constructor(e={}){(0,i.defaultsDeep)(this,e,this.defaults)}get defaults(){return{}}static set(e,t,n){if(t){const r=(0,i.cloneDeep)(e);return r[t]=n,r}return this}static setObject(e,t={}){const n=(0,i.cloneDeep)(e);for(const r of Object.keys(t))n[r]=t[r];return n}}class a extends o{static async save(e,t,n){const i=(0,r.Ay)(JSON.parse(JSON.stringify(e)),e=>{e.user={id:null===n||void 0===n?void 0:n.id}});return await t(i)}static async update(e,t){return await t(JSON.parse(JSON.stringify(e)))}}class l extends o{get defaults(){return{dataGroups:[]}}}class s extends o{get defaults(){return{levels:[],groups:[],orgUnits:[],userSubX2Unit:!1,userSubUnit:!1,userOrgUnit:!1}}}class c{constructor(e){this.selectionItem=e}get id(){return this.selectionItem?this.selectionItem.id:void 0}get name(){return this.selectionItem?this.selectionItem.name:void 0}get type(){return this.selectionItem?this.selectionItem.type:void 0}}class u{constructor(e){this.periodSelection=e}get items(){return(this.periodSelection?this.periodSelection.items:[]).map(e=>new c(e))}}var d=n(65859);class m extends o{get defaults(){return{id:void 0,type:"userGroup",access:d.he.NO_ACCESS,displayName:""}}}class g extends o{get defaults(){return{averageDisplayType:d.uL.ALL,legend:!0,title:!0,itemNumber:!0,emptyRows:!0,showHierarchy:!1,averageColumn:!1,averageRow:!1,highlightedIndicators:!1}}}var f=n(31594);class v extends a{get defaults(){return{id:(0,f.Ld)(),name:"",title:"",subtitle:"",description:"",customHeader:"",periodType:"",legendDefinitions:[],dataSelection:new l,orgUnitSelection:new s,periodSelection:new u,options:new g,highlightedIndicators:[],publicAccess:new m,userGroupAccesses:[],userAccesses:[],user:{},targetOnLevels:!1,additionalLabels:[]}}}var p=n(96464),h=n(2793),A=n(22732),y=n.n(A),E=n(74096),S=n(41381),w=n(56850),b=n(7354),k=n(50374),D=n.n(k);function C(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class U{constructor(){C(this,"engine",void 0),C(this,"_cancelled",!1),C(this,"_totalRequests",0),C(this,"_progress",0),C(this,"_progress$",new E.t),C(this,"_dataEntities",{}),C(this,"_dataEntities$",new E.t(this._dataEntities)),C(this,"dataEntities$",this._dataEntities$.asObservable()),C(this,"_previousPeriods",[]),C(this,"_calendar",void 0),C(this,"_loading$",new E.t),this._cancelled=!1}get loading$(){return this._loading$.asObservable()}get _canLoadData(){var e,t,n,r;return(null===(e=this._selectedOrgUnits)||void 0===e?void 0:e.length)>0&&(null===(t=this._selectedPeriods)||void 0===t?void 0:t.length)>0&&((null===(n=this._selectedData.normalDataItems)||void 0===n?void 0:n.length)>0||(null===(r=this._selectedData.customDataItems)||void 0===r?void 0:r.length)>0)}setDataQueryEngine(e){return this.engine=e,this}setPeriodType(e){return this._periodType=e,this._selectedPeriods=this._getSelectedPeriods(this._selectedPeriods,e),this}refresh(){return this.reset(!1),this.load(),this}setPeriods(e){var t,n;let r=[];return this._selectedPeriods=(0,i.uniqBy)((e||[]).map(e=>{const t=(new h.aA).setPreferences({allowFuturePeriods:!0}).setCalendar(this._calendar).getById(null===e||void 0===e?void 0:e.id);return r=[...r,null===t||void 0===t?void 0:t.lastPeriod],t||e}),"id"),r.forEach(e=>{(0,i.find)(this._selectedPeriods,["id",null===e||void 0===e?void 0:e.id])||(this._selectedPeriods=(0,i.compact)([...this._selectedPeriods,e]))}),this._previousPeriods=null!==(t=(0,i.compact)(null===(n=(0,i.differenceBy)(r,e,"id"))||void 0===n?void 0:n.map(e=>null===e||void 0===e?void 0:e.id)))&&void 0!==t?t:[],this}setCalendar(e){return this._calendar=e,this}setDataGroups(e){return this._selectedData=this._getSelectedData(e),this}setOrgUnits(e){return this._selectedOrgUnits=e,this}_updateDataEntities(e){(e||[]).forEach(t=>{var n,r,o,a,l;const s=`${null===t||void 0===t||null===(n=t.dx)||void 0===n?void 0:n.id}_${null===t||void 0===t||null===(r=t.ou)||void 0===r?void 0:r.id}_${null===t||void 0===t||null===(o=t.pe)||void 0===o?void 0:o.id}`,c=null===(a=(0,i.find)(this._selectedPeriods,["id",null===t||void 0===t||null===(l=t.pe)||void 0===l?void 0:l.id]))||void 0===a?void 0:a.lastPeriod,u=e.find(e=>{var n,r,i,o,a;return(null===e||void 0===e||null===(n=e.dx)||void 0===n?void 0:n.id)===(null===t||void 0===t||null===(r=t.dx)||void 0===r?void 0:r.id)&&(null===e||void 0===e||null===(i=e.ou)||void 0===i?void 0:i.id)===(null===t||void 0===t||null===(o=t.ou)||void 0===o?void 0:o.id)&&(null===e||void 0===e||null===(a=e.pe)||void 0===a?void 0:a.id)===(null===c||void 0===c?void 0:c.id)});this._dataEntities={...this._dataEntities||{},[s]:{current:t.value,previous:null===u||void 0===u?void 0:u.value}},this._dataEntities$.next(this._dataEntities)})}load(){this._canLoadData&&(this._loading$.next(!0),this._cancelled=!1,this._progress=0,this._progress$.next(this._progress),this._getScorecardData({selectedOrgUnits:this._selectedOrgUnits.map(e=>null===e||void 0===e?void 0:e.id),selectedPeriods:this._selectedPeriods.map(e=>null===e||void 0===e?void 0:e.id),selectedData:this._selectedData}))}getProgress(){return this._progress$.pipe((0,w.T)(e=>Math.floor(e/this._totalRequests*100)))}isRowEmpty(e=""){return this.dataEntities$.pipe((0,w.T)(t=>{const n=(0,i.pickBy)(t,(t,n)=>n.match(RegExp(e)));return(0,i.isEmpty)(n)}))}isDataSourcesRowEmpty(e=[]){return this.dataEntities$.pipe((0,w.T)(t=>{const n=(0,i.pickBy)(t,(t,n)=>n.match(RegExp((0,i.head)(e)))||n.match(RegExp((0,i.last)(e))));return(0,i.isEmpty)(n)}))}sortOrgUnitsByDataAndPeriod({dataSource:e,period:t,sortType:n}){return this.dataEntities$.pipe((0,b.s)(1),(0,w.T)(r=>{if(n===d.hn.DEFAULT)return[];const o=(0,i.pickBy)(r,(n,r)=>{const[i,,o]=r.split("_");return i===e&&o===t}),a=(0,i.sortBy)((0,i.toPairs)(o),[e=>{var t;return+(null===(t=(0,i.last)(e))||void 0===t?void 0:t.current)}]);return n===d.hn.DESC?a.reverse().map(([e])=>null===e||void 0===e?void 0:e.split("_")[1]):a.map(([e])=>null===e||void 0===e?void 0:e.split("_")[1])}))}sortOrgUnitsByData({dataSource:e,periods:t=[],sortType:n}){return this.dataEntities$.pipe((0,b.s)(1),(0,w.T)(r=>{if(n===d.hn.DEFAULT)return[];const o=(0,i.pickBy)(r,(n,r)=>{const[i,,o]=r.split("_");return i===e&&t.includes(o)}),a=(0,i.groupBy)((0,i.toPairs)(o),e=>{var t;return(null===(t=(0,i.head)(e))||void 0===t?void 0:t.split("_"))[1]}),l={};(0,i.forIn)(a,(e,n)=>{l[n]=(0,i.reduce)(e,(e,n)=>{var r;return e+(null===(r=(0,i.last)(n))||void 0===r?void 0:r.current)/(null===t||void 0===t?void 0:t.length)},0)});const s=(0,i.sortBy)((0,i.toPairs)(l),[e=>(0,i.last)(e)]);var c;return n===d.hn.DESC?null===s||void 0===s||null===(c=s.map(([e])=>e))||void 0===c?void 0:c.reverse():null===s||void 0===s?void 0:s.map(([e])=>e)}))}sortDataSourceByOrgUnitAndPeriod({orgUnit:e,period:t,sortType:n}){return this.dataEntities$.pipe((0,b.s)(1),(0,w.T)(r=>{if(n===d.hn.DEFAULT)return[];const o=(0,i.pickBy)(r,(n,r)=>{const[,i,o]=r.split("_");return i===e&&o===t}),a=(0,i.sortBy)((0,i.toPairs)(o),[e=>{var t;return parseInt(null===(t=(0,i.last)(e))||void 0===t?void 0:t.current)}]);return n===d.hn.DESC?a.reverse().map(([e])=>null===e||void 0===e?void 0:e.split("_")[0]):a.map(([e])=>null===e||void 0===e?void 0:e.split("_")[0])}))}sortDataSourceByOrgUnit({periods:e,orgUnit:t,sortType:n}){return this.dataEntities$.pipe((0,b.s)(1),(0,w.T)(r=>{if(n===d.hn.DEFAULT)return[];const o=(0,i.pickBy)(r,(n,r)=>{const[,i,o]=r.split("_");return i===t&&e.includes(o)}),a=(0,i.groupBy)((0,i.toPairs)(o),e=>{var t;return(null===(t=(0,i.head)(e))||void 0===t?void 0:t.split("_"))[0]}),l={};(0,i.forIn)(a,(t,n)=>{l[n]=(0,i.reduce)(t,(t,n)=>{var r;return t+(null===(r=(0,i.last)(n))||void 0===r?void 0:r.current)/(null===e||void 0===e?void 0:e.length)},0)});const s=(0,i.sortBy)((0,i.toPairs)(l),[e=>(0,i.last)(e)]);var c;return n===d.hn.DESC?null===s||void 0===s||null===(c=s.map(([e])=>e))||void 0===c?void 0:c.reverse():null===s||void 0===s?void 0:s.map(([e])=>e)}))}getOrgUnitAverage(e=""){return this.dataEntities$.pipe((0,w.T)(t=>{var n;const r=(0,i.pickBy)(t,(t,n)=>{const[,r,o]=n.split("_");return r===e&&!this._previousPeriods.includes(o)&&!!(0,i.find)(this._selectedPeriods,e=>(null===e||void 0===e?void 0:e.id)===o)}),o=Object.keys(r).length;if(0!==(null===(n=(0,i.compact)(Object.values(r).map(({current:e})=>e)))||void 0===n?void 0:n.length))return(0,i.reduce)(r,(e,t)=>(null!==e&&void 0!==e?e:0)+t.current/o,0)}))}getDataSourceAverage(e=[]){return this.dataEntities$.pipe((0,w.T)(t=>{const n={};for(const o of e){var r;const e=(0,i.pickBy)(t,(e,t)=>{var n;const[r,a,l]=t.split("_");return o===r&&!this._previousPeriods.includes(l)&&!!(0,i.find)(this._selectedPeriods,e=>(null===e||void 0===e?void 0:e.id)===l)&&(null===(n=this._selectedOrgUnits)||void 0===n?void 0:n.map(e=>null===e||void 0===e?void 0:e.id).includes(a))}),a=Object.keys(e).length;0===(null===(r=(0,i.compact)(Object.values(e).map(({current:e})=>e)))||void 0===r?void 0:r.length)?n[o]=void 0:n[o]=(0,i.reduce)(e,(e,t)=>(null!==e&&void 0!==e?e:0)+t.current/a,0)}return n}))}getOrgUnitColumnAverage({period:e,orgUnit:t}){return this.dataEntities$.pipe((0,w.T)(n=>{var r;const o=(0,i.pickBy)(n,(n,r)=>{const[,i,o]=r.split("_");return i===t&&o===e}),a=Object.keys(o).length;if(0!==(null===(r=(0,i.compact)(Object.values(o).map(({current:e})=>e)))||void 0===r?void 0:r.length))return(0,i.reduce)(o,(e,t)=>(null!==e&&void 0!==e?e:0)+t.current/a,0)}))}getDataSourceColumnAverage({period:e,dataSources:t,orgUnits:n}){return this.dataEntities$.pipe((0,w.T)(r=>{const o={};for(const l of t){var a;const t=(0,i.pickBy)(r,(t,r)=>{const[i,o,a]=r.split("_");return l===i&&a===e&&(null===n||void 0===n?void 0:n.includes(o))}),s=Object.keys(t).length;0===(null===(a=(0,i.compact)(Object.values(t).map(({current:e})=>e)))||void 0===a?void 0:a.length)?o[l]=void 0:o[l]=(0,i.reduce)(t,(e,t)=>(null!==e&&void 0!==e?e:0)+t.current/s,0)}return o}))}getOverallAverage(e){return this.dataEntities$.pipe((0,w.T)(t=>{if(!(0,i.isEmpty)(t)){var n;const r=(0,i.pickBy)(t,(t,n)=>{const[,r,o]=n.split("_");return(null===e||void 0===e?void 0:e.includes(r))&&!this._previousPeriods.includes(o)&&!!(0,i.find)(this._selectedPeriods,e=>(null===e||void 0===e?void 0:e.id)===o)}),o=Object.keys(r).length;if(0===(null===(n=(0,i.compact)(Object.values(r).map(({current:e})=>e)))||void 0===n?void 0:n.length))return;return(0,i.reduce)(r,(e,t)=>(null!==e&&void 0!==e?e:0)+t.current/o,0)}}))}getAllOrgUnitData(e){return this.dataEntities$.pipe((0,w.T)(t=>(0,i.pickBy)(t,(t,n)=>{const[,r]=n.split("_");return null===e||void 0===e?void 0:e.includes(r)})))}get(e){return this.dataEntities$.pipe((0,w.T)(t=>t?t[e]:null))}reset(e=!1){this._totalRequests=0,this._progress=0,this._progress$=new E.t,this._loading$=new E.t,this._dataEntities={},this._dataEntities$=new E.t(this._dataEntities),this.dataEntities$=this._dataEntities$.asObservable(),this._previousPeriods=[],this._dataEntities={},this._cancelled=e}_getScorecardData(e){const{selectedOrgUnits:t,selectedPeriods:n,selectedData:r}=e,{normalDataItems:i,customDataItems:o}=r;this._getNormalScorecardData({selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:i}),this._getCustomScorecardData({selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:o})}_getAnalyticsData(e){if(!this._cancelled){var t,n,r,o,a;let l=[],s=[],c=[];return(e||[]).forEach(e=>{this._dataEntities[`${e.dx}_${e.ou}_${e.pe}`]||(l=[...l,e.dx],s=[...s,e.ou],c=[...c,e.pe])}),l=(0,i.uniq)(l),s=(0,i.uniq)(s),c=(0,i.uniq)(c),0===(null===(t=l)||void 0===t?void 0:t.length)&&0===(null===(n=s)||void 0===n?void 0:n.length)&&0===(null===(r=c)||void 0===r?void 0:r.length)?(0,S.of)(null).toPromise():(new p.Fn.Analytics).setOrgUnit(null===(o=s)||void 0===o?void 0:o.join(";")).setPeriod(null===(a=c)||void 0===a?void 0:a.join(";")).setData(l.join(";")).postProcess(e=>{this._updateDataEntities(null===e||void 0===e?void 0:e.rows)}).get()}return(0,S.of)(null).toPromise()}_getCustomAnalyticsData(e){if(!this._cancelled){var t,n,r;let o=[],a=[],l=[];return(e||[]).forEach(e=>{this._dataEntities[`${e.dx}_${e.ou}_${e.pe}`]||(o=[...o,e.dx],a=[...a,e.ou],l=[...l,e.pe])}),o=(0,i.uniq)(o),a=(0,i.uniq)(a),l=(0,i.uniq)(l),0===(null===(t=o)||void 0===t?void 0:t.length)&&0===(null===(n=a)||void 0===n?void 0:n.length)&&0===(null===(r=l)||void 0===r?void 0:r.length)?(0,S.of)(null).toPromise():getCustomFunctionAnalytics(this.engine,{functions:o,orgUnits:a,periods:l})}return(0,S.of)(null).toPromise()}_getNormalScorecardData(e){var t;const{selectedOrgUnits:n,selectedPeriods:r,selectedDataItems:o}=null!==e&&void 0!==e?e:{};let a=[];n.forEach(e=>{(0,i.chunk)(o.map(t=>r.map(n=>({dx:t.id,ou:e,pe:n}))),2).forEach(e=>{a=[...a,(0,i.flatten)(e)]})}),this._totalRequests=null===(t=a)||void 0===t?void 0:t.length,y()(a,10,(e,t)=>{this._getAnalyticsData(e).then(e=>{this._progress=this._progress+1,this._progress$.next(this._progress),t(null,e)}).catch(e=>{t(e,null)})},(e,t)=>{this._loading$.next(!1)})}_getCustomScorecardData(e){window.$=D();const{selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:r}=null!==e&&void 0!==e?e:{};if(0===(null===r||void 0===r?void 0:r.length))return new Promise(e=>e(null));let o=[];t.forEach(e=>{(0,i.chunk)(r.map(t=>n.map(n=>({dx:t.id,ou:e,pe:n}))),2).forEach(e=>{o=[...o,(0,i.flatten)(e)]})}),y()(o,10,(e,t)=>{this._getCustomAnalyticsData(e).then(e=>{var n,r;this._updateDataEntities(null!==(n=null===e||void 0===e||null===(r=e.rows)||void 0===r?void 0:r.map(([e,t,n,r])=>(0,i.fromPairs)([["dx",{id:e}],["pe",{id:t}],["ou",{id:n}],["value",`${r}`]])))&&void 0!==n?n:[]),this._progress=this._progress+1,this._progress$.next(this._progress),t(null,e)}).catch(e=>{t(e,null)})})}_getSelectedPeriods(e,t){if((null===e||void 0===e?void 0:e.length)>0)return e;try{var n,r,i;const e=null===(n=new h.aA)||void 0===n||null===(r=n.setPreferences({allowFuturePeriods:!0}).setType(t))||void 0===r||null===(i=r.get())||void 0===i?void 0:i.list(),o=e?e[0]:null;return[o,...null!==o&&void 0!==o&&o.lastPeriod?[null===o||void 0===o?void 0:o.lastPeriod]:[]]}catch(o){return console.warn(o),null}}_getSelectedData(e){const t=(0,i.flatten)((e||[]).map(e=>(0,i.flatten)(((null===e||void 0===e?void 0:e.dataHolders)||[]).map(e=>e.dataSources))));return{normalDataItems:t.filter(e=>"customFunction"!==e.type),customDataItems:t.filter(e=>"customFunction"===e.type)}}}class N extends o{get defaults(){return{id:(0,f.Ld)(),type:"",label:"",name:"",weight:100,effectiveGap:5,displayArrows:!0,highIsGood:!0,showColors:!0,legends:[],specificTargets:[],specificTargetsSet:!1}}}class T extends o{constructor(e){super(e)}get defaults(){return{id:(0,f.Ld)(),dataSources:[]}}static linkDataSource(e=new T,t=new N){return T.set(e,"dataSources",[...e.dataSources,t])}}class I extends o{get defaults(){return{id:(0,f.Ld)(),legendDefinitionId:"",startValue:null,endValue:null}}}class P extends o{constructor(e){super(e)}get defaults(){return{id:(0,f.Ld)(),title:"",dataHolders:[],style:{backgroundColor:"#FFFFFF",color:"#000000"}}}}},43861:function(e,t,n){n.d(t,{pu:function(){return i},WP:function(){return c},jJ:function(){return k},AM:function(){return f},Dh:function(){return w},fZ:function(){return s},ZM:function(){return u},dD:function(){return N},d5:function(){return A},Gx:function(){return v},fh:function(){return R}});const r=(e=[])=>{const t={};for(const n of e)t[n]={resource:`dataStore/functions/${n}`};return t};async function i(e=[],t){const n=r(e);return await t.query(n)}var o=n(96464),a=n(2793),l=n(59541);async function s({orgUnit:e,periods:t,dataSources:n}){try{const r=null===t||void 0===t?void 0:t.map(e=>{var t;const n=(new a.aA).setPreferences({allowFuturePeriods:!0}).getById(e);return null===n||void 0===n||null===(t=n.lastPeriod)||void 0===t?void 0:t.id}),i=(0,l.uniq)([...t,...r]);return await(new o.Fn.Analytics).setOrgUnit(e).setPeriod(null===i||void 0===i?void 0:i.join(";")).setData(n.join(";")).get()}catch(r){console.error(r)}}async function c({orgUnits:e,periods:t,highlightedIndicators:n}){try{return await(new o.Fn.Analytics).setOrgUnit(null===e||void 0===e?void 0:e.join(";")).setPeriod(null===t||void 0===t?void 0:t.join(";")).setData(null===n||void 0===n?void 0:n.join(";")).get()}catch(r){console.error(r)}}async function u(e){const t=function(e){var t;let n=[];e.userOrgUnit&&(n=["USER_ORGUNIT"]);e.userSubUnit&&(n=[...n,"USER_ORGUNIT_CHILDREN"]);e.userSubX2Unit&&(n=[...n,"USER_ORGUNIT_GRANDCHILDREN"]);(null===e||void 0===e||null===(t=e.orgUnitIds)||void 0===t?void 0:t.length)>0&&(n=null===e||void 0===e?void 0:e.orgUnitIds);return n}(e.orgUnitSelection),{currentPeriods:n,previousPeriods:r}=function(e,t){try{var n,r,i,o;const e=null===(n=(new a.aA).setPreferences({allowFuturePeriods:!0}))||void 0===n||null===(r=n.setType(t))||void 0===r||null===(i=r.get())||void 0===i?void 0:i.list(),l=e?e[0]:null;return{currentPeriods:l?[l.id]:[],previousPeriods:null!==l&&void 0!==l&&l.lastPeriod?[null===(o=l.lastPeriod)||void 0===o?void 0:o.id]:[]}}catch(l){return console.warn(l),null}}(e.periodSelection,e.periodType),i=function(e){const t=(0,l.flatten)(null===e||void 0===e?void 0:e.dataGroups.map(e=>(0,l.flatten)(((null===e||void 0===e?void 0:e.dataHolders)||[]).map(e=>e.dataSources))));return{normalDataItems:t.filter(e=>"functionRule"!==e.type),customDataItems:t.filter(e=>"functionRule"===e.type)}}(e.dataSelection);return Promise.all([d({selectedOrgUnits:t,selectedPeriods:n,selectedData:i}),d({selectedOrgUnits:t,selectedPeriods:r,selectedData:i})])}function d(e){const{selectedOrgUnits:t,selectedPeriods:n,selectedData:r}=e,{normalDataItems:i,customDataItems:o}=r;return new Promise((e,r)=>{Promise.all([m({selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:i}),g({selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:o})]).then(t=>{e(t)}).catch(e=>{r(e)})})}function m(e){const{selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:r}=e;return(new o.Fn.Analytics).setOrgUnit(null===t||void 0===t?void 0:t.join(";")).setPeriod(null===n||void 0===n?void 0:n.join(";")).setData(r.map(e=>e.id).join(";")).get()}function g(e){const{selectedOrgUnits:t,selectedPeriods:n,selectedDataItems:r}=e;if(0===(null===r||void 0===r?void 0:r.length))return new Promise(e=>e(null));new Promise(e=>e(null))}function f(e){var t;const{metaData:n}=null!==e&&void 0!==e?e:{},{ouHierarchy:r,items:i,ouNameHierarchy:o,dimensions:a}=null!==n&&void 0!==n?n:{},s=(0,l.omitBy)(r,e=>!e);return null===a||void 0===a||null===(t=a.ou)||void 0===t?void 0:t.map(e=>{var t,n,r,a,l,c;const u=`${null!==(t=null===s||void 0===s?void 0:s[e])&&void 0!==t?t:""}/${e}`;return{id:e,displayName:null===i||void 0===i||null===(n=i[e])||void 0===n?void 0:n.name,path:u.startsWith("/")?u:`/${u}`,level:(null!==(r=null===s||void 0===s||null===(a=s[e])||void 0===a||null===(l=a.split("/"))||void 0===l?void 0:l.length)&&void 0!==r?r:0)+1,hierarchy:null===o||void 0===o||null===(c=o[e])||void 0===c?void 0:c.replace("/","")}})}function v(e){return!e.match(/(LEVEL-)|(USER_)|(OU_GROUP-)\w+/)}const p=["keyCalendar"],h={system:{resource:"systemSettings",params:({keys:e})=>({keys:null===e||void 0===e?void 0:e.map(e=>`key=${e}`)})}};async function A(e){const{system:t}=await e.query(h,{variables:{keys:p}}),{keyCalendar:n}=null!==t&&void 0!==t?t:{};return{calendar:n}}var y=n(65859),E=n(37973);const S={scorecard:{resource:y.ix,id:({id:e})=>e}};async function w(e="",t){if(e)try{const n=await t.query(S,{variables:{id:e}});return{scorecard:function(e){var t;const{dataGroups:n}=null!==(t=e.dataSelection)&&void 0!==t?t:{},r=n.map(e=>({...e,dataHolders:(0,l.compact)(null===e||void 0===e?void 0:e.dataHolders)}));return{...e,dataSelection:{dataGroups:r}}}(null===n||void 0===n?void 0:n.scorecard)}}catch(n){return{error:n}}return{error:"not found"}}const b={orgUnits:{resource:"organisationUnits",params:({orgUnits:e})=>({filter:[`id:in:[${null===e||void 0===e?void 0:e.join(",")}]`],fields:["path","displayName","level","id"]})}};async function k({orgUnitSelection:e},t){var n;const{orgUnits:r}=null!==e&&void 0!==e?e:{},{orgUnits:i}=await t.query(b,{variables:{orgUnits:null!==(n=null===r||void 0===r?void 0:r.map(({id:e})=>e))&&void 0!==n?n:[]}});return new E.vi({...e,orgUnits:null===i||void 0===i?void 0:i.organisationUnits})}var D=n(31594);const C={summary:{resource:y.ix,id:y.Sd}},U={type:"create",resource:`${y.ix}/${y.Sd}`,data:({data:e})=>e};async function N(e){try{const t=await e.query(C);return{summary:null===t||void 0===t?void 0:t.summary}}catch(n){var t;return 404===(null===n||void 0===n||null===(t=n.details)||void 0===t?void 0:t.httpStatusCode)?(await async function(e){return await e.mutate(U,{variables:{data:[]}})}(e),N(e)):{error:n}}}const T={scorecards:{resource:y.ix}},I={type:"update",resource:y.ix,id:y.Sd,data:({data:e})=>e},P={scorecard:{resource:y.ix,id:({id:e})=>e}},R=async e=>{const{summary:t,error:n}=await N(e);if(!n){const{scorecards:n}=await e.query(T),r=(0,l.filter)(n,e=>"settings"!==e&&"savedObjects"!==e);if(!(0,l.isEmpty)(r)){const n=(0,l.filter)(r,e=>{var n;return!(null!==t&&void 0!==t&&null!==(n=t.map(({id:e})=>e))&&void 0!==n&&n.includes(e))});if(!(0,l.isEmpty)(n)){const r=[...t];for(const t of n){const{scorecard:n}=await e.query(P,{variables:{id:t}}),i=(0,D.gW)(n);r.push(i)}await e.mutate(I,{variables:{data:r.filter(e=>!(0,l.isEmpty)((0,l.compact)(Object.values(e))))}})}}}}},49927:function(e,t,n){n.d(t,{Y:function(){return a},w:function(){return l}});var r=n(51654),i=n.n(r),o=n(21758);const a=({x:e,y:t,decreasing:n,fontSize:r})=>o.createElement("path",{d:`M ${e} ${t} L ${e-r/2} ${t+r} L ${e+r/2} ${t+r} Z`,fill:"black",transform:n&&"rotate(90)"});a.propTypes={fontSize:i().number.isRequired,x:i().number.isRequired,y:i().number.isRequired,decreasing:i().bool};const l=({x:e,y:t,fontSize:n})=>o.createElement("path",{d:`M ${e} ${t} L ${e-n/2} ${t-n} L ${e+n/2} ${t-n} Z`,fill:"black"});l.propTypes={fontSize:i().number.isRequired,x:i().number.isRequired,y:i().number.isRequired}},55785:function(e,t,n){n.d(t,{Gk:function(){return i},yP:function(){return o},VP:function(){return a},Hj:function(){return c},_I:function(){return u},N1:function(){return l},Fq:function(){return s},Vd:function(){return d},qF:function(){return r},lV:function(){return m},gz:function(){return g}});n(21758);var r=n.p+"static/media/img.b7f44bd30d62ad7a852a.png",i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QgBCigg8qRFlwAABGRJREFUaN7tmF1MW2UYx//v+ejpJ+uKVArrB1K+JnM1GwIGHYnxwk4mF154Rbj2wsGFCashkBnjLkxG4kxMjJnGmMy4RAQ7EmdCh94MXPy4IYtL1opCKCsc6MeBlnNeL5Als3z0tHXpSfq/anrePu/zO//3ed/nLVBWWUWTPxD07X7mtAjw6tBkN8uwX1DQTwH8qjmQ3tFpq7yVHCGEDDAsA1mWHz5jtALRc+FGL81IC4IgvDlzxgOTyfTIc67gN5ROXSaUhhjK3hq/9Eq46C4MTXkoiyuUKmedTieueBkANGtcQSBKRpoUdLoOAG+k02l97/DUXXlbngKY8cn3/bcKhTgXCJ6nhL6n1+v5rzrtB47lCphkjCFMx/UuB7cbZyDMNK1EH7jjifjAa+/cSAIkRBX5a7Vu+QNBH0fIhyyYdnedix/zKIf+Ji+QnkCwH8D58e5jj3w/5lEAj00P2NAd500NkfWza+L6S2rcOhcIjgAYtZjN21+22ThAySkn1SD+QNBHgKuNjQ0A0vuOC1kyCLUaARj1ubi1u6UShqkWT9VhwpJRlRuntrhpOjVjt1fhg2NpVS/gMLcUWWmy25/AJ61GABnVq0QVCM1IMwajwbgzWf7ay63PnBQiS/OOyamoi6sMIcevddjZYm+xuRRzUUB6AsF+AvR/0+0s2QOTUVfcpSvu0FOV0B8djmrVxV0yjvSOTlspi6DZbNZ/3Kwr+V5sXxAqb33E85x351CCNkF6Lnw3QCh9/XqXQweNiNnr0kIIuez11msGIqvY/YGgjyVkUgvFDSYDzvSgOsuR3tFpq45lrlmPWgU1xT0kLj12hreiv4Cr/AE643JzliNKOjXA87zzc18Fn0uw4XgKf61NYFFJo08EBK4CZqEJZr0b71qMRU9+OJ5CLHkbic0FcEdsMCgcNvdbWoJOlwZwaBaDK/OIJOdwoq4eJ+u9SG5KWIhGsRiLIBKbQ18MqDA0wCx4cMnqKAhgSFxCLHEbke0NPOWowYuu52GzWPD9z7NYy7dpHEnIWBQnkWIz8LfvBAQAk96AZpcbzS43AGBhJYrl1Rgi0Z/QJ0p5uTW4Mo916TdECUWLy4UW92noOL7wpnFwZR73k3NodrrwTL33wKDOKjucVXacbmpR5dZIQkYsOYsN6Q9smyrQ1tKIekdtcZrGiykei+K3SJEkXj7VhieP2lQtjVzdim/dxf3tDdRV16L9uPp5DgR5ezWMexszqKm0o+tE54Eu5Kq93FpaDaPGXgVvrQ8mvaF4TePFFI+/1yYQU0ScOfksnFX2/2Ub/a9bRe1+h8Ql3BNv/uvCC0Vx4bGe7KwQt3KVv5ujGwl0Pt2ac5GVHIhQ8adPMEqs/7nOvNdpyTSNBt6gSYgsEArt6iEI4aUwgbylpeQJL4WzQHghGSYM3dQSCC8kwzn/i6LZG2IZpAxSBimDlEHKIPneRxJSynzzzqwmEhcT8b1BFCihTAZYXl3TjAsKlBDKKlH9A2uhxAYqDYPmAAAAAElFTkSuQmCC",o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QgBCi0ogQg54AAAAF1JREFUaN7t1sENABEARUHUowxlK0M/uxU4kAhi3nUddiKRH4Ik7Sx2v9T2bfmjkuPI8XT7DQAAAAAAvA2QrhlzgyPNKwQAAAAAYMxJJ425RWPQKwQAAAAAIEma7gd8qAk6zZ+mSwAAAABJRU5ErkJggg==",a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QgBCi4J5kx6fQAAAF5JREFUaN7t1sEJwCAMQNEojtMxOrZjdJ+6QA9CKaHk/bMHHxE1QpIya+k7mNe9te48Hvfa/z4BAIDqgPHV7WACAAAAAAAAr17ihL+9IwQAAAAAAAAAAAAAAAAgSWVa3dEJTJ4U+r4AAAAASUVORK5CYII=",l="data:image/png;base64,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",s="data:image/png;base64,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",c="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAGpSURBVFiF7Zg9S8NQFIbfJjdJFRzt0NXFj9oPQfwCcat2VFz9G9Z/UP0jpQgODkrBQRR1cNBqRScHUYe6ilKbpC7toHipJ/dckqHPGMLl4eQ95x4CRJwYAORL5/VqcT4VpsjKztmII+xd1/NHhWncvzexfrQ1/Wh0PCfClAMAx7IrhVwyvb2RG1jOJjND8XYZAIywxbq0XD+1mEqYg47A0mTCbLbaGSBCgo6I3ZzUG57r+Ti+bXi2ZVwDgAhbrMvnl796cPW6v3f5lI4LUXM/WmuAZkFZ8P9693Bz9hnA1O/nWj+xLPgUtArKgk9BbwUlwaegNYOy4JPJly7azG5skCpI6Uqu80gZ5OhK6nkkQY6upJ5HqyBDV1LPI2WQrSup50W5iyOzzcjQvs2ojibtFVQdTdoFVUeT/goqjibtGVQdTVJBrntXtin/F+kn5r53gyIV5L53gyKvIPO9GxRpBqnh5t4VewpSw+1YdqWQTaYXxofN07u3TLX2UgYwoyrINgd1ZZZNUFdm2QY19674g/4+qEBfUJXIC3Z+okeySR6qxbmxsCV68g24XGzi2T5o8AAAAABJRU5ErkJggg==",u="data:image/png;base64,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",d="data:image/png;base64,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",m="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QgBCisuPjE7UwAAAGhJREFUaN7t1sEJgCAAhlFtCZdwjGjooE08tElN4EE9pPTetZA+AvlDAPhSrD047+vpOfAoaeyL9hxbXt9W/wMCBAgQIODfAbDMmGscaW4hAQIECBBgzMFMY25UZQy6hQQIECBAAADdXkveDzotuZk2AAAAAElFTkSuQmCC",g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4QgBCiwieMbhvwAAAG5JREFUaN7t1sENQDAAhtESozgaQwwtxrCEKTi6ODQR+YP3nWn60qZtKZKUrInPYFn3qu/G4XKu7dtXAADg74DuqdPBCgAAAAAAANy6iQNve1sIAMApdDb3W9UAU+AfWwgAAAAAAAAA4CMAScp2AMTtD3X9QcAUAAAAAElFTkSuQmCC"},61476:function(e,t,n){n.d(t,{c:function(){return k},A:function(){return D}});var r=n(66190),i=n(72714),o=n(2235),a=n(34207),l=n(41887),s=n(24563),c=n(77337),u=n(59541),d=n(51654),m=n.n(d),g=n(21758),f=n(65298),v=n(83590),p=n(2793),h=n(84161);function A({legends:e}){const t=(0,f.useRecoilValue)((0,h.NP)("legendDefinitions"));return g.createElement("div",{className:"column gap-8"},g.createElement("table",null,g.createElement("col",{width:"60%"}),g.createElement("col",{width:"20%"}),g.createElement("col",{width:"20%"}),g.createElement("thead",null,g.createElement("tr",null,g.createElement("th",{align:"left"},r.A.t("Legend")),g.createElement("th",null,r.A.t("Min")),g.createElement("th",null,r.A.t("Max")))),g.createElement("tbody",null,null===e||void 0===e?void 0:e.map(e=>{const n=(0,u.find)(t,{id:e.legendDefinitionId});return g.createElement("tr",{key:`${e.id}-view`},g.createElement("td",null,g.createElement("table",null,g.createElement("col",{width:"20%"}),g.createElement("col",{width:"80%"}),g.createElement("tbody",null,g.createElement("tr",null,g.createElement("td",null,g.createElement("div",{style:{height:24,width:32,background:n.color}})),g.createElement("td",null,n.name))))),g.createElement("td",{align:"center"},null===e||void 0===e?void 0:e.startValue),g.createElement("td",{align:"center"},null===e||void 0===e?void 0:e.endValue))}))))}function y({dataSourceLabel:e,specificTarget:t}){var n;const{items:i,legends:o}=null!==t&&void 0!==t?t:{},a=(0,f.useRecoilValue)((0,h.ZU)(i));return g.createElement("div",{style:{maxWidth:350,border:`1px solid ${v.T.grey600}`,borderRadius:4},className:"column gap-16 p-16"},g.createElement("div",{className:"column gap-16"},g.createElement("div",null,g.createElement("b",null,r.A.t("Organisation Unit(s)"),": ")," ",null===a||void 0===a||null===(n=a.map(e=>e.displayName))||void 0===n?void 0:n.join(", ")),g.createElement("div",null,g.createElement("b",null,r.A.t("Data Source"),": "),e)),g.createElement(A,{legends:o}))}function E({dataSourceLabel:e,specificTarget:t}){var n;const{items:i,legends:o}=null!==t&&void 0!==t?t:{};return g.createElement("div",{style:{maxWidth:350,border:`1px solid ${v.T.grey600}`,borderRadius:4},className:"column gap-16 p-16"},g.createElement("div",{className:"column gap-16"},g.createElement("div",null,g.createElement("b",null,r.A.t("Period"),": ")," ",null===i||void 0===i||null===(n=i.map(e=>{var t;return null===(t=(new p.aA).setPreferences({allowFuturePeriods:!0}).getById(e))||void 0===t?void 0:t.name}))||void 0===n?void 0:n.join(", ")),g.createElement("div",null,g.createElement("b",null,r.A.t("Data Source"),": "),e)),g.createElement(A,{legends:o}))}function S({dataSourceLabel:e,legends:t}){const n=(0,f.useRecoilValue)(h.cT);return g.createElement(g.Fragment,null,g.createElement("div",{className:"row gap-16 page-break-avoid"},null===n||void 0===n?void 0:n.map(n=>{var i;return g.createElement(g.Fragment,null,g.createElement("div",{key:`${n.id}- specific-level-view`,style:{maxWidth:350,border:`1px solid ${v.T.grey600}`,borderRadius:4},className:"column gap-16 p-16"},g.createElement("div",{className:"column gap-16"},g.createElement("div",null,g.createElement("b",null,r.A.t("Organisation Unit Level"),": ")," ",null!==(i=n.displayName)&&void 0!==i?i:n.name),g.createElement("div",null,g.createElement("b",null,r.A.t("Data Source"),": "),e)),g.createElement(A,{legends:t[n.id]})),g.createElement("div",{className:"page-break"}))})),g.createElement("div",{className:"page-break"}))}A.propTypes={legends:m().array},S.propTypes={dataSourceLabel:m().string,legends:m().object},y.propTypes={dataSourceLabel:m().string,specificTarget:m().object},E.propTypes={dataSourceLabel:m().string,specificTarget:m().object};var w={"specific-targets-lib":"SpecificTargetsLibrary_specific-targets-lib__Fce6Y"},b=n(31594);function k(){var e,t,n;const{dataGroups:i}=(0,f.useRecoilValue)((0,h.NP)("dataSelection")),o=(0,g.useMemo)(()=>(0,b.$q)(i),[i]),a=(0,g.useMemo)(()=>{const e=(0,u.filter)(o,e=>e.specificTargetsSet),t=(0,u.groupBy)((0,u.filter)(e,e=>!(0,u.isEmpty)(e.specificTargets)),e=>{var t;return null===(t=(0,u.head)(e.specificTargets))||void 0===t?void 0:t.type});return t.orgUnitLevel=e.filter(e=>(0,u.isEmpty)(e.specificTargets)),t},[o]);return g.createElement(g.Fragment,null,g.createElement("div",{className:"column gap-16"},!(0,u.isEmpty)(null===a||void 0===a?void 0:a.orgUnit)&&g.createElement("div",null,g.createElement("h3",null,r.A.t("Organisation Units Specific targets")),g.createElement("div",{className:"row gap-16"},null===a||void 0===a||null===(e=a.orgUnit)||void 0===e?void 0:e.map(e=>g.createElement(g.Fragment,null,g.createElement(y,{key:`${e.id}-orgUnit-specific-target`,specificTarget:(0,u.head)(e.specificTargets),dataSourceLabel:e.label}),g.createElement("div",{className:"page-break"})))),g.createElement("div",{className:"page-break"})),!(0,u.isEmpty)(null===a||void 0===a?void 0:a.period)&&g.createElement("div",null,g.createElement("h3",null,r.A.t("Period Specific targets")),g.createElement("div",{className:"row gap-16"},null===a||void 0===a||null===(t=a.period)||void 0===t?void 0:t.map(e=>g.createElement(g.Fragment,null,g.createElement(E,{key:`${e.id}-orgUnit-specific-target`,specificTarget:(0,u.head)(e.specificTargets),dataSourceLabel:e.label}),g.createElement("div",{className:"page-break"})))),g.createElement("div",{className:"page-break"})),!(0,u.isEmpty)(null===a||void 0===a?void 0:a.orgUnitLevell)&&g.createElement("div",null,g.createElement("h3",null,r.A.t("Organisation unit level targets")),g.createElement("div",{className:"column gap-16"},null===a||void 0===a||null===(n=a.orgUnitLevel)||void 0===n?void 0:n.map(e=>g.createElement(S,{key:`${e.id}-orgUnit-specific-target`,legends:e.legends,dataSourceLabel:e.label}))),g.createElement("div",{className:"page-break"}))))}function D({open:e,onClose:t}){return g.createElement(i.a,{onClose:t,className:w["specific-targets-lib"],large:!0,position:"middle",hide:!e},g.createElement(o.w,null,"Specific Targets Library"),g.createElement(a.$,null,g.createElement(g.Suspense,{fallback:g.createElement("div",{className:"column align-items-center justify-content-center",style:{height:"60vh",width:"100%"}},g.createElement(l.F,{small:!0}))},g.createElement(k,null))),g.createElement(s.N,null,g.createElement(c.$,{onClick:t},r.A.t("Cancel"))))}D.propTypes={open:m().bool.isRequired,onClose:m().func.isRequired}},65859:function(e,t,n){n.d(t,{Lw:function(){return se},Zk:function(){return M},xT:function(){return m},C3:function(){return r},B_:function(){return i},es:function(){return V},uL:function(){return W},XD:function(){return p},eW:function(){return g},ix:function(){return a},UT:function(){return u},ki:function(){return o},B6:function(){return c},Iq:function(){return s},Sd:function(){return l},ej:function(){return ie},XR:function(){return oe},kN:function(){return ne},Vq:function(){return O},zR:function(){return R},x5:function(){return E},XI:function(){return B},R$:function(){return h},Kg:function(){return A},fg:function(){return j},X0:function(){return z},KB:function(){return $},az:function(){return ae},bx:function(){return le},nC:function(){return re},uz:function(){return te},dg:function(){return K},my:function(){return P},Zh:function(){return Z},d8:function(){return ee},NQ:function(){return ce},t4:function(){return L},gA:function(){return X},kT:function(){return F},Ws:function(){return y},WW:function(){return d},W1:function(){return J},dI:function(){return ue},Sf:function(){return q},he:function(){return _},sK:function(){return Q},hn:function(){return Y},qR:function(){return x},F8:function(){return k},fO:function(){return w},nN:function(){return S},zP:function(){return b},LU:function(){return D},KK:function(){return de}});const r="hisptz-scorecard",i="Interactive Scorecard",o="hisptz-scorecard",a="dataStore/hisptz-scorecard",l="scorecard-summary",s=[{key:"title",path:["title"]},{key:"description",path:["description"]},{key:"id",path:["id"]},{key:"user",path:["user","id"]},{key:"userAccesses",path:["userAccesses"]},{key:"userGroupAccesses",path:["userGroupAccesses"]},{key:"publicAccess",path:["publicAccess"]},{key:"additionalLabels",path:["additionalLabels"]}],c="dataStore/scorecards",u="dataStore/functions",d="https://docs.dhis2.org/en/use/optional-apps/interactive-scorecard-app/app-version-01/scorecard-and-demo.html",m=[{name:"dx",column:"Data",valueType:"TEXT",type:"java.lang.String",hidden:!1,meta:!0},{name:"pe",column:"Period",valueType:"TEXT",type:"java.lang.String",hidden:!1,meta:!0},{name:"ou",column:"Organisation unit",valueType:"TEXT",type:"java.lang.String",hidden:!1,meta:!0},{name:"value",column:"Value",valueType:"NUMBER",type:"java.lang.Double",hidden:!1,meta:!1}],g={ETHIOPIAN:"ethiopian",GREGORIAN:"gregorian"};var f=n(66190),v=n(55785);const p=[{type:"column",description:f.A.t("Column chart"),icon:v.VP},{type:"line",description:f.A.t("Line chart"),icon:v.Hj},{type:"bar",description:f.A.t("Bar chart"),icon:v.yP},{type:"area",description:f.A.t("Area chart"),icon:v.Gk},{type:"pie",description:f.A.t("Pie chart"),icon:v.Fq}],h={EXCEL:"Excel",PDF:"PDF",CSV:"CSV"},A={DATA_COLUMN:"dataColumn",ORG_UNIT_COLUMN:"orgUnitColumn",DATA_ROW:"dataRow",ORG_UNIT_ROW:"orgUnitRow",OU_LAYOUT:"ou",DX_LAYOUT:"dx",PE_LAYOUT:"pe"},y=["title","description","periodType"],E={INTEGER:{name:"INTEGER",formName:"number"},TRUE_ONLY:{name:"TRUE_ONLY",formName:"checkbox"},TEXT:{name:"TEXT",formName:"text"},NUMBER:{name:"NUMBER",formName:"number"},DATE:{name:"DATE",formName:"date"},LONG_TEXT:{name:"LONG_TEXT",formName:"textarea"},LEGEND_DEFINITION:{name:"LEGEND_DEFINITION",formName:"legendDefinition"},RICH_TEXT:{name:"RICH_TEXT",formName:"richText"},LEGEND_MIN_MAX:{name:"LEGEND_MIN_MAX",formName:"legendMinMax"},NORMAL_LEGEND_MIN_MAX:{name:"NORMAL_LEGEND_MIN_MAX",formName:"normalLegendMinMax"},LEVEL_LEGEND_MIN_MAX:{name:"LEVEL_LEGEND_MIN_MAX",formName:"levelLegendMinMax"},MULTIPLE_FIELDS:{name:"MULTIPLE_FIELDS",formName:"multipleFields"}},S=["title","subtitle","description","periodType","periodSelection","legendDefinitions","additionalLabels"],w=["dataSelection","dataSelection.dataGroups"],b=[],k=[],D=[];var C=n(83590),U=n(85237),N=n(76483),T=n(43705),I=n(21758);const P={dx:{name:"data",displayName:f.A.t("Data"),icon:I.createElement(T.A,{style:{color:C.T.grey700}})},ou:{name:"orgUnit",displayName:f.A.t("Organisation Unit"),icon:I.createElement(N.A,{style:{color:C.T.grey700}})},pe:{name:"period",displayName:f.A.t("Period"),icon:I.createElement(U.A,{style:{color:C.T.grey700}})}},R={column:["dx"],row:["pe"],filter:["ou"]},O="skipMigration",L={ORG_UNIT_VS_DATA:"orgUnitsVsData",DATA_VS_ORG_UNIT:"dataVsOrgUnits"},F={RELATIVE:{name:f.A.t("Relative Periods"),key:"relative"},FIXED:{name:f.A.t("Fixed Periods"),key:"fixed"}},x=["RelativeWeek","RelativeFinancialYear"];function G(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class _{}G(_,"READ_WRITE","rw----"),G(_,"READ_ONLY","r-----"),G(_,"NO_ACCESS","------");const B={read:!1,write:!1,delete:!1},V={USER:"user",USER_GROUP:"userGroup"},M=[_.NO_ACCESS,_.READ_ONLY,_.READ_WRITE],j={ORG_UNIT:"ORG_UNIT",PERIOD:"PERIOD"},Q={CELL_WIDTH:102},Y={ASC:"asc",DESC:"desc",DEFAULT:"default"};function H(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class W{}H(W,"ALL","ALL"),H(W,"BELOW_AVERAGE","BELOW_AVERAGE"),H(W,"ABOVE_AVERAGE","ABOVE_AVERAGE");const q={nextLabel:f.A.t("Next"),prevLabel:f.A.t("Previous"),skipLabel:f.A.t("Skip"),doneLabel:f.A.t("Done"),hideNext:!1,hidePrev:!0,showProgress:!1,disableInteraction:!1,tooltipClass:"custom-tooltip"},J=[{intro:I.createElement("div",null,I.createElement("h1",null,f.A.t("Welcome to the most interactive scorecard ever!")))},{element:".search-input",intro:f.A.t("Search here for scorecards by name, id, or description")},{element:".change-view-button",intro:f.A.t("Click here to change the scorecards view to either list or grid")},{element:".add-scorecard-button",intro:f.A.t("Click here to add a new scorecard")},{element:".scorecard-list",intro:f.A.t("Click on View or anywhere on the scorecard to view, click on Edit to edit configurations and click on Delete to delete the scorecard")}],z=[{intro:I.createElement("div",{style:{width:200}},I.createElement("h3",null,f.A.t("Scorecard Management")),f.A.t("Here you can modify your scorecard configuration"))},{element:".general-settings",intro:f.A.t("Set your title and subtitle here")},{element:".description-settings",intro:f.A.t("Describe your scorecard")},{element:".period-type-settings",intro:f.A.t("Set the default period type here. This will determine which periods will be selected as defaults")},{element:".custom-header-settings",intro:f.A.t("Modify the scorecard header here. You can add different styling, icons, images,and much more")},{element:".legend-definitions-settings",intro:f.A.t("Define legends here. Set the title and color")},{element:".additional-labels-settings",intro:f.A.t("Set additional labels here")},{element:".settings-next-button",intro:f.A.t("Click on next to move to data configuration page")}],K=[{intro:I.createElement("div",null,I.createElement("h3",null,f.A.t("Data Configuration")),f.A.t("On this page, you can configure different data sources (indicators, dataElements, e.t.c) for the scorecard. You can also preview the scorecard table."))}],X=[{element:".preview-table-area",intro:f.A.t("This is the preview area. It shows how your scorecard will look like.")}],Z=[{element:".groups-configuration-area",intro:I.createElement("div",null,I.createElement("p",null,f.A.t("You can configure different data sources on this area.")),I.createElement("p",null,f.A.t("Indicators are configured and displayed in groups")))},{element:".scorecard-add-group-button",intro:f.A.t("Click Here to add a group")}],$=[{element:".groups-configuration-area",intro:I.createElement("div",null,I.createElement("p",null,f.A.t("You can configure different data sources on this area.")),I.createElement("p",null,f.A.t("Indicators are configured and displayed in groups")))},{element:".group-name-area",intro:f.A.t("Double click or click on the edit button to edit the group name")},{element:".expand-group-icon",intro:f.A.t("Click here to expand or collapse the group area")},{element:".delete-group-icon",intro:f.A.t("Click here to delete the group")},{element:".scorecard-add-group-button",intro:f.A.t("Click Here to add more groups")}],ee=[{element:".scorecard-indicator-add",intro:f.A.t("Click here to add an indicator")}],te=[{element:".data-holders-area",intro:f.A.t("Selected indicators appear here")},{element:".data-holder",intro:f.A.t("Click here to configure this indicator. You can also drag this to rearrange the indicators within a group")},{element:".link-button",intro:f.A.t("Click here to link two adjacent indicators or to unlink linked indicators")},{element:".data-source.close-icon",intro:f.A.t("Click here to delete this indicator")},{element:".scorecard-indicator-add",intro:f.A.t("Click here to add more indicators")}],ne=[{element:".groups-configuration-area",intro:f.A.t("You can configure different data sources on this area")},{element:".target-on-level-selector",intro:f.A.t("Check this box to set legend configuration according to organisation unit levels")},{element:".scorecard-add-group-button",intro:f.A.t("Click Here to add a group")},...$,...te],re=[{element:".data-source-form-container",intro:f.A.t("You can edit indicator configuration here")},{element:'input[name="label"]',intro:f.A.t("Edit indicator label here. This label will displayed on the scorecard table header")},{element:'input[name="weight"]',intro:f.A.t("You can set the indicator weight here. This is the indicator's maximum value")},{element:".effective-gap-settings",intro:f.A.t("You can set the effective gap here.")},{element:".indicator-options-settings-area",intro:I.createElement("div",null,f.A.t("Here you can set different options for the indicator"),I.createElement("p",null,I.createElement("b",null,f.A.t("Display Arrows"),":"),f.A.t("Check this to display increasing/decreasing arrows on this indicator's value")),I.createElement("p",null,I.createElement("b",null,f.A.t("High is Good"),":"),f.A.t("Check this to indicate that higher values are good for this indicator  ")),I.createElement("p",null,I.createElement("b",null,f.A.t("Show Colors"),":"),f.A.t("Check this to enable legend color on an indicator value ")))},{element:".legend-settings-area",intro:f.A.t("Here you can configure the maximum and minimum values for each legend")}],ie=[],oe={introduction:{start:0,end:K.length-1},emptyGroups:{start:1,end:Z.length-1},groupConfig:{start:Z.length,end:$.length-1},emptyIndicators:{start:$.length,end:ee.length-1},indicatorSetup:{start:ee.length,end:te.length-1},indicatorConfiguration:{start:te.length,end:re.length-1}},ae=[{intro:I.createElement("div",null,I.createElement("h3",null,f.A.t("Highlighted Indicators")),I.createElement("p",null,f.A.t("In this page you can add and configure highlighted indicators. These indicators appear on top of the scorecard table")))},{element:".add-highlighted-indicator-button",intro:f.A.t("To add a highlighted indicator click here")}],le=[{element:".highlighted-indicator-table",intro:f.A.t("Selected indicators will appear here")},{element:".highlighted-indicator-row",intro:f.A.t("Click on the row to configure the indicator")},{element:".highlighted-indicator-delete",intro:f.A.t("Click on the remove button to delete the indicator from the list")},{element:".add-highlighted-indicator-button",intro:f.A.t("To add more highlighted indicators click here")}],se=[{intro:I.createElement("div",null,I.createElement("h3",null,f.A.t("Access Settings")),I.createElement("p",null,f.A.t("In this page you can configure the default organisation unit and sharing access")))},{element:".access-org-unit-filter",intro:f.A.t("Choose the default organisation unit from this selector")},{element:".add-sharing-access",intro:f.A.t("You can add a new user or user group to share the scorecard with here")},{element:".user-selector",intro:f.A.t("Search and select a user or user group here")},{element:".access-selector",intro:f.A.t("Select the appropriate access here")},{element:".add-access-button",intro:f.A.t("Click here to add the access settings")},{element:".sharing-list",intro:f.A.t("List of shared users and user groups will appear here")},{element:".edit-delete-access",intro:f.A.t("You can edit or delete access here")}],ce=[{intro:I.createElement("div",null,I.createElement("h3",null,f.A.t("Default Options Settings")),I.createElement("p",null,f.A.t("In this page you can set default options for the scorecard view")))},{element:".visibility-options",intro:I.createElement("div",null,f.A.t("These options affect the scorecard view"),I.createElement("p",null,I.createElement("b",null,f.A.t("Legend"),":"),f.A.t("Allows the legends on the scorecard header to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Title"),":"),f.A.t("Allows the title on the scorecard header to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Item Number"),":"),f.A.t("Allows row numbers on the scorecard to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Empty Rows"),":"),f.A.t("Allows the empty rows on the scorecard to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Show Hierarchy"),":"),f.A.t("Allows the organisation units hierarchy to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Average Column"),":"),f.A.t("Allows the average column to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Average Row"),":"),f.A.t("Allows the average row to be displayed when checked")),I.createElement("p",null,I.createElement("b",null,f.A.t("Highlighted Indicators"),":"),f.A.t("Allows the highlighted indicators to be displayed when checked")))},{element:".average-options",intro:I.createElement("div",null,f.A.t("These options allow to view data based on the average"),I.createElement("p",null,I.createElement("b",null,f.A.t("All"),":"),f.A.t("Allows all data to be displayed")),I.createElement("p",null,I.createElement("b",null,f.A.t("Below Average"),":"),f.A.t("Allows data that is below the overall average to be displayed")),I.createElement("p",null,I.createElement("b",null,f.A.t("Above Average"),":"),f.A.t("Allows data that is above the overall average to be displayed")))},{element:".other-options",intro:I.createElement("div",null,I.createElement("p",null,I.createElement("b",null,f.A.t("Arrows"),":"),f.A.t("Allows increasing or decreasing indicators on data cells to be displayed")),I.createElement("p",null,I.createElement("b",null,f.A.t("Show Data in Rows"),":"),f.A.t("Changes the table layout, the indicators are shown in rows and orgaunisation units in columns")))}],ue=[{intro:I.createElement("div",null,I.createElement("h3",null,f.A.t("Scorecard View")),I.createElement("p",null,f.A.t("This is the default view for your scorecard")))},{element:"#org-unit-selector",intro:f.A.t("Click here to select different organisation units")},{element:"#period-selector",intro:f.A.t("Click here to select different periods")},{element:".home-button",intro:f.A.t("Click here to return to scorecard list")},{element:".refresh-button",intro:f.A.t("Click here to refresh the scorecard page. This will reset organisation units, periods, and options to default values")},{element:".option-button",intro:f.A.t("Click here to customize the scorecard look. Add numbering, enable average rows and columns, hide or show arrows and many more")},{element:".scorecard-view-edit-button",intro:f.A.t("Click here to edit scorecard configuration")},{element:".download-button",intro:f.A.t("Click here to download the scorecard in Excel, PDF, CSV, and JSON formats")},{element:".scorecard-table",intro:I.createElement("div",null,I.createElement("h3",null,f.A.t("Here is the scorecard!")),`${f.A.t("Here you can")}: `,I.createElement("ul",null,I.createElement("li",null,f.A.t("Sort table based on organisation unit names or values")),I.createElement("li",null,f.A.t("Search organisation units")),I.createElement("li",null,f.A.t("Change the table layout")),I.createElement("li",null,f.A.t("Further analyse data in the cells"))))},{element:".org-unit-search",intro:f.A.t("Search here for a specific organisation unit")},{element:'[data-test="dhis2-uicore-tableheadercellaction"]',intro:f.A.t("Click on the arrows to sort the table based on the name or values")},{element:"th.parent-org-unit-cell",intro:f.A.t("To change the table layout, click, hold, and drag this cell to the table headers")},{element:".data-cell",intro:I.createElement("div",null,I.createElement("p",{style:{margin:2}},f.A.t("Click on a data cell to see further analysis")),I.createElement("br",null),I.createElement("p",{style:{margin:2}},f.A.t("You can also right click to view the cell data in different options")))},{element:'[data-test="orgUnit-children-table-column-cell"] > td:nth-child(1)',intro:f.A.t("Click on the arrow to drill down to the scorecard of this organisation unit's lower level")}],de=[{id:"general",content:f.A.t("Here you can set your scorecard general information \n You can set name, period type, legends and additional labels of your scorecard.")},{id:"dataConfiguration",content:f.A.t("On this page, you can configure different data sources (indicators, dataElements, e.t.c) for the scorecard. You can also preview the scorecard table.")},{id:"highlightedIndicators",content:f.A.t("In this page you can add and configure highlighted indicators. These indicators appear on top of the scorecard table")},{id:"access",content:f.A.t("In this page you can configure the default organisation unit and sharing access for the scorecard.")},{id:"option",content:f.A.t("In this page you can set default options for the scorecard view. These options affect the scorecard view")}]},74179:function(e,t,n){n.d(t,{p3:function(){return p},PG:function(){return me},wz:function(){return ge.w},IJ:function(){return ye},GN:function(){return he},HE:function(){return de.A},AZ:function(){return g},_V:function(){return j},Yb:function(){return ge.Y},Sx:function(){return ve},VI:function(){return pe.A},V6:function(){return Q},Il:function(){return H},Yc:function(){return ue},Pj:function(){return fe}});var r=n(66190),i=n(59541),o=n(21758),a=n(50433),l=n(65298),s=n(96421),c=n(41887),u=n(83590),d=n(51654),m=n.n(d);function g({text:e,small:t}){return o.createElement("div",{className:"column center",style:{height:"100%",width:"100%"}},o.createElement(s.o,null,o.createElement("div",null,o.createElement(c.F,{small:t}),o.createElement("p",{style:{color:u.T.default}},e))))}g.propTypes={small:m().bool,text:m().string};var f=n(77337),v=n(44820);function p({accessType:e}){const t=(0,a.W6)();return o.createElement("div",{className:"column center align-items-center w-100 h-100"},o.createElement(s.o,null,o.createElement("div",{className:"column align-items-center"},o.createElement(v.A,{style:{color:u.T.grey700,fontSize:64},fontSize:"large"}),o.createElement("p",{style:{color:u.T.grey700,fontWeight:"bold",fontSize:"1vw"}},r.A.t("You do not have access to {{accessType}} this Scorecard",{accessType:e})),o.createElement(f.$,{primary:!0,onClick:()=>{t.replace("/")}},r.A.t("Back to scorecard list")))))}function h(){return o.createElement("div",{className:"flex-1 column center align-items-center"},o.createElement("h2",{style:{color:u.T.grey700}},r.A.t("Select Organisation Units and Period to start")))}p.propTypes={accessType:m().oneOf(["edit","view"]).isRequired};var A=n(84161),y=n(31594);function E({highlightedIndicator:e}){var t;const n=(0,l.useRecoilValue)(A.cT),r=(0,l.useRecoilValue)((0,A.NP)("legendDefinitions")),i=(0,l.useRecoilValue)((0,A.Ye)(!0)),{displayName:a,legends:s,id:c,weight:u}=null!==e&&void 0!==e?e:{},d=(0,l.useRecoilValue)((0,A.cX)(c)),{color:m}=null!==(t=(0,y.sG)(d,s,{max:u,defaultLegends:i,orgUnitLevels:n,dataOrgUnitLevel:1,legendDefinitions:r}))&&void 0!==t?t:{};return o.createElement("div",{style:{background:"white",border:"1px solid rgb(232, 237, 242)",margin:8}},o.createElement("div",{id:"test-highlighted-indicator",className:"row flex-1 space-between align-items-center"},o.createElement("p",{style:{margin:0,padding:"0 8px",fontSize:14}},a),o.createElement("div",{style:{width:60,minHeight:"100%",background:m,padding:16,display:"flex",alignItems:"center",justifyContent:"center"}},o.createElement("p",{style:{fontSize:14,margin:0}},d))))}function S(){var e,t,n,a;const s=(0,l.useRecoilValue)((0,A.NP)("highlightedIndicators")),{highlightedIndicators:u}=null!==(e=(0,l.useRecoilValue)((0,A.NP)("options")))&&void 0!==e?e:{},{state:d,contents:m}=(0,l.useRecoilValueLoadable)(A.he);return u&&!(0,i.isEmpty)(s)?o.createElement("div",{className:"column"},o.createElement("div",null,o.createElement("h3",null,r.A.t("Highlighted Indicators"))),"loading"===d&&o.createElement("div",{className:"row center align-items-center p-16"},o.createElement(c.F,{small:!0})),"hasError"===d&&o.createElement("div",{className:"row center align-items-center"},o.createElement(ErrorIcon,{size:24}),o.createElement("div",{style:{paddingLeft:16}},null!==(t=null!==(n=null!==(a=null===m||void 0===m?void 0:m.message)&&void 0!==a?a:null===m||void 0===m?void 0:m.details)&&void 0!==n?n:m.toString())&&void 0!==t?t:"Error")),"hasValue"===d&&o.createElement("div",{className:"grid highlighted-indicators-container"},null===s||void 0===s?void 0:s.map(e=>o.createElement(E,{key:null===e||void 0===e?void 0:e.id,highlightedIndicator:e})))):null}E.propTypes={highlightedIndicator:m().object.isRequired};var w=n(34174),b=n(96098),k=n(33791),D=n(28384),C=n(65859);function U({onClose:e,onDownload:t}){var n;return o.createElement(k.n,{dataTest:"download-menu"},null===(n=Object.values(C.R$))||void 0===n?void 0:n.map(n=>o.createElement(D.D,{dataTest:`${n}-download-menu`,onClick:()=>{t(n),e()},key:`${n}-download-menu`,label:n})),o.createElement(D.D,{dataTest:"ALMA-download-menu",label:"ALMA"},o.createElement(D.D,{dataTest:"test-alma-data-json",label:`${r.A.t("Data")}(JSON)`,onClick:()=>{t("ALMAData"),e()}}),o.createElement(D.D,{dataTest:"test-alma-meta-data",label:r.A.t("Metadata"),onClick:()=>{t("ALMAMeta"),e()}})))}U.propTypes={onClose:m().func.isRequired,onDownload:m().func.isRequired};var N=n(4147),T=n(77866),I=n(32323),P=n(81205);function R({periods:e,data:t,orgUnits:n,dataHolders:r,title:o,type:a}){try{const l=function({periods:e=[],data:t={},orgUnits:n=[],dataSources:r=[]}){return null===n||void 0===n?void 0:n.map(({displayName:n,id:i})=>{const o={"Organisation Unit":n};for(const l of r){const{id:n,displayName:r,label:s}=null!==l&&void 0!==l?l:{};for(const l of e){var a;const{id:e,name:c}=null!==l&&void 0!==l?l:{};o[`${null!==r&&void 0!==r?r:s}-${c}`]=null===(a=t[`${n}_${i}_${e}`])||void 0===a?void 0:a.current}}return o})}({periods:e,data:t,orgUnits:n,dataSources:(0,i.flatten)(null===r||void 0===r?void 0:r.map(({dataSources:e})=>e))}),s=P.Wp.json_to_sheet(l),c=P.Wp.book_new();P.Wp.book_append_sheet(c,s,`${o}`),(0,P._h)(c,`${o}.${a}`)}catch(l){return l}}function O({orgUnits:e,dataSources:t,periods:n,legendDefinitions:o}){function a(e){if(Array.isArray(e))return null===e||void 0===e?void 0:e.map(({startValue:e,endValue:t,legendDefinitionId:n})=>{var r;return{min:e,max:t,color:null===(r=(0,i.find)(o,["id",n]))||void 0===r?void 0:r.color}});{const t={};return(0,i.forIn)(e,(e,n)=>{t[n]=null===e||void 0===e?void 0:e.map(({startValue:e,endValue:t,legendDefinitionId:n})=>{var r;return{min:e,max:t,color:null===(r=(0,i.find)(o,["id",n]))||void 0===r?void 0:r.color}})}),t}}return{dimensions:function(e,t,n){return{ou:null===e||void 0===e?void 0:e.map(({id:e})=>e),pe:null===n||void 0===n?void 0:n.map(({id:e})=>e),dx:null===t||void 0===t?void 0:t.map(({id:e})=>e),co:[]}}(e,t,n),items:function(e,t){const n={};for(const r of t){const{displayName:e,id:t,legends:o}=null!==r&&void 0!==r?r:{};(0,i.set)(n,[t],{name:e,legendSet:a(o)})}for(const r of e){const{id:e,displayName:t}=null!==r&&void 0!==r?r:{};(0,i.set)(n,[e],{name:t})}return(0,i.set)(n,"dx",{name:r.A.t("Data")}),(0,i.set)(n,"pe",{name:r.A.t("Period")}),(0,i.set)(n,"ou",{name:r.A.t("Organisation Unit")}),n}(e,t)}}function L(e){const t=[];return(0,i.forIn)(e,(e,n)=>{const[r,i,o]=null===n||void 0===n?void 0:n.split("_");t.push([r,o,i,null===e||void 0===e?void 0:e.current])}),t}function F(e,t){const n=(0,l.useRecoilValue)((0,A.NP)("title")),r=(0,l.useRecoilValue)((0,A.NP)("legendDefinitions")),a=(0,l.useRecoilValueLoadable)(A.kg),s=(0,o.useMemo)(()=>{var e;return"hasValue"===a.state?null===(e=a.contents)||void 0===e?void 0:e.orgUnits:[]},[a]),c=(0,o.useMemo)(()=>null===s||void 0===s?void 0:s.map(({id:e})=>e),[s]),{filteredOrgUnits:u,childrenOrgUnits:d}=(0,l.useRecoilValue)((0,A.iH)(c)),m=(0,l.useRecoilValue)(A.T8),g=(0,o.useMemo)(()=>[...u,...d],[u,d]),f=(0,l.useRecoilValue)(A.Jv),v=(0,l.useRecoilValue)((0,A.Wn)(c)),[p,h]=(0,o.useState)(),{show:y}=(0,N.MW)(({message:e})=>e,({type:e})=>({...e,duration:3e3})),E=(0,T.useReactToPrint)({content:()=>null===e||void 0===e?void 0:e.current,documentTitle:`${n}`});(0,o.useEffect)(function(){if(void 0!==v&&!v&&"hasValue"===a.state){const e=t.getAllOrgUnitData(null===g||void 0===g?void 0:g.map(({id:e})=>e)).subscribe(h);return()=>e.unsubscribe()}},[v,g,t]);const S=e=>{if(void 0!==v&&!v&&"hasValue"===a.state)switch(e){case C.R$.EXCEL:return function({periods:e,data:t,orgUnits:n,dataHolders:r,title:i}){return R({periods:e,data:t,orgUnits:n,dataHolders:r,title:i,type:"xlsx"})}({periods:f,data:p,orgUnits:g,dataHolders:m,title:n});case C.R$.CSV:return function({periods:e,data:t,orgUnits:n,dataHolders:r,title:i}){return R({periods:e,data:t,orgUnits:n,dataHolders:r,title:i,type:"csv"})}({periods:f,data:p,orgUnits:g,dataHolders:m,title:n});case C.R$.PDF:return E();case"ALMAData":return function({periods:e,data:t,orgUnits:n,dataHolders:r,title:o,legendDefinitions:a}){try{const l=JSON.stringify({dataValues:[{headers:C.xT,metaData:O({orgUnits:n,dataSources:(0,i.flatten)(null===r||void 0===r?void 0:r.map(({dataSources:e})=>e)),periods:e,legendDefinitions:a}),rows:L(t)}]}),s=new Blob([l],{type:"application/json"});(0,I.saveAs)(s,`${o}.json`)}catch(l){return l}}({periods:f,data:p,orgUnits:s,dataHolders:m,title:n,legendDefinitions:r});case"ALMAMeta":return function({orgUnits:e,dataHolders:t,title:n}){try{const r=JSON.stringify({organisationUnits:null===e||void 0===e?void 0:e.map(({id:e,level:t,displayName:n,path:r})=>{var i,o;const a=r.split("/"),l=a.length>=2&&null!==(i=null===a||void 0===a?void 0:a[a.length-2])&&void 0!==i?i:"";return{id:e,name:n,level:null!==t&&void 0!==t?t:(null===r||void 0===r||null===(o=r.split("/"))||void 0===o?void 0:o.length)-1,parent:a.length<=2?{id:l}:void 0}}),indicators:(0,i.flatten)(null===t||void 0===t?void 0:t.map(({dataSources:e})=>null===e||void 0===e?void 0:e.map(({id:e,displayName:t})=>({id:e,name:t}))))}),o=new Blob([r],{type:"application/json"});(0,I.saveAs)(o,`${n}-metadata.json`)}catch(r){return r}}({orgUnits:g,dataHolders:m,title:n});default:return}};return{download:e=>{const t=S(e);var n,r;t&&y({message:null!==(n=null!==(r=null===t||void 0===t?void 0:t.message)&&void 0!==r?r:t.details)&&void 0!==n?n:null===t||void 0===t?void 0:t.toString()})}}}var x=n(72714),G=n(2235),_=n(34207),B=n(24563),V=n(44247),M=n(73397);function j({helpSteps:e}){const t=(0,l.useSetRecoilState)(A.rZ);return(0,o.useEffect)(()=>(t(t=>[...t,...e]),()=>{t(t=>{const n=[...t];return(0,i.pullAllWith)(n,e,i.isEqual),n})}),[e]),null}function Q({options:e,onChange:t}){return o.createElement("div",{className:"container p-16"},o.createElement(j,{helpSteps:C.NQ}),o.createElement("div",{className:"row"},o.createElement("div",{className:"column "},o.createElement("h3",null,r.A.t("Visibility")),o.createElement("div",{className:"column visibility-options"},o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.legend,onChange:t("legend"),value:"legend",label:r.A.t("Legend")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.title,onChange:t("title"),value:"title",label:r.A.t("Title")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.itemNumber,onChange:t("itemNumber"),value:"itemNumber",label:r.A.t("Item Number")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.emptyRows,onChange:t("emptyRows"),value:"emptyRows",label:r.A.t("Empty Rows")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.showHierarchy,onChange:t("showHierarchy"),value:"showHierarchy",label:r.A.t("Show Hierarchy")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.averageColumn,onChange:t("averageColumn"),value:"averageColumn",label:r.A.t("Average Column")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.averageRow,onChange:t("averageRow"),value:"averageRow",label:r.A.t("Average Row")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.highlightedIndicators,onChange:t("highlightedIndicators"),value:"highlightedIndicators",label:r.A.t("Highlighted Indicators")})),o.createElement("h3",null,r.A.t("Average")),o.createElement("div",{className:"column average-options"},o.createElement(M.s,{onChange:()=>t("averageDisplayType")(C.uL.ALL),checked:(null===e||void 0===e?void 0:e.averageDisplayType)===C.uL.ALL,value:C.uL.ALL,label:r.A.t("All")}),o.createElement(M.s,{onChange:()=>t("averageDisplayType")(C.uL.BELOW_AVERAGE),checked:(null===e||void 0===e?void 0:e.averageDisplayType)===C.uL.BELOW_AVERAGE,value:C.uL.BELOW_AVERAGE,label:r.A.t("Below Average")}),o.createElement(M.s,{onChange:()=>t("averageDisplayType")(C.uL.ABOVE_AVERAGE),checked:(null===e||void 0===e?void 0:e.averageDisplayType)===C.uL.ABOVE_AVERAGE,value:C.uL.ABOVE_AVERAGE,label:r.A.t("Above Average")})),o.createElement("h3",null,r.A.t("Options")),o.createElement("div",{className:"column other-options"},o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.arrows,onChange:t("arrows"),value:"arrows",label:r.A.t("Arrows")}),o.createElement(V.Y,{checked:null===e||void 0===e?void 0:e.showDataInRows,onChange:t("showDataInRows"),value:"showDataInRows",label:r.A.t("Show Data in Rows")})))))}j.propTypes={helpSteps:m().arrayOf(m().object).isRequired},Q.propTypes={options:m().object.isRequired,onChange:m().func.isRequired};var Y=n(37973);function H({onSelect:e,onClose:t,initialValues:n}){const[i,a]=(0,o.useState)(n);return o.createElement(x.a,{onClose:t,large:!0},o.createElement(G.w,null,r.A.t("Options")),o.createElement(_.$,null,o.createElement("div",{className:"column"},o.createElement(Q,{options:i,onChange:e=>t=>{a(n=>{var r;return Y.f6.set(n,e,null!==(r=null===t||void 0===t?void 0:t.checked)&&void 0!==r?r:t)})}}))),o.createElement(B.N,null,o.createElement(w.v,null,o.createElement(f.$,{onClick:t},r.A.t("Cancel")),o.createElement(f.$,{dataTest:"update-button-on-options",primary:!0,onClick:()=>{e(i),t()}},r.A.t("Update")))))}function W({downloadAreaRef:e,dataEngine:t,widget:n}){const i=(0,l.useSetRecoilState)(A.ZK),[s,c]=(0,l.useRecoilState)((0,A.NP)("options")),[u,d]=(0,o.useState)(!1),{baseUrl:m,serverVersion:g}=(0,N.UK)(),{download:v}=F(e,t),p=(0,l.useRecoilValue)(A.x9),h=(0,l.useRecoilValue)((0,A.Qg)(p)),E=null===h||void 0===h?void 0:h.write,S=(0,a.W6)(),k=(0,l.useRecoilCallback)(({set:e,reset:t})=>()=>{t((0,A.NP)("orgUnitSelection")),t((0,A.NP)("periodSelection")),e(A.j$,e=>e+1)}),D=()=>{if(E){if(i(e=>({...e,previous:`/view/${p}`})),n){const e=(0,y.QY)(m,{name:C.C3,title:C.B_},g);return window.parent.open(e+"#/edit/"+p)}S.push(`/edit/${p}`)}};return o.createElement("div",{className:"row end print-hide"},o.createElement("div",{className:"column align-items-end"},!n&&o.createElement(w.v,null,o.createElement(f.$,{className:"option-button",dataTest:"scorecard-option-button",onClick:()=>d(!0)},r.A.t("Options")),E&&o.createElement(f.$,{dataTest:"edit-scorecard-button",className:"scorecard-view-edit-button",onClick:D},r.A.t("Edit")),o.createElement(b.g,{component:o.createElement(U,{onClose:()=>{},onDownload:v}),className:"download-button",dataTest:"download-button"},r.A.t("Download")),o.createElement(f.$,{className:"refresh-button",onClick:k},r.A.t("Refresh")))),n&&E?o.createElement(f.$,{dataTest:"edit-scorecard-button",className:"scorecard-view-edit-button",onClick:D},r.A.t("Edit")):null,u&&o.createElement(H,{onClose:()=>d(!1),initialValues:s,onSelect:c}))}H.propTypes={initialValues:m().object.isRequired,onClose:m().func.isRequired,onSelect:m().func.isRequired},W.propTypes={dataEngine:m().instanceOf(Y.v5).isRequired,downloadAreaRef:m().any.isRequired};var q=n(13619),J=n.n(q);function z(){var e;const{title:t}=(0,l.useRecoilValue)((0,A.NP)("options")),n=(0,l.useRecoilValue)((0,A.NP)("customHeader")),r=(0,l.useRecoilValue)(A.Jv),a=(0,l.useRecoilValue)((0,A.NP)("title")),s=(0,l.useRecoilValue)((0,A.NP)("subtitle"));return t&&!(0,i.isEmpty)(r)?o.createElement("div",{className:"row space-between",id:"scorecard-header"},o.createElement("div",{className:"row"},n?o.createElement(J(),{autoCloseVoidElements:!0,className:"w-100",onError:console.error,bindings:{title:a,subtitle:s,period:1===r.length?null===(e=(0,i.head)(r))||void 0===e?void 0:e.name:""},jsx:n}):o.createElement("div",{className:"column center align-items-center"},o.createElement("h1",{style:{margin:8},id:"data-test-score-card-title"},a," ",""+(1===r.length?` - ${r[0].name}`:"")),o.createElement("h3",{style:{color:u.T.grey600,margin:0}},s)))):null}var K=n(48389),X=n(10103),Z=n(1685),$=n(75038),ee=n(80629),te=n(75017),ne=n(42412);function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},re.apply(null,arguments)}const ie=1;function oe({type:e,onClick:t,selectedItems:n=[],id:a,...l}){const s=e===C.fg.PERIOD?r.A.t("Selected period"):r.A.t("Selected organisation unit"),c=(0,i.head)((0,i.chunk)(n,ie));return o.createElement("div",{id:a,onClick:t},o.createElement(ee.m,{content:o.createElement("div",null,null===n||void 0===n?void 0:n.map(({name:e,displayName:t,id:n})=>o.createElement("p",{style:{margin:4},key:`${n}-tooltip`},null!==e&&void 0!==e?e:t)))},o.createElement(te.a,re({className:"selection-box"},l),o.createElement("p",{className:"selection-box-header"},s),o.createElement(te.a,{className:"selection-text-box",width:"90%",height:"40%"},null===c||void 0===c?void 0:c.map(({name:e,displayName:t,id:n})=>o.createElement(ne.v,{key:n},null!==e&&void 0!==e?e:t)),(null===n||void 0===n?void 0:n.length)>ie&&o.createElement(ne.v,null,r.A.t("and {{number}} more",{number:n.length-ie}))))))}function ae(){var e;const[t,n]=(0,l.useRecoilState)(A.r6),{calendar:i}=null!==(e=(0,l.useRecoilValue)(A.SN))&&void 0!==e?e:{},s=(0,a.W6)(),c=(0,l.useRecoilValue)(A.x9),u=(0,l.useRecoilValue)(A.cT),d=(0,l.useRecoilValue)(A.X),[m,g]=(0,l.useRecoilState)((0,A.NP)("orgUnitSelection")),[v,p]=(0,l.useRecoilState)((0,A.NP)("periodSelection")),[h,E]=(0,o.useState)(!1),[S,b]=(0,o.useState)(!1),k=(0,l.useRecoilCallback)(({reset:e})=>()=>{e(A.x9),e((0,A.Qs)(c))},[c]);(0,o.useEffect)(()=>()=>{k()},[]);const D=(0,o.useMemo)(()=>(0,y.Sx)(m,{orgUnitGroups:d,orgUnitLevels:u}),[d,u,m]);return o.createElement("div",{className:"selection-card"},o.createElement($.gj,{options:C.Sf,steps:C.dI,enabled:t,initialStep:0,onExit:()=>{n(!1)}}),o.createElement(K.Z,null,o.createElement("div",{className:"row space-between align-items-center pl-16 pr-16"},o.createElement("div",{className:"row align-items-center"},o.createElement(oe,{id:"org-unit-selector",selectedItems:D,name:"Organisation Unit",dataTest:"test-selected-organization-unit",onClick:()=>{E(!0)},type:C.fg.ORG_UNIT}),o.createElement(oe,{id:"period-selector",selectedItems:null===v||void 0===v?void 0:v.periods,dataTest:"test-selected-period",name:"Period",onClick:()=>{b(!0)},type:C.fg.PERIOD})),o.createElement("div",{className:"column align-items-end"},o.createElement(w.v,{className:"pb-8"},o.createElement(f.$,{className:"home-button",onClick:()=>{s.replace("/")}},r.A.t("Back to all scorecards")),o.createElement(f.$,{onClick:()=>n(!0)},r.A.t("Help")))),h&&o.createElement(X.ng,{value:m,showGroups:!0,showLevels:!0,showUserOptions:!0,hide:!h,onClose:()=>E(!1),onUpdate:e=>{g(e),E(!1)}}),S&&o.createElement(X.o0,{enablePeriodSelector:!0,excludedPeriodTypes:C.qR,calendar:i,selectedPeriods:v.periods.map(({id:e})=>e),hide:!S,onClose:()=>b(!1),onUpdate:e=>{p({periods:e.map(e=>Z.qk.getPeriodById(e))}),b(!1)}}))))}oe.defaultProps={type:"",name:""},oe.propTypes={name:m().string.isRequired,type:m().oneOf([C.fg.PERIOD,C.fg.ORG_UNIT]).isRequired,onClick:m().func.isRequired,id:m().string,selectedItems:m().array};var le=n(61476);const se=(0,o.lazy)(()=>n.e(253).then(n.bind(n,30253))),ce=(0,o.lazy)(()=>Promise.all([n.e(4043),n.e(4268),n.e(7386)]).then(n.bind(n,7386)));function ue({widget:e}){var t;const{id:n}=(0,a.g)(),s=(0,l.useSetRecoilState)(A.x9),c=(0,l.useRecoilValueLoadable)(A.kg),u=(0,o.useMemo)(()=>{var e,t,n;return"hasValue"===c.state&&null!==(e=null===(t=c.contents)||void 0===t||null===(n=t.orgUnits)||void 0===n?void 0:n.map(e=>null===e||void 0===e?void 0:e.id))&&void 0!==e?e:[]},[c.state,c.contents]),{read:d}=(0,l.useRecoilValue)((0,A.Qg)(n)),m=(0,o.useRef)(),f=(0,l.useRecoilValue)(A.Jv),v=(0,l.useRecoilValue)(A.xp),y=(0,o.useMemo)(()=>new Y.v5,[]),E=(0,l.useRecoilCallback)(({reset:e})=>()=>{e((0,A.NP)("periodSelection")),e((0,A.NP)("orgUnitSearchKeyword")),e((0,A.ug)(u)),e((0,A.NP)("options")),e(A.x9),e(A.Qq),e(A.T8)});return(0,o.useEffect)(()=>(s(n),()=>{E()}),[]),d?o.createElement(o.Suspense,{fallback:o.createElement(g,null)},!e&&o.createElement(ae,null),o.createElement(o.Suspense,{fallback:o.createElement(g,null)},o.createElement("div",{ref:m,className:"column p-16  print-visible",style:{height:"100%",width:"100%",overflow:"visible"}},o.createElement(W,{widget:e,dataEngine:y,downloadAreaRef:m}),o.createElement(z,null),o.createElement(se,null),o.createElement(S,null),o.createElement("div",{className:"column align-items-center pt-16 flex-1"},(0,i.isEmpty)(null===c||void 0===c||null===(t=c.contents)||void 0===t?void 0:t.orgUnits)||(0,i.isEmpty)(f)?o.createElement(h,null):o.createElement(o.Suspense,{fallback:o.createElement(g,{small:!0})},o.createElement(ce,{initialDataEngine:y,nested:!1,orgUnits:u})),v&&o.createElement("div",{className:"hide print-show always-page-break"},o.createElement("div",{className:"always-page-break"}),o.createElement("h1",null,r.A.t("Specific Targets Legends")),o.createElement(le.c,null)))))):o.createElement(p,{accessType:"view"})}var de=n(16519);function me({height:e}){return o.createElement("div",{style:{height:null!==e&&void 0!==e?e:"100%",minHeight:null!==e&&void 0!==e?e:"100%"},className:"column center align-items-center"},o.createElement(c.F,{small:!0}))}me.propTypes={height:m().oneOfType([m().string,m().number])};var ge=n(49927);function fe({cellRef:e,color:t,value:n,status:r,bold:i}){const a=(null===e||void 0===e?void 0:e.offsetWidth)-1||100,l=(null===e||void 0===e?void 0:e.offsetHeight)-1||47,s=12,c="decreasing"===r;return o.createElement("svg",{width:a,height:l,style:{display:"block"}},o.createElement("polygon",{points:`0 0 0 ${l} ${a} ${l} ${a} 0`,style:{fill:null!==t&&void 0!==t?t:"#FFFFFF"}}),r&&(c?o.createElement(ge.w,{x:a/2-24,y:(l-10)/2+10,fontSize:10}):o.createElement(ge.Y,{fontSize:10,y:(l-10)/2,x:a/2-24})),o.createElement("text",{id:"test-average-column",style:{fontWeight:i&&"bold"},lengthAdjust:"spacingAndGlyphs",fontSize:s,x:a/2-s,y:(l-s)/2+s},n))}function ve({bold:e,topValue:t,bottomValue:n,topColor:r,bottomColor:i,topStatus:a,bottomStatus:l,cellRef:s}){const c=(null===s||void 0===s?void 0:s.offsetWidth)-1||100,u=(null===s||void 0===s?void 0:s.offsetHeight)-1||47;return o.createElement("svg",{width:c,height:u,viewBox:`0 0 ${c} ${u}`,style:{display:"block"}},o.createElement("polygon",{points:`0,0 0,${u} ${c}, 0`,style:{fill:null!==r&&void 0!==r?r:"#FFFFFF",strokeWidth:1,stroke:"rgb(232, 237, 242)"}}),o.createElement("text",{style:{fontWeight:e&&"bold"},id:"test-cell-selector",lengthAdjust:"spacingAndGlyphs",textLength:(null===t||void 0===t?void 0:t.length)>4?28:null,fontSize:12,x:18,y:18},t),a&&("increasing"===a?o.createElement(ge.Y,{fontSize:10,y:6,x:12}):o.createElement(ge.w,{fontSize:10,y:18,x:12})),o.createElement("polygon",{points:`${c},0 ${c},${u} 0,${u}`,style:{fill:null!==i&&void 0!==i?i:"#FFFFFF",strokeWidth:1,stroke:"rgb(232, 237, 242)"}}),o.createElement("text",{style:{fontWeight:e&&"bold"},id:"test-cell-selector",lengthAdjust:"spacingAndGlyphs",textLength:(null===n||void 0===n?void 0:n.length)>4?28:null,fontSize:12,x:c/2+6,y:u-6},n),l&&("increasing"===l?o.createElement(ge.Y,{fontSize:10,y:u-18,x:c-12}):o.createElement(ge.w,{fontSize:10,y:u-6,x:c-12})))}fe.propTypes={value:m().string.isRequired,bold:m().bool,color:m().string,status:m().oneOf(["increasing","decreasing"])},ve.propTypes={bottomValue:m().any.isRequired,topValue:m().any.isRequired,bold:m().bool,bottomColor:m().string,bottomStatus:m().oneOf(["increasing","decreasing"]),topColor:m().string,topStatus:m().oneOf(["increasing","decreasing"])};var pe=n(80754);class he{constructor(e={}){(0,i.defaultsDeep)(this,e,this.defaults)}get defaults(){return{}}}var Ae=n(30162);function ye({size:e,color:t}){return o.createElement(Ae.A,{style:{color:null!==t&&void 0!==t?t:u.T.grey500,fontSize:null!==e&&void 0!==e?e:24}})}ye.propTypes={size:m().number.isRequired,color:m().string}},80754:function(e,t,n){n.d(t,{A:function(){return a}});var r=n(96421),i=n(41887),o=n(21758);function a(){return o.createElement("div",{className:"w-100 h-100"},o.createElement(r.o,null,o.createElement(i.F,{small:!0})))}},84161:function(e,t,n){n.d(t,{Uz:function(){return S},mS:function(){return pe},mW:function(){return he},xb:function(){return ce},Se:function(){return o},W5:function(){return le},Ck:function(){return ae},aN:function(){return ge},r6:function(){return fe},rZ:function(){return me},he:function(){return Ae},kg:function(){return re},c7:function(){return k},xp:function(){return M},dw:function(){return ne},h7:function(){return $},gT:function(){return te},X:function(){return Z},cT:function(){return X},HN:function(){return ee},Jv:function(){return Y},j$:function(){return P},ZK:function(){return ue},Qs:function(){return Q},a5:function(){return U},SG:function(){return C},qf:function(){return I},cH:function(){return T},Yk:function(){return N},Wn:function(){return V},T8:function(){return B},oL:function(){return j},x9:function(){return E},Ye:function(){return L},ug:function(){return R},iH:function(){return _},Pn:function(){return b},Oj:function(){return w},Mj:function(){return G},Qq:function(){return x},Qy:function(){return F},NP:function(){return O},jZ:function(){return p},ZU:function(){return ie},Uf:function(){return oe},cX:function(){return ye},SN:function(){return u},Qg:function(){return v},bM:function(){return f}});var r=n(59541),i=n(65298);const o=(0,i.atom)({key:"engineState",default:{}});var a=n(2793),l=n(66190);const s=["keyCalendar"],c={system:{resource:"systemSettings",params:({keys:e})=>({keys:null===e||void 0===e?void 0:e.map(e=>`key=${e}`)})}},u=(0,i.atom)({key:"system-settings-state",default:(0,i.selector)({key:"system-settings-selector",get:async({get:e})=>{const t=e(o),{system:n}=await t.query(c,{variables:{keys:s}}),{keyCalendar:r}=null!==n&&void 0!==n?n:{};return{calendar:r}}})});var d=n(65859),m=n(31594);const g={user:{resource:"me",params:{fields:["id","displayName","userGroups","authorities","organisationUnits[id,level,displayName]"]}}},f=(0,i.atom)({key:"userState",default:(0,i.selector)({key:"userStateSelector",get:async({get:e})=>{try{const t=e(o);if(t){const{user:e}=await t.query(g);return e||null}}catch(t){console.error(t)}}})}),v=(0,i.selectorFamily)({key:"user-scorecard-authority",get:e=>({get:t})=>{var n;const i=(0,r.find)(t(w),["id",e]),o=t(f);return null!==(n=(0,m.t4)(o,i))&&void 0!==n?n:d.XI}}),p=(0,i.atom)({key:"screen-dimensions",default:{},effects_UNSTABLE:[({setSelf:e})=>{function t(){e((0,m.YO)())}return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)}]});var h=n(37973),A=n(43861);const y={legendDefinitions:[{color:"#D3D3D3",name:l.A.t("N/A"),isDefault:!0,id:"N/A"},{color:"#FFFFFF",name:l.A.t("No Data"),isDefault:!0,id:"No Data"},{id:(0,m.Ld)(),color:"#008000",name:l.A.t("Target Reached/ On Track")},{id:(0,m.Ld)(),color:"#FFFF00",name:l.A.t("Progress, but more effort required")},{id:(0,m.Ld)(),color:"#FF0000",name:l.A.t("Not on track")}],options:new h.f6,publicAccess:new h.Ny({id:"public",type:"public",access:d.he.NO_ACCESS,displayName:"Public"}),orgUnitSelection:new h.vi,userGroupAccesses:[],userAccesses:[],highlightedIndicators:[]},E=(0,i.atom)({key:"scorecard-id",default:null}),S=(0,i.selector)({key:"all-scorecard-summary-state",get:async({get:e})=>{const t=e(o);await(0,A.fh)(t);const{summary:n,error:r}=await(0,A.dD)(t);if(r)throw r;return n}}),w=(0,i.atom)({key:"scorecard-summary",default:(0,i.selector)({key:"scorecard-summary-selector",get:async({get:e})=>{const t=e(S),n=e(f);return(0,r.filter)(t,e=>{var t;const{read:r}=null!==(t=(0,m.t4)(n,e))&&void 0!==t?t:{};return r})}})}),b=(0,i.atomFamily)({key:"scorecardForceUpdateState",default:0}),k=(0,i.atom)({key:"isNewScorecard",default:void 0}),D=(0,i.atomFamily)({key:"scorecard-config",default:(0,i.selectorFamily)({key:"active-scorecard-config",get:e=>async({get:t})=>{const n=t(o);if(t(b(e)),e){const{scorecard:t,error:i}=await(0,A.Dh)(e,n);if(i){var r;if(404===(null===i||void 0===i||null===(r=i.details)||void 0===r?void 0:r.httpStatusCode))throw{...i,title:l.A.t("Scorecard Not Found"),message:l.A.t(`Scorecard with id ${e} could not be found.`)};throw i}const o=await(0,A.jJ)(t,n);return{...t,orgUnitSelection:o}}return new h.HI(y)}})}),C=(0,i.atomFamily)({key:"scorecard-config-edit-state",default:(0,i.selectorFamily)({key:"scorecard-state-default",get:e=>async({get:t})=>{const n=t(E);return(0,r.isEmpty)(n)?(0,r.get)(new h.HI(y),e):(0,r.get)(t(D(n)),e)}})}),U=(0,i.selectorFamily)({key:"scorecard-dirty-state-selector",get:({key:e,path:t})=>({get:n})=>(0,r.get)(n(C(e)),t),set:({key:e,path:t})=>({get:n,set:i},o)=>{const a=n(C(e)),l=(0,r.set)((0,r.cloneDeep)(a),t,o);i(C(e),l)}}),N=(0,i.atom)({key:"scorecard-config-error-state",default:{}}),T=(0,i.selectorFamily)({key:"scorecard-config-error-selector",get:e=>({get:t})=>(0,r.get)(t(N),e),set:e=>({set:t},n)=>{t(N,t=>(0,r.set)(t,e,n))}}),I=(0,i.atom)({key:"scorecard-edit-state",default:{}}),P=(0,i.atom)({key:"refresh-scorecard",default:0}),R=(0,i.atomFamily)({key:"scorecard-name-sort",default:{orgUnit:d.hn.DEFAULT,data:d.hn.DEFAULT}}),O=(0,i.atomFamily)({key:"scorecard-view-config",default:(0,i.selectorFamily)({key:"scorecardViewStateSelector",get:e=>({get:t})=>{var n,i;const o=t(E),{calendar:l}=t(u),s=t(D(o));var c;if("periodSelection"===e&&(0,r.isEmpty)(null===s||void 0===s||null===(c=s.periodSelection)||void 0===c?void 0:c.periods)){const{periodType:e}=s,t=(new a.aA).setCalendar(l).setPreferences({allowFuturePeriods:!0});if(e)return t.setType(e),"Yearly"===e?{periods:[null===t||void 0===t||null===(n=t.get())||void 0===n?void 0:n.list()[0]],periodType:e}:{periods:null===t||void 0===t||null===(i=t.get())||void 0===i?void 0:i.list(),periodType:e}}return s[e]}})}),L=(0,i.selectorFamily)({get:e=>({get:t})=>{const n=t(O("legendDefinitions"));return e?(0,r.filter)(n,({isDefault:e})=>e):(0,r.filter)(n,({isDefault:e})=>!e)}}),F=(0,i.atomFamily)({key:"scorecard-table-state",default:{orgUnit:d.hn.DEFAULT,data:d.hn.DEFAULT}}),x=(0,i.selector)({key:"scorecard-table-orientation-default",get:({get:e})=>{var t;const{showDataInRows:n}=null!==(t=e(O("options")))&&void 0!==t?t:{};return n?d.t4.DATA_VS_ORG_UNIT:d.t4.ORG_UNIT_VS_DATA},set:({set:e},t)=>{e(O("options"),e=>(0,r.set)((0,r.cloneDeep)(e),"showDataInRows",t===d.t4.DATA_VS_ORG_UNIT))}}),G=(0,i.selectorFamily)({key:"scorecard-table-details",get:e=>({get:t})=>{const n=t(x),r=t(Y),{dataGroups:i}=t(O("dataSelection")),{averageColumn:o}=t(O("options")),{filteredOrgUnits:a,childrenOrgUnits:l}=t(_(e)),{width:s}=t(p),c=(0,m.dL)(r,i,o),u=(0,m.QB)(s,c),d=(0,m.Dp)(r,[...a,...l],o),g=(0,m.QB)(s,d);return"orgUnitsVsData"===n?{rows:"orgUnits",columns:["groups","data","periods"],tableWidth:(0,m.hp)(r,i,o),colSpan:c+2,nameColumnWidth:u}:{rows:"data",columns:["orgUnits","periods"],tableWidth:(0,m.H1)(r,[...a,...l],o),colSpan:d+2,nameColumnWidth:g}}}),_=(0,i.atomFamily)({key:"selected-org-unit-state",default:(0,i.selectorFamily)({key:"selected-org-units-default",get:e=>async({get:t})=>{var n;let i=[];const o=t(ie(e));return 1===e.length&&(0,A.Gx)((0,r.head)(e))&&(i=t(te((0,r.head)(e)))),{childrenOrgUnits:i,filteredOrgUnits:o,orgUnitsCount:(null===(n=i)||void 0===n?void 0:n.length)+(null===o||void 0===o?void 0:o.length)}}})}),B=(0,i.atom)({key:"data-source-state",default:(0,i.selector)({key:"scorecard-data-sources-default",get:({get:e})=>{var t;const{dataGroups:n}=null!==(t=e(O("dataSelection")))&&void 0!==t?t:{};return(0,m.Ik)(n)}})}),V=(0,i.atomFamily)({key:"data-loading-state"}),M=(0,i.selector)({key:"is-specific-targets-set",get:({get:e})=>{const{dataGroups:t}=e(O("dataSelection")),n=(0,m.$q)(t);return(0,r.some)(n,"specificTargetsSet")}}),j=(0,i.atomFamily)({key:"scorecard-force-update-state",default:0});(0,i.atomFamily)({key:"scorecard-in-search-state",default:!1});var Q=D;const Y=(0,i.selector)({key:"period-resolver",get:({get:e})=>{var t,n;const{periods:i}=null!==(t=e(O("periodSelection")))&&void 0!==t?t:{},{calendar:o}=null!==(n=e(u))&&void 0!==n?n:{calendar:"gregorian"};if(!(0,r.isEmpty)(i)){const e=(0,r.filter)(i,({id:e})=>{var t;const n=(new a.aA).setPreferences({allowFuturePeriods:!0}).setCalendar(o).getById(e);return null===n||void 0===n||null===(t=n.type)||void 0===t?void 0:t.match(RegExp("Relative"))});let t=[...(0,r.differenceBy)(i,e,"id")];for(const n of e){const e=(new a.aA).setPreferences({allowFuturePeriods:!0}).setCalendar(o).getById(null===n||void 0===n?void 0:n.id),i=(0,r.isArray)(null===e||void 0===e?void 0:e.iso)?null===e||void 0===e?void 0:e.iso:[null===e||void 0===e?void 0:e.iso];t=t.concat(i)}return(0,r.uniqBy)((0,r.compact)(t),"id")}return[]}}),{atomFamily:H}=n(65298),W={orgUnit:{resource:"organisationUnits",id:({id:e})=>e,params:{fields:["id","displayName","path","level"]}}},q={analytics:{resource:"analytics",params:({id:e,level:t})=>({dimension:[`ou:${e};LEVEL-${t}`,`pe:${(new Date).getFullYear()}`],skipData:!0,hierarchyMeta:!0,showHierarchy:!0})}},J={analytics:{resource:"analytics",params:({ou:e,pe:t})=>({dimension:[`ou:${e.join(";")}`,`pe:${t}`],skipData:!0,hierarchyMeta:!0,showHierarchy:!0})}},z={levels:{resource:"organisationUnitLevels",params:{fields:["id","displayName","level"]}}},K={groups:{resource:"organisationUnitGroups",params:{fields:["id","displayName"]}}},X=(0,i.atom)({key:"org-unit-levels",default:(0,i.selector)({key:"org-unit-levels-default",get:async({get:e})=>{const t=e(o),{levels:n}=await t.query(z);return null===n||void 0===n?void 0:n.organisationUnitLevels}})}),Z=(0,i.atom)({key:"org-unit-group",default:(0,i.selector)({key:"org-unit-group-default",get:async({get:e})=>{const t=e(o),{groups:n}=await t.query(K);return null===n||void 0===n?void 0:n.organisationUnitGroups}})}),$=(0,i.selectorFamily)({key:"orgUnitSelector",get:e=>async({get:t})=>{try{const n=t(o),{orgUnit:r}=await n.query(W,{variables:{id:e}});return r}catch(n){return{}}}}),ee=H({key:"orgUnitPath",default:(0,i.selectorFamily)({key:"orgUnitPathSelector",get:(e="")=>async({get:t})=>{var n;const i=(0,r.compact)(e.split("/"));return(null===(n=(0,r.sortBy)(t(ie(i)),"level"))||void 0===n?void 0:n.map(({displayName:e})=>e)).join("/")}})}),te=(0,i.selectorFamily)({key:"org-unit-children",get:e=>async({get:t})=>{const n=t(o),r=t($(e));if(r){var i;const{analytics:t}=await n.query(q,{variables:{id:e,level:r.level+1}});return null!==(i=(0,A.AM)(t))&&void 0!==i?i:[]}}}),ne=(0,i.selector)({key:"last-org-unit-level",get:({get:e})=>{const t=e(X);return(0,r.reduce)(t,(e,t)=>t.level>e.level?t:e)}}),re=(0,i.selector)({key:"initial-org-units-resolver",get:async({get:e})=>{var t,n,i,o;const{orgUnits:a,levels:l,groups:s,userOrgUnit:c,userSubUnit:u,userSubX2Unit:d}=null!==(t=e(O("orgUnitSelection")))&&void 0!==t?t:{},g=null!==(n=e(Y))&&void 0!==n?n:[],v=e(X),{dataGroups:p}=null!==(i=e(O("dataSelection")))&&void 0!==i?i:{},h=null!==(o=(0,m.Ik)(p))&&void 0!==o?o:[],{organisationUnits:A}=e(f);let y=a;if(!(0,r.isEmpty)(h)&&!(0,r.isEmpty)(g)){var E,S;if(d&&(y=[...y,{id:"USER_ORGUNIT_GRANDCHILDREN"}]),u&&(y=[...y,{id:"USER_ORGUNIT_CHILDREN"}]),c&&(y=[...y,...A]),!(0,r.isEmpty)(l))y=[...y,...null!==(E=null===l||void 0===l?void 0:l.map(e=>{var t;return{id:`LEVEL-${null===(t=(0,r.find)(v,{id:e}))||void 0===t?void 0:t.level}`}}))&&void 0!==E?E:[]];if(!(0,r.isEmpty)(s))y=[...y,...null!==(S=null===s||void 0===s?void 0:s.map(e=>({id:`OU_GROUP-${e}`})))&&void 0!==S?S:[]]}return{orgUnits:(0,r.uniqBy)(y,"id")}}}),ie=(0,i.selectorFamily)({key:"selected-org-units-resolver",get:e=>async({get:t})=>{try{const n=t(o),i=(0,r.chunk)(e,5),a=await Promise.all(i.map(e=>(async(e,t)=>{const n=(new Date).getFullYear(),{analytics:r}=await e.query(J,{variables:{ou:null!==t&&void 0!==t?t:[],pe:n}});return(0,A.AM)(r)})(n,e)));return(0,r.flatten)(a)}catch(n){return console.error(n),[]}}}),oe=(0,i.atom)({key:"should-validate-state",default:!1}),ae=(0,i.selectorFamily)({key:"text-fields-error-state",get:({id:e,validations:t})=>({get:n})=>{if(n(oe)){const i=n(C(e));if(null!==t&&void 0!==t&&t.mandatory&&(0,r.isEmpty)(i))return l.A.t("This field is required")}}}),le=(0,i.selector)({key:"scorecard-error-state",get:({getCallback:e})=>e(({snapshot:e})=>()=>e.getLoadable((0,i.waitForAll)([...null===d.Ws||void 0===d.Ws?void 0:d.Ws.map(e=>ae({id:e,validations:{mandatory:!0}})),se])).contents)}),se=(0,i.selector)({key:"data-groups-error-state",get:({get:e})=>{if(e(oe)){var t;const n=null===(t=e(C("dataSelection")))||void 0===t?void 0:t.dataGroups;return(0,m.V3)(n)||null}}}),ce=(0,i.selectorFamily)({key:"data-groups-validator",get:e=>({get:t})=>{const n=t(se);return null===n||void 0===n?void 0:n[e]}});var ue=(0,i.atom)({key:"router-state",default:{previous:"/"}});const de=(0,i.atom)({key:"help-state",default:!1}),me=(0,i.atom)({key:"intro-js-state",default:[]}),ge=(0,i.atom)({key:"current-step-index",default:0});var fe=de;const ve={keys:{resource:"dataStore/functions"}},pe=(0,i.atom)({key:"customFunctionsKeys",default:(0,i.selector)({key:"customFunctionKeysSelector",get:async({get:e})=>{try{const t=e(o),{keys:n}=await t.query(ve);return n||[]}catch(t){return[]}}})}),he=(0,i.atom)({key:"customFunctions",default:(0,i.selector)({key:"customFunctionsSelector",get:async({get:e})=>{const t=e(o),n=e(pe);return await(0,A.pu)(n,t)}})}),Ae=(0,i.atom)({key:"highlighted-indicators-state",default:(0,i.selector)({key:"highlighted-indicators-selector",get:async({get:e})=>{const{orgUnits:t}=e(re),n=e(Y),i=e(O("highlightedIndicators"));if(!(0,r.isEmpty)(t)&&!(0,r.isEmpty)(n)&&!(0,r.isEmpty)(i)){var o,a;const e=await(0,A.WP)({orgUnits:[null===(o=t[0])||void 0===o?void 0:o.id],periods:[null===(a=n[0])||void 0===a?void 0:a.id],highlightedIndicators:null===i||void 0===i?void 0:i.map(({id:e})=>e)});if(!(0,r.isEmpty)(e)){const{rows:t,headers:n}=e._data,i=(0,r.findIndex)(n,["name","dx"]),o=(0,r.findIndex)(n,["name","value"]),a={};for(const e of t)a[e[i]]=e[o];return a}return[]}}})}),ye=(0,i.selectorFamily)({key:"highlighted-indicator-single-selector",get:e=>({get:t})=>(0,r.get)(t(Ae),e)})},96359:function(e,t,n){n.r(t),n.d(t,{default:function(){return z}});var r=n(79753),i=n(39761),o=n(65195),a=n(15087),l=n(58749),s=n(637),c=n(42937),u=n(28228),d=n(43541),m=n(65296),g=n(24648),f=n(53012),v=n(46518),p=n(67179),h=n(4147),A=n(78673),y=n(94455),E=n(3314),S=n(21758);const w="4",b="cv";async function k(){if("caches"in window)try{const e=(await caches.keys()).filter(e=>e.includes("hisptz-scorecard")).map(e=>caches.delete(e));await Promise.all(e),console.log("Caches cleared")}catch(e){console.warn("Error clearing caches:",e)}}async function D(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.getRegistrations();for(const t of e)await t.unregister();console.log("Service workers unregistered")}catch(e){console.warn("Error unregistering service workers:",e)}}var C={initialize:async function(){const e=new URL(window.location.href),t=e.searchParams.get(b);if(t!==w){if(sessionStorage.setItem("scrollPosition",window.scrollY),t)return e.searchParams.set(b,w),void window.location.replace(e.toString());e.searchParams.set(b,w),window.history.replaceState({},"",e)}sessionStorage.getItem(`cacheCleared_${w}`)||(sessionStorage.setItem(`cacheCleared_${w}`,"true"),Promise.all([k(),D(),new Promise(e=>{setTimeout(()=>{!function(){try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&n.startsWith("hisptz-scorecard")&&e.push(n)}e.forEach(e=>localStorage.removeItem(e)),sessionStorage.clear()}catch(e){console.warn("Error clearing storage:",e)}}(),e()},1e3)})]).catch(console.error)),console.log("Cache buster: Running version",w)}},U=n(16272),N=n(92321),T=n(10103),I=n(26802),P=n(89666),R=n(65298),O=n(51095),L=n(50433);const F=S.lazy(()=>Promise.all([n.e(9691),n.e(3970)]).then(n.bind(n,63970))),x=S.lazy(()=>Promise.all([n.e(9435),n.e(4043),n.e(9131),n.e(1404)]).then(n.bind(n,71404))),G=S.lazy(()=>Promise.resolve().then(n.bind(n,26802)).then(e=>({default:e.ScorecardView}))),_=[{pathname:"/migrate",component:S.lazy(()=>n.e(1709).then(n.bind(n,11709)))},{pathname:"/edit/:id",component:x},{pathname:"/add",component:x},{pathname:"/view/:id",component:G},{pathname:"/",component:F}];function B(){return(0,R.useRecoilValue)(I.SystemSettingsState),S.createElement(O.I9,null,S.createElement(P.ErrorBoundary,{FallbackComponent:I.FullPageError},S.createElement(S.Suspense,{fallback:S.createElement(I.FullPageLoader,null)},S.createElement(L.dO,null,_.map(({pathname:e,component:t})=>{const n=t;return S.createElement(L.qh,{key:e,path:e},S.createElement(P.ErrorBoundary,{FallbackComponent:I.FullPageError},S.createElement(n,null)))}),S.createElement(L.qh,{path:"/*"},S.createElement(L.rd,{to:"/"}))))))}var V=n(66190),M=JSON.parse('{"Welcome to Scorecard App!":"Welcome to Scorecard App!","Create a scorecard instantly, over tea break":"Create a scorecard instantly, over tea break","New Scorecard":"New Scorecard","Please select at least one organisation unit":"Please select at least one Project","Organisation Unit":"Project","Select Access":"Select Access","Add":"Add","Edit":"Edit","Delete":"Delete","Sharing":"Sharing","Shared With":"Shared With","Add Access":"Add Access","No Access":"No Access","Can Read":"Can Read","Can Read and Write":"Can Read and Write","Save":"Save","Cancel":"Cancel","Click to configure, drag to rearrange":"Click to configure, drag to rearrange","Click to {{linkAction}}":"Click to {{linkAction}}","unlink":"unlink","link":"link","Click to {{action}}, drag to rearrange":"Click to {{action}}, drag to rearrange","collapse":"collapse","expand":"expand","Add a data source":"Add a data source","Add Item":"Add Item","Organisation Unit(s)":"Project(s)","Change":"Change","Organisation Unit Specific Targets":"Project Specific Targets","Other Periods":"Other Periods","Update":"Update","Period Specific Targets":"Period Specific Targets","Period":"Period","Change Period":"Change Period","Organisation unit(s)":"Project(s)","Organisation unit levels":"Project levels","Legends":"Legends","Other Organisation Units":"Other Projects","Set Specific Targets":"Set Specific Targets","Specific target type":"Specific target type","Organisation Unit Level":"Project Level","Add Data source":"Add Data source","Please select at least one data source for this group":"Please select at least one data source for this group","Add Group":"Add Group","Configure Data Sources":"Configure Data Sources","Add a data source group":"Add a data source group","Modify the group name":"Modify the group name","Add different data sources to a group":"Add different data sources to a group","Click on a data source to configure it":"Click on a data source to configure it","View the changes on the preview panel above":"View the changes on the preview panel above","Select a data source to configure":"Select a data source to configure","Search for Indicator":"Search for Indicator","Groups":"Groups","Name":"Name","Label":"Label","Label is required":"Label is required","Weight":"Weight","Effective Gap":"Effective Gap","Display Arrows":"Display Arrows","High is Good":"High is Good","Show Colors":"Show Colors","Title":"Title","Title is required":"Title is required","A scorecard with the title \'{{value}}\' already exists. Please select another title":"A scorecard with the title \'{{value}}\' already exists. Please select another title","Subtitle":"Subtitle","Description":"Description","Period Type":"Period Type","Custom Header":"Custom Header","Additional Labels (Tags)":"Additional Labels (Tags)","Legend Definitions":"Legend Definitions","Year":"Year","Period type is required":"Period type is required","Fixed Periods":"Fixed Periods","Relative Periods":"Relative Periods","Highlighted Indicators":"Highlighted Indicators","Add Highlighted Indicator":"Add Highlighted Indicator","Scorecard updated successfully":"Scorecard updated successfully","Scorecard added successfully":"Scorecard added successfully","Please fill in all required fields":"Please fill in all required fields","Help":"Help","Saving":"Saving","Save and exit":"Save and exit","Save and continue":"Save and continue","Exit without saving":"Exit without saving","General":"General","Data Configuration":"Data Configuration","Access":"Access","Options":"Options","Scorecard deleted successfully":"Scorecard deleted successfully","Confirm scorecard delete":"Confirm scorecard delete","Are you sure you want to delete scorecard ":"Are you sure you want to delete scorecard ","View":"View","No scorecards found":"No scorecards found","Could not find scorecards matching the keyword ":"Could not find scorecards matching the keyword ","Start a guided tour":"Start a guided tour","Documentation":"Documentation","Search":"Search","Switch to {{viewType}} view":"Switch to {{viewType}} view","list":"list","grid":"grid","Add New Scorecard":"Add New Scorecard","Preparing migration...":"Preparing migration...","Migrating scorecards":"Migrating scorecards","of":"of"}');V.A.addResources("en","default",M);n(12957);var j=()=>{const{initializeState:e}=(0,I.useInitApp)();return S.createElement(U.b,{namespace:I.DATASTORE_NAMESPACE,loadingComponent:S.createElement(I.FullPageLoader,null)},S.createElement(N.v,null),S.createElement(R.RecoilRoot,{initializeState:e},S.createElement(P.ErrorBoundary,{FallbackComponent:I.FullPageError},S.createElement(T.sQ,null,S.createElement(S.Suspense,{fallback:S.createElement(I.FullPageLoader,null)},S.createElement("div",{className:"main-container"},S.createElement(B,null)))))))},Q="App_sidebar__EbNVl",Y="App_logo__h5EGN",H="App_menu__Y4oQE";const{Sider:W,Content:q}=A.A,J={me:{resource:"me",params:{fields:["firstName","surname","email"]}}};var z=()=>{(0,S.useEffect)(()=>{C.initialize()},[]);const[e,t]=(0,S.useState)(!1),[n,w]=(0,S.useState)(["3"]),{loading:b,error:k,data:D}=(0,h.iO)(J);if(b||k)return null;const{firstName:U,surname:N,email:T}=D.me,I=(null===U||void 0===U||U[0],null===N||void 0===N||N[0],S.createElement(y.A,null,S.createElement(y.A.Item,{key:"profile-settings",icon:S.createElement(r.A,null)},S.createElement("a",{href:"/sims-web-user-profile/#/profile"},"Settings")),S.createElement(y.A.Item,{key:"account",icon:S.createElement(i.A,null)},S.createElement("a",{href:"/sims-web-user-profile/#/account"},"Account")),S.createElement(y.A.Item,{key:"logout",icon:S.createElement(o.A,null)},S.createElement("a",{href:"/dhis-web-commons-security/logout.action"},"Logout")))),P=(a.A,a.A,a.A,a.A,[{key:"5.1",icon:S.createElement(l.A,null),label:S.createElement("a",{href:"/sims-web-usage-analytics/"},"Usage Analytics")},{key:"5.2",icon:S.createElement(s.A,null),label:S.createElement("a",{href:"/sims-web-user/"},"User Management")},{key:"5.3",icon:S.createElement(r.A,null),label:S.createElement("a",{href:"/sims-web-settings/"},"System Settings")},{key:"5.4",icon:S.createElement(a.A,null),label:S.createElement("a",{href:"/sims-web-maintenance/#/organisationUnitSection/hierarchy"},"Hierarchy Operations")}]),R=[{key:"3.1",label:S.createElement("a",{href:"/sims-web-capture/"},"Forms"),icon:S.createElement(c.A,null)},{key:"3.2",label:S.createElement("a",{href:"/sims-web-aggregate-data-entry/"},"Spreadsheets"),icon:S.createElement(u.A,null)},{key:"3.3",label:S.createElement("a",{href:"/sims-web-import-export/"},"Data Import & Export"),icon:S.createElement(d.A,null)}];return S.createElement(A.A,{style:{height:"100vh"}},S.createElement(W,{trigger:null,collapsible:!0,width:"20%",collapsedWidth:80,collapsed:e,onCollapse:e=>t(e),breakpoint:"lg",onBreakpoint:e=>t(e),className:Q,style:{padding:"10px 0",transition:"width 0.2s",background:"#003D8F",borderRight:"1px solid #d9d9d9",overflow:"hidden"}},S.createElement("div",{style:{display:"flex",flexDirection:"column",background:"#003D8F",height:"100%"}},S.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",flexShrink:0}},S.createElement("div",{className:Y,style:{flexDirection:e&&"column-reverse"}},S.createElement(E.Ay,{type:"text",className:"",icon:S.createElement(m.A,{fontSize:"medium"}),onClick:()=>t(!e),style:{width:"16px",height:"16px",color:"#fff"}}),S.createElement("div",null,S.createElement("img",{src:"./sims-sidebar-logo.png",alt:"SIMS",style:{width:e?"30px":"40px",height:e?"30px":"40px",objectFit:"cover",transition:"all 0.2s",filter:"brightness(0) invert(1)"}})))),S.createElement("div",{style:{overflowY:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",height:"100%"}},S.createElement(y.A,{selectedKeys:["1"],openKeys:n,onOpenChange:e=>{const t=e.find(e=>!n.includes(e));["2","5"].includes(t)?w(t?[t]:[]):w(e)},style:{height:"100%"},className:H,defaultSelectedKeys:["1"],defaultOpenKeys:["sub1"],mode:"inline",inlineCollapsed:e},S.createElement(y.A.Item,{key:"1",icon:S.createElement(g.A,null)},S.createElement("a",{href:"/sims-web-app/"},"Home")),S.createElement(y.A.Divider,null),S.createElement(y.A.SubMenu,{key:"2",icon:S.createElement(f.A,null),title:"Activation"},S.createElement(y.A.Item,{key:"2.1",title:"Thematic Areas",icon:S.createElement(a.A,null)},S.createElement("a",{href:"/sims-web-maintenance/#/list/organisationUnitSection/organisationUnit"},"Thematic Areas")),S.createElement(y.A.Item,{key:"2.2",icon:S.createElement(a.A,null)},S.createElement("a",{href:"/sims-web-maintenance/#/list/organisationUnitSection/programsHierarchy"},"Programs")),S.createElement(y.A.Item,{key:"2.3",icon:S.createElement(a.A,null)},S.createElement("a",{href:"/sims-web-maintenance/#/list/programSection/program"},"Projects")),S.createElement(y.A.Item,{key:"2.4",icon:S.createElement(a.A,null)},S.createElement("a",{href:"/sims-web-maintenance/#/list/dataElementSection/dataElement"},"Data Elements")),S.createElement(y.A.Item,{key:"2.5",icon:S.createElement(a.A,null)},S.createElement("a",{href:"/sims-web-maintenance/#/list/dataSetSection/dataSet"},"Data Sets"))),S.createElement(y.A.Divider,null),S.createElement(y.A.SubMenu,{key:"3",icon:S.createElement(v.A,null),title:"Data Collection"},R.map(e=>S.createElement(y.A.Item,{key:e.key,icon:e.icon},e.label))),S.createElement(y.A.Divider,null),S.createElement(y.A.Item,{key:"4",icon:S.createElement(p.A,null)},S.createElement("a",{href:"/sims-web-dashboard/"},"Visualization")),S.createElement(y.A.Divider,null),S.createElement(y.A.SubMenu,{key:"5",icon:S.createElement(i.A,null),title:"Admin Centre",style:{marginTop:"auto"}},P.map(e=>S.createElement(y.A.Item,{key:e.key,icon:e.icon},e.label))))),S.createElement("div",null,I))),S.createElement(A.A,{style:{padding:"0 15px 15px 15px",height:"100vh",overflow:"hidden"}},S.createElement("div",{style:{backgroundColor:"#F9FAFB",borderRadius:"8px",padding:"10px 16px"}}),S.createElement(q,{style:{margin:0,display:"flex",flexDirection:"column",padding:0,height:"100%",overflow:"auto"}},S.createElement(j,null))))}}}]);
//# sourceMappingURL=app.31eb1d4a.chunk.js.map