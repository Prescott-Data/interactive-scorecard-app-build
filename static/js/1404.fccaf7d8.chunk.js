"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[1404],{71404:function(e,t,a){a.r(t),a.d(t,{default:function(){return It}});var n=a(66190),l=a(80629),i=a(77337),o=a(34174),r=a(58981),c=a(62792),d=a(77745),s=a(52637),u=a(26802),m=a(75038),v=a(21758),p=a(22199),g=a(50433),E=a(65298),h=a(4147),f=a(10353),S=a(59541),y=a(83590),A=a(65797),b=a(10103);function N(){const{setValue:e,watch:t,register:a,formState:l}=(0,p.xW)();a("orgUnitSelection",{validate:{atLeastOneOrgUnit:e=>!!function({groups:e,levels:t,orgUnits:a,userOrgUnit:n,userSubUnit:l,userSubX2Unit:i}){return i||l||n||e.length>0||t.length>0||a.length>0}(e)||n.A.t("Please select at least one organisation unit")}});const i=t("orgUnitSelection"),o=(0,v.useCallback)(t=>{e("orgUnitSelection",t)},[e]),r=(0,S.get)(l.errors,"orgUnitSelection");return v.createElement("div",{className:"column h-100"},v.createElement("div",{className:"pt-16 pb-16"},v.createElement("h3",null,n.A.t("Organisation Unit"))),r&&v.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"8px 0",color:y.T.red500}},v.createElement(A.A,null),null===r||void 0===r?void 0:r.message),v.createElement("div",{style:{minHeight:400},className:"access-org-unit-filter h-100"},v.createElement(v.Suspense,{fallback:v.createElement(u.ContainerLoader,{height:400})},v.createElement(b.EK,{showGroups:!0,showLevels:!0,showUserOptions:!0,onUpdate:e=>{o(u.OrgUnitSelection.setObject(i,e))},value:i}))))}var C=a(20851),w=a(50059);function x(){const{watch:e,setValue:t}=(0,p.xW)(),a=e("publicAccess"),n=(0,v.useCallback)(e=>{t("publicAccess",e)},[t]),l=e("userGroupAccesses"),i=(0,v.useCallback)(e=>{t("userGroupAccesses",e)},[t]),o=e("userAccesses"),r=(0,v.useCallback)(e=>{t("userAccesses",e)},[t]),c=(0,v.useMemo)(()=>[...o||[],...l||[]],[o,l]),d=(0,v.useCallback)(e=>{n(e)},[n]),s=(0,v.useCallback)(e=>{const{type:t}=e||{};if("user"===t){const t=(0,S.cloneDeep)(o);return(0,S.remove)(t,["id",null===e||void 0===e?void 0:e.id]),void r(t)}const a=(0,S.cloneDeep)(l);(0,S.remove)(a,["id",null===e||void 0===e?void 0:e.id]),i(a)},[r,i,o,l]),m=(0,v.useCallback)(e=>{const{type:t}=e||{};if(t===u.AccessTypes.USER){const t=(0,S.findIndex)(o,["id",null===e||void 0===e?void 0:e.id]);r((0,f.Ay)(o,a=>{(0,S.set)(a,[t],e)}))}const a=(0,S.findIndex)(l,["id",null===e||void 0===e?void 0:e.id]);i((0,f.Ay)(l,t=>{(0,S.set)(t,[a],e)}))},[r,i,o,l]);return{onAdd:(0,v.useCallback)((e,t)=>{e&&t&&("user"===(null===t||void 0===t?void 0:t.type)?r([...null!==o&&void 0!==o?o:[],new u.ScorecardAccess({id:null===t||void 0===t?void 0:t.id,displayName:null===t||void 0===t?void 0:t.displayName,type:"user",access:e})]):i([...null!==l&&void 0!==l?l:[],new u.ScorecardAccess({id:null===t||void 0===t?void 0:t.id,displayName:null===t||void 0===t?void 0:t.displayName,type:"userGroup",access:e})]))},[r,i,o,l]),publicAccess:a,onPublicAccessChange:d,userAndUserGroupAccesses:c,onDelete:s,onUpdate:m}}var k=a(28384),I=a(35949),T=a(26722),D=a(42153),H=a(70759),L=a(28463);function P(e=""){switch(e){case u.ScorecardAccessType.NO_ACCESS:return n.A.t("No Access");case u.ScorecardAccessType.READ_ONLY:return n.A.t("Can Read");case u.ScorecardAccessType.READ_WRITE:return n.A.t("Can Read and Write")}}function $(e=""){switch(e){case"public":return v.createElement(L.A,null);case"user":return v.createElement(H.A,null);case"userGroup":return v.createElement(D.A,null)}}var G=a(90535),U=a(19125),O=a(33791),R=a(80068);function _({reference:e,onClose:t,selectedAccess:a,onAccessChange:n}){return v.createElement(G.W,{onClick:t},v.createElement(U.N,{reference:e,placement:"bottom-start"},v.createElement(O.n,null,null===u.ACCESS_TYPES||void 0===u.ACCESS_TYPES?void 0:u.ACCESS_TYPES.map(e=>v.createElement(v.Fragment,{key:e},v.createElement(k.D,{onClick:()=>n(e),active:a===e,label:P(e),icon:a===e&&v.createElement(R.A,null)}))))))}function V({access:e,onDelete:t,onAccessChange:a}){const{access:l,type:r,displayName:c}=e,[d,s]=(0,v.useState)();return v.createElement(k.D,{icon:$(r),label:v.createElement("div",{className:"row space-between align-items-center"},v.createElement("div",{className:"column"},v.createElement("p",{style:{margin:2,fontSize:16}},c),v.createElement("p",{style:{color:y.T.grey700,fontSize:14,margin:0}},P(l))),v.createElement("div",{className:"column align-items-end"},v.createElement(o.v,{className:"edit-delete-access"},v.createElement(i.$,{onClick:(e,t)=>s(t.currentTarget),icon:v.createElement(T.A,null)},n.A.t("Edit")),Boolean(t)&&v.createElement(i.$,{onClick:()=>{t(e)},icon:v.createElement(I.A,null)},n.A.t("Delete")))),d&&v.createElement(_,{reference:d,onClose:()=>s(void 0),selectedAccess:l,onAccessChange:t=>{const n=(0,S.cloneDeep)(e);(0,S.set)(n,["access"],t),a(n),s(void 0)}}))})}function F(){const{publicAccess:e,onPublicAccessChange:t,userAndUserGroupAccesses:a,onUpdate:n,onDelete:l}=x();return v.createElement("div",null,v.createElement(C.W,{dense:!0},v.createElement(V,{onAccessChange:t,access:e}),v.createElement(w.N,null),null===a||void 0===a?void 0:a.map(e=>v.createElement(v.Fragment,{key:null===e||void 0===e?void 0:e.id},v.createElement(V,{onAccessChange:n,access:e,onDelete:l}),v.createElement(w.N,null)))))}var M=a(37526),W=a(12862),j=a(25363),B=a(19660);const q={users:{resource:"users",params:({keyword:e})=>({filter:[`displayName:ilike:${e}`],fields:["id","displayName"],order:"name:asc"})},userGroups:{resource:"userGroups",params:({keyword:e})=>({filter:e?[`displayName:ilike:${e}`]:void 0,fields:["id","name","displayName"],order:"name:asc"})}};function Y({data:e,onSelect:t,reference:a,onClose:n}){return a?v.createElement(U.N,{className:"layer-1",reference:a,placement:"bottom-start"},v.createElement(O.n,{maxHeight:"400px"},null===e||void 0===e?void 0:e.map(e=>v.createElement(k.D,{key:null===e||void 0===e?void 0:e.id,onClick:()=>(t(e),void n()),label:null===e||void 0===e?void 0:e.displayName,icon:$(null===e||void 0===e?void 0:e.type)})))):null}function X({selected:e,onChange:t,selectedList:a=[]}){const[n,l]=(0,v.useState)(null===e||void 0===e?void 0:e.displayName),{data:i,loading:o,error:r,setKeyword:c}=function(e){const[t,a]=(0,v.useState)(e),{data:n,errors:l,loading:i,refetch:o}=(0,h.iO)(q,{variables:{keyword:t},lazy:!0});return(0,v.useEffect)(()=>{t&&o({keyword:t})},[t]),{data:(0,v.useMemo)(()=>{var e,t,a,l;return[...(null===n||void 0===n||null===(e=n.users)||void 0===e||null===(t=e.users)||void 0===t?void 0:t.map(e=>({...e,type:"user"})))||[],...(null===n||void 0===n||null===(a=n.userGroups)||void 0===a||null===(l=a.userGroups)||void 0===l?void 0:l.map(e=>({...e,type:"userGroup"})))||[]]},[null===n||void 0===n?void 0:n.users,null===n||void 0===n?void 0:n.userGroups]),errors:l,loading:i,setKeyword:a}}(n),d=(0,v.useRef)(),[s,u]=(0,v.useState)(),m=(0,S.debounce)(()=>{c(null===n||void 0===n?void 0:n.trim())},1e3);(0,v.useEffect)(()=>{e||l(void 0)},[e]);return v.createElement(v.Fragment,null,v.createElement("div",{ref:d},v.createElement(B.F,{loading:o,error:r,validationText:null===r||void 0===r?void 0:r.message,label:"Select User or User Group",value:n,onChange:({value:e},t)=>{l(e),u(null===t||void 0===t?void 0:t.target),m()}})),s&&!(0,S.isEmpty)(i)&&v.createElement(Y,{onClose:()=>u(void 0),reference:s,onSelect:e=>{l(null===e||void 0===e?void 0:e.displayName),t(e)},data:(0,S.filter)(i,({id:e})=>!(null!==a&&void 0!==a&&a.includes(e)))}))}function z(){const{userAndUserGroupAccesses:e,onAdd:t}=x(),[a,l]=(0,v.useState)(),[o,r]=(0,v.useState)(),c=e;return v.createElement("div",{className:"row align-items-end add-sharing-access"},v.createElement("div",{className:"column pr-16 user-selector",style:{width:"50%"}},v.createElement(X,{selectedList:null===c||void 0===c?void 0:c.map(({id:e})=>e),selected:a,onChange:l})),v.createElement("div",{className:"column pr-16",style:{width:"30%"}},v.createElement(M.l,{className:"access-selector",required:!0,selected:o,onChange:({selected:e})=>{r(e)},label:n.A.t("Select Access")},null===u.ACCESS_TYPES||void 0===u.ACCESS_TYPES?void 0:u.ACCESS_TYPES.map(e=>v.createElement(W.e,{value:e,key:e,label:P(e)})))),v.createElement("div",{className:"column",style:{width:"20%"}},v.createElement(i.$,{className:"add-access-button",onClick:()=>{t(o,a),r(void 0),l(void 0)},icon:v.createElement(j.A,null)},n.A.t("Add"))))}function J(){return v.createElement("div",{className:"p-16 pl-32"},v.createElement("div",null,v.createElement("h3",null,n.A.t("Sharing"))),v.createElement("div",null,v.createElement("p",{style:{fontSize:18}},n.A.t("Shared With"))),v.createElement("div",{className:"sharing-list"},v.createElement(F,null)),v.createElement("div",{className:"pt-32"},v.createElement("p",{style:{fontSize:18}},n.A.t("Add Access"))),v.createElement("div",null,v.createElement(z,null)))}function K(){return v.createElement("div",{className:"col-12",style:{height:"100%"}},v.createElement("div",{className:"row center"},v.createElement("div",{className:"info-box"},v.createElement("div",{className:"column"},v.createElement("h2",{className:"info-box-title"},n.A.t("Configure Data Sources")),v.createElement("ul",{className:"info-box-list"},v.createElement("li",null,n.A.t("Add a data source group")),v.createElement("li",null,n.A.t("Modify the group name")),v.createElement("li",null,n.A.t("Add different data sources to a group")),v.createElement("li",null,n.A.t("Click on a data source to configure it")),v.createElement("li",null,n.A.t("View the changes on the preview panel above")))))))}function Z(){return v.createElement("div",{className:"col-12",style:{height:"100%"}},v.createElement("div",{className:"row center align-items-center"},v.createElement("div",{className:"info-box"},v.createElement("div",{className:"column"},v.createElement("p",{style:{fontSize:18,color:y.T.grey600,fontWeight:"bold"}},n.A.t("Select a data source to configure"))))))}var Q=a(41887),ee=a(79817);function te(e){var t;return null!==(t=null===e||void 0===e?void 0:e.filter(e=>!e.isDefault))&&void 0!==t?t:[]}var ae=a(61473),ne=a(92359),le=a(8744),ie=a(27124);function oe({value:e,onChange:t,legendDefinitions:a,highIsGood:n}){return v.createElement(b.Zg,{value:e,legendDefinitions:a,highIsGood:n,valueType:"LEGEND_MIN_MAX_GROUP",name:"legend-min-max-group",onChange:t})}function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},re.apply(null,arguments)}function ce({name:e,value:t=[],onChange:a,multipleFields:n,weight:l,highIsGood:i,...o}){var r;const c=(0,E.useRecoilValue)(u.OrgUnitLevels),{watch:d}=(0,p.xW)(),[s,m]=(0,v.useState)(null===(r=(0,S.head)(c))||void 0===r?void 0:r.id),g=te(d("legendDefinitions")),h=(0,v.useMemo)(()=>{var e;return Array.isArray(t)?(0,S.fromPairs)([...null!==(e=null===c||void 0===c?void 0:c.map(({id:e})=>[e,(0,u.generateLegendDefaults)(n,l,i)]))&&void 0!==e?e:[]]):t},[i,t,n,c,l]),A=(e,t)=>{a({value:(0,f.Ay)(h,a=>(0,S.set)(a,[t],e))})};return(0,v.useEffect)(()=>{Array.isArray(t)&&a({value:h})},[h,t]),v.createElement(ae.D,re({name:e},o),null===c||void 0===c?void 0:c.map(({id:e,displayName:t})=>{var a,n;return v.createElement(ne.A,{expanded:s===e,key:e,onChange:(n=e,(e,t)=>{m(!!t&&n)})},v.createElement(le.A,{style:{background:y.T.grey200}},t),v.createElement(ie.A,null,v.createElement("div",{className:"column w-100"},v.createElement(oe,{highIsGood:i,legendDefinitions:g,value:null!==(a=(0,S.get)(h,e))&&void 0!==a?a:[],onChange:t=>A(t,e)}))))}))}function de({path:e}){const{watch:t,setValue:a}=(0,p.xW)(),n=te(t("legendDefinitions")),l=t(`${e}.weight`),i=t(`${e}.highIsGood`),o=t(`${e}.legends`);return v.createElement(ce,{multipleFields:null===n||void 0===n?void 0:n.map(e=>new u.FormFieldModel({id:e.id,mandatory:!1,name:e.name,legendDefinition:e,valueType:u.DHIS2ValueTypes.LEGEND_MIN_MAX.name})),value:o,onChange:({value:t})=>{a(`${e}.legends`,t)},legends:o,highIsGood:i,weight:l,path:e,name:"legends"})}var se=a(72714),ue=a(2235),me=a(34207),ve=a(24563);function pe({target:e,setTarget:t}){var a;const[l,o]=(0,v.useState)((0,S.isEmpty)(e.items)),r=(0,E.useRecoilValue)((0,u.SelectedOrgUnits)(e.items));return v.createElement(v.Fragment,null,v.createElement("div",{className:" align-items-end row gap-8 w-100"},v.createElement("div",{className:"column flex-1"},v.createElement(B.F,{fullWidth:!0,label:n.A.t("Organisation Unit(s)"),disabled:!0,value:null===r||void 0===r||null===(a=r.map(e=>null===e||void 0===e?void 0:e.displayName))||void 0===a?void 0:a.join(", ")})),v.createElement("div",{className:"w-25"},v.createElement(i.$,{onClick:()=>o(!0)},n.A.t("Change")))),l&&v.createElement(b.ng,{value:{orgUnits:null!==r&&void 0!==r?r:[]},onClose:()=>o(!1),hide:!l,onUpdate:({orgUnits:e})=>{t(t=>({...t,items:null===e||void 0===e?void 0:e.map(e=>e.id)})),o(!1)}}))}function ge({open:e,onClose:t,onUpdate:a,specificTarget:l,defaultLegends:r,onChangeDefaultLegends:c,path:d}){const{watch:s}=(0,p.xW)(),[u,m]=(0,v.useState)(l),g=te(s("legendDefinitions")),E=s(`${d}.highIsGood`),h=(0,v.useCallback)(()=>{a({...u}),t()},[t,a,u]);return v.createElement(se.a,{onClose:t,hide:!e,position:"middle"},v.createElement(ue.w,null,n.A.t("Organisation Unit Specific Targets")),v.createElement(me.$,null,v.createElement(v.Suspense,{fallback:v.createElement("div",{className:"column align-items-center justify-content-center",style:{height:100,width:"100%"}},v.createElement(Q.F,{small:!0}))},v.createElement("div",{className:"column w-100 gap-16"},v.createElement(pe,{target:u,setTarget:m}),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement(oe,{highIsGood:E,legendDefinitions:g,value:u.legends,onChange:e=>{m(t=>({...t,legends:e}))}}))),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement("p",null,n.A.t("Other Periods")),v.createElement(oe,{highIsGood:E,legendDefinitions:g,value:r,onChange:c})))))),v.createElement(ve.N,null,v.createElement(o.v,null,v.createElement(i.$,{onClick:t},n.A.t("Cancel")),v.createElement(i.$,{onClick:h,primary:!0},n.A.t("Update")))))}var Ee=a(2793);function he({open:e,onClose:t,onUpdate:a,specificTarget:l,defaultLegends:r,onChangeDefaultLegends:c,path:d}){var s,m,g,h;const{watch:f}=(0,p.xW)(),[y,A]=(0,v.useState)(l),{calendar:N}=(0,E.useRecoilValue)(u.SystemSettingsState),C=te(f("legendDefinitions")),w=f(`${d}.highIsGood`),[x,k]=(0,v.useState)((0,S.isEmpty)(y.items)),I=(0,v.useCallback)(()=>{a({...y}),t()},[t,a,y]);return v.createElement(se.a,{onClose:t,hide:!e,position:"middle"},v.createElement(ue.w,null,n.A.t("Period Specific Targets")),v.createElement(me.$,null,v.createElement("div",{className:"column w-100 gap-16"},v.createElement("div",{className:" align-items-end row gap-8 w-100"},v.createElement("div",{className:"column flex-1"},v.createElement(B.F,{fullWidth:!0,label:n.A.t("Period"),disabled:!0,value:null===y||void 0===y||null===(s=y.items)||void 0===s||null===(m=s.map(e=>{var t;if(e)return null===(t=(new Ee.aA).setPreferences({allowFuturePeriods:!0}).setCalendar(N).getById(e))||void 0===t?void 0:t.name}))||void 0===m?void 0:m.join(", ")})),v.createElement("div",{className:"w-25"},v.createElement(i.$,{onClick:()=>k(!0)},n.A.t("Change Period")))),x&&v.createElement(b.o0,{enablePeriodSelector:!0,excludeRelativePeriods:!0,singleSelection:!0,selectedPeriods:(0,S.compact)([...null!==(g=null===(h=y.items)||void 0===h?void 0:h.map(e=>{if(e)return e}))&&void 0!==g?g:[]]),onClose:()=>k(!1),hide:!x,onUpdate:e=>{A(t=>{var a;return{...t,items:[null===(a=e[0])||void 0===a?void 0:a.id]}}),k(!1)}}),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement(oe,{highIsGood:w,legendDefinitions:C,value:y.legends,onChange:e=>{A(t=>({...t,legends:e}))}}))),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement("p",null,n.A.t("Other Periods")),v.createElement(oe,{highIsGood:w,legendDefinitions:C,value:r,onChange:c}))))),v.createElement(ve.N,null,v.createElement(o.v,null,v.createElement(i.$,{onClick:t},n.A.t("Cancel")),v.createElement(i.$,{onClick:I,primary:!0},n.A.t("Update")))))}var fe=a(75999);function Se({legends:e,legendDefinitions:t}){return v.createElement("div",{className:"row gap-16 space-evenly"},null===e||void 0===e?void 0:e.map((e,a)=>{var n;const{legendDefinitionId:l,startValue:i,endValue:o}=null!==e&&void 0!==e?e:{},r=null!==(n=(0,S.find)(t,{id:l}))&&void 0!==n?n:{};return v.createElement("div",{className:"row gap-8 align-items-center",key:a},v.createElement("div",{style:{height:32,width:48,background:r.color}}),v.createElement("div",null,`${o} - ${i}`))}))}function ye(e){switch(e){case"period":return n.A.t("Period");case"orgUnit":return n.A.t("Organisation unit(s)");case"orgUnitLevel":return n.A.t("Organisation unit levels")}}function Ae({specificTarget:e,legendDefinitions:t,onUpdate:a,defaultLegends:l}){const{legends:o,items:r}=null!==e&&void 0!==e?e:{},c=(0,E.useRecoilValue)((0,u.SelectedOrgUnits)(r));return v.createElement("div",{style:{border:`1px solid ${y.T.grey500}`,borderRadius:4,padding:8},className:"column gap-8 flex-wrap"},v.createElement("div",{className:"column gap-8 flex-wrap"},v.createElement("b",null,n.A.t("Organisation Unit(s)")),v.createElement("div",{className:"row gap-8 flex-wrap"},null===c||void 0===c?void 0:c.map(e=>v.createElement(fe.v,{key:`${e}-tag`},e.displayName)))),v.createElement("div",null,v.createElement("p",null,n.A.t("Legends")),v.createElement(Se,{legends:o,legendDefinitions:t})),v.createElement("div",null,v.createElement("p",null,n.A.t("Other Organisation Units")),v.createElement(Se,{legends:l,legendDefinitions:t})),v.createElement("div",{className:"row gap-8 justify-content-end"},v.createElement(i.$,{onClick:a},n.A.t("Update"))))}function be({specificTarget:e,legendDefinitions:t,onUpdate:a,defaultLegends:l}){const{legends:o,type:r,items:c}=null!==e&&void 0!==e?e:{},{calendar:d}=(0,E.useRecoilValue)(u.SystemSettingsState);return v.createElement("div",{style:{border:`1px solid ${y.T.grey500}`,borderRadius:4,padding:8},className:"column gap-8 flex-wrap"},v.createElement("div",{className:"column gap-8 flex-wrap"},v.createElement("b",null,ye(r)),v.createElement("div",{className:"row gap-8 flex-wrap"},null===c||void 0===c?void 0:c.map(e=>{var t;return v.createElement(fe.v,{key:`${e}-tag`},null===(t=(new Ee.aA).setPreferences({allowFuturePeriods:!0}).setCalendar(d).getById(e))||void 0===t?void 0:t.name)}))),v.createElement("div",null,v.createElement("p",null,n.A.t("Legends")),v.createElement(Se,{legends:o,legendDefinitions:t})),v.createElement("div",null,v.createElement("p",null,n.A.t(`Other ${ye(r)}`)),v.createElement(Se,{legends:l,legendDefinitions:t})),v.createElement("div",{className:"row gap-8 justify-content-end"},v.createElement(i.$,{onClick:a},n.A.t("Update"))))}function Ne(e){const{name:t,path:a}=null!==e&&void 0!==e?e:{},[n,l]=(0,p.FH)({name:["legendDefinitions",`${a}.highIsGood`]}),i=(0,v.useMemo)(()=>n.filter(e=>!e.isDefault),[n]);return v.createElement(b.tj,{name:t,valueType:"LEGEND_MIN_MAX_GROUP",highIsGood:!l,legendDefinitions:i})}function Ce({path:e}){const{setValue:t}=(0,p.xW)(),[a,l,i,o,r,c]=(0,p.FH)({name:["legendDefinitions",`${e}.specificTargetsSet`,`${e}.specificTargets`,`${e}.legends`,`${e}.weight`,`${e}.highIsGood`]}),d=te(a),[s,m]=(0,v.useState)(!1),[g,E]=(0,v.useState)(function(e,t){var a;return!(0,S.isEmpty)(e)&&t?null===(a=(0,S.head)(e))||void 0===a?void 0:a.type:t?"orgUnitLevel":null}(i,l));return(0,v.useEffect)(()=>{l||(0,S.isEmpty)(i)||(E(null),t(`${e}.specificTargets`,[]))},[l,i,t,e]),(0,v.useEffect)(()=>{var e;g&&(0,S.isEmpty)(null===(e=i[0])||void 0===e?void 0:e.items)&&m(!0)},[g,i]),v.createElement("div",{className:"column gap-16"},v.createElement(b.tj,{valueType:u.DHIS2ValueTypes.TRUE_ONLY.name,label:n.A.t("Set Specific Targets"),name:`${e}.specificTargetsSet`}),l?v.createElement("div",{className:"column gap-16"},v.createElement(M.l,{label:n.A.t("Specific target type"),selected:g,onChange:({selected:a})=>{if("orgUnitLevel"===a)return E(a),t(`${e}.legends`,[]),void t(`${e}.specificTargets`,[]);E(a),t(`${e}.legends`,(0,u.generateLegendDefaults)(d,r,c)),t(`${e}.specificTargets`,[{id:(0,u.uid)(),type:a,items:[],legends:(0,u.generateLegendDefaults)(d,r,c)}])}},v.createElement(W.e,{value:"period",label:n.A.t("Period")}),v.createElement(W.e,{value:"orgUnit",label:n.A.t("Organisation Unit")}),v.createElement(W.e,{value:"orgUnitLevel",label:n.A.t("Organisation Unit Level")})),v.createElement("div",{className:"column gap-8"},v.createElement(v.Suspense,{fallback:v.createElement("div",{className:"column align-items-center justify-content-center",style:{height:100,width:"100%"}},v.createElement(Q.F,{small:!0}))},"orgUnitLevel"!==g&&(null===i||void 0===i?void 0:i.map(a=>"period"===g?v.createElement(be,{defaultLegends:o,onDelete:()=>{t(`${e}.specificTargets`,[])},legendDefinitions:d,onUpdate:()=>m(!0),key:`${a.id}-view`,specificTarget:a}):v.createElement(Ae,{defaultLegends:o,onDelete:()=>{t(`${e}.specificTargets`,[])},legendDefinitions:d,onUpdate:()=>m(!0),key:`${a.id}-view`,specificTarget:a}))))),"period"===g&&s&&!(0,S.isEmpty)(i)?v.createElement(he,{path:e,defaultLegends:o,onChangeDefaultLegends:a=>t(`${e}.legends`,a),specificTarget:i[0],onClose:()=>m(!1),open:s,onUpdate:a=>{m(!1),t(`${e}.specificTargets`,[a])}}):null,"orgUnit"===g&&s&&!(0,S.isEmpty)(i)?v.createElement(ge,{path:e,defaultLegends:o,onChangeDefaultLegends:a=>t(`${e}.legends`,a),specificTarget:i[0],onClose:()=>m(!1),open:s,onUpdate:a=>{m(!1),t(`${e}.specificTargets`,[a])}}):null,"orgUnitLevel"===g&&v.createElement(de,{path:e})):v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement(Ne,{name:`${e}.legends`,path:e}))))}function we({path:e}){const{watch:t,setValue:a}=(0,p.xW)();return(0,v.useEffect)(()=>{e&&a(e,t(e))},[t,e,a]),v.createElement("div",{className:"container p-16 data-source-form-container"},v.createElement("div",{style:{gap:16},className:"column"},v.createElement(b.tj,{disabled:!0,mandatory:!0,valueType:u.DHIS2ValueTypes.TEXT.name,label:n.A.t("Name"),name:`${e}.name`}),v.createElement(b.tj,{mandatory:!0,valueType:u.DHIS2ValueTypes.TEXT.name,label:n.A.t("Label"),name:`${e}.label`,validations:{required:n.A.t("Label is required")}}),v.createElement(b.tj,{valueType:u.DHIS2ValueTypes.NUMBER.name,label:n.A.t("Weight"),name:`${e}.weight`}),v.createElement("div",{className:"row space-between"},v.createElement("div",{className:"column pr-16 effective-gap-settings"},v.createElement(b.tj,{valueType:u.DHIS2ValueTypes.NUMBER.name,label:n.A.t("Effective Gap"),name:`${e}.effectiveGap`})),v.createElement("div",{className:"column pl-16 indicator-options-settings-area"},v.createElement(b.tj,{renderAsCheckbox:!0,valueType:"BOOLEAN",label:n.A.t("Display Arrows"),name:`${e}.displayArrows`}),v.createElement(b.tj,{renderAsCheckbox:!0,valueType:"BOOLEAN",label:n.A.t("High is Good"),name:`${e}.highIsGood`}),v.createElement(b.tj,{renderAsCheckbox:!0,valueType:"BOOLEAN",label:n.A.t("Show Colors"),name:`${e}.showColors`}))),v.createElement(ee.c,null),v.createElement(Ce,{path:e})))}function xe(){var e,t;const{watch:a}=(0,p.xW)(),n=(0,E.useRecoilValue)(u.ScorecardConfigEditState),l=null===(e=["dataSelection","dataGroups",null===n||void 0===n?void 0:n.selectedGroupIndex,"dataHolders",null===n||void 0===n?void 0:n.selectedDataHolderIndex])||void 0===e?void 0:e.join("."),i=a(l);return v.createElement("div",{className:"data-configuration-row"},(null===i||void 0===i||null===(t=i.dataSources)||void 0===t?void 0:t.map((e,t)=>{const a=`${l}.dataSources.${t}`;return v.createElement("div",{key:e.id,style:{maxWidth:720,minWidth:480},className:"w-100 h-100"},v.createElement("div",{className:"container-bordered h-100"},v.createElement("div",{className:"column"},v.createElement("div",{className:"p-16"},v.createElement(v.Suspense,{fallback:v.createElement("div",{className:"w-100 h-100 center align-items-center"},v.createElement(Q.F,{small:!0}))},v.createElement(we,{path:a}))))))}))||null)}function ke(){const{selectedDataHolderIndex:e}=(0,E.useRecoilValue)(u.ScorecardConfigEditState);return v.createElement("div",null,v.createElement(v.Suspense,{fallback:v.createElement(u.ContainerLoader,null)},isNaN(e)?v.createElement("div",{className:"row center align-items-center"},v.createElement(Z,null)):v.createElement(xe,null)))}function Ie({onGroupAdd:e}){return v.createElement("div",{style:{margin:"auto"}},v.createElement(i.$,{onClick:e,icon:v.createElement(j.A,null),className:"scorecard-add-group-button",dataTest:"scorecard-add-group-button"},n.A.t("Add Group")))}var Te=a(62062),De=a(43427),He=a(8890),Le=a(65245),Pe=a(98225);function $e({top:e,bottom:t,orgUnit:a,period:n}){var l,i;const{legends:o,showColors:r,displayArrows:c,weight:d,specificTargets:s}=null!==e&&void 0!==e?e:{},{legends:m,showColors:g,displayArrows:E,weight:h,specificTargets:f}=null!==t&&void 0!==t?t:{},{watch:S}=(0,p.xW)(),y=S("legendDefinitions"),A=(0,v.useMemo)(u.generateRandomValues,[]),b=(0,v.useMemo)(u.generateRandomValues,[]),{color:N}=null!==(l=(0,u.getLegend)(A,o,{max:d,specificTargets:s,orgUnit:a,period:n,legendDefinitions:y}))&&void 0!==l?l:{},{color:C}=null!==(i=(0,u.getLegend)(b,m,{max:h,specificTargets:f,orgUnit:a,period:n,legendDefinitions:y}))&&void 0!==i?i:{};return v.createElement("td",{className:"data-cell"},v.createElement(u.LinkedCellSvg,{topStatus:c&&"increasing",bottomStatus:E&&"decreasing",topColor:r?N:void 0,bottomColor:g?C:void 0,bottomValue:b,topValue:A}))}function Ge({config:e}){var t,a,n;const{watch:l}=(0,p.xW)(),i=(0,E.useRecoilValue)(u.OrgUnitLevels),{organisationUnits:o}=(0,E.useRecoilValue)(u.UserState),r=l("legendDefinitions"),c=(null===e||void 0===e||null===(t=e.dataSources)||void 0===t?void 0:t.length)>1,[d,s]=null!==(a=null===e||void 0===e?void 0:e.dataSources)&&void 0!==a?a:[],{legends:m,showColors:g,id:h,displayArrows:f,weight:y,specificTargets:A}=null!==d&&void 0!==d?d:{},b=(0,v.useMemo)(u.generateRandomValues,[]),N=null===(n=(0,S.head)(o))||void 0===n?void 0:n.id,C=(new Date).getFullYear(),w=(0,u.getLegend)(b,m,{max:y,orgUnitLevels:i,dataOrgUnitLevel:1,legendDefinitions:r,specificTargets:A,orgUnit:N,period:C});return c?v.createElement($e,{orgUnit:N,period:C,bottom:s,top:d,specificTargets:A}):v.createElement("td",{width:"100px",className:"data-cell",align:"center",key:`${h}-data`,id:h},v.createElement(u.SingleCellSvg,{status:f&&"decreasing",color:g?null===w||void 0===w?void 0:w.color:void 0,value:b}))}function Ue(){var e,t;const{watch:a}=(0,p.xW)(),{organisationUnits:l}=(0,E.useRecoilValue)(u.UserState),{dataGroups:i}=null!==(e=a("dataSelection"))&&void 0!==e?e:{},o=(0,v.useMemo)(()=>[...i],[i]);return v.createElement("div",{className:"column",style:{width:"100%",overflowX:"auto"}},v.createElement(Te.b,{bordered:!0,width:"100%"},v.createElement(De.n,null,v.createElement(He.J,null,v.createElement(Le.B,{fixed:!0,align:"center",className:"table-header scorecard-table-header",bordered:!0,rowSpan:"2"},n.A.t("Organisation Unit")),null===o||void 0===o?void 0:o.map(e=>{var t;return v.createElement(Le.B,{fixed:!0,align:"center",className:"table-header scorecard-table-header",bordered:!0,colSpan:null===e||void 0===e||null===(t=e.dataHolders)||void 0===t?void 0:t.length,key:null===e||void 0===e?void 0:e.id},null===e||void 0===e?void 0:e.title)})),v.createElement(He.J,null,null===i||void 0===i?void 0:i.map(e=>{var t,a,n;return v.createElement("th",{width:100*(null===(t=e.dataHolders)||void 0===t?void 0:t.length)+"px",key:e.id,colSpan:(null===(a=e.dataHolders)||void 0===a?void 0:a.length)||1},v.createElement("table",{style:{borderSpacing:0,height:"100%"}},v.createElement("tr",null,null===e||void 0===e||null===(n=e.dataHolders)||void 0===n?void 0:n.map(({dataSources:e})=>{var t,a,n,l;return v.createElement(Le.B,{width:"100px",fixed:!0,bordered:!0,key:null===(t=e[0])||void 0===t?void 0:t.id,id:null===(a=e[0])||void 0===a?void 0:a.id},null===(n=e[0])||void 0===n?void 0:n.label," ",e.length>1&&`/${null===e||void 0===e||null===(l=e[1])||void 0===l?void 0:l.label}`)}))))}))),v.createElement(Pe.B,null,v.createElement(He.J,{bordered:!0},v.createElement(Le.B,{width:"100%",className:"min-width-200",fixed:!0,tag:"th",bordered:!0},null===(t=(0,S.head)(l))||void 0===t?void 0:t.displayName),null===i||void 0===i?void 0:i.map(e=>{var t,a,n;return v.createElement("td",{className:"no-wrap",width:100*(null===(t=e.dataHolders)||void 0===t?void 0:t.length)+"px",style:{height:47},key:e.id,colSpan:(null===(a=e.dataHolders)||void 0===a?void 0:a.length)||1},v.createElement("table",{style:{borders:"none",borderSpacing:0}},v.createElement(He.J,null,null===e||void 0===e||null===(n=e.dataHolders)||void 0===n?void 0:n.map(e=>v.createElement(Ge,{key:e.id,config:e})))))})))))}var Oe=a(17092),Re=a(39435),_e=a(93691);function Ve({onClose:e,open:t,onSelect:a,disabled:l}){const[r,c]=(0,v.useState)([]);return v.createElement(se.a,{onClose:e,position:"middle",large:!0,hide:!t},v.createElement(ue.w,null,n.A.t("Add Data source")),v.createElement(me.$,null,v.createElement("div",{className:"w-100"},v.createElement(b.Ve,{dataSources:["indicator","dataElement","dataSet","programIndicator","customFunction"],selected:r,disabled:l,onSelect:c}))),v.createElement(ve.N,null,v.createElement(o.v,{end:!0},v.createElement(i.$,{onClick:e},n.A.t("Cancel")),v.createElement(i.$,{dataTest:"scorecard-data-source-add",primary:!0,onClick:()=>{a(r),e()}},n.A.t("Add")))))}var Fe=a(85195);const Me=(0,Fe.A)({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}})(ne.A),We=(0,Fe.A)({root:{background:"#F8F9FA",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:56,"&$expanded":{minHeight:56}},content:{"&$expanded":{margin:"12px 0"}},expanded:{}})(le.A),je=(0,Fe.A)(e=>({root:{padding:e.spacing(2)}}))(ie.A);function Be({titleEditValue:e,setTitleEditValue:t,title:a,onClose:l,onTitleEditSubmit:r}){return v.createElement("div",{className:"row space-between w-100"},v.createElement("div",{onClick:e=>e.stopPropagation(),className:"column"},v.createElement(Oe.p,{initialFocus:!0,value:e,onChange:({value:e})=>t(e)})),v.createElement("div",{className:"column "},v.createElement(o.v,{end:!0},v.createElement(i.$,{onClick:r},n.A.t("Save")),v.createElement(i.$,{onClick:(e,n)=>{n.stopPropagation(),l(!1),t(a)}},n.A.t("Cancel")))))}var qe=a(44490);function Ye({setTitleEditOpen:e,title:t,error:a,onDelete:l,id:o}){return v.createElement("div",{className:"row space-between align-items-center"},v.createElement("div",{className:"row  align-items-center accordion-title-container"},v.createElement("div",{className:"column w-auto"},v.createElement("p",{onDoubleClick:t=>{t.stopPropagation(),e(!0)},onClick:e=>e.stopPropagation(),className:"accordion-title group-name-area"},t),a&&v.createElement("p",{style:{fontSize:12,margin:4,color:"#f44336"}},null===a||void 0===a?void 0:a.message)),v.createElement(qe.A,{onClick:t=>{t.stopPropagation(),e(!0)},size:"small",className:"accordion-title-edit"},v.createElement(T.A,null))),v.createElement("div",{className:!0},v.createElement("div",{className:"row align-items-center"},v.createElement(i.$,{className:"delete-group-icon",onClick:(e,t)=>{t.stopPropagation(),l&&l(o)},icon:v.createElement(I.A,null)},n.A.t("Delete")),a&&v.createElement("div",{style:{paddingLeft:16}},v.createElement(u.ErrorIcon,{color:"#f44336",size:24})))))}var Xe=a(17346),ze=a(36553);var Je=a(67317);function Ke({dataSource:e,index:t,onDelete:a}){const{label:l,type:o}=null!==e&&void 0!==e?e:new u.ScorecardIndicator;return v.createElement("div",null,v.createElement("div",{className:"container-bordered data-source p-8 w-100"},v.createElement("div",{className:"row space-between align-items-center"},v.createElement("div",{className:"row align-items-center "},v.createElement(Je.A,{className:"data-source avatar"},(0,u.getDataSourceShortName)(o)),v.createElement("p",{className:"data-source name"},l," ")),v.createElement("div",null,v.createElement(i.$,{className:"data-source close-icon",small:!0,onClick:(e,n)=>{n.stopPropagation(),a(t)},icon:v.createElement(I.A,null)},n.A.t("Delete"))))))}function Ze(){return Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ze.apply(null,arguments)}function Qe({dataHolder:e,id:t,index:a,onDelete:n}){const{dataSources:l}=null!==e&&void 0!==e?e:new u.ScorecardIndicatorHolder,{trigger:i}=(0,p.xW)(),[o,r]=(0,E.useRecoilState)(u.ScorecardConfigEditState),c=["dataGroups",o.selectedGroupIndex,"dataHolders",a],d=(0,E.useSetRecoilState)((0,u.ScorecardConfigDirtySelector)({key:"dataSelection",path:c})),s=o.selectedDataHolderIndex===a,m=(null===l||void 0===l?void 0:l.length)>1,g=e=>{if(m){const t=[...l];return t.splice(e,1),void d(e=>u.ScorecardIndicatorHolder.set(e,"dataSources",t))}n(a)};return v.createElement(Re.sx,{draggableId:`${t}`,index:a},e=>v.createElement("div",Ze({},e.draggableProps,e.dragHandleProps,{ref:e.innerRef}),v.createElement("div",{className:"row align-items-center"},v.createElement("div",{onClick:async()=>{t&&await i()&&r(e=>({...e,selectedDataHolderIndex:a}))},className:"column center",style:{border:m&&`1px solid ${y.T.grey400}`,background:s&&`${y.T.teal200}`,padding:m&&8,marginBottom:8}},null===l||void 0===l?void 0:l.map((e,t)=>v.createElement("div",{className:"data-holder",key:e.id,style:{margin:"4px 0"}},v.createElement(Ke,{hasLinked:m,dataSource:e,key:e.id,onDelete:g,index:t})))))))}function et({chunk:e,onDataSourceDelete:t,onLink:a,onUnlink:i,dataHolders:o}){const{linkable:r,hasLink:c,onIconClick:d,getIndex:s,onUnlinkClick:u}=function({onLink:e,onUnlink:t,dataHolders:a,chunk:n}){var l,i;const o=n.length>1,r=(null===(l=(0,S.head)(n))||void 0===l||null===(i=l.dataSources)||void 0===i?void 0:i.length)>1,c=(0,v.useCallback)(e=>(0,S.findIndex)(a,["id",e]),[a]),d=()=>{var t,a;const l=c(null===(t=(0,S.head)(n))||void 0===t?void 0:t.id),i=c(null===(a=(0,S.last)(n))||void 0===a?void 0:a.id);e(l,i)},s=()=>{t((0,S.head)(n).id)};return{linkable:o,hasLink:r,onIconClick:()=>{r?s():d()},onLinkClick:d,onUnlinkClick:s,getIndex:c}}({onLink:a,onUnlink:i,dataHolders:o,chunk:e});return v.createElement("div",{className:"linking-container"},v.createElement("div",{className:"row align-items-center"},v.createElement("div",{className:"column"},null===e||void 0===e?void 0:e.map(e=>v.createElement(l.m,{content:n.A.t("Click to configure, drag to rearrange"),key:e.id},v.createElement(Qe,{onUnlink:u,dataHolder:e,onDelete:t,key:e.id,id:e.id,index:s(e.id)})))),v.createElement("div",{className:"link-button-container"},v.createElement(l.m,{content:n.A.t("Click to {{linkAction}}",{linkAction:c?n.A.t("unlink"):n.A.t("link")})},v.createElement(qe.A,{onClick:d,disabled:!r&&!c},(r||c)&&(c?v.createElement(ze.A,{className:"link-button"}):v.createElement(Xe.A,{className:"link-button"})))))))}function tt(){return tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},tt.apply(null,arguments)}function at({handleAccordionChange:e,expanded:t,index:a,onDelete:o,error:r},c){const{onDataSourceDelete:d,onDataSourceAdd:s,onTitleEditSubmit:m,titleEditValue:g,titleEditOpen:h,setTitleEditOpen:f,setTitleEditValue:A,group:b}=function({index:e,expanded:t}){const{watch:a,setValue:n}=(0,p.xW)(),l=(0,E.useRecoilValue)(u.OrgUnitLevels),i=(0,E.useRecoilValue)((0,u.ScorecardConfigDirtyState)("targetOnLevels")),[o,r]=(0,E.useRecoilState)(u.ScorecardConfigEditState),c=(0,v.useMemo)(()=>["dataSelection","dataGroups",e].join("."),[e]),d=a(c),s=(0,v.useCallback)(e=>{try{n(c,e)}catch(t){console.error(t)}},[c,n]),m=a("legendDefinitions"),g=(0,v.useMemo)(()=>(0,S.filter)(m,({isDefault:e})=>!e),[m]),{title:h,id:f,dataHolders:y}=null!==d&&void 0!==d?d:new u.ScorecardIndicatorGroup,[A,b]=(0,v.useState)(!1),[N,C]=(0,v.useState)(h);return(0,v.useEffect)(()=>{t===f&&r(t=>({...t,selectedDataHolderIndex:void 0,selectedGroupIndex:e}))},[t]),{onDataSourceDelete:e=>{try{o.selectedDataHolderIndex===e&&r(e=>({...e,selectedDataHolderIndex:void 0}));const t=(0,S.cloneDeep)(y)||[];(0,S.isEmpty)(t)||(t.splice(e,1),s(u.ScorecardIndicatorGroup.set(d,"dataHolders",t)))}catch(t){console.error(t)}},onDataSourceAdd:e=>{const t=null===e||void 0===e?void 0:e.map(e=>{var t;return new u.ScorecardIndicatorHolder({id:(0,u.uid)(),dataSources:[new u.ScorecardIndicator({...e,label:e.displayName,name:e.displayName,legends:i?(0,S.fromPairs)([...null!==(t=null===l||void 0===l?void 0:l.map(({id:e})=>[e,(0,u.generateLegendDefaults)(g,100,!0)]))&&void 0!==t?t:[]]):(0,u.generateLegendDefaults)(g,100,!0)})]})}),a=[...y,...t];s(u.ScorecardIndicatorGroup.set(d,"dataHolders",a))},onTitleEditSubmit:(e,t)=>{t.stopPropagation(),(0,S.isEmpty)(N.trim())?(C(h),b(!1)):(s(u.ScorecardIndicatorGroup.set(d,"title",N)),b(!1))},titleEditOpen:A,titleEditValue:N,setTitleEditValue:C,setTitleEditOpen:b,group:d}}({index:a,expanded:t}),{onLink:N,onUnlink:C,onDragEnd:w,onExpand:x}=function({handleAccordionChange:e,index:t}){const{watch:a,setValue:n}=(0,p.xW)(),l=(0,v.useMemo)(()=>["dataSelection","dataGroups",t].join("."),[t]),i=a(l),{id:o,dataHolders:r}=null!==i&&void 0!==i?i:new u.ScorecardIndicatorGroup,c=(0,v.useCallback)(e=>{n(l,e)},[l,n]),d=(0,E.useRecoilCallback)(({snapshot:e,set:t})=>(a,n)=>{var l,o;const d=(0,S.head)(null===(l=r[n])||void 0===l?void 0:l.dataSources),s=u.ScorecardIndicatorHolder.linkDataSource(r[a],d),m=[...r];m.splice(a,1,s),m.splice(n,1);const v=null===(o=e.getLoadable(u.ScorecardConfigEditState).contents)||void 0===o?void 0:o.selectedDataHolderIndex;v!==a&&v!==n||t(u.ScorecardConfigEditState,e=>({...e,selectedDataHolderIndex:a})),c(u.ScorecardIndicatorGroup.set(i,"dataHolders",m))},[r,i,c]),s=(0,E.useRecoilCallback)(({set:e})=>t=>{var a;const n=(0,S.find)(r,["id",t]),l=(0,S.findIndex)(r,["id",t]),o=new u.ScorecardIndicatorHolder({dataSources:[(0,S.last)(null===n||void 0===n?void 0:n.dataSources)]}),d=(0,S.cloneDeep)(n),s=u.ScorecardIndicatorHolder.set(d,"dataSources",null===d||void 0===d||null===(a=d.dataSources)||void 0===a?void 0:a.splice(0,1)),m=[...r];(0,S.set)(m,[l],s),m.splice(l,0,o),c(u.ScorecardIndicatorGroup.set(i,"dataHolders",m)),e(u.ScorecardConfigEditState,e=>({...e,selectedDataHolderIndex:void 0}))});return{onLink:d,onUnlink:s,onDragEnd:(0,E.useRecoilCallback)(({set:e})=>t=>{const{destination:a,source:n}=t||{};c(u.ScorecardIndicatorGroup.set(i,"dataHolders",(0,u.updateListFromDragAndDrop)(null===i||void 0===i?void 0:i.dataHolders,null===n||void 0===n?void 0:n.index,null===a||void 0===a?void 0:a.index))),e(u.ScorecardConfigEditState,e=>e.selectedDataHolderIndex===(null===n||void 0===n?void 0:n.index)?{...e,selectedDataHolderIndex:null===a||void 0===a?void 0:a.index}:e)}),onExpand:(t,a)=>{e(o)(t,a)}}}({handleAccordionChange:e,index:a}),{dataHolderChunks:k,selectedDataSourcesIds:I}=function({index:e}){var t;const{watch:a}=(0,p.xW)(),n=a((0,v.useMemo)(()=>["dataSelection","dataGroups",e].join("."),[e])),{dataHolders:l}=null!==n&&void 0!==n?n:new u.ScorecardIndicatorGroup;return{dataHolderChunks:function(e=[]){const t=[],a=[...e];for(;a.length>0;){var n,l,i,o,r;(null===(n=a[0])||void 0===n?void 0:n.dataSources)>1?t.push(a.splice(0,1)):(null===(l=a[0])||void 0===l||null===(i=l.dataSources)||void 0===i?void 0:i.length)<2&&(null===(o=a[1])||void 0===o||null===(r=o.dataSources)||void 0===r?void 0:r.length)<2?t.push(a.splice(0,2)):t.push(a.splice(0,1))}return t}(l),selectedDataSourcesIds:null===(t=(0,S.flattenDeep)(null===l||void 0===l?void 0:l.map(({dataSources:e})=>e)))||void 0===t?void 0:t.map(({id:e})=>e)}}({index:a}),{title:T,id:D,dataHolders:H}=null!==b&&void 0!==b?b:new u.ScorecardIndicatorGroup,[L,P]=(0,v.useState)(!1),$=(0,v.useRef)();return v.createElement(Re.sx,{ref:c,index:a,draggableId:D},e=>v.createElement(Me,{innerRef:e.innerRef,onDoubleClick:e=>e.stopPropagation(),expandIcon:v.createElement(_e.A,null),square:!0,expanded:t===D,onChange:x},v.createElement(l.m,{content:n.A.t("Click to {{action}}, drag to rearrange",{action:t===D?n.A.t("collapse"):n.A.t("expand")})},v.createElement(We,tt({innerRef:$,onClick:e=>e.stopPropagation()},e.draggableProps,e.dragHandleProps,{expandIcon:v.createElement(_e.A,{className:"expand-group-icon",dataTest:"scorecard-group-expand"}),"aria-controls":`${D}d-content`,id:`${D}d--header`,dataTest:"scorecard-group-item"}),h?v.createElement(Be,{onTitleEditSubmit:m,titleEditValue:g,onClose:f,title:T,setTitleEditValue:A}):v.createElement(Ye,{title:T,onDelete:o,setTitleEditOpen:f,id:D,error:r}))),v.createElement(je,null,v.createElement("div",{className:"column data-holders-area"},(0,S.isEmpty)(H)?v.createElement("div",{className:"column w-100 text-center center",style:{height:100}},v.createElement("p",{style:{color:y.T.grey600}},n.A.t("Add a data source"))):v.createElement(Re.JY,{onDragEnd:w},v.createElement(Re.gL,{droppableId:`${D}`},e=>v.createElement("div",tt({className:"w-100 "},e.droppableProps,{ref:e.innerRef}),null===k||void 0===k?void 0:k.map((e,t)=>v.createElement(et,{dataHolders:H,onUnlink:C,onLink:N,chunk:e,chunkIndex:t,onDataSourceDelete:d,key:`${t}-linking-container-${null===b||void 0===b?void 0:b.id}`})),e.placeholder))),v.createElement("div",null,v.createElement(i.$,{className:"scorecard-indicator-add",dataTest:"scorecard-indicator-add",onClick:()=>P(!0),icon:v.createElement(j.A,null)},n.A.t("Add Item")))),L&&v.createElement(Ve,{disabled:I,onSelect:s,onClose:()=>P(!1),open:L}))))}var nt=(0,v.forwardRef)(at);function lt(){return lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},lt.apply(null,arguments)}function it(){var e;const{setValue:t,watch:a}=(0,p.xW)(),l=a("dataSelection"),i=(0,E.useRecoilValue)(ot),o=(0,v.useCallback)(e=>{t("dataSelection",e)},[t]),r=(0,E.useResetRecoilState)(u.ScorecardConfigEditState),{dataGroups:c}=l||new u.DataSelection,[d,s]=(0,v.useState)(null===(e=(0,S.last)(c))||void 0===e?void 0:e.id),m=e=>(t,a)=>{s(!!a&&e)},g=e=>{const t=[...c];(0,S.remove)(t,["id",e]),o(u.DataSelection.set(l,"dataGroups",t)),r()},h=(e,t)=>{const a=[...c];(0,S.set)(a,[e],t),o(u.DataSelection.set(l,"dataGroups",a))},f=(0,v.useMemo)(()=>(0,S.isEmpty)(i)?c:(0,S.filter)(c,({id:e})=>i.includes(e)),[i,c]);return(0,v.useEffect)(()=>{var e;s(null===(e=(0,S.last)(f))||void 0===e?void 0:e.id)},[f,f.length]),v.createElement(Re.gL,{droppableId:"group-area"},e=>v.createElement("div",lt({},e.droppableProps,{ref:e.innerRef}),v.createElement("div",null,null===f||void 0===f?void 0:f.map(e=>{const t=(0,S.findIndex)(c,["id",e.id]);return v.createElement(p.xI,{key:e.id,id:e.id,rules:{validate:{isNotEmpty:e=>!(0,S.isEmpty)(null===e||void 0===e?void 0:e.dataHolders)||n.A.t("Please select at least one data source for this group")}},name:`dataSelection.dataGroups.${t}`,render:({field:a,fieldState:n})=>v.createElement(nt,lt({},a,{error:n.error,onGroupUpdate:h,onDelete:g,index:t,group:e,expanded:d,handleAccordionChange:m}))})}),e.placeholder)))}const ot=(0,E.atom)({key:"dataSelectionFilterAtom",default:[]});function rt({onGroupAdd:e}){const{setValue:t,watch:a}=(0,p.xW)(),l=a("dataSelection"),[o,r]=(0,v.useState)(""),c=(0,E.useSetRecoilState)(ot),d=(0,v.useRef)((0,S.debounce)(e=>{c(()=>{var t;return e?null===l||void 0===l||null===(t=l.dataGroups.filter(t=>(0,S.find)(null===t||void 0===t?void 0:t.dataHolders,t=>(0,S.find)(null===t||void 0===t?void 0:t.dataSources,t=>`${t.name} ${t.label}`.toLowerCase().match(new RegExp(e.toLowerCase()))))))||void 0===t?void 0:t.map(({id:e})=>e):[]})},500)),s=(0,E.useRecoilCallback)(({set:e})=>a=>{const{destination:n,source:i}=null!==a&&void 0!==a?a:{};t("dataSelection",u.DataSelection.set(l,"dataGroups",[...(0,u.updateListFromDragAndDrop)(null===l||void 0===l?void 0:l.dataGroups,null===i||void 0===i?void 0:i.index,null===n||void 0===n?void 0:n.index)])),e(u.ScorecardConfigEditState,e=>e.selectedGroupIndex===(null===i||void 0===i?void 0:i.index)?{...e,selectedGroupIndex:null===n||void 0===n?void 0:n.index}:e)},[l,t]);return v.createElement("div",{className:"column h-100"},v.createElement("div",{className:"p-16"},v.createElement(Oe.p,{value:o,name:"",onChange:({value:e})=>{r(e),""!==e&&void 0!==e?d.current(e):c([])},placeholder:n.A.t("Search for Indicator")})),v.createElement("h4",{className:"pl-16"},n.A.t("Groups")),v.createElement("div",{style:{maxHeight:"60vh",overflowY:"auto",flex:1}},v.createElement(Re.JY,{onDragEnd:s},v.createElement(it,null))),v.createElement("div",{className:"p-8 column",style:{alignItems:"start"}},v.createElement(i.$,{onClick:e,icon:v.createElement(j.A,null),dataTest:"scocecard-add-group-button",className:"scorecard-add-group-button"},n.A.t("Add Group"))))}function ct(e){return new u.ScorecardIndicatorGroup({title:`Group ${(null===e||void 0===e?void 0:e.length)+1||1}`})}var dt={step:"ScorecardManagement_step__A9+fv","edit-container":"ScorecardManagement_edit-container__sZk39"};function st(){const{watch:e,setValue:t}=(0,p.xW)(),a=e("dataSelection.dataGroups"),n=a.length>0;return{onResetLegends:(0,v.useCallback)(e=>{const n=function(e,t){const a=(0,S.cloneDeep)(e);return a&&(null===a||void 0===a||a.forEach(e=>{var a;null===e||void 0===e||null===(a=e.dataHolders)||void 0===a||a.forEach(e=>{var a;null===e||void 0===e||null===(a=e.dataSources)||void 0===a||a.forEach(e=>{(0,S.set)(e,"legends",(0,u.generateLegendDefaults)(te(t))),(0,S.isEmpty)(e.specificTargets)||e.specificTargets.forEach(e=>{(0,S.set)(e,"legends",(0,u.generateLegendDefaults)(te(t)))})})})})),a}(a,e);t("dataSelection.dataGroups",n)},[a,t]),shouldVerify:n}}function ut(){const{shouldVerify:e,onResetLegends:t}=st();return v.createElement(b.tj,{label:n.A.t("Legend Definitions"),onResetLegends:t,shouldVerify:e,valueType:"LEGEND_DEFINITIONS",name:"legendDefinitions",mandatory:!0})}var mt=a(1685);function vt(){const{getValues:e}=(0,p.xW)(),t=(0,v.useMemo)(()=>{const t=(0,S.head)(e("periodSelection.periods"));return t?mt.qk.getPeriodById(null===t||void 0===t?void 0:t.id).start.year:(new Date).getFullYear()},[e]),[a,l]=(0,v.useState)(null!==t&&void 0!==t?t:(new Date).getFullYear()),i=(0,p.FH)({name:"periodType"}),o=(0,v.useMemo)(()=>{var e;if(!i)return[];const t=mt.qk.fromObject({year:a,category:mt.Ix.FIXED}).getPeriodType(i.toUpperCase());return null===t||void 0===t||null===(e=t.periods)||void 0===e?void 0:e.map(({id:e,name:t})=>({name:t,code:e}))},[i,a]),r=(0,v.useMemo)(()=>new Array(10).fill("").map((e,t)=>({code:((new Date).getFullYear()-t).toString(),name:(new Date).getFullYear()-t})).reverse(),[]);return v.createElement(p.xI,{render:({field:e})=>{var t,i;const c=null===(t=(0,S.head)(null===e||void 0===e||null===(i=e.value)||void 0===i?void 0:i.periods))||void 0===t?void 0:t.id,d=(0,S.find)(o,["code",c])?c:void 0;return v.createElement("div",{style:{display:"flex",gap:16,width:"100%"}},v.createElement(b.Kt,{fullWidth:!0,label:n.A.t("Year"),value:a.toString(),optionSet:{options:r},name:"year",onChange:l}),v.createElement(b.Kt,{fullWidth:!0,label:n.A.t("Period"),value:d,optionSet:{options:o},name:"periodSelection",onChange:t=>{const a=mt.qk.getPeriodById(t);e.onChange({periods:[{name:a.name,id:null===a||void 0===a?void 0:a.id}]})}}))},name:"periodSelection"})}var pt="PeriodTypeSelector_select-header__c8O-e";function gt(){return gt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},gt.apply(null,arguments)}function Et({label:e,name:t}){const a=(0,v.useMemo)(()=>(new mt.qk).setCategory(mt.Ix.FIXED).periodTypes,[]),l=(0,v.useMemo)(()=>(new mt.qk).setCategory(mt.Ix.RELATIVE).periodTypes,[]);return v.createElement(p.xI,{name:t,rules:{required:n.A.t("Period type is required")},render:({field:t,fieldState:i})=>{var o;return v.createElement(M.l,gt({},t,{label:e,required:!0,filterable:!0,selected:t.value,onChange:({selected:e})=>t.onChange(e),validationText:null===(o=i.error)||void 0===o?void 0:o.message,error:!!i.error}),v.createElement(W.e,{value:"disabled",disabled:!0,className:pt,label:n.A.t("Fixed Periods")}),null===a||void 0===a?void 0:a.map(e=>v.createElement(W.e,{key:e.id,value:e.id,label:e.config.name})),v.createElement(W.e,{value:"disabled",disabled:!0,className:pt,label:n.A.t("Relative Periods")}),null===l||void 0===l?void 0:l.map(e=>v.createElement(W.e,{key:e.id,value:e.id,label:e.config.name})))}})}function ht(){const{id:e}=(0,g.g)(),t=(0,h.ow)();return v.createElement("div",{style:{gap:16,display:"flex",flexDirection:"column"},className:"col-12"},v.createElement("div",{style:{display:"flex",flexDirection:"column",gap:16},className:"col-12 general-settings"},v.createElement(b.tj,{valueType:u.DHIS2ValueTypes.TEXT.name,name:"title",label:n.A.t("Title"),required:!0,validations:{required:n.A.t("Title is required"),validate:async a=>await async function(e,t,a){const{summary:n}=await(0,u.getScorecardSummary)(e);if((0,S.isEmpty)(n))return!0;const l=(0,S.find)(n,{title:a});return l?l.id===t:!l}(t,e,a)||n.A.t("A scorecard with the title '{{value}}' already exists. Please select another title",{value:a})}}),v.createElement(b.tj,{valueType:u.DHIS2ValueTypes.TEXT.name,name:"subtitle",label:n.A.t("Subtitle"),max:"120"})),v.createElement("div",{className:"description-settings"},v.createElement(b.tj,{name:"description",valueType:u.DHIS2ValueTypes.LONG_TEXT.name,label:n.A.t("Description")})),v.createElement("div",{className:"row align-items-center",style:{gap:24}},v.createElement("div",{className:"col-md-4 period-type-settings"},v.createElement(Et,{label:n.A.t("Period Type"),name:"periodType"})),v.createElement("div",{className:"flex-1 period-settings w-100"},v.createElement(vt,null))),v.createElement("div",{className:"custom-header-settings"},v.createElement(b.tj,{name:"customHeader",label:n.A.t("Custom Header"),valueType:u.DHIS2ValueTypes.RICH_TEXT.name})),v.createElement("div",{className:"col-sm-6 col-xl-4 legend-definitions-settings gap-8"},v.createElement(ut,null)),v.createElement("div",{className:"col-sm-6 col-xl-4 additional-labels-settings"},v.createElement(b.tj,{addable:!0,deletable:!0,name:"additionalLabels",valueType:u.DHIS2ValueTypes.MULTIPLE_FIELDS.name,label:n.A.t("Additional Labels (Tags)"),multipleField:{name:"label",valueType:u.DHIS2ValueTypes.TEXT.name}})))}function ft(){var e;const{selectedHighlightedIndicatorIndex:t}=null!==(e=(0,E.useRecoilValue)(u.ScorecardConfigEditState))&&void 0!==e?e:{},a=`highlightedIndicators.${t}`;return isNaN(t)?null:v.createElement("div",{className:"container-bordered"},v.createElement(u.Help,{helpSteps:u.INDICATOR_CONFIGURATION_STEPS}),v.createElement(we,{path:a}))}var St=a(98138),yt=a(58789);const At=[{label:"Name",path:"displayName"},{label:"Label",path:"label"}];function bt(){const{watch:e,setValue:t,trigger:a}=(0,p.xW)(),l=e("highlightedIndicators"),o=(0,v.useCallback)(e=>{t("highlightedIndicators",e)},[t]),[r,c]=(0,E.useRecoilState)(u.ScorecardConfigEditState),d=(0,v.useCallback)(e=>{(0,S.findIndex)(l,["id",e])===r.selectedHighlightedIndicatorIndex&&c(e=>({...e,selectedHighlightedIndicatorIndex:void 0}));const t=(0,S.cloneDeep)(l);(0,S.remove)(t,["id",e]),o(t)},[l,r.selectedHighlightedIndicatorIndex,o,c]);return(0,S.isEmpty)(l)?null:v.createElement(v.Fragment,null,v.createElement(u.Help,{helpSteps:u.HIGHLIGHTED_TABLE_HELP_STEPS}),v.createElement(Te.b,{fixed:!0,scrollHeight:"75vh"},v.createElement(De.n,null,v.createElement(He.J,null,null===At||void 0===At?void 0:At.map(({label:e,path:t})=>v.createElement(St.w,{fixed:!0,top:"0",key:`${t}-column`},e)),v.createElement(St.w,{fixed:!0,top:"0"}))),v.createElement(yt.B,null,null===l||void 0===l?void 0:l.map((e,t)=>v.createElement(He.J,{selected:(null===r||void 0===r?void 0:r.selectedHighlightedIndicatorIndex)===t,key:`${null===e||void 0===e?void 0:e.id}`},null===At||void 0===At?void 0:At.map(({path:n})=>v.createElement(Le.B,{onClick:()=>(async e=>{await a()&&c(t=>({...t,selectedHighlightedIndicatorIndex:e}))})(t),key:`${null===e||void 0===e?void 0:e.id}-${n}`},(0,S.get)(e,n))),v.createElement(Le.B,{align:"center"},v.createElement(i.$,{onClick:(t,a)=>{a.stopPropagation(),d(null===e||void 0===e?void 0:e.id)},icon:v.createElement(I.A,null)},n.A.t("Delete"))))))))}const Nt=[{label:n.A.t("General"),component:function(){return v.createElement("div",{className:"container"},v.createElement(u.Help,{helpSteps:u.GENERAL_HELP_STEPS}),v.createElement("div",{className:"column space-between"},v.createElement(ht,null)))},helpSteps:u.GENERAL_HELP_STEPS,tooltip:u.scorecardManagementTooltips[0].content,id:"general"},{label:n.A.t("Data Configuration"),component:function(){const{setValue:e,watch:t,register:a}=(0,p.xW)();a("dataSelection");const n=t("dataSelection"),l=(0,v.useCallback)(t=>{e("dataSelection",t)},[e]),{dataGroups:i}=null!==n&&void 0!==n?n:new u.DataSelection,o=function(e){const[t,a]=(0,v.useState)(u.INTRODUCTION_HELP_STEPS),{selectedDataHolderIndex:n}=(0,E.useRecoilValue)(u.ScorecardConfigEditState);return(0,v.useEffect)(()=>{a(t=>{let a=[...t];return(0,S.isEmpty)(e)||(a=[...u.INTRODUCTION_HELP_STEPS,...u.GROUPS_CONFIG_HELP_STEPS,...u.PREVIEW_TABLE_HELP_STEPS]),(0,S.isEmpty)(e)&&(a=[...u.INTRODUCTION_HELP_STEPS,...u.NO_GROUPS_HELP_STEPS]),!(0,S.isEmpty)(e)&&(0,S.isEmpty)((0,u.getHoldersFromGroups)(e))&&(a=[...a,...u.NO_INDICATORS_HELP_STEPS]),(0,S.isEmpty)((0,u.getHoldersFromGroups)(e))||(a=[...a,...u.INDICATOR_SETUP_HELP_STEPS]),isNaN(n)||(a=[...a,...u.INDICATOR_CONFIGURATION_STEPS]),(0,S.uniqBy)(a,"element")})},[e,n]),t}(i),r=(0,v.useCallback)(()=>{var e;l(u.DataSelection.set(n,"dataGroups",[...null!==(e=null===n||void 0===n?void 0:n.dataGroups)&&void 0!==e?e:[],ct(i)]))},[n,i,l]);return v.createElement("div",{className:"row",style:{height:"100%"}},v.createElement(u.Help,{helpSteps:o}),v.createElement("div",{className:"col-md-4 col-sm-6 p-16 groups-configuration-area"},v.createElement("div",{className:" container-bordered column",style:{minHeight:"100%",height:"100%"}},v.createElement(v.Suspense,{fallback:v.createElement(u.ContainerLoader,null)},(0,S.isEmpty)(i)?v.createElement(Ie,{onGroupAdd:r}):v.createElement(rt,{onGroupAdd:r})))),v.createElement("div",{className:"col-md-8 p-16 h-100"},!(0,S.isEmpty)(i)&&v.createElement("div",{className:"row pb-16"},v.createElement("div",{className:"column preview-table-area"},v.createElement(Ue,null))),v.createElement("div",{className:"column h-100"},(0,S.isEmpty)(i)?v.createElement("div",{style:{margin:"auto"}},v.createElement(K,null)):v.createElement(ke,null))))},helpSteps:u.DATA_CONFIGURATION_HELP_STEPS,tooltip:u.scorecardManagementTooltips[1].content,id:"dataConfiguration"},{label:n.A.t("Highlighted Indicators"),component:function(){const{watch:e,setValue:t,register:a}=(0,p.xW)();a("highlightedIndicators");const l=e("highlightedIndicators"),o=(0,v.useCallback)(e=>{t("highlightedIndicators",e)},[t]),r=te(e("legendDefinitions")),c=(0,E.useSetRecoilState)(u.ScorecardConfigEditState),[d,s]=(0,v.useState)(!1),m=()=>{s(!0)},g=(0,v.useCallback)(e=>{const t=(0,u.generateLegendDefaults)(r,100,!0),a=null===e||void 0===e?void 0:e.map(e=>new u.ScorecardIndicator({...e,label:null===e||void 0===e?void 0:e.displayName,legends:t}));o([...null!==l&&void 0!==l?l:[],...null!==a&&void 0!==a?a:[]]),(0,S.isEmpty)(e)||c(e=>({...e,selectedHighlightedIndicatorIndex:0}))},[l,r,o,c]);return v.createElement("div",{className:"column",style:{height:"100%"}},v.createElement(u.Help,{helpSteps:u.HIGHLIGHTED_INDICATOR_HELP_STEPS}),v.createElement("h3",null,n.A.t("Highlighted Indicators")),(0,S.isEmpty)(l)?v.createElement("div",{className:"row align-items-center center flex-1"},v.createElement(i.$,{className:"add-highlighted-indicator-button",onClick:m,icon:v.createElement(j.A,null)},n.A.t("Add Highlighted Indicator"))):v.createElement(v.Fragment,null,v.createElement("div",{className:"rowlabel "},v.createElement(i.$,{className:"add-highlighted-indicator-button",onClick:m,icon:v.createElement(j.A,null)},n.A.t("Add"))),v.createElement("div",{className:"row"},v.createElement("div",{className:"col-md-8 pt-32 "},v.createElement(bt,null)),v.createElement("div",{className:"col-md-4"},v.createElement("div",{className:"pl-16 pt-32"},v.createElement(ft,null))))),d&&v.createElement(Ve,{open:d,onSelect:g,disabled:null===l||void 0===l?void 0:l.map(({id:e})=>e),onClose:()=>s(!1)}))},helpSteps:[],tooltip:u.scorecardManagementTooltips[2].content,id:"highlightedIndicators"},{label:n.A.t("Access"),component:function(){return v.createElement("div",{style:{minHeight:"70vh",height:"100%"},className:"container p-16"},v.createElement(u.Help,{helpSteps:u.ACCESS_HELP_STEPS}),v.createElement("div",{className:"row"},v.createElement("div",{className:"column"},v.createElement(N,null)),v.createElement("div",{className:"column"},v.createElement(J,null))))},helpSteps:[],tooltip:u.scorecardManagementTooltips[3].content,id:"access"},{label:n.A.t("Options"),component:function(){const{scorecardOptions:e,onChange:t,onAverageChange:a}=function(){const{watch:e,setValue:t}=(0,p.xW)(),a=e("options"),n=(0,v.useCallback)(e=>{t("options",e)},[t]);return{onAverageChange:e=>{n(u.ScorecardOptions.set(a,"averageDisplayType",e))},onChange:e=>t=>{var l;n(u.ScorecardOptions.set(a,e,null!==(l=null===t||void 0===t?void 0:t.checked)&&void 0!==l?l:t))},scorecardOptions:a}}();return v.createElement("div",{style:{height:"100%"}},v.createElement(u.ScorecardOptionsForm,{options:e,onChange:t,onAverageChange:a}))},helpSteps:[],tooltip:u.scorecardManagementTooltips[4].content,id:"options"}],Ct=(0,E.atom)({key:"activeStepState",default:Nt[0]}),wt=(0,E.selector)({key:"activeStepIndexState",get:({get:e})=>{const t=e(Ct);return(0,S.findIndex)(Nt,e=>e.id===t.id)}});function xt(){const e=(0,g.W6)(),{id:t}=(0,g.g)(),a=(0,E.useSetRecoilState)(u.IsNewScorecardState),l=(0,E.useRecoilValue)(wt),i=(0,E.useRecoilValue)(u.UserState),[o,r]=(0,E.useRecoilState)(u.RouterState),{update:c}=(0,u.useUpdateScorecard)(t),d=(0,E.useRecoilValue)((0,u.ScorecardConfState)(t)),[s,m]=(0,v.useState)(!1),[y,A]=(0,v.useState)(!1),b=(0,S.cloneDeep)(d),N=(0,p.mN)({shouldFocusError:!0,defaultValues:{...b},reValidateMode:"onChange"}),C=(0,E.useSetRecoilState)(Ct),{add:w}=(0,u.useAddScorecard)(),{show:x}=(0,h.MW)(({message:e})=>e,({type:e})=>({...e,duration:3e3})),k=(0,E.useRecoilCallback)(({reset:e})=>()=>{e(u.ScorecardConfigEditState),e(u.ScorecardConfigErrorState),e(u.ShouldValidate),e(u.IsNewScorecardState),e(Ct)}),I=(0,E.useRecoilCallback)(({reset:e})=>()=>{e((0,u.ScorecardConfState)(t)),e(u.ScorecardIdState)});(0,v.useEffect)(()=>()=>{k(),I()},[]);const T=()=>{r(e=>({...e,previous:`/edit/${t}`})),e.replace(null===o||void 0===o?void 0:o.previous)},D=async e=>{await u.Scorecard.save(e,w,i)},H=async e=>{await u.Scorecard.update(e,c)},L=(0,E.useRecoilCallback)(()=>async e=>{m(!0);try{if(t)await H(e),x({message:n.A.t("Scorecard updated successfully"),type:{success:!0}});else{const t=(0,u.uid)(),a=(0,f.Ay)((0,S.cloneDeep)(e),e=>{(0,S.set)(e,"id",t)});await D((0,S.cloneDeep)(a)),x({message:n.A.t("Scorecard added successfully"),type:{success:!0}})}T()}catch(a){console.error(a),x({message:n.A.t("Scorecard could not be saved: "+(null===a||void 0===a?void 0:a.message)),type:{info:!0}})}m(!1)}),P=(0,E.useRecoilCallback)(()=>async i=>{A(!0);try{if(t)await H(i),C(e=>{const t=(0,S.findIndex)(Nt,{id:e.id});if(t!==Nt.length-1)return Nt[t+1]});else{const t=(0,u.uid)(),n=(0,f.Ay)(i,e=>{(0,S.set)(e,"id",t)});await D(n),a({nextStepIndex:l+1}),e.replace(`edit/${t}?new=true`)}}catch(o){console.error(o),x({message:n.A.t("Scorecard could not be saved: "+(null===o||void 0===o?void 0:o.message)),type:{info:!0}})}A(!1)});return{form:N,resetEditStates:k,resetScorecardStates:I,saving:s,onSave:L,onNavigate:T,onSaveAndContinue:P,savingAndContinue:y}}function kt({form:e,onSave:t,onNavigate:a}){const[l,i]=(0,E.useRecoilState)(u.HelpIndex),[o,r]=(0,E.useRecoilState)(Ct),{search:c}=(0,g.zy)(),d=(0,E.useResetRecoilState)(u.IsNewScorecardState),s=o.component,{show:m}=(0,h.MW)(({message:e})=>e,({type:e})=>({...e,duration:3e3}));(0,v.useEffect)(()=>{new URLSearchParams(c).get("new")&&r(e=>0===(0,S.findIndex)(Nt,["id",e.id])?Nt[1]:e)},[d,c,r]);const p=(0,v.useMemo)(()=>(0,S.findIndex)(Nt,["id",o.id])!==Nt.length-1,[o]),f=(0,v.useMemo)(()=>(0,S.findIndex)(Nt,["id",o.id])>0,[o]),y=(0,v.useMemo)(()=>(0,S.findIndex)(Nt,["id",o.id]),[o]),A=(0,v.useCallback)(async t=>{await e.trigger((0,u.getValidationPageFields)(e,o))&&r(t)},[o,e]);return{Component:s,activeStep:o,onNextStep:async()=>{if(!p)return void await e.handleSubmit(t)();if(!await e.trigger())return void m({message:n.A.t("Please fill in all required fields"),type:{info:!0}});const a=(0,S.findIndex)(Nt,["id",o.id]);a!==Nt.length-1&&(r(Nt[a+1]),i(0))},onPreviousStep:()=>{const e=(0,S.findIndex)(Nt,["id",o.id]);0!==e&&(r(Nt[e-1]),i(0))},onCancel:()=>{a()},helpStepIndex:l,setHelpStepIndex:i,hasNextStep:p,hasPreviousStep:f,currentIndex:y,steps:Nt,onStepChange:A}}function It(){var e,t,a;const[h,f]=(0,E.useRecoilState)(u.HelpState),S=(0,E.useRecoilValue)(u.HelpSteps),{id:y}=(0,g.g)(),{write:A}=(0,E.useRecoilValue)((0,u.UserAuthorityOnScorecard)(y)),{height:b}=(0,u.useMediaQuery)(),{form:N,onSave:C,saving:w,onNavigate:x,onSaveAndContinue:k,savingAndContinue:I}=xt(),{Component:T,activeStep:D,helpStepIndex:H,onCancel:L,onNextStep:P,onPreviousStep:$,setHelpStepIndex:G,steps:U,currentIndex:O,hasPreviousStep:R,hasNextStep:_,onStepChange:V}=kt({form:N,onSave:C,onNavigate:x});return!A&&y?v.createElement(u.AccessDeniedPage,{accessType:"edit"}):v.createElement(p.Op,N,v.createElement(v.Suspense,{fallback:v.createElement(u.FullPageLoader,null)},v.createElement("div",{className:dt["edit-container"]},v.createElement(m.gj,{enabled:h,options:u.STEP_OPTIONS,steps:S,initialStep:H,onBeforeChange:e=>{G(e)},onExit:()=>{f(!1)}}),v.createElement("div",{className:"column"},v.createElement("div",null,v.createElement(r.A,null,null===U||void 0===U?void 0:U.map(e=>v.createElement(c.A,{style:e===D?{background:"#00695c"}:void 0,active:e===D,onClick:()=>V(e),key:`${e.id}-step`},v.createElement(d.A,null,v.createElement(l.m,{content:e.tooltip,key:`${e.id}-step`},e.label)))))),v.createElement("div",{className:"row"},v.createElement("div",{className:"column center",style:{flex:1}},v.createElement("div",{className:"container container-bordered background-white center",style:{width:"100%",height:"100%",minHeight:.8*b}},v.createElement("div",{className:"row",style:{height:"100%"}},v.createElement("div",{className:"column p-16",style:{height:"100%",justifyContent:"space-between"}},v.createElement("div",{className:"row end align-items-center"},v.createElement(i.$,{icon:v.createElement(s.A,null),onClick:()=>{G(0),f(!0)}},n.A.t("Help"))),v.createElement("div",{style:{height:"100%",padding:16}},v.createElement(v.Suspense,{fallback:v.createElement(u.FullPageLoader,{small:!0})},v.createElement(T,{onNextStep:P,onPreviousStep:$}))),v.createElement(o.v,{start:!0},v.createElement(i.$,{disabled:!R,onClick:$},n.A.t(`Previous: ${null!==(e=null===(t=U[O-1])||void 0===t?void 0:t.label)&&void 0!==e?e:""}`)),v.createElement(i.$,{loading:w,primary:!0,disabled:w,onClick:P,className:"settings-next-button",dataTest:"scorecard-admin-next-button"},_?n.A.t(`Next: ${null===(a=U[O+1])||void 0===a?void 0:a.label}`):w?`${n.A.t("Saving")}...`:n.A.t("Save")))))))),v.createElement("div",{className:"row center p-16"},v.createElement(o.v,{center:!0},v.createElement(i.$,{loading:w,dataTest:"scorecard-save-button",disabled:w,onClick:N.handleSubmit(C)},w?`${n.A.t("Saving")}...`:n.A.t("Save and exit")),_&&v.createElement(i.$,{loading:I,dataTest:"scorecard-save-and-continue-button",disabled:I,onClick:N.handleSubmit(k)},I?`${n.A.t("Saving")}...`:n.A.t("Save and continue")),v.createElement(i.$,{onClick:L},n.A.t("Exit without saving"))))))))}}}]);
//# sourceMappingURL=1404.fccaf7d8.chunk.js.map