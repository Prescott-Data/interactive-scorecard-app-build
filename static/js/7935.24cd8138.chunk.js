"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[7935],{97935:function(e,t,a){a.r(t),a.d(t,{default:function(){return Dt}});var n=a(26874),l=a(6997),i=a(86837),o=a(99136),r=a(52307),c=a(51284),d=a(33593),s=a(93651),u=a(6585),m=a(31813),v=a(81195),p=a(18049),g=a(29989),E=a(25435),h=a(7105),f=a(68820),S=a(69987),y=a(13488),b=a(93407),N=a(98132);function C(){const{setValue:e,watch:t,register:a,formState:l}=(0,p.Gc)();a("orgUnitSelection",{validate:{atLeastOneOrgUnit:e=>!!function(e){let{groups:t,levels:a,orgUnits:n,userOrgUnit:l,userSubUnit:i,userSubX2Unit:o}=e;return o||i||l||t.length>0||a.length>0||n.length>0}(e)||n.Z.t("Please select at least one organisation unit")}});const i=t("orgUnitSelection"),o=(0,v.useCallback)((t=>{e("orgUnitSelection",t)}),[e]),r=(0,S.get)(l.errors,"orgUnitSelection");return v.createElement("div",{className:"column h-100"},v.createElement("div",{className:"pt-16 pb-16"},v.createElement("h3",null,n.Z.t("Organisation Unit"))),r&&v.createElement("div",{style:{display:"flex",gap:8,alignItems:"center",padding:"8px 0",color:y.O.red500}},v.createElement(b.Z,null),null===r||void 0===r?void 0:r.message),v.createElement("div",{style:{minHeight:400},className:"access-org-unit-filter h-100"},v.createElement(v.Suspense,{fallback:v.createElement(u.ContainerLoader,{height:400})},v.createElement(N.aY,{showGroups:!0,showLevels:!0,showUserOptions:!0,onUpdate:e=>{o(u.OrgUnitSelection.setObject(i,e))},value:i}))))}var w=a(75798),I=a(94518);function k(){const{watch:e,setValue:t}=(0,p.Gc)(),a=e("publicAccess"),n=(0,v.useCallback)((e=>{t("publicAccess",e)}),[t]),l=e("userGroupAccesses"),i=(0,v.useCallback)((e=>{t("userGroupAccesses",e)}),[t]),o=e("userAccesses"),r=(0,v.useCallback)((e=>{t("userAccesses",e)}),[t]),c=(0,v.useMemo)((()=>[...o||[],...l||[]]),[o,l]),d=(0,v.useCallback)((e=>{n(e)}),[n]),s=(0,v.useCallback)((e=>{const{type:t}=e||{};if("user"===t){const t=(0,S.cloneDeep)(o);return(0,S.remove)(t,["id",null===e||void 0===e?void 0:e.id]),void r(t)}const a=(0,S.cloneDeep)(l);(0,S.remove)(a,["id",null===e||void 0===e?void 0:e.id]),i(a)}),[r,i,o,l]),m=(0,v.useCallback)((e=>{const{type:t}=e||{};if(t===u.AccessTypes.USER){const t=(0,S.findIndex)(o,["id",null===e||void 0===e?void 0:e.id]);r((0,f.ZP)(o,(a=>{(0,S.set)(a,[t],e)})))}const a=(0,S.findIndex)(l,["id",null===e||void 0===e?void 0:e.id]);i((0,f.ZP)(l,(t=>{(0,S.set)(t,[a],e)})))}),[r,i,o,l]);return{onAdd:(0,v.useCallback)(((e,t)=>{e&&t&&("user"===(null===t||void 0===t?void 0:t.type)?r([...null!==o&&void 0!==o?o:[],new u.ScorecardAccess({id:null===t||void 0===t?void 0:t.id,displayName:null===t||void 0===t?void 0:t.displayName,type:"user",access:e})]):i([...null!==l&&void 0!==l?l:[],new u.ScorecardAccess({id:null===t||void 0===t?void 0:t.id,displayName:null===t||void 0===t?void 0:t.displayName,type:"userGroup",access:e})]))}),[r,i,o,l]),publicAccess:a,onPublicAccessChange:d,userAndUserGroupAccesses:c,onDelete:s,onUpdate:m}}var T=a(13414),D=a(55898),x=a(29530),Z=a(84617),G=a(62755),H=a(59349);function A(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case u.ScorecardAccessType.NO_ACCESS:return n.Z.t("No Access");case u.ScorecardAccessType.READ_ONLY:return n.Z.t("Can Read");case u.ScorecardAccessType.READ_WRITE:return n.Z.t("Can Read and Write")}}function P(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"public":return v.createElement(H.Z,null);case"user":return v.createElement(G.Z,null);case"userGroup":return v.createElement(Z.Z,null)}}var O=a(63401),U=a(26330),L=a(89020),R=a(45919);function _(e){let{reference:t,onClose:a,selectedAccess:n,onAccessChange:l}=e;return v.createElement(O.m,{onClick:a},v.createElement(U.r,{reference:t,placement:"bottom-start"},v.createElement(L.q,null,null===u.ACCESS_TYPES||void 0===u.ACCESS_TYPES?void 0:u.ACCESS_TYPES.map((e=>v.createElement(v.Fragment,{key:e},v.createElement(T.s,{onClick:()=>l(e),active:n===e,label:A(e),icon:n===e&&v.createElement(R.Z,null)})))))))}function V(e){let{access:t,onDelete:a,onAccessChange:l}=e;const{access:r,type:c,displayName:d}=t,[s,u]=(0,v.useState)();return v.createElement(T.s,{icon:P(c),label:v.createElement("div",{className:"row space-between align-items-center"},v.createElement("div",{className:"column"},v.createElement("p",{style:{margin:2,fontSize:16}},d),v.createElement("p",{style:{color:y.O.grey700,fontSize:14,margin:0}},A(r))),v.createElement("div",{className:"column align-items-end"},v.createElement(o.J,{className:"edit-delete-access"},v.createElement(i.z,{onClick:(e,t)=>u(t.currentTarget),icon:v.createElement(x.Z,null)},n.Z.t("Edit")),Boolean(a)&&v.createElement(i.z,{onClick:()=>{a(t)},icon:v.createElement(D.Z,null)},n.Z.t("Delete")))),s&&v.createElement(_,{reference:s,onClose:()=>u(void 0),selectedAccess:r,onAccessChange:e=>{const a=(0,S.cloneDeep)(t);(0,S.set)(a,["access"],e),l(a),u(void 0)}}))})}function $(){const{publicAccess:e,onPublicAccessChange:t,userAndUserGroupAccesses:a,onUpdate:n,onDelete:l}=k();return v.createElement("div",null,v.createElement(w.v,{dense:!0},v.createElement(V,{onAccessChange:t,access:e}),v.createElement(I.R,null),null===a||void 0===a?void 0:a.map((e=>v.createElement(v.Fragment,{key:null===e||void 0===e?void 0:e.id},v.createElement(V,{onAccessChange:n,access:e,onDelete:l}),v.createElement(I.R,null))))))}var M=a(49656),F=a(34697),z=a(75877),j=a(70464);const K={users:{resource:"users",params:e=>{let{keyword:t}=e;return{filter:[`displayName:ilike:${t}`],fields:["id","displayName"],order:"name:asc"}}},userGroups:{resource:"userGroups",params:e=>{let{keyword:t}=e;return{filter:t?[`displayName:ilike:${t}`]:void 0,fields:["id","name","displayName"],order:"name:asc"}}}};function B(e){let{data:t,onSelect:a,reference:n,onClose:l}=e;return n?v.createElement(U.r,{className:"layer-1",reference:n,placement:"bottom-start"},v.createElement(L.q,{maxHeight:"400px"},null===t||void 0===t?void 0:t.map((e=>v.createElement(T.s,{key:null===e||void 0===e?void 0:e.id,onClick:()=>(a(e),void l()),label:null===e||void 0===e?void 0:e.displayName,icon:P(null===e||void 0===e?void 0:e.type)}))))):null}function W(e){let{selected:t,onChange:a,selectedList:n=[]}=e;const[l,i]=(0,v.useState)(null===t||void 0===t?void 0:t.displayName),{data:o,loading:r,error:c,setKeyword:d}=function(e){const[t,a]=(0,v.useState)(e),{data:n,errors:l,loading:i,refetch:o}=(0,h.u_)(K,{variables:{keyword:t},lazy:!0});return(0,v.useEffect)((()=>{t&&o({keyword:t})}),[t]),{data:(0,v.useMemo)((()=>{var e,t,a,l;return[...(null===n||void 0===n||null===(e=n.users)||void 0===e||null===(t=e.users)||void 0===t?void 0:t.map((e=>({...e,type:"user"}))))||[],...(null===n||void 0===n||null===(a=n.userGroups)||void 0===a||null===(l=a.userGroups)||void 0===l?void 0:l.map((e=>({...e,type:"userGroup"}))))||[]]}),[null===n||void 0===n?void 0:n.users,null===n||void 0===n?void 0:n.userGroups]),errors:l,loading:i,setKeyword:a}}(l),s=(0,v.useRef)(),[u,m]=(0,v.useState)(),p=(0,S.debounce)((()=>{d(null===l||void 0===l?void 0:l.trim())}),1e3);(0,v.useEffect)((()=>{t||i(void 0)}),[t]);return v.createElement(v.Fragment,null,v.createElement("div",{ref:s},v.createElement(j.U,{loading:r,error:c,validationText:null===c||void 0===c?void 0:c.message,label:"Select User or User Group",value:l,onChange:(e,t)=>{let{value:a}=e;i(a),m(null===t||void 0===t?void 0:t.target),p()}})),u&&!(0,S.isEmpty)(o)&&v.createElement(B,{onClose:()=>m(void 0),reference:u,onSelect:e=>{i(null===e||void 0===e?void 0:e.displayName),a(e)},data:(0,S.filter)(o,(e=>{let{id:t}=e;return!(null!==n&&void 0!==n&&n.includes(t))}))}))}function Y(){const{userAndUserGroupAccesses:e,onAdd:t}=k(),[a,l]=(0,v.useState)(),[o,r]=(0,v.useState)(),c=e;return v.createElement("div",{className:"row align-items-end add-sharing-access"},v.createElement("div",{className:"column pr-16 user-selector",style:{width:"50%"}},v.createElement(W,{selectedList:null===c||void 0===c?void 0:c.map((e=>{let{id:t}=e;return t})),selected:a,onChange:l})),v.createElement("div",{className:"column pr-16",style:{width:"30%"}},v.createElement(M.n,{className:"access-selector",required:!0,selected:o,onChange:e=>{let{selected:t}=e;r(t)},label:n.Z.t("Select Access")},null===u.ACCESS_TYPES||void 0===u.ACCESS_TYPES?void 0:u.ACCESS_TYPES.map((e=>v.createElement(F.a,{value:e,key:e,label:A(e)}))))),v.createElement("div",{className:"column",style:{width:"20%"}},v.createElement(i.z,{className:"add-access-button",onClick:()=>{t(o,a),r(void 0),l(void 0)},icon:v.createElement(z.Z,null)},n.Z.t("Add"))))}function q(){return v.createElement("div",{className:"p-16 pl-32"},v.createElement("div",null,v.createElement("h3",null,n.Z.t("Sharing"))),v.createElement("div",null,v.createElement("p",{style:{fontSize:18}},n.Z.t("Shared With"))),v.createElement("div",{className:"sharing-list"},v.createElement($,null)),v.createElement("div",{className:"pt-32"},v.createElement("p",{style:{fontSize:18}},n.Z.t("Add Access"))),v.createElement("div",null,v.createElement(Y,null)))}function X(){return v.createElement("div",{className:"col-12",style:{height:"100%"}},v.createElement("div",{className:"row center"},v.createElement("div",{className:"info-box"},v.createElement("div",{className:"column"},v.createElement("h2",{className:"info-box-title"},n.Z.t("Configure Data Sources")),v.createElement("ul",{className:"info-box-list"},v.createElement("li",null,n.Z.t("Add a data source group")),v.createElement("li",null,n.Z.t("Modify the group name")),v.createElement("li",null,n.Z.t("Add different data sources to a group")),v.createElement("li",null,n.Z.t("Click on a data source to configure it")),v.createElement("li",null,n.Z.t("View the changes on the preview panel above")))))))}function J(){return v.createElement("div",{className:"col-12",style:{height:"100%"}},v.createElement("div",{className:"row center align-items-center"},v.createElement("div",{className:"info-box"},v.createElement("div",{className:"column"},v.createElement("p",{style:{fontSize:18,color:y.O.grey600,fontWeight:"bold"}},n.Z.t("Select a data source to configure"))))))}var Q=a(84415),ee=a(83498);function te(e){var t;return null!==(t=null===e||void 0===e?void 0:e.filter((e=>!e.isDefault)))&&void 0!==t?t:[]}var ae=a(34335),ne=a(28259),le=a(62),ie=a(57046);function oe(e){let{value:t,onChange:a,legendDefinitions:n,highIsGood:l}=e;return v.createElement(N.E3,{value:t,legendDefinitions:n,highIsGood:l,valueType:"LEGEND_MIN_MAX_GROUP",name:"legend-min-max-group",onChange:a})}function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},re.apply(this,arguments)}function ce(e){var t;let{name:a,value:n=[],onChange:l,multipleFields:i,weight:o,highIsGood:r,...c}=e;const d=(0,E.useRecoilValue)(u.OrgUnitLevels),{watch:s}=(0,p.Gc)(),[m,g]=(0,v.useState)(null===(t=(0,S.head)(d))||void 0===t?void 0:t.id),h=te(s("legendDefinitions")),b=(0,v.useMemo)((()=>{var e;return Array.isArray(n)?(0,S.fromPairs)([...null!==(e=null===d||void 0===d?void 0:d.map((e=>{let{id:t}=e;return[t,(0,u.generateLegendDefaults)(i,o,r)]})))&&void 0!==e?e:[]]):n}),[r,n,i,d,o]),N=(e,t)=>{l({value:(0,f.ZP)(b,(a=>(0,S.set)(a,[t],e)))})};return(0,v.useEffect)((()=>{Array.isArray(n)&&l({value:b})}),[b,n]),v.createElement(ae.g,re({name:a},c),null===d||void 0===d?void 0:d.map((e=>{var t;let{id:a,displayName:n}=e;return v.createElement(ne.Z,{expanded:m===a,key:a,onChange:(l=a,(e,t)=>{g(!!t&&l)})},v.createElement(le.Z,{style:{background:y.O.grey200}},n),v.createElement(ie.Z,null,v.createElement("div",{className:"column w-100"},v.createElement(oe,{highIsGood:r,legendDefinitions:h,value:null!==(t=(0,S.get)(b,a))&&void 0!==t?t:[],onChange:e=>N(e,a)}))));var l})))}function de(e){let{path:t}=e;const{watch:a,setValue:n}=(0,p.Gc)(),l=te(a("legendDefinitions")),i=a(`${t}.weight`),o=a(`${t}.highIsGood`),r=a(`${t}.legends`);return v.createElement(ce,{multipleFields:null===l||void 0===l?void 0:l.map((e=>new u.FormFieldModel({id:e.id,mandatory:!1,name:e.name,legendDefinition:e,valueType:u.DHIS2ValueTypes.LEGEND_MIN_MAX.name}))),value:r,onChange:e=>{let{value:a}=e;n(`${t}.legends`,a)},legends:r,highIsGood:o,weight:i,path:t,name:"legends"})}var se=a(22020),ue=a(53040),me=a(86900),ve=a(98914);function pe(e){var t;let{target:a,setTarget:l}=e;const[o,r]=(0,v.useState)((0,S.isEmpty)(a.items)),c=(0,E.useRecoilValue)((0,u.SelectedOrgUnits)(a.items));return v.createElement(v.Fragment,null,v.createElement("div",{className:" align-items-end row gap-8 w-100"},v.createElement("div",{className:"column flex-1"},v.createElement(j.U,{fullWidth:!0,label:n.Z.t("Organisation Unit(s)"),disabled:!0,value:null===c||void 0===c||null===(t=c.map((e=>null===e||void 0===e?void 0:e.displayName)))||void 0===t?void 0:t.join(", ")})),v.createElement("div",{className:"w-25"},v.createElement(i.z,{onClick:()=>r(!0)},n.Z.t("Change")))),o&&v.createElement(N.e5,{value:{orgUnits:null!==c&&void 0!==c?c:[]},onClose:()=>r(!1),hide:!o,onUpdate:e=>{let{orgUnits:t}=e;l((e=>({...e,items:null===t||void 0===t?void 0:t.map((e=>e.id))}))),r(!1)}}))}function ge(e){let{open:t,onClose:a,onUpdate:l,specificTarget:r,defaultLegends:c,onChangeDefaultLegends:d,path:s}=e;const{watch:u}=(0,p.Gc)(),[m,g]=(0,v.useState)(r),E=te(u("legendDefinitions")),h=u(`${s}.highIsGood`),f=(0,v.useCallback)((()=>{l({...m}),a()}),[a,l,m]);return v.createElement(se.u,{onClose:a,hide:!t,position:"middle"},v.createElement(ue.r,null,n.Z.t("Organisation Unit Specific Targets")),v.createElement(me.h,null,v.createElement(v.Suspense,{fallback:v.createElement("div",{className:"column align-items-center justify-content-center",style:{height:100,width:"100%"}},v.createElement(Q.V,{small:!0}))},v.createElement("div",{className:"column w-100 gap-16"},v.createElement(pe,{target:m,setTarget:g}),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement(oe,{highIsGood:h,legendDefinitions:E,value:m.legends,onChange:e=>{g((t=>({...t,legends:e})))}}))),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement("p",null,n.Z.t("Other Periods")),v.createElement(oe,{highIsGood:h,legendDefinitions:E,value:c,onChange:d})))))),v.createElement(ve.n,null,v.createElement(o.J,null,v.createElement(i.z,{onClick:a},n.Z.t("Cancel")),v.createElement(i.z,{onClick:f,primary:!0},n.Z.t("Update")))))}var Ee=a(21386);function he(e){var t,a,l,r;let{open:c,onClose:d,onUpdate:s,specificTarget:m,defaultLegends:g,onChangeDefaultLegends:h,path:f}=e;const{watch:y}=(0,p.Gc)(),[b,C]=(0,v.useState)(m),{calendar:w}=(0,E.useRecoilValue)(u.SystemSettingsState),I=te(y("legendDefinitions")),k=y(`${f}.highIsGood`),[T,D]=(0,v.useState)((0,S.isEmpty)(b.items)),x=(0,v.useCallback)((()=>{s({...b}),d()}),[d,s,b]);return v.createElement(se.u,{onClose:d,hide:!c,position:"middle"},v.createElement(ue.r,null,n.Z.t("Period Specific Targets")),v.createElement(me.h,null,v.createElement("div",{className:"column w-100 gap-16"},v.createElement("div",{className:" align-items-end row gap-8 w-100"},v.createElement("div",{className:"column flex-1"},v.createElement(j.U,{fullWidth:!0,label:n.Z.t("Period"),disabled:!0,value:null===b||void 0===b||null===(t=b.items)||void 0===t||null===(a=t.map((e=>{var t;if(e)return null===(t=(new Ee.Period).setPreferences({allowFuturePeriods:!0}).setCalendar(w).getById(e))||void 0===t?void 0:t.name})))||void 0===a?void 0:a.join(", ")})),v.createElement("div",{className:"w-25"},v.createElement(i.z,{onClick:()=>D(!0)},n.Z.t("Change Period")))),T&&v.createElement(N.rJ,{enablePeriodSelector:!0,excludeRelativePeriods:!0,singleSelection:!0,selectedPeriods:(0,S.compact)([...null!==(l=null===(r=b.items)||void 0===r?void 0:r.map((e=>{if(e)return e})))&&void 0!==l?l:[]]),onClose:()=>D(!1),hide:!T,onUpdate:e=>{C((t=>{var a;return{...t,items:[null===(a=e[0])||void 0===a?void 0:a.id]}})),D(!1)}}),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement(oe,{highIsGood:k,legendDefinitions:I,value:b.legends,onChange:e=>{C((t=>({...t,legends:e})))}}))),v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement("p",null,n.Z.t("Other Periods")),v.createElement(oe,{highIsGood:k,legendDefinitions:I,value:g,onChange:h}))))),v.createElement(ve.n,null,v.createElement(o.J,null,v.createElement(i.z,{onClick:d},n.Z.t("Cancel")),v.createElement(i.z,{onClick:x,primary:!0},n.Z.t("Update")))))}var fe=a(32031);function Se(e){let{legends:t,legendDefinitions:a}=e;return v.createElement("div",{className:"row gap-16 space-evenly"},null===t||void 0===t?void 0:t.map(((e,t)=>{var n;const{legendDefinitionId:l,startValue:i,endValue:o}=null!==e&&void 0!==e?e:{},r=null!==(n=(0,S.find)(a,{id:l}))&&void 0!==n?n:{};return v.createElement("div",{className:"row gap-8 align-items-center",key:t},v.createElement("div",{style:{height:32,width:48,background:r.color}}),v.createElement("div",null,`${o} - ${i}`))})))}function ye(e){switch(e){case"period":return n.Z.t("Period");case"orgUnit":return n.Z.t("Organisation unit(s)");case"orgUnitLevel":return n.Z.t("Organisation unit levels")}}function be(e){let{specificTarget:t,legendDefinitions:a,onUpdate:l,defaultLegends:o}=e;const{legends:r,items:c}=null!==t&&void 0!==t?t:{},d=(0,E.useRecoilValue)((0,u.SelectedOrgUnits)(c));return v.createElement("div",{style:{border:`1px solid ${y.O.grey500}`,borderRadius:4,padding:8},className:"column gap-8 flex-wrap"},v.createElement("div",{className:"column gap-8 flex-wrap"},v.createElement("b",null,n.Z.t("Organisation Unit(s)")),v.createElement("div",{className:"row gap-8 flex-wrap"},null===d||void 0===d?void 0:d.map((e=>v.createElement(fe.V,{key:`${e}-tag`},e.displayName))))),v.createElement("div",null,v.createElement("p",null,n.Z.t("Legends")),v.createElement(Se,{legends:r,legendDefinitions:a})),v.createElement("div",null,v.createElement("p",null,n.Z.t("Other Organisation Units")),v.createElement(Se,{legends:o,legendDefinitions:a})),v.createElement("div",{className:"row gap-8 justify-content-end"},v.createElement(i.z,{onClick:l},n.Z.t("Update"))))}function Ne(e){let{specificTarget:t,legendDefinitions:a,onUpdate:l,defaultLegends:o}=e;const{legends:r,type:c,items:d}=null!==t&&void 0!==t?t:{},{calendar:s}=(0,E.useRecoilValue)(u.SystemSettingsState);return v.createElement("div",{style:{border:`1px solid ${y.O.grey500}`,borderRadius:4,padding:8},className:"column gap-8 flex-wrap"},v.createElement("div",{className:"column gap-8 flex-wrap"},v.createElement("b",null,ye(c)),v.createElement("div",{className:"row gap-8 flex-wrap"},null===d||void 0===d?void 0:d.map((e=>{var t;return v.createElement(fe.V,{key:`${e}-tag`},null===(t=(new Ee.Period).setPreferences({allowFuturePeriods:!0}).setCalendar(s).getById(e))||void 0===t?void 0:t.name)})))),v.createElement("div",null,v.createElement("p",null,n.Z.t("Legends")),v.createElement(Se,{legends:r,legendDefinitions:a})),v.createElement("div",null,v.createElement("p",null,n.Z.t(`Other ${ye(c)}`)),v.createElement(Se,{legends:o,legendDefinitions:a})),v.createElement("div",{className:"row gap-8 justify-content-end"},v.createElement(i.z,{onClick:l},n.Z.t("Update"))))}function Ce(e){const{name:t,path:a}=null!==e&&void 0!==e?e:{},[n,l]=(0,p.qo)({name:["legendDefinitions",`${a}.highIsGood`]}),i=(0,v.useMemo)((()=>n.filter((e=>!e.isDefault))),[n]);return v.createElement(N.hK,{name:t,valueType:"LEGEND_MIN_MAX_GROUP",highIsGood:!l,legendDefinitions:i})}function we(e){let{path:t}=e;const{setValue:a}=(0,p.Gc)(),[l,i,o,r,c,d]=(0,p.qo)({name:["legendDefinitions",`${t}.specificTargetsSet`,`${t}.specificTargets`,`${t}.legends`,`${t}.weight`,`${t}.highIsGood`]}),s=te(l),[m,g]=(0,v.useState)(!1),[E,h]=(0,v.useState)(function(e,t){var a;return!(0,S.isEmpty)(e)&&t?null===(a=(0,S.head)(e))||void 0===a?void 0:a.type:t?"orgUnitLevel":null}(o,i));return(0,v.useEffect)((()=>{i||(0,S.isEmpty)(o)||(h(null),a(`${t}.specificTargets`,[]))}),[i,o,a,t]),(0,v.useEffect)((()=>{var e;E&&(0,S.isEmpty)(null===(e=o[0])||void 0===e?void 0:e.items)&&g(!0)}),[E,o]),v.createElement("div",{className:"column gap-16"},v.createElement(N.hK,{valueType:u.DHIS2ValueTypes.TRUE_ONLY.name,label:n.Z.t("Set Specific Targets"),name:`${t}.specificTargetsSet`}),i?v.createElement("div",{className:"column gap-16"},v.createElement(M.n,{label:n.Z.t("Specific target type"),selected:E,onChange:e=>{let{selected:n}=e;if("orgUnitLevel"===n)return h(n),a(`${t}.legends`,[]),void a(`${t}.specificTargets`,[]);h(n),a(`${t}.legends`,(0,u.generateLegendDefaults)(s,c,d)),a(`${t}.specificTargets`,[{id:(0,u.uid)(),type:n,items:[],legends:(0,u.generateLegendDefaults)(s,c,d)}])}},v.createElement(F.a,{value:"period",label:n.Z.t("Period")}),v.createElement(F.a,{value:"orgUnit",label:n.Z.t("Organisation Unit")}),v.createElement(F.a,{value:"orgUnitLevel",label:n.Z.t("Organisation Unit Level")})),v.createElement("div",{className:"column gap-8"},v.createElement(v.Suspense,{fallback:v.createElement("div",{className:"column align-items-center justify-content-center",style:{height:100,width:"100%"}},v.createElement(Q.V,{small:!0}))},"orgUnitLevel"!==E&&(null===o||void 0===o?void 0:o.map((e=>"period"===E?v.createElement(Ne,{defaultLegends:r,onDelete:()=>{a(`${t}.specificTargets`,[])},legendDefinitions:s,onUpdate:()=>g(!0),key:`${e.id}-view`,specificTarget:e}):v.createElement(be,{defaultLegends:r,onDelete:()=>{a(`${t}.specificTargets`,[])},legendDefinitions:s,onUpdate:()=>g(!0),key:`${e.id}-view`,specificTarget:e})))))),"period"===E&&m&&!(0,S.isEmpty)(o)?v.createElement(he,{path:t,defaultLegends:r,onChangeDefaultLegends:e=>a(`${t}.legends`,e),specificTarget:o[0],onClose:()=>g(!1),open:m,onUpdate:e=>{g(!1),a(`${t}.specificTargets`,[e])}}):null,"orgUnit"===E&&m&&!(0,S.isEmpty)(o)?v.createElement(ge,{path:t,defaultLegends:r,onChangeDefaultLegends:e=>a(`${t}.legends`,e),specificTarget:o[0],onClose:()=>g(!1),open:m,onUpdate:e=>{g(!1),a(`${t}.specificTargets`,[e])}}):null,"orgUnitLevel"===E&&v.createElement(de,{path:t})):v.createElement("div",{className:"row"},v.createElement("div",{className:"column w-100 legend-settings-area"},v.createElement(Ce,{name:`${t}.legends`,path:t}))))}function Ie(e){let{path:t}=e;const{watch:a,setValue:l}=(0,p.Gc)();return(0,v.useEffect)((()=>{t&&l(t,a(t))}),[a,t,l]),v.createElement("div",{className:"container p-16 data-source-form-container"},v.createElement("div",{style:{gap:16},className:"column"},v.createElement(N.hK,{disabled:!0,mandatory:!0,valueType:u.DHIS2ValueTypes.TEXT.name,label:n.Z.t("Name"),name:`${t}.name`}),v.createElement(N.hK,{mandatory:!0,valueType:u.DHIS2ValueTypes.TEXT.name,label:n.Z.t("Label"),name:`${t}.label`,validations:{required:n.Z.t("Label is required")}}),v.createElement(N.hK,{valueType:u.DHIS2ValueTypes.NUMBER.name,label:n.Z.t("Weight"),name:`${t}.weight`}),v.createElement("div",{className:"row space-between"},v.createElement("div",{className:"column pr-16 effective-gap-settings"},v.createElement(N.hK,{valueType:u.DHIS2ValueTypes.NUMBER.name,label:n.Z.t("Effective Gap"),name:`${t}.effectiveGap`})),v.createElement("div",{className:"column pl-16 indicator-options-settings-area"},v.createElement(N.hK,{renderAsCheckbox:!0,valueType:"BOOLEAN",label:n.Z.t("Display Arrows"),name:`${t}.displayArrows`}),v.createElement(N.hK,{renderAsCheckbox:!0,valueType:"BOOLEAN",label:n.Z.t("High is Good"),name:`${t}.highIsGood`}),v.createElement(N.hK,{renderAsCheckbox:!0,valueType:"BOOLEAN",label:n.Z.t("Show Colors"),name:`${t}.showColors`}))),v.createElement(ee.i,null),v.createElement(we,{path:t})))}function ke(){var e,t;const{watch:a}=(0,p.Gc)(),n=(0,E.useRecoilValue)(u.ScorecardConfigEditState),l=null===(e=["dataSelection","dataGroups",null===n||void 0===n?void 0:n.selectedGroupIndex,"dataHolders",null===n||void 0===n?void 0:n.selectedDataHolderIndex])||void 0===e?void 0:e.join("."),i=a(l);return v.createElement("div",{className:"data-configuration-row"},(null===i||void 0===i||null===(t=i.dataSources)||void 0===t?void 0:t.map(((e,t)=>{const a=`${l}.dataSources.${t}`;return v.createElement("div",{key:e.id,style:{maxWidth:720,minWidth:480},className:"w-100 h-100"},v.createElement("div",{className:"container-bordered h-100"},v.createElement("div",{className:"column"},v.createElement("div",{className:"p-16"},v.createElement(v.Suspense,{fallback:v.createElement("div",{className:"w-100 h-100 center align-items-center"},v.createElement(Q.V,{small:!0}))},v.createElement(Ie,{path:a}))))))})))||null)}function Te(){const{selectedDataHolderIndex:e}=(0,E.useRecoilValue)(u.ScorecardConfigEditState);return v.createElement("div",null,v.createElement(v.Suspense,{fallback:v.createElement(u.ContainerLoader,null)},isNaN(e)?v.createElement("div",{className:"row center align-items-center"},v.createElement(J,null)):v.createElement(ke,null)))}function De(e){let{onGroupAdd:t}=e;return v.createElement("div",{style:{margin:"auto"}},v.createElement(i.z,{onClick:t,icon:v.createElement(z.Z,null),className:"scorecard-add-group-button",dataTest:"scorecard-add-group-button"},n.Z.t("Add Group")))}var xe=a(10815),Ze=a(93010),Ge=a(10466),He=a(40891),Ae=a(73004);function Pe(e){var t,a;let{top:n,bottom:l,orgUnit:i,period:o}=e;const{legends:r,showColors:c,displayArrows:d,weight:s,specificTargets:m}=null!==n&&void 0!==n?n:{},{legends:g,showColors:E,displayArrows:h,weight:f,specificTargets:S}=null!==l&&void 0!==l?l:{},{watch:y}=(0,p.Gc)(),b=y("legendDefinitions"),N=(0,v.useMemo)(u.generateRandomValues,[]),C=(0,v.useMemo)(u.generateRandomValues,[]),{color:w}=null!==(t=(0,u.getLegend)(N,r,{max:s,specificTargets:m,orgUnit:i,period:o,legendDefinitions:b}))&&void 0!==t?t:{},{color:I}=null!==(a=(0,u.getLegend)(C,g,{max:f,specificTargets:S,orgUnit:i,period:o,legendDefinitions:b}))&&void 0!==a?a:{};return v.createElement("td",{className:"data-cell"},v.createElement(u.LinkedCellSvg,{topStatus:d&&"increasing",bottomStatus:h&&"decreasing",topColor:c?w:void 0,bottomColor:E?I:void 0,bottomValue:C,topValue:N}))}function Oe(e){var t,a,n;let{config:l}=e;const{watch:i}=(0,p.Gc)(),o=(0,E.useRecoilValue)(u.OrgUnitLevels),{organisationUnits:r}=(0,E.useRecoilValue)(u.UserState),c=i("legendDefinitions"),d=(null===l||void 0===l||null===(t=l.dataSources)||void 0===t?void 0:t.length)>1,[s,m]=null!==(a=null===l||void 0===l?void 0:l.dataSources)&&void 0!==a?a:[],{legends:g,showColors:h,id:f,displayArrows:y,weight:b,specificTargets:N}=null!==s&&void 0!==s?s:{},C=(0,v.useMemo)(u.generateRandomValues,[]),w=null===(n=(0,S.head)(r))||void 0===n?void 0:n.id,I=(new Date).getFullYear(),k=(0,u.getLegend)(C,g,{max:b,orgUnitLevels:o,dataOrgUnitLevel:1,legendDefinitions:c,specificTargets:N,orgUnit:w,period:I});return d?v.createElement(Pe,{orgUnit:w,period:I,bottom:m,top:s,specificTargets:N}):v.createElement("td",{width:"100px",className:"data-cell",align:"center",key:`${f}-data`,id:f},v.createElement(u.SingleCellSvg,{status:y&&"decreasing",color:h?null===k||void 0===k?void 0:k.color:void 0,value:C}))}function Ue(){var e,t;const{watch:a}=(0,p.Gc)(),{organisationUnits:l}=(0,E.useRecoilValue)(u.UserState),{dataGroups:i}=null!==(e=a("dataSelection"))&&void 0!==e?e:{},o=(0,v.useMemo)((()=>[...i]),[i]);return v.createElement("div",{className:"column",style:{width:"100%",overflowX:"auto"}},v.createElement(xe.w,{bordered:!0,width:"100%"},v.createElement(Ze.s,null,v.createElement(Ge.U,null,v.createElement(He.W,{fixed:!0,align:"center",className:"table-header scorecard-table-header",bordered:!0,rowSpan:"2"},n.Z.t("Organisation Unit")),null===o||void 0===o?void 0:o.map((e=>{var t;return v.createElement(He.W,{fixed:!0,align:"center",className:"table-header scorecard-table-header",bordered:!0,colSpan:null===e||void 0===e||null===(t=e.dataHolders)||void 0===t?void 0:t.length,key:null===e||void 0===e?void 0:e.id},null===e||void 0===e?void 0:e.title)}))),v.createElement(Ge.U,null,null===i||void 0===i?void 0:i.map((e=>{var t,a,n;return v.createElement("th",{width:100*(null===(t=e.dataHolders)||void 0===t?void 0:t.length)+"px",key:e.id,colSpan:(null===(a=e.dataHolders)||void 0===a?void 0:a.length)||1},v.createElement("table",{style:{borderSpacing:0,height:"100%"}},v.createElement("tr",null,null===e||void 0===e||null===(n=e.dataHolders)||void 0===n?void 0:n.map((e=>{var t,a,n,l;let{dataSources:i}=e;return v.createElement(He.W,{width:"100px",fixed:!0,bordered:!0,key:null===(t=i[0])||void 0===t?void 0:t.id,id:null===(a=i[0])||void 0===a?void 0:a.id},null===(n=i[0])||void 0===n?void 0:n.label," ",i.length>1&&`/${null===i||void 0===i||null===(l=i[1])||void 0===l?void 0:l.label}`)})))))})))),v.createElement(Ae.R,null,v.createElement(Ge.U,{bordered:!0},v.createElement(He.W,{width:"100%",className:"min-width-200",fixed:!0,tag:"th",bordered:!0},null===(t=(0,S.head)(l))||void 0===t?void 0:t.displayName),null===i||void 0===i?void 0:i.map((e=>{var t,a,n;return v.createElement("td",{className:"no-wrap",width:100*(null===(t=e.dataHolders)||void 0===t?void 0:t.length)+"px",style:{height:47},key:e.id,colSpan:(null===(a=e.dataHolders)||void 0===a?void 0:a.length)||1},v.createElement("table",{style:{borders:"none",borderSpacing:0}},v.createElement(Ge.U,null,null===e||void 0===e||null===(n=e.dataHolders)||void 0===n?void 0:n.map((e=>v.createElement(Oe,{key:e.id,config:e}))))))}))))))}var Le=a(56861),Re=a(92544),_e=a(78223);function Ve(e){let{onClose:t,open:a,onSelect:l,disabled:r}=e;const[c,d]=(0,v.useState)([]);return v.createElement(se.u,{onClose:t,position:"middle",large:!0,hide:!a},v.createElement(ue.r,null,n.Z.t("Add Data source")),v.createElement(me.h,null,v.createElement("div",{className:"w-100"},v.createElement(N.aN,{dataSources:["indicator","dataElement","dataSet","programIndicator","customFunction"],selected:c,disabled:r,onSelect:d}))),v.createElement(ve.n,null,v.createElement(o.J,{end:!0},v.createElement(i.z,{onClick:t},n.Z.t("Cancel")),v.createElement(i.z,{dataTest:"scorecard-data-source-add",primary:!0,onClick:()=>{l(c),t()}},n.Z.t("Add")))))}var $e=a(97611);const Me=(0,$e.Z)({root:{border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&$expanded":{margin:"auto"}},expanded:{}})(ne.Z),Fe=(0,$e.Z)({root:{background:"#F8F9FA",borderBottom:"1px solid rgba(0, 0, 0, .125)",marginBottom:-1,minHeight:56,"&$expanded":{minHeight:56}},content:{"&$expanded":{margin:"12px 0"}},expanded:{}})(le.Z),ze=(0,$e.Z)((e=>({root:{padding:e.spacing(2)}})))(ie.Z);function je(e){let{titleEditValue:t,setTitleEditValue:a,title:l,onClose:r,onTitleEditSubmit:c}=e;return v.createElement("div",{className:"row space-between w-100"},v.createElement("div",{onClick:e=>e.stopPropagation(),className:"column"},v.createElement(Le.I,{initialFocus:!0,value:t,onChange:e=>{let{value:t}=e;return a(t)}})),v.createElement("div",{className:"column "},v.createElement(o.J,{end:!0},v.createElement(i.z,{onClick:c},n.Z.t("Save")),v.createElement(i.z,{onClick:(e,t)=>{t.stopPropagation(),r(!1),a(l)}},n.Z.t("Cancel")))))}var Ke=a(30506);function Be(e){let{setTitleEditOpen:t,title:a,error:l,onDelete:o,id:r}=e;return v.createElement("div",{className:"row space-between align-items-center"},v.createElement("div",{className:"row  align-items-center accordion-title-container"},v.createElement("div",{className:"column w-auto"},v.createElement("p",{onDoubleClick:e=>{e.stopPropagation(),t(!0)},onClick:e=>e.stopPropagation(),className:"accordion-title group-name-area"},a),l&&v.createElement("p",{style:{fontSize:12,margin:4,color:"#f44336"}},null===l||void 0===l?void 0:l.message)),v.createElement(Ke.Z,{onClick:e=>{e.stopPropagation(),t(!0)},size:"small",className:"accordion-title-edit"},v.createElement(x.Z,null))),v.createElement("div",{className:!0},v.createElement("div",{className:"row align-items-center"},v.createElement(i.z,{className:"delete-group-icon",onClick:(e,t)=>{t.stopPropagation(),o&&o(r)},icon:v.createElement(D.Z,null)},n.Z.t("Delete")),l&&v.createElement("div",{style:{paddingLeft:16}},v.createElement(u.ErrorIcon,{color:"#f44336",size:24})))))}var We=a(33493),Ye=a(18699);var qe=a(91798);function Xe(e){let{dataSource:t,index:a,onDelete:l}=e;const{label:o,type:r}=null!==t&&void 0!==t?t:new u.ScorecardIndicator;return v.createElement("div",null,v.createElement("div",{className:"container-bordered data-source p-8 w-100"},v.createElement("div",{className:"row space-between align-items-center"},v.createElement("div",{className:"row align-items-center "},v.createElement(qe.Z,{className:"data-source avatar"},(0,u.getDataSourceShortName)(r)),v.createElement("p",{className:"data-source name"},o," ")),v.createElement("div",null,v.createElement(i.z,{className:"data-source close-icon",small:!0,onClick:(e,t)=>{t.stopPropagation(),l(a)},icon:v.createElement(D.Z,null)},n.Z.t("Delete"))))))}function Je(){return Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Je.apply(this,arguments)}function Qe(e){let{dataHolder:t,id:a,index:n,onDelete:l}=e;const{dataSources:i}=null!==t&&void 0!==t?t:new u.ScorecardIndicatorHolder,{trigger:o}=(0,p.Gc)(),[r,c]=(0,E.useRecoilState)(u.ScorecardConfigEditState),d=["dataGroups",r.selectedGroupIndex,"dataHolders",n],s=(0,E.useSetRecoilState)((0,u.ScorecardConfigDirtySelector)({key:"dataSelection",path:d})),m=r.selectedDataHolderIndex===n,g=(null===i||void 0===i?void 0:i.length)>1,h=e=>{if(g){const t=[...i];return t.splice(e,1),void s((e=>u.ScorecardIndicatorHolder.set(e,"dataSources",t)))}l(n)};return v.createElement(Re._l,{draggableId:`${a}`,index:n},(e=>v.createElement("div",Je({},e.draggableProps,e.dragHandleProps,{ref:e.innerRef}),v.createElement("div",{className:"row align-items-center"},v.createElement("div",{onClick:async()=>{a&&await o()&&c((e=>({...e,selectedDataHolderIndex:n})))},className:"column center",style:{border:g&&`1px solid ${y.O.grey400}`,background:m&&`${y.O.teal200}`,padding:g&&8,marginBottom:8}},null===i||void 0===i?void 0:i.map(((e,t)=>v.createElement("div",{className:"data-holder",key:e.id,style:{margin:"4px 0"}},v.createElement(Xe,{hasLinked:g,dataSource:e,key:e.id,onDelete:h,index:t})))))))))}function et(e){let{chunk:t,onDataSourceDelete:a,onLink:i,onUnlink:o,dataHolders:r}=e;const{linkable:c,hasLink:d,onIconClick:s,getIndex:u,onUnlinkClick:m}=function(e){var t,a;let{onLink:n,onUnlink:l,dataHolders:i,chunk:o}=e;const r=o.length>1,c=(null===(t=(0,S.head)(o))||void 0===t||null===(a=t.dataSources)||void 0===a?void 0:a.length)>1,d=(0,v.useCallback)((e=>(0,S.findIndex)(i,["id",e])),[i]),s=()=>{var e,t;const a=d(null===(e=(0,S.head)(o))||void 0===e?void 0:e.id),l=d(null===(t=(0,S.last)(o))||void 0===t?void 0:t.id);n(a,l)},u=()=>{l((0,S.head)(o).id)};return{linkable:r,hasLink:c,onIconClick:()=>{c?u():s()},onLinkClick:s,onUnlinkClick:u,getIndex:d}}({onLink:i,onUnlink:o,dataHolders:r,chunk:t});return v.createElement("div",{className:"linking-container"},v.createElement("div",{className:"row align-items-center"},v.createElement("div",{className:"column"},null===t||void 0===t?void 0:t.map((e=>v.createElement(l.u,{content:n.Z.t("Click to configure, drag to rearrange"),key:e.id},v.createElement(Qe,{onUnlink:m,dataHolder:e,onDelete:a,key:e.id,id:e.id,index:u(e.id)}))))),v.createElement("div",{className:"link-button-container"},v.createElement(l.u,{content:n.Z.t("Click to {{linkAction}}",{linkAction:d?n.Z.t("unlink"):n.Z.t("link")})},v.createElement(Ke.Z,{onClick:s,disabled:!c&&!d},(c||d)&&(d?v.createElement(Ye.Z,{className:"link-button"}):v.createElement(We.Z,{className:"link-button"})))))))}function tt(){return tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},tt.apply(this,arguments)}function at(e,t){let{handleAccordionChange:a,expanded:o,index:r,onDelete:c,error:d}=e;const{onDataSourceDelete:s,onDataSourceAdd:m,onTitleEditSubmit:g,titleEditValue:h,titleEditOpen:f,setTitleEditOpen:b,setTitleEditValue:N,group:C}=function(e){let{index:t,expanded:a}=e;const{watch:n,setValue:l}=(0,p.Gc)(),i=(0,E.useRecoilValue)(u.OrgUnitLevels),o=(0,E.useRecoilValue)((0,u.ScorecardConfigDirtyState)("targetOnLevels")),[r,c]=(0,E.useRecoilState)(u.ScorecardConfigEditState),d=(0,v.useMemo)((()=>["dataSelection","dataGroups",t].join(".")),[t]),s=n(d),m=(0,v.useCallback)((e=>{try{l(d,e)}catch(t){console.error(t)}}),[d,l]),g=n("legendDefinitions"),h=(0,v.useMemo)((()=>(0,S.filter)(g,(e=>{let{isDefault:t}=e;return!t}))),[g]),{title:f,id:y,dataHolders:b}=null!==s&&void 0!==s?s:new u.ScorecardIndicatorGroup,[N,C]=(0,v.useState)(!1),[w,I]=(0,v.useState)(f);return(0,v.useEffect)((()=>{a===y&&c((e=>({...e,selectedDataHolderIndex:void 0,selectedGroupIndex:t})))}),[a]),{onDataSourceDelete:e=>{try{r.selectedDataHolderIndex===e&&c((e=>({...e,selectedDataHolderIndex:void 0})));const t=(0,S.cloneDeep)(b)||[];(0,S.isEmpty)(t)||(t.splice(e,1),m(u.ScorecardIndicatorGroup.set(s,"dataHolders",t)))}catch(t){console.error(t)}},onDataSourceAdd:e=>{const t=null===e||void 0===e?void 0:e.map((e=>{var t;return new u.ScorecardIndicatorHolder({id:(0,u.uid)(),dataSources:[new u.ScorecardIndicator({...e,label:e.displayName,name:e.displayName,legends:o?(0,S.fromPairs)([...null!==(t=null===i||void 0===i?void 0:i.map((e=>{let{id:t}=e;return[t,(0,u.generateLegendDefaults)(h,100,!0)]})))&&void 0!==t?t:[]]):(0,u.generateLegendDefaults)(h,100,!0)})]})})),a=[...b,...t];m(u.ScorecardIndicatorGroup.set(s,"dataHolders",a))},onTitleEditSubmit:(e,t)=>{t.stopPropagation(),(0,S.isEmpty)(w.trim())?(I(f),C(!1)):(m(u.ScorecardIndicatorGroup.set(s,"title",w)),C(!1))},titleEditOpen:N,titleEditValue:w,setTitleEditValue:I,setTitleEditOpen:C,group:s}}({index:r,expanded:o}),{onLink:w,onUnlink:I,onDragEnd:k,onExpand:T}=function(e){let{handleAccordionChange:t,index:a}=e;const{watch:n,setValue:l}=(0,p.Gc)(),i=(0,v.useMemo)((()=>["dataSelection","dataGroups",a].join(".")),[a]),o=n(i),{id:r,dataHolders:c}=null!==o&&void 0!==o?o:new u.ScorecardIndicatorGroup,d=(0,v.useCallback)((e=>{l(i,e)}),[i,l]),s=(0,E.useRecoilCallback)((e=>{let{snapshot:t,set:a}=e;return(e,n)=>{var l,i;const r=(0,S.head)(null===(l=c[n])||void 0===l?void 0:l.dataSources),s=u.ScorecardIndicatorHolder.linkDataSource(c[e],r),m=[...c];m.splice(e,1,s),m.splice(n,1);const v=null===(i=t.getLoadable(u.ScorecardConfigEditState).contents)||void 0===i?void 0:i.selectedDataHolderIndex;v!==e&&v!==n||a(u.ScorecardConfigEditState,(t=>({...t,selectedDataHolderIndex:e}))),d(u.ScorecardIndicatorGroup.set(o,"dataHolders",m))}}),[c,o,d]),m=(0,E.useRecoilCallback)((e=>{let{set:t}=e;return e=>{var a;const n=(0,S.find)(c,["id",e]),l=(0,S.findIndex)(c,["id",e]),i=new u.ScorecardIndicatorHolder({dataSources:[(0,S.last)(null===n||void 0===n?void 0:n.dataSources)]}),r=(0,S.cloneDeep)(n),s=u.ScorecardIndicatorHolder.set(r,"dataSources",null===r||void 0===r||null===(a=r.dataSources)||void 0===a?void 0:a.splice(0,1)),m=[...c];(0,S.set)(m,[l],s),m.splice(l,0,i),d(u.ScorecardIndicatorGroup.set(o,"dataHolders",m)),t(u.ScorecardConfigEditState,(e=>({...e,selectedDataHolderIndex:void 0})))}}));return{onLink:s,onUnlink:m,onDragEnd:(0,E.useRecoilCallback)((e=>{let{set:t}=e;return e=>{const{destination:a,source:n}=e||{};d(u.ScorecardIndicatorGroup.set(o,"dataHolders",(0,u.updateListFromDragAndDrop)(null===o||void 0===o?void 0:o.dataHolders,null===n||void 0===n?void 0:n.index,null===a||void 0===a?void 0:a.index))),t(u.ScorecardConfigEditState,(e=>e.selectedDataHolderIndex===(null===n||void 0===n?void 0:n.index)?{...e,selectedDataHolderIndex:null===a||void 0===a?void 0:a.index}:e))}})),onExpand:(e,a)=>{t(r)(e,a)}}}({handleAccordionChange:a,index:r}),{dataHolderChunks:D,selectedDataSourcesIds:x}=function(e){var t;let{index:a}=e;const{watch:n}=(0,p.Gc)(),l=n((0,v.useMemo)((()=>["dataSelection","dataGroups",a].join(".")),[a])),{dataHolders:i}=null!==l&&void 0!==l?l:new u.ScorecardIndicatorGroup,o=function(){const e=[],t=[...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]];for(;t.length>0;){var a,n,l,i,o;(null===(a=t[0])||void 0===a?void 0:a.dataSources)>1?e.push(t.splice(0,1)):(null===(n=t[0])||void 0===n||null===(l=n.dataSources)||void 0===l?void 0:l.length)<2&&(null===(i=t[1])||void 0===i||null===(o=i.dataSources)||void 0===o?void 0:o.length)<2?e.push(t.splice(0,2)):e.push(t.splice(0,1))}return e}(i);return{dataHolderChunks:o,selectedDataSourcesIds:null===(t=(0,S.flattenDeep)(null===i||void 0===i?void 0:i.map((e=>{let{dataSources:t}=e;return t}))))||void 0===t?void 0:t.map((e=>{let{id:t}=e;return t}))}}({index:r}),{title:Z,id:G,dataHolders:H}=null!==C&&void 0!==C?C:new u.ScorecardIndicatorGroup,[A,P]=(0,v.useState)(!1),O=(0,v.useRef)();return v.createElement(Re._l,{ref:t,index:r,draggableId:G},(e=>v.createElement(Me,{innerRef:e.innerRef,onDoubleClick:e=>e.stopPropagation(),expandIcon:v.createElement(_e.Z,null),square:!0,expanded:o===G,onChange:T},v.createElement(l.u,{content:n.Z.t("Click to {{action}}, drag to rearrange",{action:o===G?n.Z.t("collapse"):n.Z.t("expand")})},v.createElement(Fe,tt({innerRef:O,onClick:e=>e.stopPropagation()},e.draggableProps,e.dragHandleProps,{expandIcon:v.createElement(_e.Z,{className:"expand-group-icon",dataTest:"scorecard-group-expand"}),"aria-controls":`${G}d-content`,id:`${G}d--header`,dataTest:"scorecard-group-item"}),f?v.createElement(je,{onTitleEditSubmit:g,titleEditValue:h,onClose:b,title:Z,setTitleEditValue:N}):v.createElement(Be,{title:Z,onDelete:c,setTitleEditOpen:b,id:G,error:d}))),v.createElement(ze,null,v.createElement("div",{className:"column data-holders-area"},(0,S.isEmpty)(H)?v.createElement("div",{className:"column w-100 text-center center",style:{height:100}},v.createElement("p",{style:{color:y.O.grey600}},n.Z.t("Add a data source"))):v.createElement(Re.Z5,{onDragEnd:k},v.createElement(Re.bK,{droppableId:`${G}`},(e=>v.createElement("div",tt({className:"w-100 "},e.droppableProps,{ref:e.innerRef}),null===D||void 0===D?void 0:D.map(((e,t)=>v.createElement(et,{dataHolders:H,onUnlink:I,onLink:w,chunk:e,chunkIndex:t,onDataSourceDelete:s,key:`${t}-linking-container-${null===C||void 0===C?void 0:C.id}`}))),e.placeholder)))),v.createElement("div",null,v.createElement(i.z,{className:"scorecard-indicator-add",dataTest:"scorecard-indicator-add",onClick:()=>P(!0),icon:v.createElement(z.Z,null)},n.Z.t("Add Item")))),A&&v.createElement(Ve,{disabled:x,onSelect:m,onClose:()=>P(!1),open:A})))))}var nt=(0,v.forwardRef)(at);function lt(){return lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},lt.apply(this,arguments)}function it(){var e;const{setValue:t,watch:a}=(0,p.Gc)(),l=a("dataSelection"),i=(0,E.useRecoilValue)(ot),o=(0,v.useCallback)((e=>{t("dataSelection",e)}),[t]),r=(0,E.useResetRecoilState)(u.ScorecardConfigEditState),{dataGroups:c}=l||new u.DataSelection,[d,s]=(0,v.useState)(null===(e=(0,S.last)(c))||void 0===e?void 0:e.id),m=e=>(t,a)=>{s(!!a&&e)},g=e=>{const t=[...c];(0,S.remove)(t,["id",e]),o(u.DataSelection.set(l,"dataGroups",t)),r()},h=(e,t)=>{const a=[...c];(0,S.set)(a,[e],t),o(u.DataSelection.set(l,"dataGroups",a))},f=(0,v.useMemo)((()=>(0,S.isEmpty)(i)?c:(0,S.filter)(c,(e=>{let{id:t}=e;return i.includes(t)}))),[i,c]);return(0,v.useEffect)((()=>{var e;s(null===(e=(0,S.last)(f))||void 0===e?void 0:e.id)}),[f,f.length]),v.createElement(Re.bK,{droppableId:"group-area"},(e=>v.createElement("div",lt({},e.droppableProps,{ref:e.innerRef}),v.createElement("div",null,null===f||void 0===f?void 0:f.map((e=>{const t=(0,S.findIndex)(c,["id",e.id]);return v.createElement(p.Qr,{key:e.id,id:e.id,rules:{validate:{isNotEmpty:e=>!(0,S.isEmpty)(null===e||void 0===e?void 0:e.dataHolders)||n.Z.t("Please select at least one data source for this group")}},name:`dataSelection.dataGroups.${t}`,render:a=>{let{field:n,fieldState:l}=a;return v.createElement(nt,lt({},n,{error:l.error,onGroupUpdate:h,onDelete:g,index:t,group:e,expanded:d,handleAccordionChange:m}))}})})),e.placeholder))))}const ot=(0,E.atom)({key:"dataSelectionFilterAtom",default:[]});function rt(e){let{onGroupAdd:t}=e;const{setValue:a,watch:l}=(0,p.Gc)(),o=l("dataSelection"),[r,c]=(0,v.useState)(""),d=(0,E.useSetRecoilState)(ot),s=(0,v.useRef)((0,S.debounce)((e=>{d((()=>{var t;return e?null===o||void 0===o||null===(t=o.dataGroups.filter((t=>(0,S.find)(null===t||void 0===t?void 0:t.dataHolders,(t=>(0,S.find)(null===t||void 0===t?void 0:t.dataSources,(t=>`${t.name} ${t.label}`.toLowerCase().match(new RegExp(e.toLowerCase())))))))))||void 0===t?void 0:t.map((e=>{let{id:t}=e;return t})):[]}))}),500)),m=(0,E.useRecoilCallback)((e=>{let{set:t}=e;return e=>{const{destination:n,source:l}=null!==e&&void 0!==e?e:{};a("dataSelection",u.DataSelection.set(o,"dataGroups",[...(0,u.updateListFromDragAndDrop)(null===o||void 0===o?void 0:o.dataGroups,null===l||void 0===l?void 0:l.index,null===n||void 0===n?void 0:n.index)])),t(u.ScorecardConfigEditState,(e=>e.selectedGroupIndex===(null===l||void 0===l?void 0:l.index)?{...e,selectedGroupIndex:null===n||void 0===n?void 0:n.index}:e))}}),[o,a]);return v.createElement("div",{className:"column h-100"},v.createElement("div",{className:"p-16"},v.createElement(Le.I,{value:r,name:"",onChange:e=>{let{value:t}=e;c(t),""!==t&&void 0!==t?s.current(t):d([])},placeholder:n.Z.t("Search for Indicator")})),v.createElement("h4",{className:"pl-16"},n.Z.t("Groups")),v.createElement("div",{style:{maxHeight:"60vh",overflowY:"auto",flex:1}},v.createElement(Re.Z5,{onDragEnd:m},v.createElement(it,null))),v.createElement("div",{className:"p-8 column",style:{alignItems:"start"}},v.createElement(i.z,{onClick:t,icon:v.createElement(z.Z,null),dataTest:"scocecard-add-group-button",className:"scorecard-add-group-button"},n.Z.t("Add Group"))))}function ct(e){return new u.ScorecardIndicatorGroup({title:`Group ${(null===e||void 0===e?void 0:e.length)+1||1}`})}var dt={step:"ScorecardManagement_step__A9+fv","edit-container":"ScorecardManagement_edit-container__sZk39"};function st(){const{watch:e,setValue:t}=(0,p.Gc)(),a=e("dataSelection.dataGroups"),n=a.length>0;return{onResetLegends:(0,v.useCallback)((e=>{const n=function(e,t){const a=(0,S.cloneDeep)(e);return a&&(null===a||void 0===a||a.forEach((e=>{var a;null===e||void 0===e||null===(a=e.dataHolders)||void 0===a||a.forEach((e=>{var a;null===e||void 0===e||null===(a=e.dataSources)||void 0===a||a.forEach((e=>{(0,S.set)(e,"legends",(0,u.generateLegendDefaults)(te(t))),(0,S.isEmpty)(e.specificTargets)||e.specificTargets.forEach((e=>{(0,S.set)(e,"legends",(0,u.generateLegendDefaults)(te(t)))}))}))}))}))),a}(a,e);t("dataSelection.dataGroups",n)}),[a,t]),shouldVerify:n}}function ut(){const{shouldVerify:e,onResetLegends:t}=st();return v.createElement(N.hK,{label:n.Z.t("Legend Definitions"),onResetLegends:t,shouldVerify:e,valueType:"LEGEND_DEFINITIONS",name:"legendDefinitions",mandatory:!0})}var mt=a(12307);function vt(){const{getValues:e}=(0,p.Gc)(),t=(0,v.useMemo)((()=>{const t=(0,S.head)(e("periodSelection.periods"));return t?mt._M.getPeriodById(null===t||void 0===t?void 0:t.id).start.year:(new Date).getFullYear()}),[e]),[a,l]=(0,v.useState)(null!==t&&void 0!==t?t:(new Date).getFullYear()),i=(0,p.qo)({name:"periodType"}),o=(0,v.useMemo)((()=>{var e;if(!i)return[];const t=mt._M.fromObject({year:a,category:mt.Me.FIXED}).getPeriodType(i.toUpperCase());return null===t||void 0===t||null===(e=t.periods)||void 0===e?void 0:e.map((e=>{let{id:t,name:a}=e;return{name:a,code:t}}))}),[i,a]),r=(0,v.useMemo)((()=>new Array(10).fill("").map(((e,t)=>({code:((new Date).getFullYear()-t).toString(),name:(new Date).getFullYear()-t}))).reverse()),[]);return v.createElement(p.Qr,{render:e=>{var t,i;let{field:c}=e;const d=null===(t=(0,S.head)(null===c||void 0===c||null===(i=c.value)||void 0===i?void 0:i.periods))||void 0===t?void 0:t.id,s=(0,S.find)(o,["code",d])?d:void 0;return v.createElement("div",{style:{display:"flex",gap:16,width:"100%"}},v.createElement(N.fw,{fullWidth:!0,label:n.Z.t("Year"),value:a.toString(),optionSet:{options:r},name:"year",onChange:l}),v.createElement(N.fw,{fullWidth:!0,label:n.Z.t("Period"),value:s,optionSet:{options:o},name:"periodSelection",onChange:e=>{const t=mt._M.getPeriodById(e);c.onChange({periods:[{name:t.name,id:null===t||void 0===t?void 0:t.id}]})}}))},name:"periodSelection"})}var pt={"select-header":"PeriodTypeSelector_select-header__c8O-e"};function gt(){return gt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},gt.apply(this,arguments)}function Et(e){let{label:t,name:a}=e;const l=(0,v.useMemo)((()=>(new mt._M).setCategory(mt.Me.FIXED).periodTypes),[]),i=(0,v.useMemo)((()=>(new mt._M).setCategory(mt.Me.RELATIVE).periodTypes),[]);return v.createElement(p.Qr,{name:a,rules:{required:n.Z.t("Period type is required")},render:e=>{var a;let{field:o,fieldState:r}=e;return v.createElement(M.n,gt({},o,{label:t,required:!0,filterable:!0,selected:o.value,onChange:e=>{let{selected:t}=e;return o.onChange(t)},validationText:null===(a=r.error)||void 0===a?void 0:a.message,error:!!r.error}),v.createElement(F.a,{value:"disabled",disabled:!0,className:pt["select-header"],label:n.Z.t("Fixed Periods")}),null===l||void 0===l?void 0:l.map((e=>v.createElement(F.a,{key:e.id,value:e.id,label:e.config.name}))),v.createElement(F.a,{value:"disabled",disabled:!0,className:pt["select-header"],label:n.Z.t("Relative Periods")}),null===i||void 0===i?void 0:i.map((e=>v.createElement(F.a,{key:e.id,value:e.id,label:e.config.name}))))}})}function ht(){const{id:e}=(0,g.UO)(),t=(0,h.bQ)();return v.createElement("div",{style:{gap:16,display:"flex",flexDirection:"column"},className:"col-12"},v.createElement("div",{style:{display:"flex",flexDirection:"column",gap:16},className:"col-12 general-settings"},v.createElement(N.hK,{valueType:u.DHIS2ValueTypes.TEXT.name,name:"title",label:n.Z.t("Title"),required:!0,validations:{required:n.Z.t("Title is required"),validate:async a=>await async function(e,t,a){const{summary:n}=await(0,u.getScorecardSummary)(e);if((0,S.isEmpty)(n))return!0;const l=(0,S.find)(n,{title:a});return l?l.id===t:!l}(t,e,a)||n.Z.t("A scorecard with the title '{{value}}' already exists. Please select another title",{value:a})}}),v.createElement(N.hK,{valueType:u.DHIS2ValueTypes.TEXT.name,name:"subtitle",label:n.Z.t("Subtitle"),max:"120"})),v.createElement("div",{className:"description-settings"},v.createElement(N.hK,{name:"description",valueType:u.DHIS2ValueTypes.LONG_TEXT.name,label:n.Z.t("Description")})),v.createElement("div",{className:"row align-items-center",style:{gap:24}},v.createElement("div",{className:"col-md-4 period-type-settings"},v.createElement(Et,{label:n.Z.t("Period Type"),name:"periodType"})),v.createElement("div",{className:"flex-1 period-settings w-100"},v.createElement(vt,null))),v.createElement("div",{className:"custom-header-settings"},v.createElement(N.hK,{name:"customHeader",label:n.Z.t("Custom Header"),valueType:u.DHIS2ValueTypes.RICH_TEXT.name})),v.createElement("div",{className:"col-sm-6 col-xl-4 legend-definitions-settings gap-8"},v.createElement(ut,null)),v.createElement("div",{className:"col-sm-6 col-xl-4 additional-labels-settings"},v.createElement(N.hK,{addable:!0,deletable:!0,name:"additionalLabels",valueType:u.DHIS2ValueTypes.MULTIPLE_FIELDS.name,label:n.Z.t("Additional Labels (Tags)"),multipleField:{name:"label",valueType:u.DHIS2ValueTypes.TEXT.name}})))}function ft(){var e;const{selectedHighlightedIndicatorIndex:t}=null!==(e=(0,E.useRecoilValue)(u.ScorecardConfigEditState))&&void 0!==e?e:{},a=`highlightedIndicators.${t}`;return isNaN(t)?null:v.createElement("div",{className:"container-bordered"},v.createElement(u.Help,{helpSteps:u.INDICATOR_CONFIGURATION_STEPS}),v.createElement(Ie,{path:a}))}var St=a(77986),yt=a(81843);const bt=[{label:"Name",path:"displayName"},{label:"Label",path:"label"}];function Nt(){const{watch:e,setValue:t,trigger:a}=(0,p.Gc)(),l=e("highlightedIndicators"),o=(0,v.useCallback)((e=>{t("highlightedIndicators",e)}),[t]),[r,c]=(0,E.useRecoilState)(u.ScorecardConfigEditState),d=(0,v.useCallback)((e=>{(0,S.findIndex)(l,["id",e])===r.selectedHighlightedIndicatorIndex&&c((e=>({...e,selectedHighlightedIndicatorIndex:void 0})));const t=(0,S.cloneDeep)(l);(0,S.remove)(t,["id",e]),o(t)}),[l,r.selectedHighlightedIndicatorIndex,o,c]);return(0,S.isEmpty)(l)?null:v.createElement(v.Fragment,null,v.createElement(u.Help,{helpSteps:u.HIGHLIGHTED_TABLE_HELP_STEPS}),v.createElement(xe.w,{fixed:!0,scrollHeight:"75vh"},v.createElement(Ze.s,null,v.createElement(Ge.U,null,null===bt||void 0===bt?void 0:bt.map((e=>{let{label:t,path:a}=e;return v.createElement(St.p,{fixed:!0,top:"0",key:`${a}-column`},t)})),v.createElement(St.p,{fixed:!0,top:"0"}))),v.createElement(yt.R,null,null===l||void 0===l?void 0:l.map(((e,t)=>v.createElement(Ge.U,{selected:(null===r||void 0===r?void 0:r.selectedHighlightedIndicatorIndex)===t,key:`${null===e||void 0===e?void 0:e.id}`},null===bt||void 0===bt?void 0:bt.map((n=>{let{path:l}=n;return v.createElement(He.W,{onClick:()=>(async e=>{await a()&&c((t=>({...t,selectedHighlightedIndicatorIndex:e})))})(t),key:`${null===e||void 0===e?void 0:e.id}-${l}`},(0,S.get)(e,l))})),v.createElement(He.W,{align:"center"},v.createElement(i.z,{onClick:(t,a)=>{a.stopPropagation(),d(null===e||void 0===e?void 0:e.id)},icon:v.createElement(D.Z,null)},n.Z.t("Delete")))))))))}const Ct=[{label:n.Z.t("General"),component:function(){return v.createElement("div",{className:"container"},v.createElement(u.Help,{helpSteps:u.GENERAL_HELP_STEPS}),v.createElement("div",{className:"column space-between"},v.createElement(ht,null)))},helpSteps:u.GENERAL_HELP_STEPS,tooltip:u.scorecardManagementTooltips[0].content,id:"general"},{label:n.Z.t("Data Configuration"),component:function(){const{setValue:e,watch:t,register:a}=(0,p.Gc)();a("dataSelection");const n=t("dataSelection"),l=(0,v.useCallback)((t=>{e("dataSelection",t)}),[e]),{dataGroups:i}=null!==n&&void 0!==n?n:new u.DataSelection,o=function(e){const[t,a]=(0,v.useState)(u.INTRODUCTION_HELP_STEPS),{selectedDataHolderIndex:n}=(0,E.useRecoilValue)(u.ScorecardConfigEditState);return(0,v.useEffect)((()=>{a((t=>{let a=[...t];return(0,S.isEmpty)(e)||(a=[...u.INTRODUCTION_HELP_STEPS,...u.GROUPS_CONFIG_HELP_STEPS,...u.PREVIEW_TABLE_HELP_STEPS]),(0,S.isEmpty)(e)&&(a=[...u.INTRODUCTION_HELP_STEPS,...u.NO_GROUPS_HELP_STEPS]),!(0,S.isEmpty)(e)&&(0,S.isEmpty)((0,u.getHoldersFromGroups)(e))&&(a=[...a,...u.NO_INDICATORS_HELP_STEPS]),(0,S.isEmpty)((0,u.getHoldersFromGroups)(e))||(a=[...a,...u.INDICATOR_SETUP_HELP_STEPS]),isNaN(n)||(a=[...a,...u.INDICATOR_CONFIGURATION_STEPS]),(0,S.uniqBy)(a,"element")}))}),[e,n]),t}(i),r=(0,v.useCallback)((()=>{var e;l(u.DataSelection.set(n,"dataGroups",[...null!==(e=null===n||void 0===n?void 0:n.dataGroups)&&void 0!==e?e:[],ct(i)]))}),[n,i,l]);return v.createElement("div",{className:"row",style:{height:"100%"}},v.createElement(u.Help,{helpSteps:o}),v.createElement("div",{className:"col-md-4 col-sm-6 p-16 groups-configuration-area"},v.createElement("div",{className:" container-bordered column",style:{minHeight:"100%",height:"100%"}},v.createElement(v.Suspense,{fallback:v.createElement(u.ContainerLoader,null)},(0,S.isEmpty)(i)?v.createElement(De,{onGroupAdd:r}):v.createElement(rt,{onGroupAdd:r})))),v.createElement("div",{className:"col-md-8 p-16 h-100"},!(0,S.isEmpty)(i)&&v.createElement("div",{className:"row pb-16"},v.createElement("div",{className:"column preview-table-area"},v.createElement(Ue,null))),v.createElement("div",{className:"column h-100"},(0,S.isEmpty)(i)?v.createElement("div",{style:{margin:"auto"}},v.createElement(X,null)):v.createElement(Te,null))))},helpSteps:u.DATA_CONFIGURATION_HELP_STEPS,tooltip:u.scorecardManagementTooltips[1].content,id:"dataConfiguration"},{label:n.Z.t("Highlighted Indicators"),component:function(){const{watch:e,setValue:t,register:a}=(0,p.Gc)();a("highlightedIndicators");const l=e("highlightedIndicators"),o=(0,v.useCallback)((e=>{t("highlightedIndicators",e)}),[t]),r=te(e("legendDefinitions")),c=(0,E.useSetRecoilState)(u.ScorecardConfigEditState),[d,s]=(0,v.useState)(!1),m=()=>{s(!0)},g=(0,v.useCallback)((e=>{const t=(0,u.generateLegendDefaults)(r,100,!0),a=null===e||void 0===e?void 0:e.map((e=>new u.ScorecardIndicator({...e,label:null===e||void 0===e?void 0:e.displayName,legends:t})));o([...null!==l&&void 0!==l?l:[],...null!==a&&void 0!==a?a:[]]),(0,S.isEmpty)(e)||c((e=>({...e,selectedHighlightedIndicatorIndex:0})))}),[l,r,o,c]);return v.createElement("div",{className:"column",style:{height:"100%"}},v.createElement(u.Help,{helpSteps:u.HIGHLIGHTED_INDICATOR_HELP_STEPS}),v.createElement("h3",null,n.Z.t("Highlighted Indicators")),(0,S.isEmpty)(l)?v.createElement("div",{className:"row align-items-center center flex-1"},v.createElement(i.z,{className:"add-highlighted-indicator-button",onClick:m,icon:v.createElement(z.Z,null)},n.Z.t("Add Highlighted Indicator"))):v.createElement(v.Fragment,null,v.createElement("div",{className:"rowlabel "},v.createElement(i.z,{className:"add-highlighted-indicator-button",onClick:m,icon:v.createElement(z.Z,null)},n.Z.t("Add"))),v.createElement("div",{className:"row"},v.createElement("div",{className:"col-md-8 pt-32 "},v.createElement(Nt,null)),v.createElement("div",{className:"col-md-4"},v.createElement("div",{className:"pl-16 pt-32"},v.createElement(ft,null))))),d&&v.createElement(Ve,{open:d,onSelect:g,disabled:null===l||void 0===l?void 0:l.map((e=>{let{id:t}=e;return t})),onClose:()=>s(!1)}))},helpSteps:[],tooltip:u.scorecardManagementTooltips[2].content,id:"highlightedIndicators"},{label:n.Z.t("Access"),component:function(){return v.createElement("div",{style:{minHeight:"70vh",height:"100%"},className:"container p-16"},v.createElement(u.Help,{helpSteps:u.ACCESS_HELP_STEPS}),v.createElement("div",{className:"row"},v.createElement("div",{className:"column"},v.createElement(C,null)),v.createElement("div",{className:"column"},v.createElement(q,null))))},helpSteps:[],tooltip:u.scorecardManagementTooltips[3].content,id:"access"},{label:n.Z.t("Options"),component:function(){const{scorecardOptions:e,onChange:t,onAverageChange:a}=function(){const{watch:e,setValue:t}=(0,p.Gc)(),a=e("options"),n=(0,v.useCallback)((e=>{t("options",e)}),[t]);return{onAverageChange:e=>{n(u.ScorecardOptions.set(a,"averageDisplayType",e))},onChange:e=>t=>{var l;n(u.ScorecardOptions.set(a,e,null!==(l=null===t||void 0===t?void 0:t.checked)&&void 0!==l?l:t))},scorecardOptions:a}}();return v.createElement("div",{style:{height:"100%"}},v.createElement(u.ScorecardOptionsForm,{options:e,onChange:t,onAverageChange:a}))},helpSteps:[],tooltip:u.scorecardManagementTooltips[4].content,id:"options"}],wt=(0,E.atom)({key:"activeStepState",default:Ct[0]}),It=(0,E.selector)({key:"activeStepIndexState",get:e=>{let{get:t}=e;const a=t(wt);return(0,S.findIndex)(Ct,(e=>e.id===a.id))}});function kt(){const e=(0,g.k6)(),{id:t}=(0,g.UO)(),a=(0,E.useSetRecoilState)(u.IsNewScorecardState),l=(0,E.useRecoilValue)(It),i=(0,E.useRecoilValue)(u.UserState),[o,r]=(0,E.useRecoilState)(u.RouterState),{update:c}=(0,u.useUpdateScorecard)(t),d=(0,E.useRecoilValue)((0,u.ScorecardConfState)(t)),[s,m]=(0,v.useState)(!1),[y,b]=(0,v.useState)(!1),N=(0,S.cloneDeep)(d),C=(0,p.cI)({shouldFocusError:!0,defaultValues:{...N},reValidateMode:"onChange"}),w=(0,E.useSetRecoilState)(wt),{add:I}=(0,u.useAddScorecard)(),{show:k}=(0,h.VY)((e=>{let{message:t}=e;return t}),(e=>{let{type:t}=e;return{...t,duration:3e3}})),T=(0,E.useRecoilCallback)((e=>{let{reset:t}=e;return()=>{t(u.ScorecardConfigEditState),t(u.ScorecardConfigErrorState),t(u.ShouldValidate),t(u.IsNewScorecardState),t(wt)}})),D=(0,E.useRecoilCallback)((e=>{let{reset:a}=e;return()=>{a((0,u.ScorecardConfState)(t)),a(u.ScorecardIdState)}}));(0,v.useEffect)((()=>()=>{T(),D()}),[]);const x=()=>{r((e=>({...e,previous:`/edit/${t}`}))),e.replace(null===o||void 0===o?void 0:o.previous)},Z=async e=>{await u.Scorecard.save(e,I,i)},G=async e=>{await u.Scorecard.update(e,c)},H=(0,E.useRecoilCallback)((()=>async e=>{m(!0);try{if(t)await G(e),k({message:n.Z.t("Scorecard updated successfully"),type:{success:!0}});else{const t=(0,u.uid)(),a=(0,f.ZP)((0,S.cloneDeep)(e),(e=>{(0,S.set)(e,"id",t)}));await Z((0,S.cloneDeep)(a)),k({message:n.Z.t("Scorecard added successfully"),type:{success:!0}})}x()}catch(a){console.error(a),k({message:n.Z.t("Scorecard could not be saved: "+(null===a||void 0===a?void 0:a.message)),type:{info:!0}})}m(!1)})),A=(0,E.useRecoilCallback)((()=>async i=>{b(!0);try{if(t)await G(i),w((e=>{const t=(0,S.findIndex)(Ct,{id:e.id});if(t!==Ct.length-1)return Ct[t+1]}));else{const t=(0,u.uid)(),n=(0,f.ZP)(i,(e=>{(0,S.set)(e,"id",t)}));await Z(n),a({nextStepIndex:l+1}),e.replace(`edit/${t}?new=true`)}}catch(o){console.error(o),k({message:n.Z.t("Scorecard could not be saved: "+(null===o||void 0===o?void 0:o.message)),type:{info:!0}})}b(!1)}));return{form:C,resetEditStates:T,resetScorecardStates:D,saving:s,onSave:H,onNavigate:x,onSaveAndContinue:A,savingAndContinue:y}}function Tt(e){let{form:t,onSave:a,onNavigate:l}=e;const[i,o]=(0,E.useRecoilState)(u.HelpIndex),[r,c]=(0,E.useRecoilState)(wt),{search:d}=(0,g.TH)(),s=(0,E.useResetRecoilState)(u.IsNewScorecardState),m=r.component,{show:p}=(0,h.VY)((e=>{let{message:t}=e;return t}),(e=>{let{type:t}=e;return{...t,duration:3e3}}));(0,v.useEffect)((()=>{new URLSearchParams(d).get("new")&&c((e=>0===(0,S.findIndex)(Ct,["id",e.id])?Ct[1]:e))}),[s,d,c]);const f=(0,v.useMemo)((()=>(0,S.findIndex)(Ct,["id",r.id])!==Ct.length-1),[r]),y=(0,v.useMemo)((()=>(0,S.findIndex)(Ct,["id",r.id])>0),[r]),b=(0,v.useMemo)((()=>(0,S.findIndex)(Ct,["id",r.id])),[r]),N=(0,v.useCallback)((async e=>{await t.trigger((0,u.getValidationPageFields)(t,r))&&c(e)}),[r,t]);return{Component:m,activeStep:r,onNextStep:async()=>{if(!f)return void await t.handleSubmit(a)();if(!await t.trigger())return void p({message:n.Z.t("Please fill in all required fields"),type:{info:!0}});const e=(0,S.findIndex)(Ct,["id",r.id]);e!==Ct.length-1&&(c(Ct[e+1]),o(0))},onPreviousStep:()=>{const e=(0,S.findIndex)(Ct,["id",r.id]);0!==e&&(c(Ct[e-1]),o(0))},onCancel:()=>{l()},helpStepIndex:i,setHelpStepIndex:o,hasNextStep:f,hasPreviousStep:y,currentIndex:b,steps:Ct,onStepChange:N}}function Dt(){var e,t,a;const[h,f]=(0,E.useRecoilState)(u.HelpState),S=(0,E.useRecoilValue)(u.HelpSteps),{id:y}=(0,g.UO)(),{write:b}=(0,E.useRecoilValue)((0,u.UserAuthorityOnScorecard)(y)),{height:N}=(0,u.useMediaQuery)(),{form:C,onSave:w,saving:I,onNavigate:k,onSaveAndContinue:T,savingAndContinue:D}=kt(),{Component:x,activeStep:Z,helpStepIndex:G,onCancel:H,onNextStep:A,onPreviousStep:P,setHelpStepIndex:O,steps:U,currentIndex:L,hasPreviousStep:R,hasNextStep:_,onStepChange:V}=Tt({form:C,onSave:w,onNavigate:k});return!b&&y?v.createElement(u.AccessDeniedPage,{accessType:"edit"}):v.createElement(p.RV,C,v.createElement(v.Suspense,{fallback:v.createElement(u.FullPageLoader,null)},v.createElement("div",{className:dt["edit-container"]},v.createElement(m.Rg,{enabled:h,options:u.STEP_OPTIONS,steps:S,initialStep:G,onBeforeChange:e=>{O(e)},onExit:()=>{f(!1)}}),v.createElement("div",{className:"column"},v.createElement("div",null,v.createElement(r.Z,null,null===U||void 0===U?void 0:U.map((e=>v.createElement(c.Z,{style:e===Z?{background:"#00695c"}:void 0,active:e===Z,onClick:()=>V(e),key:`${e.id}-step`},v.createElement(d.Z,null,v.createElement(l.u,{content:e.tooltip,key:`${e.id}-step`},e.label))))))),v.createElement("div",{className:"row"},v.createElement("div",{className:"column center",style:{flex:1}},v.createElement("div",{className:"container container-bordered background-white center",style:{width:"100%",height:"100%",minHeight:.8*N}},v.createElement("div",{className:"row",style:{height:"100%"}},v.createElement("div",{className:"column p-16",style:{height:"100%",justifyContent:"space-between"}},v.createElement("div",{className:"row end align-items-center"},v.createElement(i.z,{icon:v.createElement(s.Z,null),onClick:()=>{O(0),f(!0)}},n.Z.t("Help"))),v.createElement("div",{style:{height:"100%",padding:16}},v.createElement(v.Suspense,{fallback:v.createElement(u.FullPageLoader,{small:!0})},v.createElement(x,{onNextStep:A,onPreviousStep:P}))),v.createElement(o.J,{start:!0},v.createElement(i.z,{disabled:!R,onClick:P},n.Z.t(`Previous: ${null!==(e=null===(t=U[L-1])||void 0===t?void 0:t.label)&&void 0!==e?e:""}`)),v.createElement(i.z,{loading:I,primary:!0,disabled:I,onClick:A,className:"settings-next-button",dataTest:"scorecard-admin-next-button"},_?n.Z.t(`Next: ${null===(a=U[L+1])||void 0===a?void 0:a.label}`):I?`${n.Z.t("Saving")}...`:n.Z.t("Save")))))))),v.createElement("div",{className:"row center p-16"},v.createElement(o.J,{center:!0},v.createElement(i.z,{loading:I,dataTest:"scorecard-save-button",disabled:I,onClick:C.handleSubmit(w)},I?`${n.Z.t("Saving")}...`:n.Z.t("Save and exit")),_&&v.createElement(i.z,{loading:D,dataTest:"scorecard-save-and-continue-button",disabled:D,onClick:C.handleSubmit(T)},D?`${n.Z.t("Saving")}...`:n.Z.t("Save and continue")),v.createElement(i.z,{onClick:H},n.Z.t("Exit without saving"))))))))}}}]);
//# sourceMappingURL=7935.24cd8138.chunk.js.map