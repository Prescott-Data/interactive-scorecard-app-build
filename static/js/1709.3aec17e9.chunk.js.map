{"version":3,"file":"static/js/1709.3aec17e9.chunk.js","mappings":"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","sources":["../../../../../node_modules/@dhis2-ui/loader/build/es/linear-loader/linear-loader.js","D2App/modules/Main/Components/ScorecardMigration/services/migrate.js","D2App/modules/Main/Components/ScorecardMigration/hooks/useMigrateScorecard.js","D2App/modules/Main/Components/ScorecardMigration/hooks/useQueue.js","D2App/modules/Main/Components/ScorecardMigration/index.js"],"sourcesContent":["import _JSXStyle from \"styled-jsx/style\";\nimport { colors, theme, spacers } from '@dhis2/ui-constants';\nimport cx from 'classnames';\nimport PropTypes from 'prop-types';\nimport React from 'react';\n\nconst Progress = _ref => {\n  let {\n    amount,\n    invert,\n    className\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: _JSXStyle.dynamic([[\"686723300\", [amount]], [\"3392977398\", [theme.primary600, colors.white]]]) + \" \" + (cx(className, {\n      invert\n    }) || \"\")\n  }, /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"686723300\",\n    dynamic: [amount]\n  }, [\"div.__jsx-style-dynamic-selector{width:\".concat(amount, \"%;}\")]), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"3392977398\",\n    dynamic: [theme.primary600, colors.white]\n  }, [\"div.__jsx-style-dynamic-selector{background-color:\".concat(theme.primary600, \";-webkit-transition:width 0.3s linear;transition:width 0.3s linear;height:4px;}\"), \".invert.__jsx-style-dynamic-selector{background-color:\".concat(colors.white, \";}\")]));\n};\n\nProgress.propTypes = {\n  amount: PropTypes.number.isRequired,\n  className: PropTypes.string,\n  invert: PropTypes.bool\n};\n\nconst LinearLoader = _ref2 => {\n  let {\n    amount,\n    width,\n    margin,\n    invert,\n    className,\n    dataTest\n  } = _ref2;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    role: \"progressbar\",\n    \"data-test\": dataTest,\n    className: \"jsx-3127531794 \" + _JSXStyle.dynamic([[\"3224415970\", [width, margin]]]) + \" \" + (cx(className, {\n      invert\n    }) || \"\")\n  }, /*#__PURE__*/React.createElement(Progress, {\n    amount: amount,\n    invert: invert\n  }), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"3127531794\"\n  }, [\"div.jsx-3127531794{display:block;overflow:hidden;overflow-x:hidden;overflow-y:hidden;background-color:rgba(110,122,138,0.15);}\", \".invert.jsx-3127531794{background-color:rgba(33,41,52,0.5);}\"]), /*#__PURE__*/React.createElement(_JSXStyle, {\n    id: \"3224415970\",\n    dynamic: [width, margin]\n  }, [\"div.__jsx-style-dynamic-selector{width:\".concat(width, \";margin:\").concat(margin, \";}\")]));\n};\n\nLinearLoader.defaultProps = {\n  margin: spacers.dp12,\n  width: '300px',\n  dataTest: 'dhis2-uicore-linearloader'\n};\nLinearLoader.propTypes = {\n  /** The progression in percent without the '%' sign */\n  amount: PropTypes.number.isRequired,\n  className: PropTypes.string,\n  dataTest: PropTypes.string,\n\n  /** Use inverted color scheme */\n  invert: PropTypes.bool,\n\n  /** The margin around the loader, can be a full shorthand */\n  margin: PropTypes.string,\n\n  /** The width of the entire indicator */\n  width: PropTypes.string\n};\nexport { LinearLoader };","import { DATASTORE_ENDPOINT, DATASTORE_OLD_SCORECARD_ENDPOINT, DATASTORE_SCORECARD_SUMMARY_KEY } from \"@scorecard/shared\";\nimport { generateCreateMutation } from \"@scorecard/shared\";\nimport { filter, forIn, fromPairs, isEmpty } from \"lodash\";\nconst generateOldScorecardQueries = (ids = []) => {\n  return fromPairs(ids === null || ids === void 0 ? void 0 : ids.map(id => [id, {\n    resource: DATASTORE_OLD_SCORECARD_ENDPOINT,\n    id\n  }]));\n};\nexport async function getOldScorecards(engine, keys) {\n  if (isEmpty(keys)) {\n    return [];\n  }\n  const oldScorecardsObject = await engine.query(generateOldScorecardQueries(keys));\n  const oldScorecardsList = [];\n  forIn(oldScorecardsObject, (value, key) => {\n    oldScorecardsList.push({\n      ...value,\n      id: key\n    });\n  });\n  return oldScorecardsList;\n}\nexport const uploadNewScorecard = async ({\n  newScorecard,\n  engine\n}) => {\n  if (newScorecard) {\n    return await engine.mutate(generateCreateMutation(newScorecard === null || newScorecard === void 0 ? void 0 : newScorecard.id), {\n      variables: {\n        data: newScorecard\n      }\n    });\n  }\n};\nexport async function getOldScorecardKeys(engine) {\n  try {\n    var _await$engine$query;\n    const {\n      keys\n    } = (_await$engine$query = await engine.query({\n      keys: {\n        resource: DATASTORE_OLD_SCORECARD_ENDPOINT\n      }\n    })) !== null && _await$engine$query !== void 0 ? _await$engine$query : {};\n    return keys;\n  } catch (e) {\n    return [];\n  }\n}\nexport async function getScorecardKeys(engine) {\n  try {\n    var _await$engine$query2;\n    const {\n      keys\n    } = (_await$engine$query2 = await engine.query({\n      keys: {\n        resource: DATASTORE_ENDPOINT\n      }\n    })) !== null && _await$engine$query2 !== void 0 ? _await$engine$query2 : {};\n    return filter(keys, key => !(key.includes(DATASTORE_SCORECARD_SUMMARY_KEY) || key.includes(\"settings\") || key.includes(\"savedObjects\")));\n  } catch (e) {\n    return [];\n  }\n}\nconst summaryMutation = {\n  type: \"update\",\n  resource: DATASTORE_ENDPOINT,\n  id: DATASTORE_SCORECARD_SUMMARY_KEY,\n  data: ({\n    data\n  }) => data\n};\nexport const uploadSummary = async (engine, summary) => {\n  return await engine.mutate(summaryMutation, {\n    variables: {\n      data: summary\n    }\n  });\n};","import { useDataEngine } from \"@dhis2/app-runtime\";\nimport { useSetting } from \"@dhis2/app-service-datastore\";\nimport { DATA_MIGRATION_CHECK } from \"@scorecard/shared\";\nimport { AllScorecardsSummaryState } from \"@scorecard/shared\";\nimport { generateScorecardSummary, migrateScorecard } from \"@scorecard/shared\";\nimport { map as mapAsync } from \"async\";\nimport { compact, filter, isEmpty, map, uniqBy } from \"lodash\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { useRecoilRefresher_UNSTABLE, useRecoilValue } from \"recoil\";\nimport { getOldScorecardKeys, getOldScorecards, getScorecardKeys, uploadNewScorecard, uploadSummary } from \"../services/migrate\";\nimport useQueue from \"./useQueue\";\nexport default function useMigrateScorecard(onComplete) {\n  const [error, setError] = useState();\n  const allSummary = useRecoilValue(AllScorecardsSummaryState);\n  const resetSummary = useRecoilRefresher_UNSTABLE(AllScorecardsSummaryState);\n  const [summaries, setSummaries] = useState();\n  const engine = useDataEngine();\n  const [, {\n    set: setSkipMigration\n  }] = useSetting(DATA_MIGRATION_CHECK, {\n    global: true\n  });\n  const migrate = useCallback(async scorecard => {\n    await uploadNewScorecard({\n      newScorecard: scorecard,\n      engine\n    });\n  }, [engine]);\n  const onMigrationComplete = useCallback(async () => {\n    await uploadSummary(engine, uniqBy([...allSummary, ...summaries], 'id'));\n    resetSummary();\n    setSkipMigration(true);\n    onComplete();\n  }, [allSummary, engine, onComplete, resetSummary, setSkipMigration, summaries]);\n  const {\n    add,\n    progress,\n    length,\n    started\n  } = useQueue({\n    drain: onMigrationComplete,\n    task: migrate\n  });\n  const onMigrationInitiated = useCallback(async () => {\n    try {\n      const scorecardKeys = await getScorecardKeys(engine);\n      const oldScorecardKeys = await getOldScorecardKeys(engine);\n      const filteredKeys = filter(oldScorecardKeys, key => {\n        return !scorecardKeys.includes(key);\n      });\n      if (filteredKeys && !isEmpty(filteredKeys)) {\n        const oldScorecards = compact(await getOldScorecards(engine, filteredKeys));\n        const newScorecards = compact(await mapAsync(oldScorecards, async oldScorecard => await migrateScorecard(oldScorecard, engine)));\n        const newScorecardsSummaries = compact(map(newScorecards, generateScorecardSummary));\n        setSummaries(newScorecardsSummaries);\n        for (const scorecard of newScorecards) {\n          add(scorecard);\n        }\n      } else {\n        onComplete();\n        setSkipMigration(true);\n      }\n    } catch (e) {\n      setError(e);\n      setSkipMigration(true);\n      onComplete();\n    }\n  }, [add, engine, onComplete, setSkipMigration]);\n  useEffect(() => {\n    onMigrationInitiated();\n  }, []);\n  return {\n    progress,\n    count: progress + length,\n    error,\n    migrationStarted: started\n  };\n}","import async from \"async\";\nimport { useCallback, useRef, useState } from \"react\";\nexport default function useQueue({\n  drain,\n  task\n}) {\n  var _queue$current, _queue$current2, _queue$current3, _queue$current4;\n  const [progress, setProgress] = useState(0);\n  const queue = useRef(async.queue((variable, callback) => {\n    task(variable).then(results => {\n      callback(results);\n    });\n  }, 1));\n  (_queue$current = queue.current) === null || _queue$current === void 0 ? void 0 : _queue$current.drain(drain);\n  const add = useCallback(task => {\n    queue.current.push(task, err => {\n      if (err) {\n        console.error(err);\n      }\n      setProgress(prevState => prevState + 1);\n    });\n  }, []);\n  return {\n    add,\n    started: (_queue$current2 = queue.current) === null || _queue$current2 === void 0 ? void 0 : _queue$current2.started,\n    kill: (_queue$current3 = queue.current) === null || _queue$current3 === void 0 ? void 0 : _queue$current3.kill,\n    progress,\n    length: (_queue$current4 = queue.current) === null || _queue$current4 === void 0 ? void 0 : _queue$current4.length()\n  };\n}","import { useAlert } from \"@dhis2/app-runtime\";\nimport i18n from \"@dhis2/d2-i18n\";\nimport { CircularLoader, LinearLoader } from \"@dhis2/ui\";\nimport React, { useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport useMigrateScorecard from \"./hooks/useMigrateScorecard\";\nexport default function ScorecardMigration() {\n  const history = useHistory();\n  const onComplete = () => {\n    history.replace(\"/\");\n  };\n  const {\n    show\n  } = useAlert(({\n    message\n  }) => message, ({\n    type\n  }) => ({\n    ...type,\n    duration: 3000\n  }));\n  const {\n    error,\n    progress,\n    count,\n    migrationStarted\n  } = useMigrateScorecard(onComplete);\n  useEffect(() => {\n    if (error) {\n      var _error$message;\n      show({\n        message: i18n.t(\"Error Migrating Scorecards: \" + ((_error$message = error === null || error === void 0 ? void 0 : error.message) !== null && _error$message !== void 0 ? _error$message : \"\")),\n        type: {\n          info: true\n        }\n      });\n    }\n  }, [error, show]);\n  if (!migrationStarted) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"column center align-items-center h-100 w-100\"\n    }, /*#__PURE__*/React.createElement(CircularLoader, {\n      small: true\n    }), /*#__PURE__*/React.createElement(\"h4\", null, i18n.t(\"Preparing migration...\")));\n  }\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"column center align-items-center h-100 w-100\"\n  }, /*#__PURE__*/React.createElement(LinearLoader, {\n    amount: progress / count * 100\n  }), /*#__PURE__*/React.createElement(\"h4\", null, i18n.t(\"Migrating scorecards\"), \"...\", +progress, \" \", i18n.t(\"of\"), \" \", +count));\n}"],"names":["Progress","_ref","amount","invert","className","React","_JSXStyle","dynamic","theme","primary600","colors","white","cx","id","concat","propTypes","PropTypes","isRequired","LinearLoader","_ref2","width","margin","dataTest","role","defaultProps","spacers","dp12","generateOldScorecardQueries","ids","fromPairs","map","resource","DATASTORE_OLD_SCORECARD_ENDPOINT","uploadNewScorecard","async","newScorecard","engine","mutate","generateCreateMutation","variables","data","summaryMutation","type","DATASTORE_ENDPOINT","DATASTORE_SCORECARD_SUMMARY_KEY","uploadSummary","summary","useMigrateScorecard","onComplete","error","setError","useState","allSummary","useRecoilValue","AllScorecardsSummaryState","resetSummary","useRecoilRefresher_UNSTABLE","summaries","setSummaries","useDataEngine","set","setSkipMigration","useSetting","DATA_MIGRATION_CHECK","global","migrate","useCallback","scorecard","onMigrationComplete","uniqBy","add","progress","length","started","drain","task","_queue$current","_queue$current2","_queue$current3","_queue$current4","setProgress","queue","useRef","variable","callback","then","results","current","push","err","console","prevState","kill","useQueue","onMigrationInitiated","scorecardKeys","_await$engine$query2","keys","query","filter","key","includes","e","getScorecardKeys","oldScorecardKeys","_await$engine$query","getOldScorecardKeys","filteredKeys","isEmpty","oldScorecards","compact","oldScorecardsObject","oldScorecardsList","forIn","value","getOldScorecards","newScorecards","mapAsync","migrateScorecard","oldScorecard","newScorecardsSummaries","generateScorecardSummary","useEffect","count","migrationStarted","ScorecardMigration","history","useHistory","show","useAlert","message","duration","replace","_error$message","i18n","t","info","CircularLoader","small"],"sourceRoot":""}