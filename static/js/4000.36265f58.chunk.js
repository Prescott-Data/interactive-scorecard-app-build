"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[4e3],{64e3:function(e,t,a){a.r(t),a.d(t,{default:function(){return y}});var n=a(21758),l=a(65298),r=a(22659),i=a(21373),o=a(59541);function c(e){const t=(0,o.last)(e);return(0,o.filter)(e[e.length-2]||[],e=>!e.colSpan).length+t.length}function s(e){return(0,o.filter)((0,o.filter)(e,e=>e.dataRowIds))}function m(e,t){return(0,o.filter)(function(e){let t=[];return(0,o.map)(e,e=>{t=[...t,(0,o.first)(e)];const a=(0,o.uniq)((0,o.flatten)((0,o.map)(e,e=>e.path?e.path.split("/"):[])));return(0,o.uniqBy)([...(0,o.filter)((0,o.map)(a,e=>(0,o.find)(t,["id",e])),e=>e),...e],"id")})}(e),e=>s(e).length>0)}function u(e,t){const{availableParent:a,mergedDataRowsOrColumnsArray:n}=function(e){const t={},a=(0,o.map)(m(e),e=>(0,o.filter)((0,o.map)(e,e=>t[e.id]?(t[e.id]=t[e.id]+1,null):(e.id&&(t[e.id]=1),e)),e=>e));return{availableParent:t,mergedDataRowsOrColumnsArray:a}}(e);return(0,o.map)(n,e=>(0,o.map)(e,e=>({...e,rowSpan:a[e.id]})))}function d(e,t){return(0,o.map)(e,e=>{const a=t.metaData[e];return(0,o.map)(a||[],e=>({id:e,name:t&&t.metaData&&t.metaData.names?t.metaData.names[e]:""}))})}function p(e,t){let a=[];return(0,o.each)((0,o.range)(e.length),n=>{if(0===a.length)"row"===t?(0,o.each)(e[n],e=>{a=[...a,[{...e,column:0,path:e.id}]]}):a=[...a,(0,o.map)(e[n],t=>({...t,path:t.id,textCenter:!0,colSpan:(0,o.reduce)((0,o.map)((0,o.slice)(e,n+1),e=>e.length),(e,t)=>e*t)}))];else{let l=[];if((0,o.each)(a,a=>{const r=(0,o.join)((0,o.map)(a,e=>e.id),"/");"row"===t&&(0,o.each)(e[n],(i,c)=>{l=0===c?[...l,[...(0,o.map)(a,a=>{const l=(0,o.reduce)((0,o.map)((0,o.slice)(e,a.column+1,n+1),e=>e.length),(e,t)=>e*t);return{...a,path:a.path?a.path:r,["row"===t?"rowSpan":"colSpan"]:l}}),{...i,path:`${r}/${i.id}`,column:n}]]:[...l,[{...i,path:`${r}/${i.id}`,column:n}]]})}),"column"===t){const t=(0,o.last)(a);l=[...a,(0,o.flatten)((0,o.map)((0,o.range)(t.length),a=>{const l=t[a].path;return(0,o.map)(e[n],t=>{const a=`${l}/${t.id}`;return{...t,path:a,dataRowIds:a.split("/"),textCenter:!0,colSpan:(0,o.reduce)((0,o.map)((0,o.slice)(e,n+1),e=>e.length),(e,t)=>e*t)}})}))]}a=l}}),a}function h(e,t,a){return(0,o.map)(t,t=>[...t,...(0,o.map)((0,o.last)(a),a=>{const n=(0,o.last)(t),l=[...n&&n.path?n.path.split("/"):[],...a&&a.path?a.path.split("/"):[]];return{id:l.join("_"),isDataCell:!0,dataDimensions:[...e.row,...e.column],dataRowIds:l}})])}function f(e,t){return(0,o.map)(e.filter,e=>(0,o.map)(t&&t.metaData&&t.metaData[e]||[],e=>t&&t.metaData&&t.metaData.names&&t.metaData.names[e]||[]).join(", ")).join(" - ")}function w(e,t){const a=p(d(t.row,e),"row"),n=function(e){const t={},a=(0,o.map)(e,e=>{const a=s(e);return(0,o.each)(a,e=>{(0,o.each)((0,o.filter)(e.dataRowIds,t=>t!==e.id),e=>{t[e]?t[e]=t[e]+1:t[e]=1})}),a.length>0?a:e});return(0,o.map)(a,e=>(0,o.map)(e,e=>({...e,colSpan:t[e.id]})))}(p(d(t.column,e),"column")),l=function(e,t,a,n){let l=[];return(0,o.each)(t,(r,i)=>{const c=(0,o.map)(r,(e,t)=>{const a=n.column[t];return{...e,dimension:a,name:e.name}});l=0===i?[...l,[...(0,o.map)(e,(e,l)=>{const r=n.row[l];return{...e,dimension:r,name:a.metaData.names[r],rowSpan:t.length}}),...c]]:[...l,c]}),l}(a[0],n,e,t);return{title:t.title,subtitle:f(t,e),headers:l,headerColSpan:c(l),rows:u(h(t,a,n))}}var b=a(51654),g=a.n(b);function v({analyticsObject:e,dataRowIds:t}){const[a,l]=(0,n.useState)(0);return(0,n.useEffect)(()=>{l(function(e,t){const a=e&&e.headers||[],n=a.indexOf((0,o.find)(a,["name","value"]));return(0,o.filter)((0,o.map)((0,o.filter)(e&&e.rows||[],e=>(0,o.intersection)(t,e).length===t.length),e=>parseFloat(e[n])),e=>!isNaN(e))}(e,t))},[e,t]),n.createElement("div",{className:"table-item-cell",style:{backgroundColor:""!==a?"#ffffff":"#eeeeee"}},a,n.createElement("div",null,"\xa0"))}function E(){const e=(0,l.useRecoilValue)(r._),t=(0,l.useRecoilValue)(i.W),a=(0,n.useMemo)(()=>w(e._data,t),[e,t]);return n.createElement("div",{className:"table-item-container"},n.createElement("table",{className:"table table-bordered"},n.createElement("thead",null," "!==(null===a||void 0===a?void 0:a.subtitle)?n.createElement("tr",null,n.createElement("th",{colSpan:null===a||void 0===a?void 0:a.headerColSpan,className:"table-header-cell"},n.createElement("div",{className:"table-header-item"},null===a||void 0===a?void 0:a.subtitle))):null,null===a||void 0===a?void 0:a.headers.map((e,t)=>n.createElement("tr",{key:t},e.map((e,t)=>n.createElement("th",{className:"table-header-cell",key:t,rowSpan:e.rowSpan,colSpan:e.colSpan,style:{textAlign:e.textCenter?"center":"left"}},e.name))))),n.createElement("tbody",null,null===a||void 0===a?void 0:a.rows.map((t,a)=>n.createElement("tr",{key:"table-row"+a},t.map((t,a)=>n.createElement("td",{className:"table-item-cell-block",key:"table-row-item-cell"+a,rowSpan:t.rowSpan},t.isDataCell?n.createElement("div",{className:"table-item-cell-data",key:"tableCellPosition"+a},n.createElement(v,{analyticsObject:e._data,dataRowIds:t.dataRowIds})):n.createElement("span",{className:"table-item-cell-label",key:"tableCellPosition"+a},t.name))))))))}function y(){return n.createElement("div",{className:"column align-items-center",style:{height:"100%"}},n.createElement(E,{width:"100%"}))}v.propTypes={analyticsObject:g().object.isRequired,dataRowIds:g().array.isRequired}}}]);
//# sourceMappingURL=4000.36265f58.chunk.js.map