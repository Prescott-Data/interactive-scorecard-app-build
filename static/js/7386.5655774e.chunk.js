"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[7386],{7386:function(e,t,a){a.r(t),a.d(t,{default:function(){return ct}});var n=a(62062),i=a(51654),l=a.n(i),r=a(21758),o=a(73743),s=a(71229),d=a(65298),c=a(98225),u=a(66190),p=a(8890),g=a(65245),m={"org-unit-header-cell":"scorecardTable_org-unit-header-cell__zyAxQ","holder-header-cell":"scorecardTable_holder-header-cell__Tysy3","data-header-cell":"scorecardTable_data-header-cell__v5Zuf","period-header-cell":"scorecardTable_period-header-cell__9IjVV","child-table-row":"scorecardTable_child-table-row__GI9Cw","parent-table-row":"scorecardTable_parent-table-row__Mz+w5","table-print":"scorecardTable_table-print__BlF6y","average-row":"scorecardTable_average-row__Lc5lf","table-header-row":"scorecardTable_table-header-row__57TP5"},v=a(59541),f=a(74179),h=a(84161),y=a(31594);function b({cellRef:e,dataSources:t,values:a,bold:n,period:i,orgUnit:l}){var o;const[s]=null!==t&&void 0!==t?t:[],c=(0,d.useRecoilValue)((0,h.Ye)(!0)),u=(0,d.useRecoilValue)(h.cT),p=(0,d.useRecoilValue)((0,h.NP)("legendDefinitions")),{color:g}=null!==(o=(0,y.sG)((0,v.head)(a),null===s||void 0===s?void 0:s.legends,{max:null===s||void 0===s?void 0:s.weight,defaultLegends:c,dataOrgUnitLevel:{},orgUnitLevels:u,legendDefinitions:p,specificTargets:null===s||void 0===s?void 0:s.specificTargets,period:i,orgUnit:l}))&&void 0!==o?o:{};return void 0===(0,v.head)(a)?null:r.createElement(f.Pj,{cellRef:e,color:g,bold:n,value:void 0!==(0,v.head)(a)?(0,v.round)((0,v.head)(a),2):""})}function E({cellRef:e,dataSources:t,values:a,bold:n,period:i,orgUnit:l}){var o,s;const c=(0,d.useRecoilValue)((0,h.Ye)(!0)),u=(0,d.useRecoilValue)(h.cT),p=(0,d.useRecoilValue)((0,h.NP)("legendDefinitions")),[g,m]=null!==t&&void 0!==t?t:[],{color:b}=null!==(o=(0,y.sG)((0,v.head)(a),null===g||void 0===g?void 0:g.legends,{max:null===g||void 0===g?void 0:g.weight,defaultLegends:c,dataOrgUnitLevel:{},orgUnitLevels:u,legendDefinitions:p,orgUnit:l,period:i,specificTargets:null===g||void 0===g?void 0:g.specificTargets}))&&void 0!==o?o:{},{color:E}=null!==(s=(0,y.sG)((0,v.last)(a),null===m||void 0===m?void 0:m.legends,{max:null===m||void 0===m?void 0:m.weight,defaultLegends:c,dataOrgUnitLevel:{},orgUnitLevels:u,legendDefinitions:p,orgUnit:l,period:i,specificTargets:null===m||void 0===m?void 0:m.specificTargets}))&&void 0!==s?s:{};return r.createElement(f.Sx,{cellRef:e,topColor:b,bottomColor:E,bold:n,topValue:(0,v.head)(a)?(0,v.round)(+(0,v.head)(a),2):"",bottomValue:(0,v.last)(a)?(0,v.round)((0,v.last)(a),2):""})}function R({value:e,bold:t,dataSources:a,period:n,orgUnit:i}){const l=Object.values(e),[o,s]=(0,r.useState)();return r.createElement("td",{ref:s,className:"data-cell",align:"center"},l.length>1?r.createElement(E,{cellRef:o,period:n,orgUnit:!0,bold:t,dataSources:a,values:l}):r.createElement(b,{cellRef:o,period:n,orgUnit:i,bold:t,dataSources:a,values:l}))}function w({value:e,bold:t,dataSources:a,orgUnit:n,period:i}){const[l,o]=(0,r.useState)();return void 0===e?null:"number"===typeof e?r.createElement("td",{ref:o,className:"data-cell",align:"center"},r.createElement(f.Pj,{cellRef:l,bold:t,value:e?(0,v.round)(e,2):""})):r.createElement(R,{orgUnit:n,period:i,value:e,bold:t,dataSources:a})}b.propTypes={values:l().arrayOf(l().any).isRequired,bold:l().bool,dataSources:l().arrayOf(l().any),orgUnit:l().string,period:l().string},E.propTypes={values:l().arrayOf(l().any).isRequired,bold:l().bool,dataSources:l().arrayOf(l().any),orgUnit:l().string,period:l().string},R.propTypes={value:l().any.isRequired,bold:l().bool,dataSources:l().arrayOf(l().any),orgUnit:l().string,period:l().string},w.propTypes={value:l().any.isRequired,bold:l().bool,dataSources:l().arrayOf(l().any),orgUnit:l().string,period:l().string};var x=a(37973);function U({period:e,dataSources:t,orgUnit:a,orgUnits:n,dataEngine:i}){const[l,o]=(0,r.useState)(),s=(0,d.useRecoilValue)((0,h.Wn)(n)),{childrenOrgUnits:c,filteredOrgUnits:u}=(0,d.useRecoilValue)((0,h.iH)(n));return(0,r.useEffect)(function(){if(!s){let l;var n;if((0,v.isEmpty)(t))l=i.getOrgUnitColumnAverage({period:e,orgUnit:a}).subscribe(o);else l=i.getDataSourceColumnAverage({period:e,dataSources:null===t||void 0===t?void 0:t.map(({id:e})=>e),orgUnits:null===(n=[...c,...u])||void 0===n?void 0:n.map(({id:e})=>e)}).subscribe(o);return()=>{l.unsubscribe()}}},[s,t,a,e,c,u]),r.createElement(w,{dataSources:t,bold:!0,value:l,period:e})}function S({orgUnits:e,overallAverage:t,dataEngine:a}){const n=(0,d.useRecoilValue)(h.Jv),i=(0,d.useRecoilValue)(h.T8),{averageColumn:l,itemNumber:o}=(0,d.useRecoilValue)((0,h.NP)("options"));return r.createElement(p.J,{className:m["average-row"],bordered:!0},r.createElement(g.B,{fixed:!0,left:"0",width:"50px"}),o&&r.createElement(g.B,{className:"extra-table-cell",fixed:!0,left:"50px",width:"50px"}),r.createElement(g.B,{fixed:!0,left:o?"100px":"50px",className:"scorecard-org-unit-cell"},r.createElement("b",null,u.A.t("Average"))),null===i||void 0===i?void 0:i.map(({dataSources:t,id:i})=>null===n||void 0===n?void 0:n.map(({id:n})=>r.createElement(U,{dataEngine:a,orgUnits:e,key:`${i}-${n}-average-cell`,dataSources:t,period:n}))),l&&r.createElement(w,{bold:!0,value:t}))}function A({orgUnits:e,overallAverage:t,dataEngine:a}){var n;const i=(0,d.useRecoilValue)(h.Jv),{childrenOrgUnits:l,filteredOrgUnits:o}=(0,d.useRecoilValue)((0,h.iH)(e)),{averageColumn:s,itemNumber:c}=(0,d.useRecoilValue)((0,h.NP)("options"));return r.createElement(p.J,{className:m["average-row"],bordered:!0},r.createElement(g.B,{fixed:!0,left:"0",width:"50px"}),c&&r.createElement(g.B,{fixed:!0,left:"50px",width:"50px"}),r.createElement(g.B,{fixed:!0,left:c?"100px":"50px",className:"scorecard-org-unit-cell"},r.createElement("b",null,u.A.t("Average"))),null===(n=[...o,...l])||void 0===n?void 0:n.map(({id:t})=>null===i||void 0===i?void 0:i.map(({id:n})=>r.createElement(U,{dataEngine:a,orgUnits:e,key:`${t}-${n}-average`,period:n,orgUnit:t}))),s&&r.createElement(w,{bold:!0,value:t}))}U.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,orgUnits:l().array.isRequired,period:l().string.isRequired,dataSources:l().array,orgUnit:l().string},S.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,orgUnits:l().array.isRequired,overallAverage:l().number.isRequired},A.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,orgUnits:l().array.isRequired,overallAverage:l().number.isRequired};var T=a(80629),O=a(72714),N=a(34207),V=a(24563),_=a(42412),k=a(77337),L=a(37810),D=a(37812),C=a(53938),q=a(69877),P=a.n(q),$=a(22659),B=a(21373);function I(e){let t="";switch(e){case"radar":case"dotted":t="line";break;default:t=e}return t}function F(e){const t=I(e.type),a={series:{cursor:"pointer",point:{events:{click:function(){const e=(window.clickedCharts||{})[this.id],t=this.color;e?(window.clickedCharts||{})[this.id]=null:(window.clickedCharts||(window.clickedCharts={}),window.clickedCharts={...window.clickedCharts,[this.id]:{color:this.color}}),this.update({color:e?"#f00"!==t?"#f00":e.color:"#f00"},!0,!1)}}}}};if(t)switch(t){case"solidgauge":case"gauge":a[t]={dataLabels:{y:5,borderWidth:0,useHTML:!0}};break;case"pie":a[t]={borderWidth:0,allowPointSelect:!0,cursor:"pointer",showInLegend:!e.hideLegend};break;default:a[""!==t?t:"series"]={showInLegend:!e.hideLegend,colorByPoint:!0},"stacked_column"!==e.type&&"stacked_bar"!==e.type&&"area"!==e.type||(a[t].stacking=e.percentStackedValues?"percent":"normal"),"dotted"===e.type&&(a.line={lineWidth:0,states:{hover:{enabled:!1}}})}return a}function j(e,t){return e.hideSubtitle?null:{text:(0,v.map)(e.zAxisType,e=>(0,v.map)(t&&t.metaData&&t.metaData[e]||[],e=>t&&t.metaData&&t.metaData.names&&t.metaData.names[e]||[]).join(", ")).join(" - "),align:"left",style:{fontWeight:"600",fontSize:"13px"}}}function W(e){return e.hideTitle?null:{text:e.title,align:"left",style:{fontWeight:"500",fontSize:"16px"}}}function M(e){const t=I(e.type);let a={};if(t)switch(t){case"solidgauge":a={enabled:!1};break;case"pie":a={pointFormat:"{series.name}<br/> <b>{point.y}</b> ( {point.percentage:.1f} % )"};break;default:if("stacked_column"===e.type)a={headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"};else a={enabled:!0}}return a}function G(e){const t={renderTo:e.renderId,zoomType:"xy",type:I(e.type)};return"pie"===e.type?(t.plotBackgroundColor=null,t.plotBorderWidth=null,t.plotShadow=!1):"radar"===e.type&&(t.polar=!0),t}function H(e,t){return t.cumulativeValues?function(e,t,a){const n=(0,v.clone)(e);if(e){const i=e.metadata[a],l=[...(0,v.reverse)([...e.metadata[t]])],r=(0,v.findIndex)(e.headers,(0,v.find)(e.headers,["name",a])),o=(0,v.findIndex)(e.headers,(0,v.find)(e.headers,["name",t])),s=(0,v.findIndex)(e.headers,(0,v.find)(e.headers,["name","value"])),d=[];i.forEach(t=>{let a=0;l.forEach(n=>{e.rows.forEach(e=>{if(e[r]===t&&e[o]===n){a+=parseInt(e[s],10);const t=(0,v.clone)(e);t[s]=a,d.push(t)}})})}),n.rows=(0,v.assign)([],d)}return n}(e,t.xAxisType[0],t.yAxisType):e}function J(e,t){const a=(0,v.flatten)((0,v.filter)((0,v.map)(t.dataSelections||[],e=>e.groups),e=>e)),n=(0,v.flatten)((0,v.map)(a,e=>(0,v.map)(e.members,t=>`${t.id}_${e.id}`))),i=(0,v.map)(e.series,e=>(0,v.filter)((0,v.map)(e.data,(e,t)=>""===e.y||n.length>0&&-1===n.indexOf(e.id)?t:-1),e=>-1!==e));let l=[];(0,v.each)(i,e=>{l=0===l.length?e:l,l=(0,v.intersection)(l,e)});const r=(0,v.map)(e.series,e=>({...e,data:(0,v.filter)((0,v.map)(e.data,e=>{const t=e.id.split("_"),n=(0,v.find)(a,["id",t[1]]);return(window.clickedCharts||{})[e.id]?{...e,color:"#f00"}:n&&(0,v.some)(n.members,e=>e.id===t[0])&&n.color?{...e,color:n.color}:e}),(e,t)=>-1===l.indexOf(t))}));let o=0;const s=(0,v.map)(e.xAxis.categories,e=>{if(!e.categories)return e;const t={...e,categories:(0,v.filter)(e.categories,(e,t)=>-1===l.indexOf(t+o))};return o+=e.categories?e.categories.length:0,t});return{...e,series:r,xAxis:{...e.xAxis,categories:s},exporting:(d=s,{scale:3,chartOptions:{title:{style:{fontSize:"10px"}},subtitle:{style:{fontSize:"10px"}},xAxis:[{categories:d,labels:{rotation:0,style:{fontSize:"8px",color:"#000000",textAlign:"center",textOverflow:"allow",width:1,paddingBottom:"5px"}}}]},buttons:{contextButton:{enabled:!0}}})};var d}function z(e,t,a){let n=[];const i=e.metaData.names;return null===t||void 0===t||t.forEach((t,a)=>{var l;const r=null!==(l=e.metaData[t])&&void 0!==l?l:[];if(r)if(a>0){const e=(0,v.assign)([],n);n=[],r.forEach(t=>{e.forEach(e=>{n.push({id:e.id+"_"+t,name:e.name+"_"+i[t].trim()})})})}else n=(0,v.map)(r,e=>({id:e,name:i[e].trim()}))}),n}function K(e){let t={};if("radar"===e)t=(0,v.assign)({},{size:"80%"});else t=(0,v.assign)({},{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}});return t}function Q(e){let t=null;if("pie"===e.type)t={enabled:e.showData,format:"{point.name}<br/> <b>{point.y}</b> ( {point.percentage:.1f} % )"};else t={enabled:e.showData};return t}function Z(e,t,a,n){const i=[],l=(0,v.findIndex)(e.headers,(0,v.find)(e.headers,["name",t.yAxisType])),r=(0,v.findIndex)(e.headers,(0,v.find)(e.headers,["name","value"])),o=(0,v.map)(t.xAxisType,t=>(0,v.findIndex)(e.headers,(0,v.find)(e.headers,["name",t]))).join("_");return n&&n.forEach(n=>{const s=function(e,t,a,n,i,l){let r=0;const o=(0,v.map)(e,e=>{let r=0,o="";if((0,v.forEach)(n.split("_"),t=>{o+=""!==o?"_":"",o+=e[t]}),e[t]===a&&o===i){const t=parseFloat(e[l]);if(isNaN(t))return e[l];r+=t}return r}).filter(e=>0!==e);if(o){if((0,v.some)(o,e=>isNaN(e)))return"";const e=(0,v.some)(o,e=>e.toString().split(".")[1]),t=o.length>0?o.reduce((e,t)=>parseFloat(e)+parseFloat(t)):0;r=e?t/o.length:t}return 0!==r?r:null}(e.rows,l,a,o,n.id,r);i.push({id:n.id,name:n.name,dataLabels:Q(t),y:s})}),i}function Y(e,t,a,n){return a.map((a,i)=>({name:a.name,id:a.id,index:i,turboThreshold:0,pointPlacement:"radar"===n.type?"on":void 0,data:Z(e,n,a.id,t),type:I(n.type)}))}function X(e){const t=e.axes;let a=[];return a=0==t.length?(0,v.assign)([],[{min:e.rangeAxisMinValue,max:e.rangeAxisMaxValue,title:{text:"",style:{color:"#000000",fontWeight:"normal",fontSize:"14px"}}}]):(0,v.map)(t,t=>({min:e.rangeAxisMinValue,max:e.rangeAxisMaxValue,title:{text:t.name,style:{color:"#000000",fontWeight:"normal",fontSize:"14px"}},opposite:"left"!==t.orientation})),(0,v.map)(a,t=>{switch(e.type){case"radar":t.gridLineInterpolation="polygon",t.lineWidth=0;break;case"solidgauge":t.lineWidth=0,t.labels={y:16},t.max=100;break;case"stacked_column":t.stackLabels={enabled:!1,style:{fontWeight:"bold"}};break;default:t.labels={style:{color:"#000000",fontWeight:"normal",fontSize:"14px"}},t.plotLines=[{color:"#000000",dashStyle:"Solid",value:e.targetLineValue,width:2,zIndex:1e3,label:{text:e.targetLineLabel}},{color:"#000000",dashStyle:"Solid",value:e.baseLineValue,zIndex:1e3,width:2,label:{text:e.baseLineLabel}}]}return t})}function ee(e){let t=[];return e.forEach(e=>{e.forEach(e=>{const a=(0,v.find)(t,["id",e.id]);if(a){const n=(0,v.findIndex)(t,a),i={...e};i.y+=a.y,t=[...t.slice(0,n),i,...t.slice(n+1)]}else t=[...t,e]})}),t}function te(e,t){let a=[...e],n=[];const i=[...ee((0,v.map)(e,e=>e.data))];return 1===t?(n=(0,v.map)((0,v.reverse)((0,v.sortBy)(i,["y"])),e=>e.id),a=(0,v.map)(a,e=>{const t={...e};return n.length>0&&(t.data=[...(0,v.map)(n,t=>(0,v.find)(e.data,["id",t]))]),t})):-1===t&&(n=(0,v.map)((0,v.sortBy)(i,["y"]),e=>e.id),a=(0,v.map)(e,e=>{const t={...e};return n.length>0&&(t.data=[...(0,v.map)(n,t=>(0,v.find)(e.data,["id",t]))]),t})),a}function ae(e,t,a){const n=(0,v.clone)(e),i=z(t,a.yAxisType);n.pane=K(a.type),n.yAxis=(0,v.assign)([],X(a));const l=te(Y(t,z(t,a.xAxisType),i,a),a.cumulativeValues?-1:a.sortOrder);return{...n,series:l}}function ne(e,t,a){const n=(0,v.clone)(e),i=z(t,a.yAxisType);n.pane=(0,v.assign)({},K(a.type)),n.yAxis=(0,v.assign)([],X(a));const l=te(Y(t,z(t,a.xAxisType),i,a),a.cumulativeValues?-1:a.sortOrder);n.series=(0,v.assign)([],l);const r=function(e){return(e?e.xAxisType:[]).map(t=>{const a=(0,v.find)(e?e.dataSelections:[],["dimension","groups"===t?"dx":t]);return a?"groups"===t?a.groups:a.items:[]})}(a);return n.xAxis=function(e,t){let a={};a="radar"===t.type?(0,v.assign)({},{categories:e,tickmarkPlacement:"on",lineWidth:0}):(0,v.assign)({},{categories:[...null===e||void 0===e?void 0:e.map(e=>e.name)],labels:{rotation:0,useHTML:!0,allowOverlap:!0,style:{color:"#000000",fontWeight:"normal",fontSize:"12px",wordBreak:"break-all",textOverflow:"allow"}}});return a}(function(e,t){const a=(0,v.reverse)(t||[]);let n=[];if(e){const t=(0,v.map)(e,e=>e.data);if(t){const e=(0,v.map)(t,e=>(0,v.map)(e,e=>{const t=e.name.split("_"),n=[];if(t){const e=(0,v.reverse)(t);(0,v.times)(t.length,t=>{if(0===t){const i=(0,v.find)(a[t]||[],["id",e[t]]);n.push({id:e[t],name:i?i.label||i.name:e[t]})}else{const i=(0,v.find)(n,["id",e[t-1]]);if(i){const l=(0,v.findIndex)(n,i);let r=i.categories?i.categories:[];const o=(0,v.find)(a[t]||[],["id",e[t]]);r=[...r,o?o.label||o.name:e[t]],i.categories=(0,v.assign)([],r),n[l]=i}}})}return n[0]}));if(e){const t=(0,v.groupBy)(e[0],"name"),a=(0,v.map)(e[0],e=>e.name),i=[];(0,v.forEach)(a,e=>{const a=(0,v.filter)((0,v.map)(t[e],e=>e.categories?e.categories[0]:null),e=>null!==e);0===a.length?i.push({name:e}):i.push({name:e,categories:a})}),n=(0,v.assign)([],i)}}}return(0,v.uniqBy)(n,"name")}(n.series,r),a),n}function ie(e,t){const a=H(e,t);let n=function(e,t){return{chart:G(t),title:W(t),subtitle:j(t,e),credits:{enabled:!1},colors:["#A9BE3B","#558CC0","#D34957","#FF9F3A","#968F8F","#B7409F","#FFDA64","#4FBDAE","#B78040","#676767","#6A33CF","#4A7833","#434348","#7CB5EC","#F7A35C","#F15C80"],plotOptions:F(t),tooltip:M(t)}}(a,t);switch(t.type){case"radar":n=ne(n,a,t);break;case"solidgauge":n=ae(n,a,t);break;case"gauge":const e=(0,v.clone)(t);e.type="solidgauge",n=ae(n,a,e);break;default:return J(ne(n,a,t),t)}return J(n,t)}function le(e,t){return`${e.title||e.displayName||e.name}${t?` : ${t}`:""}`}var re=a(65859);const oe=(0,d.atom)({key:"chartTypes-atom",default:re.XD}),se=(0,d.atom)({key:"chart-update-atom",default:{id:"",type:""}}),de=(0,d.atom)({key:"current-chart-type",default:"column"}),ce=(0,d.selectorFamily)({key:"chart-comfiguration-selector",get:({layout:e,currentChartType:t})=>()=>{var a,n,i;return n=e,i=[],{renderId:"render-id-unique",type:t,title:le(a={},""),subtitle:a.hasOwnProperty("subtitle")?a.subtitle:"",hideTitle:!a.hasOwnProperty("hideTitle")||a.hideTitle,hideSubtitle:!!a.hasOwnProperty("hideSubtitle")&&a.hideSubtitle,showData:!a.hasOwnProperty("showData")||a.showData,hideEmptyRows:!a.hasOwnProperty("hideEmptyRows")||a.hideEmptyRows,hideLegend:!a.hasOwnProperty("hideLegend")||a.hideLegend,cumulativeValues:!!a.hasOwnProperty("cumulativeValues")&&a.cumulativeValues,targetLineValue:a.targetLineValue?a.targetLineValue:void 0,targetLineLabel:a.targetLineLabel?a.targetLineLabel:"",baseLineValue:a.baseLineValue?a.baseLineValue:void 0,baseLineLabel:a.baseLineLabel?a.baseLineLabel:"",legendAlign:"bottom",categoryRotation:0,reverseLegend:!1,showLabels:!0,axes:a.axes?a.axes:[],rangeAxisMaxValue:90,rangeAxisMinValue:a.rangeAxisMinValue?a.rangeAxisMinValue:void 0,sortOrder:a.hasOwnProperty("sortOrder")?a.sortOrder:0,percentStackedValues:!a.hasOwnProperty("percentStackedValues")||a.percentStackedValues,multiAxisTypes:a.hasOwnProperty("selectedChartTypes")?a.selectedChartTypes:[],xAxisType:n.row,yAxisType:n.column,zAxisType:n.filter,dataSelections:i}}});function ue({chartHeight:e}){const t=(0,d.useRecoilValue)(oe),a=(0,d.useSetRecoilState)(se),[n,i]=(0,d.useRecoilState)(de),l=(0,d.useRecoilValue)($._),o=(0,d.useRecoilValue)(B.W),s=(0,d.useRecoilValue)(ce({layout:o,currentChartType:n}));let c="";function u(e,t){if(t&&e){const a=ie(e,t);a&&setTimeout(()=>{c=P().chart("renderId",a)},20)}}return(0,r.useEffect)(()=>{u(l._data,s)},[l,n,o]),r.createElement("div",{className:"chart-item-container",style:{width:"100%"}},r.createElement("div",{id:"renderId",className:"chart-block",style:{height:"calc("+e+"px-20px",width:"100%"}}),r.createElement("ul",{className:"chart-type-list animated fadeInRight"},null===t||void 0===t?void 0:t.map((e,t)=>r.createElement("li",{key:"chart-type"+t},r.createElement("button",{onClick:t=>function(e,t){t.stopPropagation(),i(e),u(l._data,{...s,type:e}),a({id:"render-id-unique",type:e.toUpperCase})}(e.type,t),title:e.description,className:n==e.type?"active-chart-type":""},r.createElement("img",{src:e.icon,className:"chart-option-icon",alt:""}))))))}function pe(){return r.createElement("div",{className:"chart-list"},r.createElement(r.Suspense,{fallback:r.createElement("div",null,"Loading .....")},r.createElement(ue,{chartHeight:2e3})))}ue.propTypes={chartHeight:l().string.isRequired};var ge=a(73459),me=a(24838),ve=a(80754),fe=a(16519);const he=r.lazy(()=>Promise.all([a.e(2499),a.e(3992)]).then(a.bind(a,93992))),ye=r.lazy(()=>Promise.all([a.e(9435),a.e(5403)]).then(a.bind(a,25403))),be=r.lazy(()=>a.e(4e3).then(a.bind(a,64e3))),Ee=[{displayName:u.A.t("Table"),name:"table",icon:r.createElement(C.A,null),component:be},{displayName:u.A.t("Chart"),name:"chart",icon:r.createElement(D.A,null),component:function(){return r.createElement("div",{className:"column align-items-center center h-100"},r.createElement(pe,{width:"100%"}))}},{displayName:u.A.t("Dictionary"),name:"dictionary",icon:r.createElement(L.A,null),component:he}];function Re({onClose:e,dataHolder:t,orgUnit:a,period:n}){const i=(0,d.useRecoilValueLoadable)($._),l=(0,d.useRecoilValue)(h.cT),[o,s]=(0,r.useState)(Ee[0]),c=null===t||void 0===t?void 0:t.dataSources,p=o.component,g=(0,d.useResetRecoilState)(me.w$),m=(0,d.useSetRecoilState)(ge.ar),f=(0,d.useRecoilCallback)(({set:e,snapshot:t})=>()=>{const i=t.getLoadable(ge.ar).contents,r=t.getLoadable(h.dw).contents;i&&e(B.W,{column:["dx"],row:["ou"],filter:["pe"]}),e($.v,c),e(ge.AJ,function(){const e=new x.vi({orgUnits:[a]});if(i){const t=(0,v.cloneDeep)(e),a=(0,v.get)(e,["orgUnits",0,"level"]);if(!(a<r.level))return e;{const e=(0,v.find)(l,function(e){return e.level===a+1});t.levels=[e.id]}return t}return e}()),e(me.fz,{periods:[n]})},[c,a,l,n]),b=(0,d.useRecoilCallback)(({reset:e})=>()=>{e(ge.AJ),e(me.fz),e(B.W),e($.v)},[]);return(0,r.useEffect)(()=>(f(),()=>{b(),g(),m(!1)}),[c,a,n]),r.createElement(O.a,{className:"large-modal",position:"middle",onClose:e,large:!0},r.createElement(N.$,null,r.createElement("div",{style:{overflow:"hidden",minHeight:400},className:"h-100 w-100 column"},r.createElement(ye,null),r.createElement("h3",{className:"pt-8"},(0,y.iS)(c)),r.createElement(r.Suspense,{fallback:r.createElement(ve.A,null)},r.createElement("div",{style:{overflow:"auto",margin:"16px 0",height:"100%"}},"hasError"===i.state&&r.createElement(fe.A,{error:i.contents}),"loading"===i.state&&r.createElement(ve.A,null),"hasValue"===i.state&&r.createElement(p,null))))),r.createElement(V.N,null,r.createElement("div",{style:{position:"absolute",bottom:16,left:16,width:"calc(100% - 32px)"},className:"row space-between align-items-end"},r.createElement("div",null,null===Ee||void 0===Ee?void 0:Ee.map(e=>r.createElement(_.v,{selected:(null===e||void 0===e?void 0:e.name)===(null===o||void 0===o?void 0:o.name),onClick:()=>s(e),key:null===e||void 0===e?void 0:e.name,icon:null===e||void 0===e?void 0:e.icon},null===e||void 0===e?void 0:e.displayName))),r.createElement(k.$,{onClick:e},u.A.t("Cancel")))))}Re.propTypes={dataHolder:l().object.isRequired,orgUnit:l().object.isRequired,period:l().object.isRequired,onClose:l().func.isRequired};var we=a(83590);function xe({cellRef:e,data:t,color:a,indicator:n}){var i;const{arrows:l}=null!==(i=(0,d.useRecoilValue)((0,h.NP)("options")))&&void 0!==i?i:{},{current:o,previous:s}=null!==t&&void 0!==t?t:{},c=(0,r.useMemo)(()=>{const{effectiveGap:e,displayArrows:t}=null!==n&&void 0!==n?n:{};return l&&t?(0,y.Mq)(o,s,e):null},[o,s,l,n]);return o?r.createElement(f.Pj,{cellRef:e,status:c,value:`${null!==o&&void 0!==o?o:""}`,color:a}):r.createElement("div",{style:{height:47,width:"100%",background:a}})}function Ue({cellRef:e,topData:t,bottomData:a,topColor:n,bottomColor:i,topIndicator:l,bottomIndicator:o}){var s;const{current:c,previous:u}=null!==t&&void 0!==t?t:{},{current:p,previous:g}=null!==a&&void 0!==a?a:{},{arrows:m}=null!==(s=(0,d.useRecoilValue)((0,h.NP)("options")))&&void 0!==s?s:{},v=(0,r.useMemo)(()=>{const{effectiveGap:e,displayArrows:t}=null!==l&&void 0!==l?l:{};return m&&t?(0,y.Mq)(c,u,e):null},[c,u,m,l]),b=(0,r.useMemo)(()=>{const{effectiveGap:e,displayArrows:t}=null!==o&&void 0!==o?o:{};return m&&t?(0,y.Mq)(p,g,e):null},[p,g,m,o]);return c||p?r.createElement(f.Sx,{cellRef:e,topValue:c,topColor:n,bottomValue:p,bottomColor:i,topStatus:v,bottomStatus:b}):r.createElement("div",{style:{height:"100%",width:"100%",background:we.T.grey100}})}xe.propTypes={data:l().object.isRequired,indicator:l().any.isRequired,color:l().string},Ue.propTypes={bottomData:l().object.isRequired,bottomIndicator:l().any.isRequired,topData:l().object.isRequired,topIndicator:l().any.isRequired,bottomColor:l().string,topColor:l().string};var Se=a(38112),Ae=a(20851),Te=a(28384),Oe=a(86512),Ne=a(32698),Ve=a(65013),_e=a(2793),ke="FurtherAnalysisMenu_furtherAnalysisMenu__NHa6A";function Le({stateActionRef:e,setStateActionRef:t,setAnalysisOpen:a}){const[n,i]=(0,r.useState)(!1),l=(0,d.useSetRecoilState)(me.Un),o=(0,d.useSetRecoilState)(ge.ar);return r.createElement(r.Fragment,null,r.createElement(Se.A,{onClickOutside:()=>t(void 0),placement:"bottom-start",reference:e},r.createElement(Ae.W,null,r.createElement(Te.D,{onClick:()=>{t(void 0),a(!0)},label:u.A.t("Further Analysis"),icon:r.createElement(Oe.A,null)}),r.createElement(Te.D,{onClick:()=>{o(!0),t(void 0),a(!0)},label:u.A.t("Lower Organisation Unit Levels"),icon:r.createElement(Ne.A,null)}),r.createElement(Te.D,{showSubMenu:n,toggleSubMenu:()=>{i(e=>!e)},label:u.A.t("Trend Analysis "),icon:r.createElement(Ve.A,null),className:ke},r.createElement(Te.D,{onClick:()=>{t(void 0),l([(new _e.aA).setPreferences({allowFuturePeriods:!0}).getById("LAST_3_MONTHS")]),a(!0)},label:u.A.t("Last 3 Months"),icon:r.createElement(Oe.A,null),className:ke}),r.createElement(Te.D,{onClick:()=>{t(void 0),l([(new _e.aA).setPreferences({allowFuturePeriods:!0}).getById("LAST_6_MONTHS")]),a(!0)},label:u.A.t("Last 6 Months"),icon:r.createElement(Oe.A,null),className:ke}),r.createElement(Te.D,{onClick:()=>{t(void 0),l([(new _e.aA).setPreferences({allowFuturePeriods:!0}).getById("LAST_12_MONTHS")]),a(!0)},label:u.A.t("Last 12 Months"),icon:r.createElement(Oe.A,null),className:ke}),r.createElement(Te.D,{onClick:()=>{t(void 0),l([(new _e.aA).setPreferences({allowFuturePeriods:!0}).getById("LAST_4_QUARTERS")]),a(!0)},label:u.A.t("Last 4 Quarters"),icon:r.createElement(Oe.A,null),className:ke}),r.createElement(Te.D,{onClick:()=>{t(void 0),l([(new _e.aA).setPreferences({allowFuturePeriods:!0}).getById("LAST_5_YEARS")]),a(!0)},label:u.A.t("Last 5 Years"),icon:r.createElement(Oe.A,null),className:ke})))))}Le.propTypes={setAnalysisOpen:l().func,setStateActionRef:l().func,stateActionRef:l().object};a(25182);function De({dataSources:e,orgUnit:t,period:a,dataEngine:n}){var i,l;const o=(0,d.useRecoilValue)(h.cT),s=(0,d.useRecoilValue)((0,h.NP)("legendDefinitions")),{id:c,level:u}=null!==t&&void 0!==t?t:{},{id:p}=null!==a&&void 0!==a?a:{},[g,m]=(0,r.useState)(!1),[v,f]=(0,r.useState)(),[b,E]=(0,r.useState)(),[R,w]=(0,r.useState)(null),x=(0,d.useResetRecoilState)(me.w$),U=(0,d.useResetRecoilState)(ge.Zf),[S,A]=(0,r.useState)(),[T,O]=null!==e&&void 0!==e?e:[],{color:N}=null!==(i=(0,y.sG)(null===v||void 0===v?void 0:v.current,null===T||void 0===T?void 0:T.legends,{max:null===T||void 0===T?void 0:T.weight,dataOrgUnitLevel:u,orgUnitLevels:o,legendDefinitions:s,period:p,orgUnit:c,specificTargets:null===T||void 0===T?void 0:T.specificTargets}))&&void 0!==i?i:{},{color:V}=null!==(l=(0,y.sG)(null===b||void 0===b?void 0:b.current,null===O||void 0===O?void 0:O.legends,{max:null===O||void 0===O?void 0:O.weight,dataOrgUnitLevel:u,orgUnitLevels:o,legendDefinitions:s,period:p,orgUnit:c,specificTargets:null===O||void 0===O?void 0:O.specificTargets}))&&void 0!==l?l:{},_=`${T.id}_${c}_${p}`,k=`${null===O||void 0===O?void 0:O.id}_${c}_${p}`;return(0,r.useEffect)(()=>{const e=n.get(_).subscribe(e=>{f(e)}),t=n.get(k).subscribe(E);return()=>{e.unsubscribe(),t.unsubscribe(),x(),U()}},[c,p,T,O]),r.createElement("td",{ref:A,className:"data-cell",align:"center","data-test":"data-cell",style:{minWidth:100},onClick:e=>{e.stopPropagation(),m(!0)},onContextMenu:e=>{e.preventDefault(),w(e.target)}},(null===e||void 0===e?void 0:e.length)>1?r.createElement(Ue,{cellRef:S,topIndicator:T,bottomIndicator:O,bottomData:b,topData:v,bottomColor:V,topColor:N}):r.createElement(xe,{cellRef:S,indicator:T,data:v,color:N}),g&&r.createElement(Re,{orgUnit:t,period:a,dataHolder:{dataSources:e},onClose:(e,t)=>{t.stopPropagation(),m(!1)}}),R&&r.createElement(Le,{orgUnit:t,period:a,dataSources:e,analysisOpen:g,setAnalysisOpen:m,stateActionRef:R,setStateActionRef:w}))}var Ce=De;De.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,dataSources:l().array.isRequired,orgUnit:l().object.isRequired,period:l().object.isRequired};var qe=a(41887),Pe=a(11671),$e=a(21097);function Be(){const{width:e}=(0,$e.Ub)();return r.createElement(p.J,null,r.createElement(g.B,{width:`${e}px`,align:"center"},r.createElement("div",{className:"row center align-items-center",style:{height:400,width:"100%"}},r.createElement(qe.F,{small:!0}))))}function Ie({dataEngine:e,orgUnits:t}){const{width:a}=(0,$e.Ub)(),{colSpan:n}=(0,d.useRecoilValue)((0,h.Mj)(t)),i=(0,d.useRecoilValue)((0,h.Wn)(t)),[l,o]=(0,r.useState)(0);return(0,r.useEffect)(()=>{const t=e.getProgress().subscribe(o);return()=>{t.unsubscribe()}},[t,e]),i?r.createElement(p.J,null,r.createElement("td",{colSpan:n},r.createElement(Pe.V,{width:`${a}px`,amount:l,margin:0}))):null}Ie.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,orgUnits:l().array.isRequired};var Fe=a(69530);function je({accept:e,children:t}){const a=(0,d.useSetRecoilState)(h.Qq),n=(0,r.useRef)((0,v.debounce)(a)),[{canDrop:i},l]=(0,Fe.H)({accept:e,drop:()=>{n.current(e=>e===re.t4.ORG_UNIT_VS_DATA?re.t4.DATA_VS_ORG_UNIT:re.t4.ORG_UNIT_VS_DATA)},collect:e=>({isOver:!!e.isOver(),canDrop:!!e.canDrop()})});return r.createElement("div",{ref:l,className:"column center align-items-center",style:{border:i&&`2px dashed ${we.T.grey700}`,background:i&&`${we.T.grey100}`,height:i?47:"100%",width:"100%"}},t)}je.propTypes={accept:l().arrayOf(l().string).isRequired,children:l().node.isRequired};var We=a(12198);function Me(){return Me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Me.apply(null,arguments)}function Ge({label:e,type:t,style:a,...n}){const[{isDragging:i},l]=(0,We.i)(()=>({type:t,collect:e=>({isDragging:!!e.isDragging()})}));return r.createElement("div",Me({},n,{className:"column center",style:{background:i&&(null===we.T||void 0===we.T?void 0:we.T.grey400),cursor:"move",opacity:i?.5:1,height:"100%",width:"100%",padding:"0 12px",...a},ref:l}),e)}function He({orgUnit:e}){const{showHierarchy:t}=(0,d.useRecoilValue)((0,h.NP)("options"));return r.createElement(Ge,{label:t?e.hierarchy:e.displayName,type:re.Kg.ORG_UNIT_ROW,style:{textAlign:"start"}})}function Je({orgUnit:e,expandedOrgUnit:t,onExpand:a,overallAverage:n,dataEngine:i,orgUnits:l,index:o}){var s,c;const{emptyRows:v,averageColumn:f,averageDisplayType:y,itemNumber:b}=(0,d.useRecoilValue)((0,h.NP)("options")),[E,R]=(0,r.useState)(!1),[x,U]=(0,r.useState)(),{id:S}=null!==e&&void 0!==e?e:{},{dataGroups:A}=null!==(s=(0,d.useRecoilValue)((0,h.NP)("dataSelection")))&&void 0!==s?s:{},O=(0,d.useRecoilValue)((0,h.Wn)(l)),N=null!==(c=(0,d.useRecoilValue)(h.Jv))&&void 0!==c?c:[];const V=(0,r.useCallback)(()=>{a(S===t?void 0:S)},[t,S,a]);(0,r.useEffect)(function(){if(void 0!==O&&!O){const e=i.getOrgUnitAverage(S).subscribe(U),t=i.isRowEmpty(S).subscribe(R);return()=>{e.unsubscribe(),t.unsubscribe()}}},[e,O,S,i]);const _=(v||!E)&&r.createElement(p.J,{dataTest:"orgUnit-children-table-column-cell",className:m["child-table-row"],expanded:S===t,onExpandToggle:V,expandableContent:r.createElement("div",{className:"p-16"},r.createElement(r.Suspense,{fallback:r.createElement(Be,null)},r.createElement(ct,{nested:!0,orgUnits:[S]}))),key:S,bordered:!0},b&&r.createElement(g.B,{onClick:V,width:"50px",fixed:!0,left:"50px"},o+1),r.createElement(g.B,{dataTest:"orgUnit-parent-table-column-cell",fixed:!0,left:b?"100px":"50px",width:"30%",onClick:V},r.createElement(T.m,{content:u.A.t("Drag to column headers to change layout")},r.createElement(je,{accept:[re.Kg.DATA_COLUMN]},r.createElement(He,{orgUnit:e})))),null===A||void 0===A?void 0:A.map(({id:t,dataHolders:a})=>null===a||void 0===a?void 0:a.map(({id:a,dataSources:n})=>null===N||void 0===N?void 0:N.map(l=>r.createElement(Ce,{key:`${t}-${a}-${l.id}`,dataEngine:i,orgUnit:e,dataSources:n,period:l})))),f&&r.createElement(w,{bold:!0,value:x}));return y===re.uL.ALL||y===re.uL.BELOW_AVERAGE&&n>x||y===re.uL.ABOVE_AVERAGE&&n<=x?_:null}function ze({orgUnits:e,dataSources:t,overallAverage:a,dataEngine:n,index:i}){var l,o;const{emptyRows:s,averageColumn:c,averageDisplayType:u,itemNumber:f}=(0,d.useRecoilValue)((0,h.NP)("options")),[b,E]=(0,r.useState)(!1),[R,x]=(0,r.useState)(),{filteredOrgUnits:U,childrenOrgUnits:S}=(0,d.useRecoilValue)((0,h.iH)(e)),A=null!==(l=(0,d.useRecoilValue)(h.Jv))&&void 0!==l?l:[];(0,r.useEffect)(()=>{const e=n.isDataSourcesRowEmpty(null===t||void 0===t?void 0:t.map(({id:e})=>e)).subscribe(E),a=n.getDataSourceAverage(null===t||void 0===t?void 0:t.map(({id:e})=>e)).subscribe(x);return()=>{e.unsubscribe(),a.unsubscribe()}},[t]);const T=r.createElement(p.J,{bordered:!0,className:m["average-row"]},r.createElement(g.B,{className:"jsx-1369417008",fixed:!0,left:"0",width:"50px"}),f&&r.createElement(g.B,{fixed:!0,left:"50px",width:"50px"},i+1),r.createElement(g.B,{fixed:!0,left:f?"100px":"50px",className:"scorecard-org-unit-cell"},r.createElement(je,{accept:[re.Kg.ORG_UNIT_COLUMN]},r.createElement(Ge,{label:(0,y.iS)(t),type:re.Kg.DATA_ROW}))),null===(o=[...U,...S])||void 0===o?void 0:o.map(e=>null===A||void 0===A?void 0:A.map(a=>{var i;return r.createElement("td",{className:"data-cell",align:"center",key:`${null===e||void 0===e?void 0:e.id}-${null===(i=(0,v.head)(t))||void 0===i?void 0:i.id}-${null===a||void 0===a?void 0:a.id}`},r.createElement(Ce,{dataEngine:n,orgUnit:e,dataSources:t,period:a}))})),c&&r.createElement(w,{dataSources:t,bold:!0,value:R}));return u===re.uL.ALL||u===re.uL.BELOW_AVERAGE&&a>R||u===re.uL.ABOVE_AVERAGE&&a<=R?(s||!b)&&T:null}function Ke({orgUnit:e,overallAverage:t,dataEngine:a,orgUnits:n,index:i}){var l,o;const{emptyRows:s,averageColumn:c,averageDisplayType:v,itemNumber:f}=(0,d.useRecoilValue)((0,h.NP)("options")),[y,b]=(0,r.useState)(!1),[E,R]=(0,r.useState)(),{id:x}=null!==e&&void 0!==e?e:{},{dataGroups:U}=null!==(l=(0,d.useRecoilValue)((0,h.NP)("dataSelection")))&&void 0!==l?l:{},S=(0,d.useRecoilValue)((0,h.Wn)(n)),A=null!==(o=(0,d.useRecoilValue)(h.Jv))&&void 0!==o?o:[];(0,r.useEffect)(function(){if(void 0!==S&&!S){const e=a.getOrgUnitAverage(x).subscribe(R),t=a.isRowEmpty(x).subscribe(b);return()=>{e.unsubscribe(),t.unsubscribe()}}},[e,S,x]);const O=(s||!y)&&r.createElement(p.J,{className:m["parent-table-row"],key:x,bordered:!0},r.createElement(g.B,{fixed:!0,left:"0",width:"50px"}),f&&r.createElement(g.B,{width:"50px",fixed:!0,left:"50px"},i+1),r.createElement(g.B,{dataTest:"orgUnit-parent-table-column-cell",fixed:!0,left:f?"100px":"50px",width:"30%",className:"scorecard-org-unit-cell parent-org-unit-cell"},r.createElement(T.m,{content:u.A.t("Drag to the column headers to change layout")},r.createElement(je,{accept:[re.Kg.DATA_COLUMN]},r.createElement(He,{orgUnit:e})))),null===U||void 0===U?void 0:U.map(({id:t,dataHolders:n})=>null===n||void 0===n?void 0:n.map(({id:n,dataSources:i})=>null===A||void 0===A?void 0:A.map(l=>r.createElement(Ce,{key:`${t}-${n}-${l.id}`,dataEngine:a,orgUnit:e,dataSources:i,period:l})))),c&&r.createElement(w,{bold:!0,value:E}));return v===re.uL.ALL||v===re.uL.BELOW_AVERAGE&&t>E||v===re.uL.ABOVE_AVERAGE&&t<=E?O:null}Ge.propTypes={label:l().string.isRequired,type:l().oneOf(Object.values(re.Kg)).isRequired,style:l().object},He.propTypes={orgUnit:l().object.isRequired},Je.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,index:l().number.isRequired,orgUnit:l().object.isRequired,orgUnits:l().array.isRequired,overallAverage:l().number.isRequired,onExpand:l().func.isRequired,expandedOrgUnit:l().string},ze.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,dataSources:l().arrayOf(l().object).isRequired,index:l().number.isRequired,orgUnits:l().arrayOf(l().object).isRequired,overallAverage:l().number.isRequired},Ke.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,index:l().number.isRequired,orgUnit:l().object.isRequired,orgUnits:l().array.isRequired,overallAverage:l().number.isRequired};var Qe=a(4147);function Ze(e,t,a){const{loading:n}=function(e,t,a){const[n,i]=(0,r.useState)(!1),l=(0,Qe.ow)(),o=(0,d.useSetRecoilState)((0,h.iH)(t)),s=(0,d.useRecoilValue)((0,h.NP)("orgUnitSearchKeyword")),{orgUnit:c}=(0,d.useRecoilValue)((0,h.ug)(t)),u=(0,d.useRecoilValue)((0,h.Qy)(t)),p=(0,d.useRecoilValue)(h.Jv),g=(0,d.useRecoilValue)(h.Qq),[m,f]=(0,r.useState)(),b=(0,d.useRecoilCallback)(({reset:e})=>()=>{e((0,h.iH)(t))});return(0,r.useEffect)(()=>{(0,v.isEmpty)(s)||a?b():(i(!0),async function(){const e=await(0,$e.Db)(s,l);o(t=>({...t,filteredOrgUnits:e,childrenOrgUnits:[]}))}().catch(e=>console.error(e)).finally(()=>i(!1)))},[s]),(0,r.useEffect)(()=>{u&&function(){if(g===re.t4.ORG_UNIT_VS_DATA){if("period"===u.type){var t;const[a,n]=null===(t=u.name)||void 0===t?void 0:t.split("-");e.sortOrgUnitsByDataAndPeriod({dataSource:a,period:n,sortType:null===u||void 0===u?void 0:u.direction}).subscribe(f)}if("data"===u.type){const t=null===u||void 0===u?void 0:u.name;e.sortOrgUnitsByData({dataSource:t,periods:null===p||void 0===p?void 0:p.map(({id:e})=>e),sortType:null===u||void 0===u?void 0:u.direction}).subscribe(f)}}}()},[c,u,g,e,p]),(0,r.useEffect)(()=>{(0,v.isEmpty)(m)&&c===re.hn.DEFAULT?b():(0,v.isEmpty)(m)&&!c||((0,v.isEmpty)(m)?o(({childrenOrgUnits:e,filteredOrgUnits:t})=>{const{parentOrgUnits:a,childOrgUnits:n}=(0,y.sq)({sort:c,childrenOrgUnits:e,filteredOrgUnits:t});return{filteredOrgUnits:a,childrenOrgUnits:n}}):o(({childrenOrgUnits:e,filteredOrgUnits:t})=>{const{parentOrgUnits:a,childOrgUnits:n}=(0,y.af)({orgUnitSort:m,childrenOrgUnits:e,filteredOrgUnits:t});return{filteredOrgUnits:a,childrenOrgUnits:n}}))},[m,c]),{loading:n}}(e,t,a),{loading:i}=function(e,t){const a=(0,d.useSetRecoilState)(h.T8),n=(0,d.useRecoilValue)((0,h.NP)("dataSearchKeyword")),{data:i}=(0,d.useRecoilValue)((0,h.ug)(t)),l=(0,d.useResetRecoilState)(h.T8),o=(0,d.useRecoilValue)((0,h.Qy)(t)),s=(0,d.useRecoilValue)(h.Jv),c=(0,d.useRecoilValue)(h.Qq);return(0,r.useEffect)(()=>{n?a(e=>(0,v.filter)(e,e=>{var t;return(0,v.flatten)(null===(t=e.dataSources)||void 0===t?void 0:t.map(({id:e,displayName:t})=>`${e}-${t}`)).join("_").toLowerCase().match(RegExp(n.toLowerCase()))})):l()},[n]),(0,r.useEffect)(()=>{i&&function t(){let n=[];if(!(0,v.isEmpty)(o)&&c===re.t4.DATA_VS_ORG_UNIT&&("orgUnit"===o.type&&e.sortDataSourceByOrgUnit({periods:null===s||void 0===s?void 0:s.map(({id:e})=>e),orgUnit:null===o||void 0===o?void 0:o.name,sortType:null===o||void 0===o?void 0:o.direction}).subscribe(e=>n=e),"period"===o.type)){const[t,a]=o.name.split("-");e.sortDataSourceByOrgUnitAndPeriod({period:a,orgUnit:t,sortType:null===o||void 0===o?void 0:o.direction}).subscribe(e=>n=e)}(0,v.isEmpty)(n)?a(e=>(0,y.J$)({sort:t,dataSources:e})):a(e=>(0,y.nZ)({dataSort:n,dataSources:e}))}()},[e,o,c,s,i]),{loading:!1}}(e,t);return function(e,t){const a=(0,d.useSetRecoilState)((0,h.Wn)(t));(0,r.useEffect)(()=>{const t=e.loading$.subscribe(a);return()=>{t.unsubscribe()}},[t,e])}(e,t),{loading:n||i}}function Ye({orgUnits:e,dataEngine:t,nested:a}){var n,i;const{loading:l}=Ze(t,e,a),[o,s]=(0,r.useState)(),u=(0,Qe.ow)(),{calendar:p}=(0,d.useRecoilValue)(h.SN),g=(0,d.useRecoilValue)(h.Qq),m=(0,d.useRecoilValue)(h.dw),{dataGroups:v}=null!==(n=(0,d.useRecoilValue)((0,h.NP)("dataSelection")))&&void 0!==n?n:{},{averageRow:f}=null!==(i=(0,d.useRecoilValue)((0,h.NP)("options")))&&void 0!==i?i:{},y=(0,d.useRecoilValue)(h.T8),b=(0,d.useRecoilValue)((0,h.Wn)(e)),E=(0,d.useRecoilValue)(h.Jv),{periodType:R}=(0,d.useRecoilValue)((0,h.NP)("periodSelection")),{childrenOrgUnits:w,filteredOrgUnits:x}=(0,d.useRecoilValue)((0,h.iH)(e)),U=(0,d.useRecoilValue)(h.j$),T=(0,d.useResetRecoilState)(h.j$),[O,N]=(0,r.useState)();return(0,r.useEffect)(()=>{var e;void 0===b||b||t.getOverallAverage(null===(e=[...w,...x])||void 0===e?void 0:e.map(({id:e})=>e)).subscribe(N)},[w,x,b]),(0,r.useEffect)(()=>(t.setDataQueryEngine(u).setDataGroups(v).setPeriods(E).setOrgUnits([...null!==x&&void 0!==x?x:[],...null!==w&&void 0!==w?w:[]]).setPeriodType(R).setCalendar(p).load(),()=>{T()}),[v,x,w,R,E,t,p]),(0,r.useEffect)(()=>{0!==U&&t.refresh()},[t,U]),l?r.createElement("div",null):r.createElement(c.B,null,r.createElement(r.Fragment,null,g===re.t4.ORG_UNIT_VS_DATA?r.createElement(r.Fragment,null,null===x||void 0===x?void 0:x.map((a,n)=>r.createElement(r.Fragment,null,r.createElement("div",{className:"page-break"}),a.level===m.level||function(e,t){return t.some(t=>t.level===e.level+1)}(a,w)?r.createElement(Ke,{index:n,dataEngine:t,key:`${null===a||void 0===a?void 0:a.id}-row`,orgUnit:a,overallAverage:O,orgUnits:e}):r.createElement(Je,{index:n,dataEngine:t,key:`${null===a||void 0===a?void 0:a.id}-row`,onExpand:s,orgUnit:a,expandedOrgUnit:o,overallAverage:O,orgUnits:e}))),null===w||void 0===w?void 0:w.map((a,n)=>a.level===m.level?r.createElement(r.Fragment,null,r.createElement("div",{className:"page-break"}),r.createElement(Ke,{index:n+1,dataEngine:t,key:`${null===a||void 0===a?void 0:a.id}-row`,orgUnit:a,overallAverage:O,orgUnits:e})):r.createElement(r.Fragment,null,r.createElement("div",{className:"page-break"}),r.createElement(Je,{index:n+1,dataEngine:t,key:`${null===a||void 0===a?void 0:a.id}-row`,onExpand:s,orgUnit:a,expandedOrgUnit:o,overallAverage:O,orgUnits:e})))):null===y||void 0===y?void 0:y.map(({id:a,dataSources:n},i)=>r.createElement(r.Fragment,null,r.createElement("div",{className:"page-break"}),r.createElement(ze,{index:i,dataEngine:t,orgUnits:e,dataSources:n,key:`${a}-row`,overallAverage:O}))),f&&(g===re.t4.ORG_UNIT_VS_DATA?r.createElement(r.Fragment,null,r.createElement("div",{className:"page-break"}),r.createElement(S,{dataEngine:t,orgUnits:e,overallAverage:O})):r.createElement(r.Fragment,null,r.createElement("div",{className:"page-break"}),r.createElement(A,{dataEngine:t,orgUnits:e,overallAverage:O})))))}Ye.propTypes={dataEngine:l().instanceOf(x.v5).isRequired,orgUnits:l().arrayOf(l().object).isRequired};var Xe=a(43427),et=a(98138),tt=a(19660);function at({orgUnits:e,nested:t}){var a;const[n,i]=(0,d.useRecoilState)((0,h.NP)("orgUnitSearchKeyword")),[l,o]=(0,r.useState)(n),{itemNumber:s}=null!==(a=(0,d.useRecoilValue)((0,h.NP)("options")))&&void 0!==a?a:{},[c,p]=(0,d.useRecoilState)((0,h.ug)(e)),f=(0,r.useRef)((0,v.debounce)(i,1e3,{trailing:!0,leading:!1}));return(0,r.useEffect)(()=>{f.current(l)},[l]),r.createElement(r.Fragment,null,r.createElement(g.B,{rowSpan:"3",fixed:!0,left:"0",width:"50px"}),s&&r.createElement(g.B,{rowSpan:"3",fixed:!0,left:"50px",width:"50px"}),r.createElement(et.w,{align:"center",name:"orgUnit",onSortIconClick:({direction:e})=>{p(t=>({...t,orgUnit:e}))},sortDirection:null===c||void 0===c?void 0:c.orgUnit,fixed:!0,top:"0",left:s?"100px":"50px",bordered:!0,width:"200px",className:m["org-unit-header-cell"],rowSpan:"3"},!t&&r.createElement(tt.F,{dataTest:"org-unit-search",className:"print-hide w-100 org-unit-search",value:l,onChange:({value:e})=>o(e),placeholder:u.A.t("Search Organisation Unit")}),r.createElement("h4",{className:"print-show hide"},u.A.t("Organisation Unit(s)"))))}function nt({nested:e,orgUnits:t}){var a,n,i;const{dataGroups:l}=null!==(a=(0,d.useRecoilValue)((0,h.NP)("dataSelection")))&&void 0!==a?a:{},{averageColumn:o}=null!==(n=(0,d.useRecoilValue)((0,h.NP)("options")))&&void 0!==n?n:{},s=null!==(i=(0,d.useRecoilValue)(h.Jv))&&void 0!==i?i:[];return!(1===l.length)&&r.createElement(p.J,{className:m["table-header-row"]},r.createElement(at,{orgUnits:t,nested:e}),null===l||void 0===l?void 0:l.map(({title:e,id:t,dataHolders:a},n)=>{var i,l,o,d;return r.createElement(g.B,{fixed:!0,className:"scorecard-table-header header",align:"center",bordered:!0,width:(null!==(i=null===a||void 0===a?void 0:a.length)&&void 0!==i?i:1)*(null!==(l=null===s||void 0===s?void 0:s.length)&&void 0!==l?l:1)*re.sK.CELL_WIDTH+"px",top:"0",colSpan:""+(null!==(o=null===a||void 0===a?void 0:a.length)&&void 0!==o?o:1)*(null!==(d=null===s||void 0===s?void 0:s.length)&&void 0!==d?d:1),key:t},e)}),o&&r.createElement(g.B,{width:`${re.sK.CELL_WIDTH}px`,fixed:!0,align:"center",bordered:!0,className:"scorecard-table-header header",rowSpan:"3"},u.A.t("Average")))}function it({orgUnits:e,nested:t}){var a,n,i;const{dataGroups:l}=null!==(a=(0,d.useRecoilValue)((0,h.NP)("dataSelection")))&&void 0!==a?a:{},[{name:o,direction:s},c]=(0,d.useRecoilState)((0,h.Qy)(e)),{averageColumn:f}=null!==(n=(0,d.useRecoilValue)((0,h.NP)("options")))&&void 0!==n?n:{},b=null!==(i=(0,d.useRecoilValue)(h.Jv))&&void 0!==i?i:[],E=e=>{c({...e,type:"data"})},R=1===l.length;return r.createElement(p.J,{className:m["table-header-row"]},R&&r.createElement(at,{nested:t,orgUnits:e}),null===l||void 0===l?void 0:l.map(({dataHolders:e})=>null===e||void 0===e?void 0:e.map(({id:e,dataSources:t},a)=>{var n,i;return r.createElement(et.w,{onSortIconClick:E,sortDirection:o===`${null===(n=(0,v.head)(t))||void 0===n?void 0:n.id}`?s:"default",className:m["holder-header-cell"],dataTest:"indicator-table-header-cell",width:(null===b||void 0===b?void 0:b.length)*re.sK.CELL_WIDTH+"px",top:"0",fixed:!0,colSpan:`${null===b||void 0===b?void 0:b.length}`,bordered:!0,align:"center",key:`${e}-column-header`,name:`${null===(i=(0,v.head)(t))||void 0===i?void 0:i.id}`},r.createElement("div",{style:{height:"100%",width:"100%"}},r.createElement(T.m,{className:"m-auto",content:u.A.t("Drag to row headers to change layout")},r.createElement(je,{accept:[re.Kg.ORG_UNIT_ROW]},r.createElement(Ge,{label:(0,y.iS)(t),type:re.Kg.DATA_COLUMN})))))})),f&&R?r.createElement(g.B,{width:`${re.sK.CELL_WIDTH}px`,fixed:!0,align:"center",bordered:!0,className:"scorecard-table-header header",rowSpan:"3"},u.A.t("Average")):null)}function lt({orgUnits:e,nested:t}){var a,n;const{averageColumn:i,itemNumber:l}=(0,d.useRecoilValue)((0,h.NP)("options")),{filteredOrgUnits:o,childrenOrgUnits:s}=(0,d.useRecoilValue)((0,h.iH)(e)),c=null!==(a=(0,d.useRecoilValue)(h.Jv))&&void 0!==a?a:[],[f,y]=(0,d.useRecoilState)((0,h.NP)("dataSearchKeyword")),[b,E]=(0,r.useState)(f),[R,w]=(0,d.useRecoilState)((0,h.ug)(e)),[{name:x,direction:U},S]=(0,d.useRecoilState)((0,h.Qy)(e)),A=(0,r.useRef)((0,v.debounce)(y,1e3,{trailing:!0,leading:!1})),{nameColumnWidth:O}=(0,d.useRecoilValue)((0,h.Mj)(e));(0,r.useEffect)(()=>{A.current(b)},[b]);const N=e=>{S({...e,type:"orgUnit"})};return r.createElement(p.J,{className:m["table-header-row"]},r.createElement(g.B,{rowSpan:"2",fixed:!0,left:"0",width:"50px"}),l&&r.createElement(g.B,{rowSpan:"2",fixed:!0,left:"50px",width:"50px"}),r.createElement(et.w,{onSortIconClick:({direction:e})=>{w(t=>({...t,data:e}))},sortDirection:null===R||void 0===R?void 0:R.data,align:"center",fixed:!0,top:"0",left:l?"100px":"50px",width:O,bordered:!0,className:m["org-unit-header-cell"],rowSpan:"2"},!t&&r.createElement(tt.F,{className:"print-hide w-100 data-search",value:b,onChange:({value:e})=>E(e),placeholder:u.A.t("Search Data")}),r.createElement("h3",{className:"print-show hide"},u.A.t("Data"))),null===(n=[...o,...s])||void 0===n?void 0:n.map(({displayName:e,id:t})=>{var a;return r.createElement(et.w,{name:`${t}`,sortDirection:x===t?U:"default",onSortIconClick:N,fixed:!0,className:m["data-header-cell"],align:"center",bordered:!0,width:(null===c||void 0===c?void 0:c.length)*re.sK.CELL_WIDTH+"px",colSpan:`${null!==(a=null===c||void 0===c?void 0:c.length)&&void 0!==a?a:1}`,key:t},r.createElement("div",{style:{height:"100%",width:"100%"}},r.createElement(T.m,{className:"m-auto",content:u.A.t("Drag to row headers to change layout ")},r.createElement(je,{accept:[re.Kg.DATA_ROW]},r.createElement(Ge,{label:e,type:re.Kg.ORG_UNIT_COLUMN})))))}),i&&r.createElement(g.B,{width:`${re.sK.CELL_WIDTH}px`,fixed:!0,align:"center",bordered:!0,className:m["data-header-cell"],rowSpan:"2"},u.A.t("Average")))}function rt({orgUnits:e}){var t,a,n,i;const{dataGroups:l}=null!==(t=(0,d.useRecoilValue)((0,h.NP)("dataSelection")))&&void 0!==t?t:{},{filteredOrgUnits:o,childrenOrgUnits:s}=null!==(a=(0,d.useRecoilValue)((0,h.iH)(e)))&&void 0!==a?a:{},c=(0,d.useRecoilValue)(h.Qq),u=null!==(n=(0,d.useRecoilValue)(h.Jv))&&void 0!==n?n:[],[{name:g,direction:f},y]=(0,d.useRecoilState)((0,h.Qy)(e)),b=e=>{y({...e,type:"period"})};return u.length>1?r.createElement(p.J,null,c===re.t4.ORG_UNIT_VS_DATA?null===l||void 0===l?void 0:l.map(({dataHolders:e})=>null===e||void 0===e?void 0:e.map(({id:e,dataSources:t})=>null===u||void 0===u?void 0:u.map(({name:a,id:n})=>{var i,l;return r.createElement(et.w,{dataTest:"test-period-table-scorecard",fixed:!0,top:"0",onSortIconClick:b,sortDirection:g===`${null===(i=(0,v.head)(t))||void 0===i?void 0:i.id}-${n}`?f:"default",width:"100px",bordered:!0,align:"center",key:`${e}-${n}`,className:m["period-header-cell"],name:`${null===(l=(0,v.head)(t))||void 0===l?void 0:l.id}-${n}`},a)}))):null===(i=[...o,...s])||void 0===i?void 0:i.map(({id:e})=>null===u||void 0===u?void 0:u.map(({name:t,id:a})=>r.createElement(et.w,{dataTest:"test-period-table-scorecard",fixed:!0,top:"0",onSortIconClick:b,sortDirection:g===`${e}-${a}`?f:"default",width:"100px",bordered:!0,align:"center",key:`${e}-${a}`,className:"scorecard-table-cell header",name:`${e}-${a}`},t)))):null}function ot(e){switch(e){case"groups":return nt;case"data":return it;case"periods":return rt;case"orgUnits":return lt;default:return null}}function st({orgUnits:e,nested:t}){const{columns:a}=(0,d.useRecoilValue)((0,h.Mj)(e)),n=(0,r.useMemo)(()=>null===a||void 0===a?void 0:a.map(ot),[a]);return r.createElement(Xe.n,null,null===n||void 0===n?void 0:n.map((n,i)=>r.createElement(n,{orgUnits:e,nested:t,key:`${a[i]}-header-row`})))}function dt({orgUnits:e}){const{nameColumnWidth:t}=(0,d.useRecoilValue)((0,h.Mj)(e));return r.createElement("colgroup",null,r.createElement("col",{width:"50px"}),r.createElement("col",{width:"50px"}),r.createElement("col",{width:`${t}`}))}function ct({orgUnits:e,nested:t,initialDataEngine:a}){const i=(0,r.useMemo)(()=>null!==a&&void 0!==a?a:new x.v5,[a]),{width:l}=(0,d.useRecoilValue)(h.jZ),{tableWidth:c}=(0,d.useRecoilValue)((0,h.Mj)(e)),u=(0,d.useRecoilCallback)(({reset:t})=>()=>{t((0,h.Wn)(e)),i.reset(!0)});return(0,r.useEffect)(()=>()=>{u()},[]),r.createElement("div",{className:"w-100 pb-32 flex-1 print-area scorecard-table overflow-hidden"},r.createElement(o.Q,{backend:s.t2},r.createElement(n.b,{className:m["table-print"],layout:"fixed",scrollWidth:null!==c&&void 0!==c?c:l},r.createElement(dt,{orgUnits:e}),r.createElement(st,{width:l,orgUnits:e,nested:t}),r.createElement(Ie,{orgUnits:e,dataEngine:i}),r.createElement(r.Suspense,{fallback:r.createElement(Be,{orgUnits:e})},r.createElement(Ye,{dataEngine:i,orgUnits:e})))))}at.propTypes={nested:l().bool,orgUnits:l().array},nt.propTypes={nested:l().bool.isRequired,orgUnits:l().array.isRequired},it.propTypes={nested:l().bool,orgUnits:l().array},lt.propTypes={nested:l().bool.isRequired,orgUnits:l().arrayOf(l().object).isRequired},rt.propTypes={orgUnits:l().arrayOf(l().object).isRequired},st.propTypes={nested:l().bool.isRequired,orgUnits:l().arrayOf(l().object).isRequired},ct.propTypes={nested:l().bool.isRequired,orgUnits:l().arrayOf(l().object).isRequired,initialDataEngine:l().instanceOf(x.v5)}},21373:function(e,t,a){a.d(t,{W:function(){return l}});var n=a(65298),i=a(65859);const l=(0,n.atom)({key:"cell-analysis-layout",default:i.zR})},22659:function(e,t,a){a.d(t,{_:function(){return c},v:function(){return u}});var n=a(96464),i=a(59541),l=a(65298),r=a(73459),o=a(24838),s=a(84161),d=a(31594);const c=(0,l.selector)({key:"cell-analysis-data",get:async({get:e})=>{const{orgUnits:t}=e(r.kg),a=e(o.nD),l=e(u),c=e(s.Se);if(!(0,i.isEmpty)(t)&&!(0,i.isEmpty)(a)&&!(0,i.isEmpty)(l)){const e=l[0];return"customFunction"===e.type?new n.AnalyticsResult(await(0,d.ac)(c,{functions:[e.id],orgUnits:t.map(({id:e})=>e),periods:null===a||void 0===a?void 0:a.map(({id:e})=>e)})):await(new n.Fn.Analytics).setDimension("ou",`${t.map(({id:e})=>e).join(";")}`).setPeriod(null===a||void 0===a||null===(p=a.map(({id:e})=>e))||void 0===p?void 0:p.join(";")).setData(null===l||void 0===l||null===(g=l.map(({id:e})=>e))||void 0===g?void 0:g.join(";")).get();var p,g}}}),u=(0,l.atom)({key:"cell-analysis-data-source",default:[]})},24838:function(e,t,a){a.d(t,{Un:function(){return d},fz:function(){return o},nD:function(){return c},w$:function(){return s}});var n=a(2793),i=a(59541),l=a(65298),r=a(84161);const o=(0,l.atom)({key:"cell-analysis-period-state",default:(0,l.selector)({key:"cell-analysis-period-selector",get:({get:e})=>e((0,r.NP)("periodSelection"))})}),s=(0,l.atom)({key:"cell-period-option-state",default:[]}),d=(0,l.selector)({key:"cell-period-option-selector",get:({get:e})=>e(s),set:({set:e},t)=>{e(s,t)},reset:({reset:e})=>{e(s)}}),c=(0,l.selector)({key:"cell-analysis-period-resolver",get:({get:e})=>{var t;const{periods:a}=null!==(t=e(o))&&void 0!==t?t:{};if(!(0,i.isEmpty)(a)){const t=(0,i.filter)(e(s).length>0?e(s):a,({id:e})=>{var t;const a=(new n.aA).setPreferences({allowFuturePeriods:!0}).getById(e);return null===a||void 0===a||null===(t=a.type)||void 0===t?void 0:t.match(RegExp("Relative"))});let l=[...(0,i.differenceBy)(a,t,"id")];l=e(s).length>0?[...(0,i.differenceBy)(t,"id")]:[...(0,i.differenceBy)(a,t,"id")];for(const e of t){const t=(new n.aA).setPreferences({allowFuturePeriods:!0}).getById(null===e||void 0===e?void 0:e.id),a=(0,i.isArray)(null===t||void 0===t?void 0:t.iso)?null===t||void 0===t?void 0:t.iso:[null===t||void 0===t?void 0:t.iso];l=l.concat(a)}return(0,i.uniqBy)((0,i.compact)(l),"id")}return[]}})},73459:function(e,t,a){a.d(t,{AJ:function(){return r},Zf:function(){return o},ar:function(){return s},kg:function(){return d}});var n=a(59541),i=a(65298),l=a(84161);const r=(0,i.atom)({key:"cell-analysis-orgUnit-state",default:(0,i.selector)({key:"cell-analysis-orgUnit-selector",get:({get:e})=>e((0,l.NP)("orgUnitSelection"))})}),o=(0,i.atom)({key:"orgUnitOptionCell",default:!1}),s=(0,i.selector)({key:"orgUnitOptionCellSelector",get:({get:e})=>e(o),set:({set:e},t)=>{e(o,t)}}),d=(0,i.selector)({key:"cell-analysis-initial-org-units-resolver",get:async({get:e})=>{var t,a;const{orgUnits:i,levels:o,groups:s,userOrgUnit:d,userSubUnit:c,userSubX2Unit:u}=e(r),p=null!==(t=e(l.Jv))&&void 0!==t?t:[],g=null!==(a=e(l.T8))&&void 0!==a?a:[],{organisationUnits:m}=e(l.bM),v=e(l.cT);let f=i;if(!(0,n.isEmpty)(g)&&!(0,n.isEmpty)(p)){var h,y;if(u&&(f=[...f,{id:"USER_ORGUNIT_GRANDCHILDREN"}]),c&&(f=[...f,{id:"USER_ORGUNIT_CHILDREN"}]),d&&(f=[...f,...m]),!(0,n.isEmpty)(o))f=[...f,...null!==(h=null===o||void 0===o?void 0:o.map(e=>{var t;return{id:`LEVEL-${null===(t=(0,n.find)(v,{id:e}))||void 0===t?void 0:t.level}`}}))&&void 0!==h?h:[]];if(!(0,n.isEmpty)(s))f=[...f,...null!==(y=null===s||void 0===s?void 0:s.map(e=>({id:`OU_GROUP-${e}`})))&&void 0!==y?y:[]]}return{orgUnits:(0,n.uniqBy)(f,"id")}}})}}]);
//# sourceMappingURL=7386.5655774e.chunk.js.map